<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <style>
      html, body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: calc(100vh - 120px); /* Resta 10px arriba y 10px abajo */
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #f0f0f0;
    margin-top: 10px;
}

        #pdf-container {
    width: 100vw;
    height: calc(100vh - 120px); /* Resta 10px arriba y 10px abajo */
    margin: 10px 0; /* MÃ¡rgenes solo arriba y abajo */
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    background: white; /* Asegura contraste si es necesario */
    margin-top: 10px;
}

        canvas {
            width: 100vw;
             height: calc(100vh - 120px); /* Resta 10px arriba y 10px abajo */
             margin-top: 10px;
            
        }
        .nav-button {
    position: fixed; /* Cambio de absolute a fixed */
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.2);
    border: none;
    color: rgb(195, 34, 34) !important;
    font-size: 30px;
    padding: 10px;
    cursor: pointer;
    border-radius: 10%;
    display: flex;
    justify-content: center;
    width: 25px;
    align-items: center;
    transition: background 0.3s, opacity 0.3s;
    opacity: 1.6;
    z-index: 1000; /* Asegura que estÃ©n sobre el canvas */
}

        .nav-button:hover {
            background: rgba(0, 0, 0, 0.4);
            opacity: 2;
        }
        #prev-page {
            left: 5px;
            
        }
        #next-page {
            right: 5px;
            
        }

 #fullscreen-button, #home-button, #play-pause-button {
    position: absolute;
    top: 0;   
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    transition: background 0.3s;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
}

        #fullscreen-button {
            right: 60px;
            background: #3498db;
        }
        #fullscreen-button:hover {
            background: #2980b9;
        }
        #home-button {
            right: 15px;
            background: #e74c3c;
        }
        #home-button:hover {
            background: #c0392b;
        }

 #play-pause-button {
    right: 110px;
    background: #2ecc71;
    top: 0;   
}
#play-pause-button:hover {
    background: #27ae60;
}


@media (max-width: 500px) {
    html, body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
      
        
    }

    #pdf-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        padding: 0;
        margin: 0;
    }

    canvas {
        width: 100vw !important;  /* ðŸ”¥ Ocupar TODO el ancho */
        height: calc(100vh - 110px) !important; /* ðŸ”¥ Reducir 20px para margen */
        max-width: 100vw;
        max-height: calc(100vh - 110px);
        object-fit: fill !important; /* ðŸ”¥ Asegurar que cubra todo el espacio */
        display: block;
        margin-top: 10px;  /* ðŸ”¥ Agregar margen superior */
        margin-bottom: 100px; /* ðŸ”¥ Agregar margen inferior */
    }

    /* ðŸ”¥ Ocultamos la segunda pÃ¡gina */
    #pdf-render-2 {
        display: none !important;
    }
}






@media (min-width: 501px) and (max-width: 700px) {
    html, body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #pdf-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        padding: 0;
        margin: 0;
    }

    canvas {
        width: 95vw !important; /* ðŸ”¥ Aumentamos el ancho para ocupar mÃ¡s espacio */
        height: auto !important; /* ðŸ”¥ Mantiene la proporciÃ³n automÃ¡tica */
        max-height: 100vh;
        display: block;
        object-fit: contain;
    }

    /* ðŸ”¥ Ocultamos la segunda pÃ¡gina para mostrar solo una */
    #pdf-render-2 {
        display: none !important;
    }
}


@media (min-width: 701px) and (max-width: 1000px) {
    html, body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #pdf-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        padding: 0;
        margin: 0;
    }

    canvas {
        width: 70vw !important; /* ðŸ”¥ Ocupar TODO el ancho disponible */
        height: 100vh !important; /* ðŸ”¥ Ocupar TODO el alto disponible */
        max-width: 100vw !important;
        max-height: 100vh !important;
        display: block;
        object-fit: fill; /* ðŸ”¥ Esto harÃ¡ que el PDF rellene completamente el espacio */
    }

    /* ðŸ”¥ Ocultamos la segunda pÃ¡gina */
    #pdf-render-2 {
        display: none !important;
    }
}




@media (min-width: 1001px) {
    html, body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #pdf-container {
        display: flex;
        flex-direction: row; /* Dos pÃ¡ginas lado a lado */
        justify-content: space-between; /* Asegura que no haya espacio entre pÃ¡ginas */
        align-items: center;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        padding: 0;
        margin: 0;
    }

    canvas {
        width: 50vw; /* ðŸ”¥ Ahora cada pÃ¡gina ocupa el 50% exacto del ancho */
        height: 100vh; /* ðŸ”¥ Ocupa el 100% del alto */
        max-height: 100vh;
        margin: 0;
        display: block;
    }
}






@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}

.shake {
    animation: shake 0.3s ease-in-out;
}

@keyframes flipPage {
    0% {
        transform: rotateY(0deg);
        opacity: 1;
    }
    50% {
        transform: rotateY(-90deg);
        opacity: 0.5;
    }
    100% {
        transform: rotateY(0deg);
        opacity: 1;
    }
}

.page-flip {
    animation: flipPage 0.6s ease-in-out;
    transform-origin: center;
    perspective: 1000px;
}

#auto-read-button {
    position: absolute;
    top: 0;   
    right: 160px; /* Ubicado a la izquierda del botÃ³n play-pause */
    background: #f1c40f;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    transition: background 0.3s;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
}
#auto-read-button:hover {
    background: #f39c12;
}

#volume-button {
    position: absolute;
    top: 0;   
    right: 210px; /* Ajuste para que estÃ© alineado con otros botones */
    background: #9b59b6;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    transition: background 0.3s;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
}

#volume-button:hover {
    background: #8e44ad;
}

#volume-slider {
    position: absolute;
    top: 45px;
    left: 120px;
    width: 100px;
    display: none;
    transition: opacity 0.3s;
}
#page-selector {
    position: absolute;
    top: 0px;
    right: 260px; /* Ajustado para estar a la izquierda del icono de volumen */
    background: transparent;
    padding: 3px 5px;
    height: 40px;
    display: flex;
    align-items: center;    
}

#page-input {
    width: 50px;
    height: 30px;
    border: none;
    padding: 3px;
    text-align: center;
    border-radius: 5px;
    font-size: 16px;
}

#go-to-page {
    background: #df1aa1;

    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
    color: white;
    font-size: 18px;
    margin-left: 5px;
    width: 40px;
    height: 40px;
}

#go-to-page:hover {
    background:  #b62a8a;
}

        /* MenÃº lateral */
        #button-slider {
            position: fixed;
            top: 20px;
            left: -400px;
            width: 400px;
            height: 40px;
            background: rgba(191, 186, 186, 0.8);
            padding: 20px;
            display: flex;
            flex-direction: row;
            gap: 15px;
            transition: transform 0.3s ease-in-out;
            align-items: center;
            text-align: center;
            margin-left: 10px;
            
        }
        .button-container {
            display: flex;
            flex-direction: row;
            gap: 15px;
            margin-left: 20px;   
          
          
        }
        .slider-toggle {
            position: fixed;
            top: 20px;
            left: 10px;
            background: #8234db;
            border: none;
            height: 40px;
            width: 30px;
            cursor: pointer;
            border-radius: 5px;
            color: white !important; /* ðŸ”¥ Asegura que el color del texto sea siempre blanco */
            font-size: 18px;  
            font-weight: bold;
        }
 #tutorial-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: flex-start; /* ðŸ”¥ Alinea el tutorial arriba */
    flex-direction: column;
    color: white;
    font-size: 20px;
    z-index: 2000;
    padding-top: 80px; /* ðŸ”¥ Ajusta para que no tape el menÃº */
}

.tutorial-content {
    position: absolute;
    top: -50px; /* ðŸ”¥ Ajusta esta altura para que el dedo estÃ© debajo del menÃº */
    left: -50px;
    background: rgba(64, 62, 62, 0.9);
    height: 300px;
    width: 300px;
    border-radius: 200px;
    text-align: center;
}

/* AnimaciÃ³n del dedo ðŸ‘† */
.hand-animation {
    font-size: 30px;
    animation: bounce 1s infinite alternate ease-in-out;
    position: absolute;
    top: 140px; /* ðŸ”¥ Ajusta para que estÃ© justo debajo del menÃº */
    left: 55px;
    transform: translateX(-50%);
}

/* Resaltar el botÃ³n del menÃº */
#slider-toggle {
    position: fixed;
    top: 20px;
    left: 0px;
    z-index: 2100;
   
}

/* Efecto de parpadeo en el menÃº */
@keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    }
    100% {
        transform: scale(1.2);
        box-shadow: 0 0 20px rgba(255, 255, 255, 1);
    }
}

/* Efecto de rebote para el dedo ðŸ‘† */
@keyframes bounce {
    0% {
        transform: translateY(0);
    }
    100% {
        transform: translateY(-15px);
    }
}

/* BotÃ³n de "Entendido" */
#tutorial-close {
    background: #39db34;
    border: none;
    padding: 9px 9px;
    cursor: pointer;
    border-radius: 20px;
    color: white;
    font-size: 12px;
    margin-top: 0px;
    margin-left: 80px;
}

#tutorial-close:hover {
    background: #227c06;
}


    </style>
</head>
<body>
    <div id="pdf-container">
        <button id="prev-page" class="nav-button">
            <i class="fas fa-chevron-left"></i>
        </button>
        <canvas id="pdf-render"></canvas>
        <canvas id="pdf-render-2"></canvas> <!-- Segundo canvas para la segunda pÃ¡gina -->

        <button id="next-page" class="nav-button">
            <i class="fas fa-chevron-right"></i>
        </button>

             
        <div id="button-slider">
            <div class="button-container">
                <button id="fullscreen-button"><i class="fas fa-expand"></i></button>
                <button id="play-pause-button" class="slider-button"><i class="fas fa-play"></i></button>
                <button id="auto-read-button" class="slider-button"><i class="fas fa-book-reader"></i></button>
                <button id="volume-button" class="slider-button"><i class="fas fa-volume-up"></i></button>
                 <input id="volume-slider" type="range" min="0" max="1" step="0.1" value="1">
                <button id="home-button" onclick="window.location.href='https://fawzinoo.github.io/Rep/Vocabulario.html'"><i class="fas fa-home"></i></button>                
                <div id="page-selector">
                    <input id="page-input" type="number" min="1" placeholder="--" />
                    <button id="go-to-page"><i class="fas fa-search"></i></button>
                </div>
            </div>    
        </div>
        <button id="slider-toggle" class="slider-toggle">â˜°</button>
    

        <audio id="pageAudio1">
            <source id="audioSource1" src="https://fawzinoo.github.io/audios/page1.mp3" type="audio/mp3">
        </audio>
        
        <audio id="pageAudio2">
            <source id="audioSource2" src="https://fawzinoo.github.io/audios/page2.mp3" type="audio/mp3">
        </audio>
        <audio id="pageAudio3">
            <source id="audioSource3" src="https://fawzinoo.github.io/audios/page3.mp3" type="audio/mp3">
        </audio>

        <audio id="pageAudio4">
            <source id="audioSource4" src="https://fawzinoo.github.io/audios/page4.mp3" type="audio/mp3">
        </audio>

        <audio id="pageAudio5">
            <source id="audioSource4" src="https://fawzinoo.github.io/audios/page5.mp3" type="audio/mp3">
        </audio>

        <audio id="pageAudio6">
            <source id="audioSource4" src="https://fawzinoo.github.io/audios/page6.mp3" type="audio/mp3">
        </audio>

        <audio id="pageAudio7">
            <source id="audioSource4" src="https://fawzinoo.github.io/audios/page7.mp3" type="audio/mp3">
        </audio>

        <audio id="pageAudio8">
            <source id="audioSource4" src="https://fawzinoo.github.io/audios/page8.mp3" type="audio/mp3">
        </audio>

        <audio id="pageAudio9">
            <source id="audioSource4" src="https://fawzinoo.github.io/audios/page9.mp3" type="audio/mp3">
        </audio>

        <audio id="pageSound">
            <source src="https://www.fesliyanstudios.com/play-mp3/387" type="audio/mp3">
        </audio>     


        <audio id="pageAudio">
            <source id="audioSource" src="" type="audio/mp3">
        </audio>
        
      <!-- ðŸ”¥ Solo se genera si el usuario NO lo ha visto antes -->
<div id="tutorial-overlay" style="display: none;">
    <div class="tutorial-content">
        <div class="hand-animation">ðŸ‘†</div>
        <p style="margin-top: 140px;font-size: 14px;margin-left: 60px;">
            Â¡Toca aquÃ­ para abrir el menÃº!
        </p>
        <button id="tutorial-close">Â¡De acuerdo!</button>
    </div>
</div>

        
    </div>
    <script>
const url = 'https://fawzinoo.github.io/Fotos/barcelona.pdf';
let pdfDoc = null, pageNum = 1;
let isPlaying = false;
let isAutoReading = false;
const canvas = document.getElementById('pdf-render');
const ctx = canvas.getContext('2d');
const prevPageBtn = document.getElementById("prev-page");
const nextPageBtn = document.getElementById("next-page");
const fullscreenBtn = document.getElementById("fullscreen-button");
const fullscreenIcon = fullscreenBtn.querySelector("i");
const playPauseButton = document.getElementById("play-pause-button");
const playPauseIcon = playPauseButton?.querySelector("i");
const autoReadButton = document.getElementById("auto-read-button");
const autoReadIcon = autoReadButton?.querySelector("i");

if (typeof pdfjsLib === 'undefined') {
    console.error("pdf.js no se cargÃ³ correctamente");
} else {
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js";
}

// Variables para gestos tÃ¡ctiles
let touchStartX = 0;
let touchEndX = 0;
const swipeThreshold = 50;
const pdfContainer = document.getElementById("pdf-container");

pdfContainer.addEventListener("touchstart", (e) => {
    touchStartX = e.touches[0].clientX;
});

pdfContainer.addEventListener("touchend", (e) => {
    touchEndX = e.changedTouches[0].clientX;
    handleSwipe();
});

function handleSwipe() {
    if (touchStartX - touchEndX > swipeThreshold && pageNum < pdfDoc.numPages) {
        pageNum++;
        renderPage(pageNum);
    } else if (touchEndX - touchStartX > swipeThreshold && pageNum > 1) {
        pageNum--;
        renderPage(pageNum);
    }

    // ðŸ”¥ Asegurar que el input de la pÃ¡gina se actualiza
    const pageInput = document.getElementById("page-input");
    if (pageInput) {
        pageInput.value = pageNum;
    }
}


// Sonido al pasar pÃ¡gina
function playPageSound() {
    const pageSound = document.getElementById("pageSound");
    if (pageSound) {
        pageSound.currentTime = 0;
        pageSound.play();
    }
}



function renderPage(num) {
    if (!pdfDoc) return;

    const isMobile = window.innerWidth <= 500; // ðŸ“± Detecta si es un mÃ³vil
    const isTablet = window.innerWidth > 500 && window.innerWidth <= 1000; // ðŸ“² Detecta si es una tablet
    const isTwoPages = window.innerWidth > 1000; // ðŸ–¥ï¸ Detecta si hay dos pÃ¡ginas en pantalla

    // ðŸ”¥ Ajustamos la escala dependiendo del dispositivo
    const scale = isTwoPages ? 2.5 : isTablet ? 3.5 : 4.5; // ðŸ“ Ajuste de escala

    playPageSound(); // ðŸŽµ Reproduce sonido al pasar pÃ¡gina

    // Actualizar el nÃºmero en el input del selector de pÃ¡gina
    const pageInput = document.getElementById("page-input");
    if (pageInput) {
        pageInput.value = num; // ðŸ”¥ Actualiza el input con la pÃ¡gina actual
    }

    // Renderiza la primera pÃ¡gina
    pdfDoc.getPage(num).then(page => {
        const viewport = page.getViewport({ scale });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const renderContext = { canvasContext: ctx, viewport: viewport };
        page.render(renderContext);
    });

    // ðŸ”Š **Actualizar los audios segÃºn la pÃ¡gina actual**
    const audio1 = document.getElementById("pageAudio1");
    const audioSource1 = document.getElementById("audioSource1");
    audioSource1.src = `https://fawzinoo.github.io/audios/page${num}.mp3`;
    audio1.load();

    if (isTwoPages && num + 1 <= pdfDoc.numPages) {
        const audio2 = document.getElementById("pageAudio2");
        const audioSource2 = document.getElementById("audioSource2");
        audioSource2.src = `https://fawzinoo.github.io/audios/page${num + 1}.mp3`;
        audio2.load();
    }

    // Renderiza la segunda pÃ¡gina si hay espacio para dos
    const canvas2 = document.getElementById('pdf-render-2');
    const ctx2 = canvas2.getContext('2d');

    if (isTwoPages && num + 1 <= pdfDoc.numPages) {
        pdfDoc.getPage(num + 1).then(page => {
            const viewport = page.getViewport({ scale });

            canvas2.width = viewport.width;
            canvas2.height = viewport.height;

            const renderContext = { canvasContext: ctx2, viewport: viewport };
            page.render(renderContext);
        });
    } else {
        // âŒ Ocultar la segunda pÃ¡gina en mÃ³viles y tablets
        canvas2.style.display = isTwoPages ? "block" : "none"; 

        // Rellenar el segundo canvas con gris si es necesario
        canvas2.width = canvas.width;
        canvas2.height = canvas.height;
        ctx2.fillStyle = "#ccc";
        ctx2.fillRect(0, 0, canvas2.width, canvas2.height);
    }
}

 
// Cargar PDF
pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    renderPage(pageNum);
});


// Botones de navegaciÃ³n
prevPageBtn.addEventListener("click", () => {
    if (pageNum > 1) {
        pageNum -= (window.innerWidth > 1000) ? 2 : 1;
        if (pageNum < 1) pageNum = 1;
        renderPage(pageNum);

        if (isAutoReading) {
            readPage(pageNum); // ðŸ”¥ Si estÃ¡ en lectura continua, reproduce la pÃ¡gina actual
        }
    }
});

nextPageBtn.addEventListener("click", () => {
    const isTwoPages = window.innerWidth > 1000;
    const nextPageNum = pageNum + (isTwoPages ? 2 : 1);

    if (nextPageNum <= pdfDoc.numPages) {
        pageNum = nextPageNum;
        renderPage(pageNum);

        if (isAutoReading) {
            readPage(pageNum); // ðŸ”¥ Si estÃ¡ en lectura continua, reproduce la pÃ¡gina actual
        }
    } else {
        nextPageBtn.classList.add("shake");
        setTimeout(() => nextPageBtn.classList.remove("shake"), 300);
    }
});


// BotÃ³n de reproducciÃ³n manual
playPauseButton.addEventListener("click", () => {
    stopAutoReading();
    togglePlayPause();
});
function togglePlayPause() {
    const audio1 = document.getElementById("pageAudio1");
    const audio2 = document.getElementById("pageAudio2");

    if (!audio1) return;

    if (isPlaying) {
        stopAllAudio(); // ðŸ”´ Si estÃ¡ reproduciendo, se detiene completamente
    } else {
        isPlaying = true;

        if (playPauseIcon) {
            playPauseIcon.classList.remove("fa-play");
            playPauseIcon.classList.add("fa-pause");
        }

        audio1.play().catch(e => console.error("Error al reproducir audio 1:", e));

        // âœ… Solo configuramos `onended` si NO estÃ¡ en pausa
        audio1.onended = () => {
            if (!isPlaying) return; // ðŸ”´ Si el usuario pausÃ³, no continuar

            if (window.hasSecondPage && audio2) {
                audio2.play().catch(e => console.error("Error al reproducir audio 2:", e));

                audio2.onended = () => {
                    if (!isPlaying) return; // ðŸ”´ No continuar si el usuario pausÃ³
                    stopAllAudio();
                };
            } else {
                stopAllAudio();
            }
        };
    }
}




// BotÃ³n de lectura automÃ¡tica
autoReadButton.addEventListener("click", () => {
    if (!isAutoReading) {
        stopManualAudio();
        isAutoReading = true;
        if (autoReadIcon) {
            autoReadIcon.classList.remove("fa-book-reader");
            autoReadIcon.classList.add("fa-stop");
        }
        readPage(pageNum);
    } else {
        stopAutoReading();
    }
});

function stopAutoReading() {
    if (!isAutoReading) return; // ðŸ”´ Evitar llamadas innecesarias

    isAutoReading = false;

    if (autoReadIcon) {
        autoReadIcon.classList.remove("fa-stop");
        autoReadIcon.classList.add("fa-book-reader");
    }

    // ðŸ”´ DETENER AUDIOS SI SE ESTÃ REPRODUCIENDO
    const audio1 = document.getElementById("pageAudio1");
    const audio2 = document.getElementById("pageAudio2");

    if (audio1) {
        audio1.pause();
        audio1.currentTime = 0;
        audio1.onended = null; // Evita que continÃºe a la siguiente pÃ¡gina
    }
    if (audio2) {
        audio2.pause();
        audio2.currentTime = 0;
        audio2.onended = null;
    }

    // ðŸ”´ EVITAR QUE SE SIGA EJECUTANDO LA FUNCIÃ“N `goToNextPage`
    clearTimeout(autoReadTimeout); // Si habÃ­a un temporizador activo, lo detiene
}


function stopManualAudio() {
    if (!isPlaying) return; // ðŸ”´ Si ya estÃ¡ en pausa, no hacer nada

    stopAllAudio();
}



function stopAllAudio() {
    const audio1 = document.getElementById("pageAudio1");
    const audio2 = document.getElementById("pageAudio2");

    if (audio1) {
        audio1.pause();
        audio1.currentTime = 0;
        audio1.onended = null; // ðŸ”´ Evita que el evento `onended` lo reinicie
    }
    if (audio2) {
        audio2.pause();
        audio2.currentTime = 0;
        audio2.onended = null; // ðŸ”´ Evita que se siga reproduciendo automÃ¡ticamente
    }

    isPlaying = false;

    if (playPauseIcon) {
        playPauseIcon.classList.remove("fa-pause");
        playPauseIcon.classList.add("fa-play");
    }
}



function readPage(num) {
    if (!isAutoReading || num > pdfDoc.numPages) return;

    pageNum = num;
    renderPage(pageNum);

    const audio1 = document.getElementById("pageAudio1");
    if (audio1) {
        audio1.play().catch(e => console.error("Error al reproducir audio 1:", e));
    }

    audio1.onended = () => {
        if (isAutoReading) {
            const nextPage = num + (window.hasSecondPage ? 2 : 1);
            if (nextPage <= pdfDoc.numPages) {
                readPage(nextPage);
            } else {
                stopAutoReading();
            }
        }
    };
}



const volumeButton = document.getElementById("volume-button");
const volumeSlider = document.getElementById("volume-slider");
let volumeTimeout;

// FunciÃ³n para mostrar el control de volumen
function showVolumeSlider() {
    volumeSlider.style.display = "block";
    volumeSlider.style.opacity = "1";
    resetVolumeTimeout();
}

// FunciÃ³n para ocultar el control de volumen
function hideVolumeSlider() {
    volumeSlider.style.opacity = "0";
    setTimeout(() => {
        if (volumeSlider.style.opacity === "0") {
            volumeSlider.style.display = "none";
        }
    }, 300); // Esconde el slider despuÃ©s de la animaciÃ³n
}

// FunciÃ³n para reiniciar el temporizador de ocultaciÃ³n
function resetVolumeTimeout() {
    clearTimeout(volumeTimeout);
    volumeTimeout = setTimeout(hideVolumeSlider, 2000); // Ocultar despuÃ©s de 2 segundos
}

// Mostrar el control al presionar el botÃ³n
volumeButton.addEventListener("click", showVolumeSlider);

// Ajustar volumen y actualizar el icono
volumeSlider.addEventListener("input", () => {
    const volume = volumeSlider.value;
    document.querySelectorAll("audio").forEach(audio => {
        audio.volume = volume;
    });

    // Cambiar el icono segÃºn el nivel de volumen
    if (volume == 0) {
        volumeButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
    } else if (volume <= 0.5) {
        volumeButton.innerHTML = '<i class="fas fa-volume-down"></i>';
    } else {
        volumeButton.innerHTML = '<i class="fas fa-volume-up"></i>';
    }

    resetVolumeTimeout(); // Reiniciar el temporizador al mover el slider
});

// Ocultar el slider cuando el usuario deja de moverlo
volumeSlider.addEventListener("mouseleave", resetVolumeTimeout);





// -------------------------------------------------------------------------------
const pageInput = document.getElementById("page-input");
const goToPageButton = document.getElementById("go-to-page");

// FunciÃ³n para cambiar de pÃ¡gina de forma fiable en mÃ³viles
function goToPage() {
    const requestedPage = parseInt(pageInput.value, 10);

    if (isNaN(requestedPage) || requestedPage < 1 || requestedPage > pdfDoc.numPages) {
        alert("NÃºmero de pÃ¡gina invÃ¡lido");
        return;
    }

    pageNum = requestedPage;

    // ðŸ”¥ Ocultar teclado en mÃ³viles y evitar scroll inesperado
    pageInput.blur();
    document.activeElement.blur();
    window.scrollTo(0, 0);

    // ðŸ”¥ Forzar la actualizaciÃ³n del input en mÃ³viles
    setTimeout(() => {
        pageInput.value = pageNum;
    }, 50);

    // ðŸ”¥ Asegurar que el canvas se vuelve a renderizar correctamente
    setTimeout(() => {
        renderPage(pageNum);

        // ðŸ”¥ Forzar actualizaciÃ³n del canvas en mÃ³viles
        setTimeout(() => {
            canvas.style.display = "none";
            setTimeout(() => {
                canvas.style.display = "block";
            }, 50);
        }, 100);
    }, 300);
}

// ðŸ› ï¸ **Forzar el clic en mÃ³viles**
goToPageButton.addEventListener("touchstart", (event) => {
    event.preventDefault(); // ðŸ”¥ Evita cualquier interferencia del navegador
    goToPage();
});

goToPageButton.addEventListener("click", goToPage);

// ðŸ“± **Compatibilidad con teclado en mÃ³viles**
pageInput.addEventListener("keyup", (event) => {
    if (event.key === "Enter") {
        goToPage();
    }
});

// ðŸ“± **Forzar ocultar teclado en mÃ³viles al perder el foco**
pageInput.addEventListener("blur", () => {
    setTimeout(() => {
        window.scrollTo(0, 0);
    }, 100);
});

//---------------------------------------------------------------------------------------





const slider = document.getElementById("button-slider");
        const toggleButton = document.getElementById("slider-toggle");
        let sliderVisible = false;

        toggleButton.addEventListener("click", () => {
            sliderVisible = !sliderVisible;
            slider.style.transform = sliderVisible ? "translateX(400px)" : "translateX(0)";
        });

        document.addEventListener("DOMContentLoaded", () => {
    const tutorialOverlay = document.getElementById("tutorial-overlay");
    const tutorialClose = document.getElementById("tutorial-close");

    // ðŸ” Verificar si los elementos existen antes de continuar
    if (!tutorialOverlay || !tutorialClose) {
        console.error("âš ï¸ Error: No se encontraron los elementos del tutorial.");
        return;
    }

    // ðŸš€ Comprobar si el usuario ya vio el tutorial antes de mostrarlo
    if (localStorage.getItem("tutorialVisto") === "true") {
        tutorialOverlay.remove(); // ðŸ”¥ Lo eliminamos completamente para que nunca se renderice
        return;
    }

    // âœ… Si el usuario nunca lo ha visto, lo mostramos
    setTimeout(() => {
        tutorialOverlay.style.display = "flex";
    }, 500); // ðŸ”¥ PequeÃ±o delay opcional para evitar parpadeo

    // ðŸ”¥ FunciÃ³n para cerrar y eliminar el tutorial correctamente
    function closeTutorial() {
        localStorage.setItem("tutorialVisto", "true"); // âœ… Guardamos el estado
        tutorialOverlay.style.display = "none"; // âœ… Ocultamos el tutorial
        setTimeout(() => {
            tutorialOverlay.remove(); // âœ… Eliminamos el tutorial del DOM despuÃ©s de ocultarlo
        }, 100);
    }

    // ðŸŽ¯ Evento para cerrar con el botÃ³n "De acuerdo"
    tutorialClose.addEventListener("click", closeTutorial);

    // ðŸŽ¯ TambiÃ©n ocultarlo si el usuario hace clic fuera del mensaje
    tutorialOverlay.addEventListener("click", (event) => {
        if (event.target === tutorialOverlay) {
            closeTutorial();
        }
    });
});
   






// Pantalla completa
fullscreenBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().then(() => {
            if (fullscreenIcon) {
                fullscreenIcon.classList.remove("fa-expand");
                fullscreenIcon.classList.add("fa-compress");
            }
        });
    } else {
        document.exitFullscreen().then(() => {
            if (fullscreenIcon) {
                fullscreenIcon.classList.remove("fa-compress");
                fullscreenIcon.classList.add("fa-expand");
            }
        });
    }
});

    </script>
</body>
</html>
