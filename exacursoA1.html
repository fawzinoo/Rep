<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Interactivo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&family=Playfair+Display:wght@400;500;600&display=swap');
        
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --accent-color: #e67e22;
            --background-color: #f8f9fa;
            --text-color: #343a40;
            --success-color: #28a745;
            --error-color: #dc3545;
            --box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', Arial, sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            text-align: center;
            margin-bottom: 2px;
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 2px;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
            flex: 1;
        }
        
        .section.active {
            display: block;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            margin-top: 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: #3a5a84;
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }
        
        .question {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: var(--box-shadow);
        }
        
        .options {
            margin-top: 1rem;
        }
        
        .option {
            display: block;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background-color: #e9ecef;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .option:hover, .segment-btn-a:hover {
            background-color: #dee2e6;
        }
        
        .option.selected, .segment-btn-a.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .text-area {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ced4da;
            border-radius: 5px;
            min-height: 150px;
            font-size: 1rem;
            margin-top: 1rem;
            resize: vertical;
        }
        
        .results {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: var(--box-shadow);
        }
        
        .result-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .score {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: 2rem 0;
        }
        
        .progress-container {
            margin: 2rem 0;
           
        }
        
        .progress-bar {
            background-color: #e9ecef;
            border-radius: 5px;
            height: 10px;
            overflow: hidden;
    
        }
        
        .progress {
            background-color: var(--primary-color);
            height: 100%;
            width: 0;
            transition: width 0.4s ease;
        }
        
        footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Estilos para secciones interactivas */
        .container-a {
            max-width: 690px;
            margin: 0 auto;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 8px 28px rgba(44,62,80,0.12);
            padding: 25px 20px;
        }
        
        .dialog-situation-a {
            background: #f8f9fb;
            box-shadow: 0 3px 15px rgba(60,60,60,0.1);
            border-radius: 12px;
            padding: 16px 14px;
            margin-bottom: 20px;
            border: 1px solid rgba(60,70,100,0.08);
            text-align: left;
        }
        
        .response-segment-a {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        .segment-options-a {
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }
        
        .segment-btn-a {
            background: #e3e9ff;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .response-container-a {
            position: relative;
            padding-bottom: 15px;
            margin-bottom: 15px;
            min-height: 65px;
        }
        
        .response-display-a {
            min-height: 25px;
            background: #fff;
            border-radius: 4px;
            padding: 12px 16px;
            margin: 6px 0;
            border: 1px dashed #ccc;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
            font-family: 'Playfair Display', serif;
            font-size: 17px;
            letter-spacing: 0.02em;
            line-height: 1.7;
            color: #2c3e50;
        }
        
        .help-text-a {
            color: #666;
            font-style: italic;
            font-size: 10px;
            margin: 2px 0;
            display: none;
        }
        
        .edit-button-a {
            background: #3867d6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 8px;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: all 0.3s ease;
            margin: 3px 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .word-segment-a {
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 3px;
            background-color: #f0f8ff;
            transition: all 0.2s ease;
            font-family: 'Playfair Display', serif;
            font-size: 17px;
        }
        
        .word-segment-a:hover {
            background-color: #e3e9ff;
            box-shadow: var(--box-shadow);
        }
        
        .word-segment-a.editing {
            background-color: #d4edda !important;
            font-weight: bold;
            box-shadow: 0 1px 4px rgba(0,0,0,0.15);
        }
        
        .reset-button-container-a {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 0;
        }

        .reset-button-a {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border: none;
            box-shadow: 0 2px 5px rgba(56, 103, 214, 0.15),
                inset 0 -1px 3px rgba(0, 0, 0, 0.05),
                inset 0 1px 3px rgba(255, 255, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            color: #3867d6;
            font-size: 16px;
        }

        .reset-button-a:hover {
            transform: translateY(-2px) rotate(15deg);
            box-shadow: 0 6px 15px rgba(56, 103, 214, 0.25),
                inset 0 -2px 5px rgba(0, 0, 0, 0.05),
                inset 0 2px 5px rgba(255, 255, 255, 0.8);
        }

        .reset-button-a:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(56, 103, 214, 0.1),
                inset 0 -1px 3px rgba(0, 0, 0, 0.1),
                inset 0 1px 3px rgba(255, 255, 255, 0.5);
        }

        .buttons-container-a {
            display: flex;
            align-items: center;
            margin-top: 5px;
            margin-bottom: 10px;
            justify-content: center;
            width: 100%;
        }

       
.button-container {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
    width: 100%;
}

.button-container .btn:first-child {
    margin-right: auto;
}

.button-container .btn:last-child {
    margin-left: auto;
}

/* Estilos de di√°logo y contenido */
.dialogo {
    background: linear-gradient(100deg, #e3e9ff 60%, #f6f8ff 100%);
    padding: 22px 24px;
    border-radius: 12px;
    margin-bottom: 28px;
    box-shadow: 0 2px 8px rgba(56,103,214,0.07);
}

.dialogo strong {
    color: #3867d6;
    font-size: 1.08em;
}

pre {
    font-family: 'Montserrat', monospace, Arial, sans-serif;
    font-size: 1em;
    background: none;
    margin: 12px 0 0 0;
    color: #222;
    white-space: pre-wrap;
}

/* Estilos de formulario */
label {
    display: block;
    margin: 14px 0 6px 0;
    font-weight: 500;
}

input[type="text"] {
    width: 210px;
    padding: 7px 10px;
    border: 1.5px solid #cfd8dc;
    border-radius: 6px;
    font-size: 1em;
    margin-left: 4px;
    transition: border-color 0.2s;
}

input[type="text"]:focus {
    border-color: #3867d6;
    outline: none;
}

input[type="radio"] {
    accent-color: #3867d6;
    margin-right: 7px;
}

.radio-group label {
    display: flex;
    align-items: center;
    margin: 6px 0;
    font-weight: 400;
}

/* Estilos de bot√≥n submit */
button[type="submit"] {
    display: block;
    margin: 32px auto 0 auto;
    background: linear-gradient(90deg, #3867d6 60%, #7f53ac 100%);
    color: #fff;
    font-size: 1.1em;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    padding: 13px 38px;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(56,103,214,0.13);
    transition: background 0.2s, transform 0.1s;
}

button[type="submit"]:hover {
    background: linear-gradient(90deg, #7f53ac 60%, #3867d6 100%);
    transform: translateY(-2px) scale(1.03);
}

/* Media queries para responsividad */
@media (max-width: 600px) {
    .container { padding: 18px 6px; }
    h1 { font-size: 1.3em; }
    pre { font-size: 0.95em; }
    input[type="text"] { width: 100%; }
}

/* Animaciones de t√≠tulo */
@keyframes titleFadeIn {
    0% {
        opacity: 0;
        transform: translateY(-10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes gradientShift {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

@keyframes lineExpand {
    0% {
        width: 0;
    }
    100% {
        width: 100%;
    }
}

/* Estilos de t√≠tulo de secci√≥n animados */
.section h2 {
    position: relative;
    background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: gradientShift 6s ease infinite;
    padding-bottom: 5px;
    display: inline-block;
}

.section h2::after {
    content: "";
    position: absolute;
    width: 0;
    height: 2px;
    bottom: 0;
    left: 0;
    background: linear-gradient(90deg, #3867d6, #7f53ac);
    transition: width 0.8s ease;
    animation: lineExpand 1.5s ease-out infinite;
    animation-delay: 0.3s;
}

/* Delays escalonados para t√≠tulos */
.section:nth-child(1) h2 {
    animation-delay: 0.1s;
}

.section:nth-child(2) h2 {
    animation-delay: 0.3s;
}

.section:nth-child(3) h2 {
    animation-delay: 0.5s;
}
@keyframes earthquake {
                        0% { transform: translate(0, 0) rotate(0deg); }
                        25% { transform: translate(-2px, 1px) rotate(-1deg); }
                        50% { transform: translate(1px, -1px) rotate(1deg); }
                        75% { transform: translate(-1px, -1px) rotate(-0.5deg); }
                        100% { transform: translate(2px, 1px) rotate(0deg); }
                    }
                    
                    .btn p {
                        display: inline-block;
                        animation: earthquake 0.5s infinite alternate;
                        animation-iteration-count: infinite;
                    }
                    
                    /* Apply the animation with pauses every 2 seconds */
                    @media (prefers-reduced-motion: no-preference) {
                        .btn p {
                            animation: none; /* Reset initial animation */
                            animation: earthquake 0.5s infinite alternate 0s, 
                                       pause-animation 5s infinite 0s;
                        }
                    }
                    
                    @keyframes pause-animation {
                        0%, 40% { animation-play-state: running; }
                        40.01%, 100% { animation-play-state: paused; }
                    }

                    @keyframes pulse {                          
                                    0% { transform: scale(1); }
                                    50% { transform: scale(1.1); }
                                    100% { transform: scale(1); }
                                }
                                @keyframes hexProgress {
                                    from { stroke-dashoffset: 210; }
                                    to { stroke-dashoffset: 0; }
                                }

                                @keyframes scoreAppear {
                            0% { opacity: 0; transform: scale(0.7) translateY(20px); }
                            50% { opacity: 1; transform: scale(1.1) translateY(-5px); }
                            70% { transform: scale(0.95) translateY(2px); }
                            100% { transform: scale(1) translateY(0); }
                        }
                        @keyframes scoreGlow {
                            0% { box-shadow: 0 4px 15px rgba(56,103,214,0.2); }
                            100% { box-shadow: 0 8px 25px rgba(127,83,172,0.4); }
                        }
                        @keyframes scoreBackground {
                            0% { background-position: 0% 50%; background-size: 200% 200%; }
                            50% { background-position: 100% 50%; background-size: 200% 200%; }
                            100% { background-position: 0% 50%; background-size: 200% 200%; }
                        }
                        @keyframes scoreCountUp {
                            0% { content: "0/40"; }
                            20% { content: "8/40"; }
                            40% { content: "16/40"; }
                            60% { content: "24/40"; }
                            80% { content: "32/40"; }
                            100% { content: "40/40"; }
                        }
                        /* Animaci√≥n para el contador de audio */
@keyframes popCount {
    0% { transform: scale(1); background: linear-gradient(90deg,#3867d6,#7f53ac);}
    40% { transform: scale(1.25); background: linear-gradient(90deg,#7f53ac,#3867d6);}
    100% { transform: scale(1); background: linear-gradient(90deg,#3867d6,#7f53ac);}
}
.audio-count-anim.pop {
    animation: popCount 0.5s;
}
@keyframes pulseMessage {
    0% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 0.9; }
}

/* Estilos para el timer - correcci√≥n definitiva */
.exam-timer {
    position: fixed;
    top: 0px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(90deg, #3867d6, #7f53ac);
    color: white;
    border-radius: 10px;
    padding: 2px 15px;
    font-size: 1.1rem;
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(56,103,214,0.3);
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transform: translateY(-20px) translateX(-50%);
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.exam-timer.active {
    opacity: 1;
    transform: translateY(0) translateX(-50%);
}

.exam-timer-icon {
    font-size: 1.2rem;
    animation: pulse 1.5s infinite;
}

/* Correcci√≥n para los estados de warning y critical */
.exam-timer.warning {
    background: linear-gradient(90deg, #e67e22, #e74c3c);
    animation: warningShake 0.5s;
}

.exam-timer.critical {
    background: linear-gradient(90deg, #c0392b, #e74c3c);
    animation: criticalShake 0.5s, criticalPulse 1s infinite alternate;
}

/* Animaciones corregidas para mantener el centrado */
@keyframes warningShake {
    0%, 100% { transform: translateX(-50%); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(calc(-50% - 5px)); }
    20%, 40%, 60%, 80% { transform: translateX(calc(-50% + 5px)); }
}

@keyframes criticalShake {
    0%, 100% { transform: translateX(-50%); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(calc(-50% - 5px)); }
    20%, 40%, 60%, 80% { transform: translateX(calc(-50% + 5px)); }
}

@keyframes criticalPulse {
    0% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.05); }
    100% { transform: translateX(-50%) scale(1); }
}

/* Estilos para el modal de tiempo agotado */
.timeout-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1001;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.timeout-modal.active {
    opacity: 1;
    visibility: visible;
}

.timeout-modal-content {
    background: white;
    border-radius: 15px;
    width: 90%;
    max-width: 450px;
    overflow: hidden;
    transform: scale(0.8);
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.timeout-modal.active .timeout-modal-content {
    transform: scale(1);
}

.timeout-modal-header {
    background: linear-gradient(90deg, #c0392b, #e74c3c);
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 1.5rem;
    font-weight: 700;
}

.timeout-modal-body {
    padding: 30px;
    text-align: center;
    color: #444;
    font-size: 1.1rem;
}

.timeout-modal-button {
    background: linear-gradient(90deg, #3867d6, #7f53ac);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 12px 30px;
    font-size: 1.1rem;
    cursor: pointer;
    margin: 15px auto 25px;
    display: block;
    box-shadow: 0 4px 12px rgba(56, 103, 214, 0.3);
    transition: all 0.2s;
}

.timeout-modal-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(56, 103, 214, 0.4);
}

@keyframes loginAppear {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes floatingCircle {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    25% { transform: translate(15px, 15px) rotate(5deg); }
    50% { transform: translate(5px, -15px) rotate(-5deg); }
    75% { transform: translate(-15px, 10px) rotate(2deg); }
}

#login input:focus {
    outline: none;
    border-color: #3867d6;
    box-shadow: 0 0 0 3px rgba(56, 103, 214, 0.15);
    background-color: white;
}

.pulsate {
    animation: pulse 1.5s infinite;
}

 #comprension header, 
    #gramatica header, 
    #lexico header, 
    #comprension-auditiva header, 
    #comunicacion header, 
    #produccion header {
        margin-top: 15px;
        margin-bottom: 5px; /* Elimina el margen inferior del header */
    }
    
    .progress-container {
        margin-top: 1px; /* Reduce el margen superior de la barra de progreso */
        margin-bottom: 1px; /* Mantiene un peque√±o espacio antes del contenido */
    }
    </style>
</head>
<body>
    <div class="container">

        <!-- Secci√≥n de Login (nueva secci√≥n) -->
<section id="login" class="section active">
    <div style="height: 100vh; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
        <!-- Elementos de fondo -->
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5; background-image: radial-gradient(#3867d6 1px, transparent 1px), radial-gradient(#7f53ac 1px, transparent 1px); background-size: 30px 30px; background-position: 0 0, 15px 15px; z-index: -1;"></div>
        
        <!-- C√≠rculos decorativos animados -->
        <div style="position: absolute; border-radius: 50%; background: linear-gradient(90deg, #3867d6, #7f53ac); opacity: 0.1; animation: floatingCircle 15s infinite ease-in-out; width: 300px; height: 300px; top: -100px; left: -100px;"></div>
        <div style="position: absolute; border-radius: 50%; background: linear-gradient(90deg, #3867d6, #7f53ac); opacity: 0.1; animation: floatingCircle 15s infinite ease-in-out 3s; width: 400px; height: 400px; bottom: -150px; right: -100px;"></div>
        <div style="position: absolute; border-radius: 50%; background: linear-gradient(90deg, #3867d6, #7f53ac); opacity: 0.1; animation: floatingCircle 15s infinite ease-in-out 7s; width: 200px; height: 200px; top: 50%; right: 10%;"></div>
        
        <!-- Contenedor principal -->
        <div style="background: white; width: 90%; max-width: 400px; padding: 40px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); position: relative; z-index: 10; overflow: hidden; animation: loginAppear 1s forwards;">
            <!-- Borde superior con gradiente -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 8px; background: linear-gradient(90deg, #3867d6, #7f53ac);"></div>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: #333; font-size: 1.8rem; margin-bottom: 8px; background: linear-gradient(90deg, #3867d6, #7f53ac); -webkit-background-clip: text; background-clip: text; color: transparent;">Examen Interactivo A1</h1>
                <p style="color: #666; font-size: 0.9rem; line-height: 1.5;">Por favor, introduce tus datos para comenzar el examen</p>
            </div>
            
            <form id="loginForm" style="margin-top: 30px;">
                <div style="margin-bottom: 25px; position: relative;">
                    <label style="display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 8px; color: #444;">Nombre</label>
                    <input type="text" id="nombre" name="nombre" placeholder="Escribe tu nombre" autocomplete="given-name" required style="width: 100%; padding: 15px; border: 1.5px solid #e0e0e0; border-radius: 10px; font-size: 1rem; transition: all 0.3s; background-color: #f8f9fa;">
                    <div id="nombre-error" style="color: #e74c3c; font-size: 0.85rem; margin-top: 5px; display: none;">Por favor, introduce tu nombre</div>
                </div>
                
                <div style="margin-bottom: 25px; position: relative;">
                    <label style="display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 8px; color: #444;">Apellido</label>
                    <input type="text" id="apellido" name="apellido" placeholder="Escribe tu apellido" autocomplete="family-name" required style="width: 100%; padding: 15px; border: 1.5px solid #e0e0e0; border-radius: 10px; font-size: 1rem; transition: all 0.3s; background-color: #f8f9fa;">
                    <div id="apellido-error" style="color: #e74c3c; font-size: 0.85rem; margin-top: 5px; display: none;">Por favor, introduce tu apellido</div>
                </div>
                
                <button type="submit" id="startExamBtn" style="width: 100%; padding: 15px; border: none; border-radius: 10px; background: linear-gradient(90deg, #3867d6, #7f53ac); color: white; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(56, 103, 214, 0.3);">Comenzar Examen</button>
            </form>
            
            <div style="text-align: center; margin-top: 25px; font-size: 0.8rem; color: #999;">
                <p style="font-size: 0.7em; text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                ¬© 2025 Examen interactivo A1<br>
                <span style="color: #3867d6; font-weight: 500;">Prof. Faouzi ElHilali</span><br>
                Todos los derechos reservados
            </p>
            </div>
        </div>
    </div>
</section>
<section id="ya-participaste" class="section">
    <div style="text-align:center; margin-top:60px;">
        <h2 style="color:#e74c3c;">Ya has participado en el examen</h2>
        <p style="font-size:1.2em; color:#444;">Contacta con tu profesor si crees que es un error.</p>
        
        <!-- Bot√≥n de cerrar sesi√≥n -->
        <button id="cerrarSesionBtnYaParticipaste" class="btn" style="margin-top: 30px; padding: 15px 40px; font-size: 1.1em; border-radius: 30px; background: linear-gradient(90deg, #e74c3c, #c0392b); transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);">
            <span style="margin-right: 10px;">üö™</span>Cerrar sesi√≥n
        </button>
        <div style="text-align: center; margin-top: 25px; font-size: 0.8rem; color: #999;">
    <p style="font-size: 0.7em; text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
        ¬© 2025 Examen interactivo A1<br>
        <span style="color: #3867d6; font-weight: 500;">Prof. Faouzi ElHilali</span><br>
        Todos los derechos reservados
    </p>
</div>
    </div>
</section>
        <!-- P√°gina de Inicio -->
        <section id="inicio" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Examen Interactivo A1</span>
                </h1>
                <div style="position: relative; width: 180px; height: 4px; background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); margin: 12px auto 30px; border-radius: 4px; box-shadow: 0 2px 10px rgba(56,103,214,0.3); background-size: 200% auto; animation: gradientShift 5s ease infinite, pulseGlow 2s infinite alternate;"></div>
                <style>
                    @keyframes pulseGlow {
                        0% { box-shadow: 0 2px 10px rgba(56,103,214,0.3); }
                        100% { box-shadow: 0 4px 15px rgba(127,83,172,0.5); }
                    }
                </style>
            </header>
            <div class="content">
                <div class="intro-container" style="max-width: 760px; margin: 0 auto; text-align: center;">
                    <p style="font-size: 1.1em; margin-bottom: 30px;">Bienvenido al examen interactivo que evaluar√° tus habilidades en espa√±ol A1.</p>
                </div>
                
                <div class="exam-sections" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 30px 0;">
                    <div class="section-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3867d6, #5e7fd6); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px;">CL</div>
                            <h3 style="margin: 0; color: #3867d6;">Comprensi√≥n de Lectura</h3>
                        </div>
                        <p style="margin: 0; color: #666;">Eval√∫a tu capacidad para entender e interpretar textos escritos.</p>
                    </div>
                    
                    <div class="section-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3867d6, #5e7fd6); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px;">G</div>
                            <h3 style="margin: 0; color: #3867d6;">Gram√°tica</h3>
                        </div>
                        <p style="margin: 0; color: #666;">Eval√∫a tus conocimientos de las reglas gramaticales del espa√±ol.</p>
                    </div>
                    
                    <div class="section-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3867d6, #5e7fd6); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px;">L</div>
                            <h3 style="margin: 0; color: #3867d6;">L√©xico</h3>
                        </div>
                        <p style="margin: 0; color: #666;">Eval√∫a tu vocabulario y conocimiento de palabras en contexto.</p>
                    </div>
                    
                    <div class="section-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3867d6, #5e7fd6); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px;">CA</div>
                            <h3 style="margin: 0; color: #3867d6;">Comprensi√≥n Auditiva</h3>
                        </div>
                        <p style="margin: 0; color: #666;">Eval√∫a tu capacidad para entender mensajes y conversaciones orales.</p>
                    </div>
                    
                    <div class="section-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3867d6, #5e7fd6); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px;">CM</div>
                            <h3 style="margin: 0; color: #3867d6;">Comunicaci√≥n</h3>
                        </div>
                        <p style="margin: 0; color: #666;">Eval√∫a tus habilidades comunicativas e interacci√≥n en espa√±ol.</p>
                    </div>
                    
                    <div class="section-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #3867d6, #5e7fd6); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-right: 15px;">PE</div>
                            <h3 style="margin: 0; color: #3867d6;">Producci√≥n Escrita</h3>
                        </div>
                        <p style="margin: 0; color: #666;">Eval√∫a tu capacidad para expresarte por escrito con claridad.</p>
                    </div>
                </div>
                
                <div class="exam-info" style="background: linear-gradient(100deg, #e3e9ff 60%, #f6f8ff 100%); border-radius: 12px; padding: 25px; margin: 30px 0; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: white; display: flex; justify-content: center; align-items: center; margin-right: 15px; box-shadow: 0 4px 10px rgba(56,103,214,0.2);">
                            <span style="font-size: 24px; color: #3867d6;">40</span>
                        </div>
                        <h3 style="margin: 0; color: #3867d6;">Puntos totales</h3>
                    </div>
                    <p style="margin: 0; color: #555;">La nota final ser√° sobre 40 puntos, distribuidos entre las seis secciones del examen.</p>
                </div>
                
                <div class="start-container" style="text-align: center; margin-top: 40px;">
                    <p style="font-size: 1.1em; margin-bottom: 25px;">Cuando est√©s listo para comenzar, haz clic en el bot√≥n de abajo.</p>
                    <button class="btn" onclick="cambiarSeccion('comprension')" style="padding: 15px 40px; font-size: 1.1em; border-radius: 30px; background: linear-gradient(90deg, #3867d6 60%, #7f53ac 100%); transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(56,103,214,0.3);">
                        Comenzar Examen <span style="margin-left: 10px;">‚Üí</span>
                    </button>
                </div>
            </div>
            
            <style>
                .section-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
                }
                .btn:hover {
                    transform: translateY(-3px) scale(1.02);
                    box-shadow: 0 8px 20px rgba(56,103,214,0.4);
                }
            </style>
        </section>

        <!-- Comprensi√≥n de Lectura -->
        <section id="comprension" class="section">
            <header>
                <h1 style="font-size: 1.5rem; position: relative; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Comprensi√≥n de lectura</span>
                </h1>
            </header>
            <div class="progress-container" >
                <div class="progress-bar">
                    <div class="progress" style="width: 16.66%;"></div>
                </div>
            </div>
            <div class="content">
                <div class="dialogo">
                    <strong>Lee el siguiente di√°logo:</strong>
                    <pre>
<strong>Laura</strong>: ¬°Hola! ¬øC√≥mo te llamas?
<strong>Marta</strong>: Hola, me llamo Marta. ¬øY t√∫?
<strong>Laura</strong>: Yo soy Laura. Mucho gusto. ¬øDe d√≥nde eres?
<strong>Marta</strong>: Soy de Colombia, de Bogot√°. ¬øY t√∫?
<strong>Laura</strong>: Yo soy de Espa√±a, de Madrid.
<strong>Laura</strong>: ¬øQu√© haces los fines de semana?
<strong>Marta</strong>: Los s√°bados voy al cine con amigos o cocino en casa. Los domingos, me gusta pasear por el parque. ¬øY t√∫?
<strong>Laura</strong>: A m√≠ me encanta ir de compras o visitar museos. ¬°Tambi√©n me gusta mucho bailar!
<strong>Marta</strong>: En Colombia hay muchos lugares bonitos. ¬øConoces el caf√© colombiano?
<strong>Laura</strong>: ¬°S√≠! En Madrid hay muchos caf√©s colombianos. Est√°n en el centro, cerca de la Plaza Mayor.
<strong>Laura</strong>: ¬øVas a viajar pronto?
<strong>Marta</strong>: S√≠, el pr√≥ximo mes voy a la playa. Llevo un ba√±ador, gafas de sol, crema solar y mi m√≥vil. ¬øY t√∫?
<strong>Laura</strong>: Yo siempre llevo ropa c√≥moda: vaqueros, camisetas y zapatillas.
<strong>Marta</strong>: ¬øTe gusta el deporte?
<strong>Laura</strong>: S√≠, me gusta nadar y correr. ¬øY a ti?
<strong>Marta</strong>: A m√≠ me encanta leer libros y escuchar m√∫sica.
<strong>Laura</strong>: ¬øQu√© haces normalmente por la ma√±ana?
<strong>Marta</strong>: Me levanto a las 7, desayuno pan tostado y voy al trabajo. Por la tarde, estudio ingl√©s.
<strong>Laura</strong>: ¬øQu√© sueles pedir en un restaurante?
<strong>Marta</strong>: De primero, ensalada; de segundo, pescado con arroz; y de postre, helado. Para beber, agua o vino. ¬øY t√∫?
<strong>Laura</strong>: Yo pido sopa, luego carne con patatas y de postre, flan. ¬°Me encanta el caf√© despu√©s!
<strong>Marta</strong>: ¬øQu√© sabes hacer bien?
<strong>Laura</strong>: S√© cocinar paella y hablar ingl√©s. ¬øY t√∫?
<strong>Marta</strong>: Yo s√© bailar salsa y usar la computadora muy r√°pido.
<strong>Laura</strong>: ¬øHas viajado mucho?
<strong>Marta</strong>: S√≠, he visitado M√©xico y Per√∫. ¬øY t√∫?
<strong>Laura</strong>: Yo he estado en Italia y Francia. ¬°Me ha gustado mucho!
                    </pre>
                </div>

                <form>
                    <h2 style="font-size: 20px;">1. Verdadero o Falso <span style="font-weight:400;color:#888;">(2,5pts.)</span></h2>
                    <p style="margin-bottom:10px;">Toca <b>Verdadero</b> o <b>Falso</b> seg√∫n el di√°logo.</p>

                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>a)</b> Marta es de Madrid.</label>
                        <div style="display:flex;gap:14px; background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="flex:1;">
                                <input type="radio" name="vf1" value="V" required>
                                <span style="padding:6px 0 6px 2px;">Verdadero</span>
                            </label>
                            <label style="flex:1;">
                                <input type="radio" name="vf1" value="F">
                                <span style="padding:6px 0 6px 2px;">Falso</span>
                            </label>
                        </div>
                    </div>

                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>b)</b> Los domingos, a Marta le gusta pasear por el parque.</label>
                        <div style="display:flex;gap:14px; background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="flex:1;">
                                <input type="radio" name="vf2" value="V" required>
                                <span style="padding:6px 0 6px 2px;">Verdadero</span>
                            </label>
                            <label style="flex:1;">
                                <input type="radio" name="vf2" value="F">
                                <span style="padding:6px 0 6px 2px;">Falso</span>
                            </label>
                        </div>
                    </div>

                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>c)</b> Laura lleva gafas de sol cuando viaja.</label>
                        <div style="display:flex;gap:14px; background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="flex:1;">
                                <input type="radio" name="vf3" value="V" required>
                                <span style="padding:6px 0 6px 2px;">Verdadero</span>
                            </label>
                            <label style="flex:1;">
                                <input type="radio" name="vf3" value="F">
                                <span style="padding:6px 0 6px 2px;">Falso</span>
                            </label>
                        </div>
                    </div>

                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>d)</b> Marta sabe bailar salsa.</label>
                        <div style="display:flex;gap:14px; background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="flex:1;">
                                <input type="radio" name="vf4" value="V" required>
                                <span style="padding:6px 0 6px 2px;">Verdadero</span>
                            </label>
                            <label style="flex:1;">
                                <input type="radio" name="vf4" value="F">
                                <span style="padding:6px 0 6px 2px;">Falso</span>
                            </label>
                        </div>
                    </div>

                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>e)</b> Laura ha visitado M√©xico.</label>
                        <div style="display:flex;gap:14px; background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="flex:1;">
                                <input type="radio" name="vf5" value="V" required>
                                <span style="padding:6px 0 6px 2px;">Verdadero</span>
                            </label>
                            <label style="flex:1;">
                                <input type="radio" name="vf5" value="F">
                                <span style="padding:6px 0 6px 2px;">Falso</span>
                            </label>
                        </div>
                    </div>

                     <h2 style="font-size: 20px;">2. Selecci√≥n m√∫ltiple <span style="font-weight:400;color:#888;">(1,5pts.)</span></h2>
                    <p style="margin-bottom:10px;">Elige la opci√≥n correcta (<b>a</b>, <b>b</b> o <b>c</b>).</p>
                    
                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>a)</b> Marta los s√°bados:</label>
                        <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm1" value="a"> a) Trabaja.</label>
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm1" value="b"> b) Va al cine con amigos.</label>
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm1" value="c"> c) Estudia ingl√©s.</label>
                        </div>
                    </div>
                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>b)</b> En Madrid, los caf√©s colombianos est√°n:</label>
                        <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm2" value="a"> a) En la playa.</label>
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm2" value="b"> b) Cerca de la Plaza Mayor.</label>
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm2" value="c"> c) En Bogot√°.</label>
                        </div>
                    </div>
                    <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>c)</b> Laura en el restaurante pide de postre:</label>
                        <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm3" value="a"> a) Helado.</label>
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm3" value="b"> b) Flan.</label>
                            <label style="display:block; margin:5px 0;"><input type="radio" name="sm3" value="c"> c) Fruta.</label>
                        </div>
                    </div>

                     <h2 style="font-size: 20px;">3. Completa las frases <span style="font-weight:400;color:#888;">(2pts.)</span></h2>
                    <p style="margin-bottom:10px;">Selecciona la palabra correcta del di√°logo para completar cada frase.</p>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>a)</b> Marta lleva a la playa: ba√±ador, gafas de sol, crema solar y 
                            <select name="comp1" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:140px;">
                                <option value="">Selecciona...</option>
                                <option value="zapatillas">sus zapatillas</option>
                                <option value="sombrero">su sombrero</option>
                                <option value="m√≥vil">su m√≥vil</option>
                                <option value="libros">sus libros</option>
                                <option value="vaqueros">sus vaqueros</option>
                                <option value="camisetas">sus camisetas</option>
                            </select>
                        </label>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>b)</b> Laura sabe cocinar 
                            <select name="comp2" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:140px;">
                                <option value="">Selecciona...</option>
                                <option value="sopa">sopa</option>
                                <option value="paella">paella</option>
                                <option value="carne">carne</option>
                                <option value="ensalada">ensalada</option>
                                <option value="pescado">pescado</option>
                                <option value="arroz">arroz</option>
                            </select>
                            y hablar ingl√©s.
                        </label>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>c)</b> Marta ha visitado 
                            <select name="comp3" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:140px;">
                                <option value="">Selecciona...</option>
                                <option value="Espa√±a">Espa√±a</option>
                                <option value="Madrid">Madrid</option>
                                <option value="Colombia">Colombia</option>
                                <option value="M√©xico">M√©xico</option>
                                <option value="Italia">Italia</option>
                            </select>
                            y 
                            <select name="comp4" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:140px;">
                                <option value="">Selecciona...</option>
                                <option value="Francia">Francia</option>
                                <option value="Per√∫">Per√∫</option>
                                <option value="Bogot√°">Bogot√°</option>
                                <option value="Madrid">Madrid</option>
                                <option value="Barcelona">Barcelona</option>
                            </select>
                        </label>
                    </div>
                </form>
                
                <div class="button-container">
                    <button class="btn" style="display:none;" onclick="cambiarSeccion('inicio')">Volver</button>
                    <button class="btn" onclick="cambiarSeccion('gramatica')" style="padding: 7px;">Siguiente <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">Gram√°tica</p>
    
                    </button>
                </div>
            </div>
        </section>

        <!-- Gram√°tica -->
        <section id="gramatica" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Gram√°tica</span>
                </h1>
            </header>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" style="width: 33.33%"></div>
                </div>
            </div>
            <div class="content">
                <div>
                    <h2 style="font-size: 20px;margin-top: 40px;">1. Conjugaci√≥n en presente <span style="font-weight:400;color:#888;">(2pts.)</span></h2>
                    <p style="margin-bottom:10px;">Completa con la forma correcta del verbo en <b>presente de indicativo</b>:</p>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>a)</b> Los s√°bados, Marta <input type="text" name="conj1" id="conj1" placeholder="ir (ella)" required style="width:120px; background:#ececec;"> al cine con amigos.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="conj1" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="conj1" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="conj1" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="conj1" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="conj1" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>b)</b> A Laura le <input type="text" name="conj2" id="conj2" placeholder="gustar" required style="width:120px; background:#ececec;"> nadar y correr.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="conj2" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="conj2" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="conj2" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="conj2" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="conj2" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>c)</b> Marta <input type="text" name="conj3" id="conj3" placeholder="saber (ella)" required style="width:120px; background:#ececec;"> bailar salsa muy bien.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="conj3" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="conj3" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="conj3" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="conj3" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="conj3" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                                        
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>e)</b> Laura y Marta <input type="text" name="conj4" id="conj4" placeholder="hablar (ellas)" required style="width:120px; background:#ececec;"> sobre sus viajes.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="conj4" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="conj4" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="conj4" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="conj4" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="conj4" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                     <h2 style="font-size: 20px;">2. Conjugaci√≥n: Ser, Estar y Haber <span style="font-weight:400;color:#888;">(2pts.)</span></h2>
                    <p style="margin-bottom:10px;">Completa las frases con la forma correcta de <b>ser</b>, <b>estar</b> o <b>haber</b>:</p>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>a)</b> En Madrid <input type="text" name="verbo1" id="verbo1" placeholder="haber" required style="width:120px; background:#ececec;"> muchos caf√©s colombianos cerca de la Plaza Mayor.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="verbo1" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="verbo1" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="verbo1" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="verbo1" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="verbo1" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>b)</b> Laura <input type="text" name="verbo2" id="verbo2" placeholder="ser" required style="width:120px; background:#ececec;"> de Espa√±a, concretamente de Madrid.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="verbo2" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="verbo2" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="verbo2" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="verbo2" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="verbo2" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>c)</b> Los caf√©s colombianos <input type="text" name="verbo3" id="verbo3" placeholder="estar" required style="width:120px; background:#ececec;"> en el centro de Madrid.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="verbo3" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="verbo3" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="verbo3" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="verbo3" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="verbo3" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                                        
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>d)</b> Marta <input type="text" name="verbo4" id="verbo4" placeholder="estar" required style="width:120px; background:#ececec;"> muy contenta porque va a viajar a la playa el pr√≥ximo mes.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="verbo4" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="verbo4" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="verbo4" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="verbo4" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="verbo4" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                     <h2 style="font-size: 20px;">3. Conjugaci√≥n: Pret√©rito Perfecto <span style="font-weight:400;color:#888;">(5 puntos)</span></h2>
                    <p style="margin-bottom:10px;">Completa las frases con la forma correcta del <b>pret√©rito perfecto</b>:</p>
                    
                 
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>c)</b> ¬ø<input type="text" name="perf1" id="perf1" placeholder="viajar (t√∫)" required style="width:120px; background:#ececec;"> a Espa√±a alguna vez?</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="perf1" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="perf1" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="perf1" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="perf1" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="perf1" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>d)</b> Nosotros nunca <input type="text" name="perf2" id="perf2" placeholder="probar (nosotros)" required style="width:120px; background:#ececec;"> el caf√© colombiano.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="perf2" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="perf2" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="perf2" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="perf2" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="perf2" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                    
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <p style="font-weight:600; margin-bottom:10px;"><b>e)</b> Laura y Marta <input type="text" name="perf3" id="perf3" placeholder="hablar (ellas)" required style="width:120px; background:#ececec;"> de sus experiencias de viaje.</p>
                        <div class="vocal-buttons" style="margin-top:6px;">
                            <button type="button" class="vocal-btn" data-field="perf3" data-vocal="√°" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√°</button>
                            <button type="button" class="vocal-btn" data-field="perf3" data-vocal="√©" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√©</button>
                            <button type="button" class="vocal-btn" data-field="perf3" data-vocal="√≠" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≠</button>
                            <button type="button" class="vocal-btn" data-field="perf3" data-vocal="√≥" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√≥</button>
                            <button type="button" class="vocal-btn" data-field="perf3" data-vocal="√∫" style="background:#e3e9ff; border:none; border-radius:6px; padding:5px 10px; margin-right:5px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.12);">√∫</button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                     <h2 style="font-size: 20px;">4. Preposiciones <span style="font-weight:400;color:#888;">(1.5pts.)</span></h2>
                    <p style="margin-bottom:10px;">Completa las frases con la preposici√≥n correcta: <b>a</b>, <b>de</b>, <b>en</b>, <b>por</b>, <b>para</b> o <b>con</b>.</p>
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>a)</b> Marta es 
                            <select name="prep1" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:70px;">
                                <option value="">---</option>
                                <option value="en">en</option>
                                <option value="para">para</option>
                                <option value="de">de</option>
                                <option value="con">con</option>
                                <option value="por">por</option>
                                <option value="a">a</option>
                            </select>
                            Colombia.
                        </label>
                    </div>
                   
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>b)</b> Marta pasea 
                            <select name="prep2" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:70px;">
                                <option value="">---</option>
                                <option value="con">con</option>
                                <option value="por">por</option>
                                <option value="a">a</option>
                                <option value="en">en</option>
                                <option value="de">de</option>
                                <option value="para">para</option>
                            </select>
                            el parque los domingos.
                        </label>
                    </div>
                    <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                        <label style="font-weight:600;"><b>c)</b> Laura lleva ropa c√≥moda 
                            <select name="prep3" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:70px;">
                                <option value="">---</option>
                                <option value="para">para</option>
                                <option value="de">de</option>
                                <option value="a">a</option>
                                <option value="en">en</option>
                                <option value="por">por</option>
                                <option value="con">con</option>
                            </select>
                            viajar.
                        </label>
                    </div>
                </div>

                <div class="button-container">
                    <button class="btn" onclick="cambiarSeccion('comprension')" style="padding:7px;">Volver <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">C.de lectura</p>
                    </button>
    
                    <button class="btn" onclick="cambiarSeccion('lexico')" style="padding: 7px;">Siguiente <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">L√©xico</p>
    
                    </button>
                </div>
            </div>
        </section>

        <!-- L√©xico -->
        <section id="lexico" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">L√©xico</span>
                </h1>
            </header>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" style="width: 50%"></div>
                </div>
            </div>
            <div class="content" style="margin-top: 50px;"">
                 <h2 style="font-size: 20px;">1. Elimina el intruso <span style="font-weight:400;color:#888;">(2pts.)</span></h2>
                <p style="margin-bottom:10px;">En cada grupo, selecciona la palabra que <b>no pertenece</b> al mismo campo sem√°ntico. ¬°Ojo! Algunas opciones pueden parecer correctas, pero solo una es el verdadero "intruso".</p>
                
                <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    <label style="font-weight:600;"><b>a)</b> Selecciona un intruso:</label>
                    <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex1" value="cine" required> Cine
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex1" value="parque"> Parque
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex1" value="museo"> Museo
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex1" value="flan"> Flan
                        </label>
                    </div>
                </div>
                
                <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    <label style="font-weight:600;"><b>b)</b> Selecciona un intruso:</label>
                    <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex2" value="ba√±ador" required> Ba√±ador
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex2" value="gafas de sol"> Gafas de sol
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex2" value="zapatillas"> Zapatillas
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex2" value="vino"> Vino
                        </label>
                    </div>
                </div>
                
                <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    <label style="font-weight:600;"><b>c)</b> Selecciona un intruso:</label>
                    <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex3" value="cerveza" required> Cerveza
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex3" value="pasta"> Pasta
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex3" value="refresco"> Refresco
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex3" value="helado"> Helado
                        </label>
                    </div>
                </div>

                <div class="radio-group" style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    <label style="font-weight:600;"><b>d)</b> Selecciona un intruso:</label>
                    <div style="background:#ececec; border-radius:8px; padding:10px 8px; margin-top:7px;">
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex4" value="leer" required> Leer
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex4" value="correr"> Correr
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex4" value="bailar"> Bailar
                        </label>
                        <label style="display:block; margin:5px 0;">
                            <input type="radio" name="lex4" value="trabajo"> Trabajo
                        </label>
                    </div>
                </div>
            </div>

            <div class="content" style="margin-top: 30px;"">
                <h2 style="font-size: 20px;">2. Palabra y definici√≥n <span style="font-weight:400;color:#888;">(2,5pts.)</span></h2>
                <p style="margin-bottom:10px;">Relaciona cada palabra con su definici√≥n correcta. Escribe la letra correspondiente (<b>a</b>, <b>b</b>, <b>c</b>, <b>d</b>, <b>e</b> o <b>f</b>) en el campo de respuesta.</p>
                <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    <ol style="margin-left: 18px;">
                        <li style="margin-bottom:10px;">
                            <b>Maleta</b>
                            <input type="text" name="lexico1" maxlength="1" required style="width:40px; margin-left:10px; background:#ececec; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em;">
                        </li>
                        <li style="margin-bottom:10px;">
                            <b>Gu√≠a</b>
                            <input type="text" name="lexico2" maxlength="1" required style="width:40px; margin-left:10px; background:#ececec; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em;">
                        </li>
                        <li style="margin-bottom:10px;">
                            <b>Mapa</b>
                            <input type="text" name="lexico3" maxlength="1" required style="width:40px; margin-left:10px; background:#ececec; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em;">
                        </li>
                        <li style="margin-bottom:10px;">
                            <b>Excursi√≥n</b>
                            <input type="text" name="lexico4" maxlength="1" required style="width:40px; margin-left:10px; background:#ececec; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em;">
                        </li>
                        <li style="margin-bottom:10px;">
                            <b>Billete</b>
                            <input type="text" name="lexico5" maxlength="1" required style="width:40px; margin-left:10px; background:#ececec; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em;">
                        </li>
                    </ol>
                    <ul style="margin-left: 18px; margin-top: 18px;">
                        <li><b>a)</b> Persona que explica y acompa√±a a los turistas.</li>
                        <li><b>b)</b> Salida o viaje corto para conocer un lugar.</li>
                        <li><b>c)</b> Objeto donde guardas tu ropa para viajar.</li>
                        <li><b>d)</b> Dibujo que muestra ciudades, calles y caminos.</li>
                        <li><b>e)</b> Documento necesario para viajar en tren, avi√≥n o autob√∫s.</li>
                    </ul>
                </div>
            </div>
            <div class="content" style="margin-top: 30px;">
                <h2 style="font-size: 20px;">3. Selecci√≥n m√∫ltiple avanzada <span style="font-weight:400;color:#888;">(2,5pts.)</span></h2>
                <p style="margin-bottom:10px;">Elige la palabra adecuada para completar cada frase. Hay opciones de viajes, ocio, objetos y lugares. ¬°Lee bien antes de responder!</p>
                <div style="background:#f5f6fa; box-shadow:0 2px 12px rgba(60,60,60,0.18); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    <ol style="margin-left: 18px;">
                        <li style="margin-bottom:12px;">
                            Cuando viajo, siempre llevo mi 
                            <select name="lexav1" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:120px;">
                                <option value="">---</option>
                                <option value="flan">flan</option>
                                <option value="gafas de sol">gafas de sol</option>
                                <option value="gu√≠a">gu√≠a</option>
                                <option value="parque">parque</option>
                                <option value="maleta">maleta</option>
                                <option value="billete">billete</option>
                            </select>
                            para guardar la ropa.
                        </li>
                        <li style="margin-bottom:12px;">
                            Para saber c√≥mo llegar a un lugar, uso un 
                            <select name="lexav2" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:120px;">
                                <option value="">---</option>
                                <option value="cine">cine</option>
                                <option value="souvenir">souvenir</option>
                                <option value="ba√±ador">ba√±ador</option>
                                <option value="gu√≠a">gu√≠a</option>
                                <option value="museo">museo</option>
                                <option value="mapa">mapa</option>
                            </select>
                            .
                        </li>

                        <li style="margin-bottom:12px;">
                            Para entrar al cine o viajar en tren, necesitas un 
                            <select name="lexav3" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:120px;">
                                <option value="">---</option>
                                <option value="excursi√≥n">excursi√≥n</option>
                                <option value="parque">parque</option>
                                <option value="m√≥vil">m√≥vil</option>
                                <option value="maleta">maleta</option>
                                <option value="gu√≠a">gu√≠a</option>
                                <option value="billete">billete</option>
                            </select>
                            .
                        </li>
                        <li style="margin-bottom:12px;">
                            Si quiero saber informaci√≥n sobre una ciudad, leo una 
                            <select name="lexav4" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:120px;">
                                <option value="">---</option>
                                <option value="excursi√≥n">excursi√≥n</option>
                                <option value="maleta">maleta</option>
                                <option value="ba√±ador">ba√±ador</option>
                                <option value="parque">parque</option>
                                <option value="mapa">mapa</option>
                                <option value="gu√≠a">gu√≠a</option>
                            </select>
                            tur√≠stica.
                        </li>
                        <li style="margin-bottom:12px;">
                            Para nadar en la playa, necesito un 
                            <select name="lexav5" required style="background:#ececec; padding:7px 10px; border:1.5px solid #cfd8dc; border-radius:6px; font-size:1em; margin-left:4px; width:120px;">
                                <option value="">---</option>
                                <option value="flan">flan</option>
                                <option value="souvenir">souvenir</option>
                                <option value="camiseta">camiseta</option>
                                <option value="parque">parque</option>
                                <option value="ba√±ador">ba√±ador</option>
                                <option value="billete">billete</option>
                            </select>
                            .
                        </li>
                    </ol>
                </div>
            </div>
            <div class="button-container">
                <button class="btn" onclick="cambiarSeccion('gramatica')" style="padding:7px;">Volver <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">Gram√°tica</p>
                </button>

                <button class="btn" onclick="cambiarSeccion('comprension-auditiva')" style="padding: 7px;">Siguiente <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">C.auditiva</p>

                </button>
            </div>
                
            
        </section>

        <!-- Comprensi√≥n Auditiva -->
        <section id="comprension-auditiva" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Comprensi√≥n auditiva</span>
                </h1>
            </header>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" style="width: 66.66%"></div>
                </div>
            </div>
            <div class="content">
                <div class="audio-pregunta" style="background:#fff; box-shadow:0 2px 12px rgba(60,60,60,0.12); border-radius:10px; padding:18px 16px; margin-bottom:18px;">
                    
                    <h2 style="font-size: 20px;">1. Escucha el audio 3 veces y responde a las preguntas: <span style="font-weight:400;color:#888;">(7pts.)</span></h2>
                    <br><br>
                    <div style="text-align: center; margin-bottom: 20px;">
    <audio id="audioPlayer" tabindex="-1" style="width:1px;height:1px;opacity:0.01;position:absolute;left:0;top:0;">
        <source src="https://fawzinoo.github.io/audios/examA1.mp3" type="audio/mp3">
        Tu navegador no soporta el elemento de audio.
    </audio>
   <button id="audioPlayBtn" style="background:linear-gradient(90deg,#3867d6,#7f53ac);color:#fff;padding:10px 28px;border:none;border-radius:30px;font-size:1.1em;font-weight:600;box-shadow:0 2px 8px rgba(56,103,214,0.13);cursor:pointer;transition:background 0.3s,transform 0.2s;position:relative;">
    <i style="display:inline-block;font-size:1.2em;margin-right:5px;">üéß</i> Pulsar audio <span id="audioCount" class="audio-count-anim" style="display:inline-block;min-width:22px;text-align:center;background:#dc3545;color:white;border-radius:50%;margin-left:8px;font-size:0.85em;padding:3px;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2);">3</span>
</button>

</div>
               
                <div id="audioPreguntasContainer" style="margin-top: 25px;">
                    <!-- 1 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øDe d√≥nde es Carlos?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio1" value="a"> a) De Espa√±a.</label>
                            <label><input type="radio" name="audio1" value="b"> b) De M√©xico.</label> <!-- correcta -->
                            <label><input type="radio" name="audio1" value="c"> c) De Francia.</label>
                        </div>
                    </div>
                    <!-- 2 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øQu√© hace Carlos los s√°bados?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio2" value="a"> a) Juega al f√∫tbol.</label> <!-- correcta -->
                            <label><input type="radio" name="audio2" value="b"> b) Visita museos.</label>
                            <label><input type="radio" name="audio2" value="c"> c) Trabaja.</label>
                        </div>
                    </div>
                    <!-- 3 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">Sophie los fines de semana...</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio3" value="a"> a) Ve pel√≠culas en casa.</label>
                            <label><input type="radio" name="audio3" value="b"> b) Juega al f√∫tbol.</label>
                            <label><input type="radio" name="audio3" value="c"> c) Va a caf√©s con su hermana.</label> <!-- correcta -->
                        </div>
                    </div>
                    <!-- 4 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px;">En Par√≠s, los restaurantes mexicanos est√°n...</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio4" value="a"> a) Cerca del r√≠o Sena.</label> <!-- correcta -->
                            <label><input type="radio" name="audio4" value="b"> b) En la monta√±a.</label>
                            <label><input type="radio" name="audio4" value="c"> c) En Guadalajara.</label>
                        </div>
                    </div>
                    <!-- 5 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">Carlos lleva a la monta√±a...</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio5" value="a"> a) Un paraguas y un libro.</label>
                            <label><input type="radio" name="audio5" value="b"> b) Una chaqueta y botas.</label> <!-- correcta -->
                            <label><input type="radio" name="audio5" value="c"> c) Un ba√±ador y gafas de sol.</label>
                        </div>
                    </div>
                    <!-- 6 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øQu√© m√∫sica le gusta a Sophie?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio6" value="a"> a) Pop.</label>
                            <label><input type="radio" name="audio6" value="b"> b) Rock.</label>
                            <label><input type="radio" name="audio6" value="c"> c) M√∫sica cl√°sica.</label> <!-- correcta -->
                        </div>
                    </div>
                    <!-- 7 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øQu√© hace Sophie los domingos?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio7" value="a"> a) Visita museos o va a caf√©s con su hermana.</label> <!-- correcta -->
                            <label><input type="radio" name="audio7" value="b"> b) Juega al f√∫tbol con amigos.</label>
                            <label><input type="radio" name="audio7" value="c"> c) Ve pel√≠culas en casa.</label>
                        </div>
                    </div>
                    <!-- 8 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øQu√© lleva Sophie cuando viaja?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio8" value="a"> a) Una chaqueta y botas.</label>
                            <label><input type="radio" name="audio8" value="b"> b) Un libro, tel√©fono y paraguas.</label> <!-- correcta -->
                            <label><input type="radio" name="audio8" value="c"> c) Una c√°mara de fotos.</label>
                        </div>
                    </div>
                    <!-- 9 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øQu√© tipo de m√∫sica le gusta a Carlos?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio9" value="a"> a) Rock.</label> <!-- correcta -->
                            <label><input type="radio" name="audio9" value="b"> b) M√∫sica cl√°sica.</label>
                            <label><input type="radio" name="audio9" value="c"> c) Salsa.</label>
                        </div>
                    </div>
                    <!-- 10 -->
                    <div class="audio-pregunta">
                        <p style="font-weight:600;margin-top: 20px">¬øQu√© ciudad de M√©xico menciona Carlos?</p>
                        <div style="background:#f0f0f0; border-radius:8px; padding:10px;">
                            <label><input type="radio" name="audio10" value="a"> a) Ciudad de M√©xico.</label>
                            <label><input type="radio" name="audio10" value="b"> b) Canc√∫n.</label> <!-- correcta -->
                            <label><input type="radio" name="audio10" value="c"> c) Guadalajara.</label>
                        </div>
                    </div>
                </div>
                 </div>
                
                        <div class="button-container">
                            <button class="btn" onclick="cambiarSeccion('lexico')" style="padding:7px;">Volver <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">L√©xico </p>
                            </button>
            
                            <button class="btn" onclick="cambiarSeccion('comunicacion')" style="padding: 7px;">Siguiente <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">Comunicaci√≥n</p>
            
                            </button>
                        </div>
            </div>
        </section>

        <!-- Comunicaci√≥n -->
        <section id="comunicacion" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Comunicaci√≥n<span style="font-weight:400;color:#888;">(6pts.)</span></span>
                </h1>
            </header>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" style="width: 83.33%"></div>
                </div>
            </div>
            <div class="container-a">
                <p style="margin-bottom:15px;">Construye las respuestas correctas seleccionando las opciones en orden. Haz clic en cada segmento para formar frases completas.</p>
    
                <div class="dialog-situation-a">
                    <center><h2 style="font-size: 20px">Situaci√≥n 1: Presentaci√≥n</h2></center>
                    <p style="margin-bottom:10px;"><strong>Mar√≠a:</strong> Hola, me llamo Mar√≠a. ¬øC√≥mo te llamas?</p>
                    
                    <div class="response-segment-a" data-dialog="1">
                        <div class="segment-options-a" data-dialog="1" data-part="1">
                            <button class="segment-btn-a" data-value="Me">Me</button>
                            <button class="segment-btn-a" data-value="Te">Te</button>
                            <button class="segment-btn-a" data-value="Se">Se</button>
                        </div>
                        <div class="segment-options-a" data-dialog="1" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="llamo">llamo</button>
                            <button class="segment-btn-a" data-value="llamas">llamas</button>
                            <button class="segment-btn-a" data-value="llaman">llaman</button>
                        </div>
                        <div class="segment-options-a" data-dialog="1" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="Pedro.">Pedro</button>
                            <button class="segment-btn-a" data-value="paula.">paula</button>
                            <button class="segment-btn-a" data-value="CarlOs.">CarlOs</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response1">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-1">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-1" style="display:none;">
                            <span id="edit-icon-1">‚úèÔ∏è</span> <span id="edit-text-1">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com1" id="com1Input">
               
                    <p style="margin-bottom:10px; margin-top: 20px;"><strong>Mar√≠a:</strong> Encantada. ¬øDe d√≥nde eres?</p>
                    
                    <div class="response-segment-a" data-dialog="2">
                        <div class="segment-options-a" data-dialog="2" data-part="1">
                            <button class="segment-btn-a" data-value="Soy">Soy</button>
                            <button class="segment-btn-a" data-value="Eres">Eres</button>
                            <button class="segment-btn-a" data-value="Son">Son</button>
                        </div>
                        <div class="segment-options-a" data-dialog="2" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="en">en</button>
                            <button class="segment-btn-a" data-value="desde">desde</button>
                        </div>
                        <div class="segment-options-a" data-dialog="2" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="Espa√±a.">Espa√±a</button>
                            <button class="segment-btn-a" data-value="colombia.">colombia</button>
                            <button class="segment-btn-a" data-value="per√∫.">per√∫</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response2">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-2">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-2" style="display:none;">
                            <span id="edit-icon-2">‚úèÔ∏è</span> <span id="edit-text-2">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com2" id="com2Input">
                </div>
                
                <div class="dialog-situation-a">
                    <h2 style="font-size: 20px">Situaci√≥n 2: En la cafeter√≠a</h2></center>
                    <p style="margin-bottom:10px;"><strong>Camarero:</strong> Buenos d√≠as, ¬øqu√© desea tomar?</p>
                    
                    <div class="response-segment-a" data-dialog="3">
                        <div class="segment-options-a" data-dialog="3" data-part="1">
                            <button class="segment-btn-a" data-value="Quiero">Quiero</button>
                            <button class="segment-btn-a" data-value="Tienes">Tienes</button>
                            <button class="segment-btn-a" data-value="Puedo">Puedo</button>
                        </div>
                        <div class="segment-options-a" data-dialog="3" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="un">un</button>
                            <button class="segment-btn-a" data-value="ning√∫n">ning√∫n</button>
                            <button class="segment-btn-a" data-value="de">de</button>
                        </div>
                        <div class="segment-options-a" data-dialog="3" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="caf√©">caf√©</button>
                            <button class="segment-btn-a" data-value="zumo">carne</button>
                            <button class="segment-btn-a" data-value="paella">paella</button>
                        </div>
                        <div class="segment-options-a" data-dialog="3" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="con">con</button>
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="por">por</button>
                        </div>
                        <div class="segment-options-a" data-dialog="3" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="leche.">leche</button>
                            <button class="segment-btn-a" data-value="naranja.">naranja</button>
                            <button class="segment-btn-a" data-value="fr√≠a.">fr√≠a</button>
                        </div>
                    </div>
                 
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response3">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-3">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-3" style="display:none;">
                            <span id="edit-icon-3">‚úèÔ∏è</span> <span id="edit-text-3">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com3" id="com3Input">
                    
                    <p style="margin-bottom:10px; margin-top: 20px;"><strong>Camarero:</strong> ¬øAlgo m√°s?</p>
                    
                    <div class="response-segment-a" data-dialog="4">
                        <div class="segment-options-a" data-dialog="4" data-part="1">
                            <button class="segment-btn-a" data-value="S√≠,">S√≠</button>
                            <button class="segment-btn-a" data-value="No,">No</button>
                            <button class="segment-btn-a" data-value="Tambi√©n,">Tambi√©n</button>
                        </div>
                        <div class="segment-options-a" data-dialog="4" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="gracias.">gracias</button>
                            <button class="segment-btn-a" data-value="inmediatamente.">inmediatamente</button>
                            <button class="segment-btn-a" data-value="perfecto.">perfecto</button>
                        </div>
                        <div class="segment-options-a" data-dialog="4" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="Esto">Esto</button>
                            <button class="segment-btn-a" data-value="Este">Este</button>
                            <button class="segment-btn-a" data-value="Esta">Esta</button>
                        </div>
                        <div class="segment-options-a" data-dialog="4" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="es">es</button>
                            <button class="segment-btn-a" data-value="son">son</button>
                            <button class="segment-btn-a" data-value="eres">eres</button>
                        </div>
                        <div class="segment-options-a" data-dialog="4" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="todo.">todo</button>
                            <button class="segment-btn-a" data-value="delicioso.">delicioso</button>
                            <button class="segment-btn-a" data-value="encantado.">encantado</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response4">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-4">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-4" style="display:none;">
                            <span id="edit-icon-4">‚úèÔ∏è</span> <span id="edit-text-4">Editar respuesta</span>
                        </button>
                    </div>
                    
                    <input type="hidden" name="com4" id="com4Input">
                </div>
                
                <div class="dialog-situation-a">
                    <center><h2 style="font-size: 20px">Situaci√≥n 3: Planes para el fin de semana</h2></center>
                   
                    <p style="margin-bottom:10px;"><strong>Amigo:</strong> ¬øQu√© vas a hacer este fin de semana?</p>
                    
                    <div class="response-segment-a" data-dialog="5">
                        <div class="segment-options-a" data-dialog="5" data-part="1">
                            <button class="segment-btn-a" data-value="Voy">Voy</button>
                            <button class="segment-btn-a" data-value="Quieren">Quieren</button>
                            <button class="segment-btn-a" data-value="pens√°is">pens√°is</button>
                        </div>
                        <div class="segment-options-a" data-dialog="5" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="a">a</button>
                            <button class="segment-btn-a" data-value="ir">ir</button>
                            <button class="segment-btn-a" data-value="gusta">gusta</button>
                        </div>
                        <div class="segment-options-a" data-dialog="5" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="ir">ir</button>
                            <button class="segment-btn-a" data-value="visita">visita</button>
                            <button class="segment-btn-a" data-value="quedarte">quedarte</button>
                        </div>
                        <div class="segment-options-a" data-dialog="5" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="al">al</button>
                            <button class="segment-btn-a" data-value="el">el</button>
                            <button class="segment-btn-a" data-value="en">en</button>
                        </div>
                        <div class="segment-options-a" data-dialog="5" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="cine">cine</button>
                            <button class="segment-btn-a" data-value="museo">museos</button>
                            <button class="segment-btn-a" data-value="casa">casa</button>
                        </div>
                        <div class="segment-options-a" data-dialog="5" data-part="6" style="display:none;">
                            <button class="segment-btn-a" data-value="con">con</button>
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="para">para</button>
                        </div>
                        <div class="segment-options-a" data-dialog="5" data-part="7" style="display:none;">
                            <button class="segment-btn-a" data-value="amigos.">amigos</button>
                            <button class="segment-btn-a" data-value="arte.">arte</button>
                            <button class="segment-btn-a" data-value="nadar.">nadar</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response5">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-5">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-5" style="display:none;">
                            <span id="edit-icon-5">‚úèÔ∏è</span> <span id="edit-text-5">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com5" id="com5Input">
                    
                    <p style="margin-bottom:10px; margin-top: 20px;"><strong>Amigo:</strong> ¬øQu√© m√°s tienes planeado?</p>
                    
                    <div class="response-segment-a" data-dialog="6">
                        <div class="segment-options-a" data-dialog="6" data-part="1">
                            <button class="segment-btn-a" data-value="Pienso">Pienso</button>
                            <button class="segment-btn-a" data-value="Quieres">Quieres</button>
                            <button class="segment-btn-a" data-value="Te">Te</button>
                        </div>
                        <div class="segment-options-a" data-dialog="6" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="ir">ir</button>
                            <button class="segment-btn-a" data-value="a">a</button>
                            <button class="segment-btn-a" data-value="gusta">gusta</button>
                        </div>
                        <div class="segment-options-a" data-dialog="6" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="al">al</button>
                            <button class="segment-btn-a" data-value="visitar">visitar</button>
                            <button class="segment-btn-a" data-value="quedarme">quedarme</button>
                        </div>
                        <div class="segment-options-a" data-dialog="6" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="gimnasio">gimnasio</button>
                            <button class="segment-btn-a" data-value="naturaleza">naturaleza</button>
                            <button class="segment-btn-a" data-value="en">en</button>
                        </div>
                        <div class="segment-options-a" data-dialog="6" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="por">por</button>
                            <button class="segment-btn-a" data-value="museo">museo</button>
                            <button class="segment-btn-a" data-value="casa">casa</button>
                        </div>
                        <div class="segment-options-a" data-dialog="6" data-part="6" style="display:none;">
                            <button class="segment-btn-a" data-value="la">la</button>
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="y">y</button>
                        </div>
                        <div class="segment-options-a" data-dialog="6" data-part="7" style="display:none;">
                            <button class="segment-btn-a" data-value="tarde.">tarde</button>
                            <button class="segment-btn-a" data-value="mediod√≠a.">mediod√≠a</button>
                            <button class="segment-btn-a" data-value="ahora.">ahora</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response6">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-6">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-6" style="display:none;">
                            <span id="edit-icon-6">‚úèÔ∏è</span> <span id="edit-text-6">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com6" id="com6Input">
                </div>
                
                <div class="dialog-situation-a">
                    <center><h2 style="font-size: 20px">Situaci√≥n 4: Describiendo un viaje</h2></center>
                    
                    <p style="margin-bottom:10px;"><strong>Profesor:</strong> Cu√©ntanos sobre tu √∫ltimo viaje.</p>
                    
                    <div class="response-segment-a" data-dialog="7">
                        <div class="segment-options-a" data-dialog="7" data-part="1">
                            <button class="segment-btn-a" data-value="El">El</button>
                            <button class="segment-btn-a" data-value="Pueblo>Pueblo</button>
                            <button class="segment-btn-a" data-value="Los">Los</button>
                        </div>
                        <div class="segment-options-a" data-dialog="7" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="a√±o">a√±o</button>
                            <button class="segment-btn-a" data-value="semana">semana</button>
                            <button class="segment-btn-a" data-value="verano">verano</button>
                        </div>
                        <div class="segment-options-a" data-dialog="7" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="pasado">pasado</button>
                            <button class="segment-btn-a" data-value="pasada">pasada</button>
                            <button class="segment-btn-a" data-value="pasados">pasados</button>
                        </div>
                        <div class="segment-options-a" data-dialog="7" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="he">he</button>
                            <button class="segment-btn-a" data-value="ha">ha</button>
                            <button class="segment-btn-a" data-value="has">has</button>
                        </div>

                           <div class="segment-options-a" data-dialog="7" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="viajado">viajado</button>
                            <button class="segment-btn-a" data-value="hecho">hecho</button>
                            <button class="segment-btn-a" data-value="dormido">dormido</button>
                        </div>
                   
                        <div class="segment-options-a" data-dialog="7" data-part="6" style="display:none;">
                            <button class="segment-btn-a" data-value="con">con</button>
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="por">por</button>
                        </div>
                        <div class="segment-options-a" data-dialog="7" data-part="7" style="display:none;">
                            <button class="segment-btn-a" data-value="mi">mi</button>
                            <button class="segment-btn-a" data-value="mis">mis</button>
                            <button class="segment-btn-a" data-value="nuestro">nuestro</button>
                        </div>
                        <div class="segment-options-a" data-dialog="7" data-part="8" style="display:none;">
                            <button class="segment-btn-a" data-value="familia.">familia</button>
                            <button class="segment-btn-a" data-value="familias.">familias</button>
                            <button class="segment-btn-a" data-value="parejas.">parejas</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response7">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-7">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-7" style="display:none;">
                            <span id="edit-icon-7">‚úèÔ∏è</span> <span id="edit-text-7">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com7" id="com7Input">
                    
                    <p style="margin-bottom:10px; margin-top: 20px;"><strong>Profesor:</strong> ¬øQu√© te ha gustado m√°s de ese lugar?</p>
                    
                    <div class="response-segment-a" data-dialog="8">
                        <div class="segment-options-a" data-dialog="8" data-part="1">
                            <button class="segment-btn-a" data-value="Me">Me</button>
                            <button class="segment-btn-a" data-value="Lo">Lo</button>
                            <button class="segment-btn-a" data-value="Te">Te</button>
                        </div>
                        <div class="segment-options-a" data-dialog="8" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="ha">ha</button>
                            <button class="segment-btn-a" data-value="he">he</button>
                            <button class="segment-btn-a" data-value="encanta">encanta</button>
                        </div>
                        <div class="segment-options-a" data-dialog="8" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="gustado">gustado</button>
                            <button class="segment-btn-a" data-value="gustada">gustada</button>
                            <button class="segment-btn-a" data-value="encanta">encanta</button>
                        </div>
                        <div class="segment-options-a" data-dialog="8" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="comida">comida</button>
                            <button class="segment-btn-a" data-value="ambiente">ambiente</button>
                            <button class="segment-btn-a" data-value="clima">clima</button>
                        </div>
                        <div class="segment-options-a" data-dialog="8" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="y">y</button>
                            <button class="segment-btn-a" data-value="que">que</button>
                            <button class="segment-btn-a" data-value="quien">quien</button>
                        </div>
                        <div class="segment-options-a" data-dialog="8" data-part="6" style="display:none;">
                            <button class="segment-btn-a" data-value="la">la</button>
                            <button class="segment-btn-a" data-value="las">las</button>
                            <button class="segment-btn-a" data-value="los">los</button>
                        </div>
                        <div class="segment-options-a" data-dialog="8" data-part="7" style="display:none;">
                            <button class="segment-btn-a" data-value="gente.">gente</button>
                            <button class="segment-btn-a" data-value="gentes.">gentes</button>
                            <button class="segment-btn-a" data-value="calor.">calor</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response8">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-8">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-8" style="display:none;">
                            <span id="edit-icon-8">‚úèÔ∏è</span> <span id="edit-text-8">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com8" id="com8Input">
                </div>
                
                <div class="dialog-situation-a">
                    <center><h2 style="font-size: 20px">Situaci√≥n 5: Expresando gustos</h2></center>
                    <p style="margin-bottom:10px;"><strong>Amiga:</strong> ¬øQu√© tipo de m√∫sica te gusta?</p>
                    
                    <div class="response-segment-a" data-dialog="9">
                        <div class="segment-options-a" data-dialog="9" data-part="1">
                            <button class="segment-btn-a" data-value="Me">Me</button>
                            <button class="segment-btn-a" data-value="Prefiero">Prefiero</button>
                            <button class="segment-btn-a" data-value="Le">Le</button>
                        </div>
                        <div class="segment-options-a" data-dialog="9" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="gusta">gusta</button>
                            <button class="segment-btn-a" data-value="odio">odio</button>
                            <button class="segment-btn-a" data-value="gustan">gustan</button>
                        </div>
                        <div class="segment-options-a" data-dialog="9" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="la">la</button>
                            <button class="segment-btn-a" data-value="g√©nero">g√©nero</button>
                            <button class="segment-btn-a" data-value="el">el</button>
                        </div>
                        <div class="segment-options-a" data-dialog="9" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="m√∫sica">m√∫sica</button>
                            <button class="segment-btn-a" data-value="musica">musica</button>
                            <button class="segment-btn-a" data-value="m√∫sicas">musicas</button>
                        </div>
                        <div class="segment-options-a" data-dialog="9" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="pop.">pop</button>
                            <button class="segment-btn-a" data-value="cl√°sico.">cl√°sico</button>
                            <button class="segment-btn-a" data-value="m√∫sico.">m√∫sico</button>
                        </div>
                      
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response9">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-9">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-9" style="display:none;">
                            <span id="edit-icon-9">‚úèÔ∏è</span> <span id="edit-text-9">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com9" id="com9Input">
                    
                    <p style="margin-bottom:10px; margin-top: 20px;"><strong>Amiga:</strong> Yo prefiero el rock. ¬øQu√© haces en tu tiempo libre?</p>
                    
                    <div class="response-segment-a" data-dialog="10">
                        <div class="segment-options-a" data-dialog="10" data-part="1">
                            <button class="segment-btn-a" data-value="En">En</button>
                            <button class="segment-btn-a" data-value="Normalmente">Normalmente</button>
                            <button class="segment-btn-a" data-value="Cuando">Cuando</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="mi">mi</button>
                            <button class="segment-btn-a" data-value="me">me</button>
                            <button class="segment-btn-a" data-value="tengo">tengo</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="tiempo">tiempo</button>
                            <button class="segment-btn-a" data-value="gusta">gusta</button>
                            <button class="segment-btn-a" data-value="tiempo">prefieren</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="libre">libre</button>
                            <button class="segment-btn-a" data-value="suelo">ocio</button>
                            <button class="segment-btn-a" data-value="prefiero">prefiero</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="me">me</button>
                            <button class="segment-btn-a" data-value="leer">leer</button>
                            <button class="segment-btn-a" data-value="practicar">practicar</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="6" style="display:none;">
                            <button class="segment-btn-a" data-value="gusta">gusta</button>
                            <button class="segment-btn-a" data-value="y">y</button>
                            <button class="segment-btn-a" data-value="deporte">deporte</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="7" style="display:none;">
                            <button class="segment-btn-a" data-value="leer">leer</button>
                            <button class="segment-btn-a" data-value="ver">leo</button>
                            <button class="segment-btn-a" data-value="salir">lee</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="8" style="display:none;">
                            <button class="segment-btn-a" data-value="y">y</button>
                            <button class="segment-btn-a" data-value="series">series</button>
                            <button class="segment-btn-a" data-value="con">con</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="9" style="display:none;">
                            <button class="segment-btn-a" data-value="ver">ver</button>
                            <button class="segment-btn-a" data-value=".">ve</button>
                            <button class="segment-btn-a" data-value="amigos">veo</button>
                        </div>
                        <div class="segment-options-a" data-dialog="10" data-part="10" style="display:none;">
                            <button class="segment-btn-a" data-value="series.">series</button>
                            <button class="segment-btn-a" data-value="serie.">serie</button>
                            <button class="segment-btn-a" data-value="serie.">pel√≠cula</button>
                        </div>
                    </div>
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response10">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-10">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-10" style="display:none;">
                            <span id="edit-icon-10">‚úèÔ∏è</span> <span id="edit-text-10">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com10" id="com10Input">
                </div>
                </div>
                <div class="button-container">
                    <button class="btn" onclick="cambiarSeccion('comprension-auditiva')" style="padding:7px;">Volver <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">C.auditiva</p>
                    </button>
    
                    <button class="btn" onclick="cambiarSeccion('produccion')" style="padding: 7px;">Siguiente <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">P.escrita</p>
    
                    </button>
                </div>
               
            
        </section>

        <!-- Producci√≥n Escrita -->
        <section id="produccion" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Producci√≥n escrita<span style="font-weight:400;color:#888;">(7pts.)</span></span>
                </h1>
            </header>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" style="width: 100%"></div>
                </div>
            </div>
            <div class="container-a">
                 <h2 style="font-size: 20px;">1. Selecciona para producir el tema<span style="font-weight:400;color:#888;"></span></h2>
                
                <div class="dialog-situation-a">
                    <u><p style="margin-bottom:10px;"><strong>Objetivo:</strong></u><br><br> Describe tu rutina diaria y alguna experiencia memorable del pasado.</p>
                    <p style="margin-bottom:15px;">Utiliza las siguientes opciones para construir frases que describan tus actividades cotidianas y una experiencia del pasado.</p>
                    
                    <div class="response-segment-a" data-dialog="11">
                        <div class="segment-options-a" data-dialog="11" data-part="1">
                            <button class="segment-btn-a" data-value="Por">Por</button>
                            <button class="segment-btn-a" data-value="Par">Par</button>
                            <button class="segment-btn-a" data-value="Durante">Durante</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="2" style="display:none;">
                            <button class="segment-btn-a" data-value="la">la</button>
                            <button class="segment-btn-a" data-value="le">le</button>
                            <button class="segment-btn-a" data-value="una">una</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="3" style="display:none;">
                            <button class="segment-btn-a" data-value="tarde,">tarde</button>
                            <button class="segment-btn-a" data-value="tard√©">tard√©</button>
                            <button class="segment-btn-a" data-value="noche">mediod√≠a</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="4" style="display:none;">
                            <button class="segment-btn-a" data-value="hago">hago</button>
                            <button class="segment-btn-a" data-value="hazo">hazo</button>
                            <button class="segment-btn-a" data-value="hice">hice</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="5" style="display:none;">
                            <button class="segment-btn-a" data-value="deberes">deberes</button>
                            <button class="segment-btn-a" data-value="sue√±o">sue√±o</button>
                            <button class="segment-btn-a" data-value="palabras">palabras</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="6" style="display:none;">
                            <button class="segment-btn-a" data-value="y">y</button>
                            <button class="segment-btn-a" data-value="ll">ll</button>
                            <button class="segment-btn-a" data-value="e">e</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="7" style="display:none;">
                            <button class="segment-btn-a" data-value="juego">juego</button>
                            <button class="segment-btn-a" data-value="jueg√≥">jueg√≥</button>
                            <button class="segment-btn-a" data-value="veo">veo</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="8" style="display:none;">
                            <button class="segment-btn-a" data-value="con">con</button>
                            <button class="segment-btn-a" data-value="com">com</button>
                            <button class="segment-btn-a" data-value="contra">contra</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="9" style="display:none;">
                            <button class="segment-btn-a" data-value="mi">mi</button>
                            <button class="segment-btn-a" data-value="mis">mis</button>
                            <button class="segment-btn-a" data-value="tu">tu</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="10" style="display:none;">
                            <button class="segment-btn-a" data-value="perro.">perro</button>
                            <button class="segment-btn-a" data-value="pero.">pero</button>
                            <button class="segment-btn-a" data-value="pera.">pera</button>
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="11" style="display:none;">
                            <button class="segment-btn-a" data-value="Los">Los</button>
                            <button class="segment-btn-a" data-value="Las">Las</button> <!-- Error gramatical (g√©nero) -->
                            <button class="segment-btn-a" data-value="El">El</button> <!-- Error gramatical (singular) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="12" style="display:none;">
                            <button class="segment-btn-a" data-value="viernes,">viernes</button>
                            <button class="segment-btn-a" data-value="vienes,">vienes</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="sabados,">sabados</button> <!-- Error tem√°tico (d√≠a diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="13" style="display:none;">
                            <button class="segment-btn-a" data-value="veo">veo</button>
                            <button class="segment-btn-a" data-value="beo">beo</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="vio">vio</button> <!-- Error gramatical (pasado) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="14" style="display:none;">
                            <button class="segment-btn-a" data-value="pel√≠culas">pel√≠culas</button>
                            <button class="segment-btn-a" data-value="peliculas">peliculas</button> <!-- Error ortogr√°fico (sin acento) -->
                            <button class="segment-btn-a" data-value="sereis">sereis</button> <!-- Error tem√°tico (contenido diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="15" style="display:none;">
                            <button class="segment-btn-a" data-value="con">con</button>
                            <button class="segment-btn-a" data-value="kon">kon</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="entre">entre</button> <!-- Error gramatical (preposici√≥n diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="16" style="display:none;">
                            <button class="segment-btn-a" data-value="mi">mi</button>
                            <button class="segment-btn-a" data-value="m√≠">m√≠</button> <!-- Error ortogr√°fico/gramatical -->
                            <button class="segment-btn-a" data-value="mio">mio</button> <!-- Error gramatical (posesivo plural) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="17" style="display:none;">
                            <button class="segment-btn-a" data-value="familia.">familia</button>
                            <button class="segment-btn-a" data-value="famila.">famila</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="amigos.">amigos</button> <!-- Error tem√°tico (grupo diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="18" style="display:none;">
                            <button class="segment-btn-a" data-value="Este">Este</button>
                            <button class="segment-btn-a" data-value="Est√©">Est√©</button> <!-- Error ortogr√°fico/gramatical -->
                            <button class="segment-btn-a" data-value="Esta">Esta</button> <!-- Error gramatical (art√≠culo) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="19" style="display:none;">
                            <button class="segment-btn-a" data-value="a√±o">a√±o</button>
                            <button class="segment-btn-a" data-value="ano">ano</button> <!-- Error ortogr√°fico (sin √±) -->
                            <button class="segment-btn-a" data-value="meses">meses</button> <!-- Error tem√°tico (tiempo diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="20" style="display:none;">
                            <button class="segment-btn-a" data-value="he">he</button>
                            <button class="segment-btn-a" data-value="e">e</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="has">has</button> <!-- Error gramatical (2a persona) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="21" style="display:none;">
                            <button class="segment-btn-a" data-value="ido">ido</button>
                            <button class="segment-btn-a" data-value="√≠do">√≠do</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="vido">vido</button> <!-- Error tem√°tico (verbo diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="22" style="display:none;">
                            <button class="segment-btn-a" data-value="a">a</button>
                            <button class="segment-btn-a" data-value="ha">ha</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="al">al</button> <!-- Error gramatical (contracci√≥n) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="23" style="display:none;">
                            <button class="segment-btn-a" data-value="un">un</button>
                            <button class="segment-btn-a" data-value="√∫n">√∫n</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="el">el</button> <!-- Error gramatical (art√≠culo definido) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="24" style="display:none;">
                            <button class="segment-btn-a" data-value="parque">parque</button>
                            <button class="segment-btn-a" data-value="parqe">parqe</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="edificio">edificio</button> <!-- Error tem√°tico (lugar diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="25" style="display:none;">
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="d√©">d√©</button> <!-- Error ortogr√°fico/gramatical -->
                            <button class="segment-btn-a" data-value="del">del</button> <!-- Error gramatical (contracci√≥n) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="26" style="display:none;">
                            <button class="segment-btn-a" data-value="atracciones">atracciones</button>
                            <button class="segment-btn-a" data-value="atraciones">atraciones</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="juegos">juegos</button> <!-- Error tem√°tico (concepto similar pero incorrecto) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="27" style="display:none;">
                            <button class="segment-btn-a" data-value="con">con</button>
                            <button class="segment-btn-a" data-value="bon">bon</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="por">por</button> <!-- Error gramatical (preposici√≥n diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="28" style="display:none;">
                            <button class="segment-btn-a" data-value="mis">mis</button>
                            <button class="segment-btn-a" data-value="m√≠s">m√≠s</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="tus">tus</button> <!-- Error gramatical (posesivo 2a persona) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="29" style="display:none;">
                            <button class="segment-btn-a" data-value="primos.">primos</button>
                            <button class="segment-btn-a" data-value="primso.">primso</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="ciudades.">ciudades</button> <!-- Error tem√°tico (relaci√≥n diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="30" style="display:none;">
                            <button class="segment-btn-a" data-value="He">He</button>
                            <button class="segment-btn-a" data-value="E">E</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="Has">Has</button> <!-- Error gramatical (2a persona) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="31" style="display:none;">
                            <button class="segment-btn-a" data-value="montado">montado</button>
                            <button class="segment-btn-a" data-value="montao">montao</button> <!-- Error ortogr√°fico (coloquialismo) -->
                            <button class="segment-btn-a" data-value="hecho">hecho</button> <!-- Error tem√°tico (sin√≥nimo no usado en contexto) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="32" style="display:none;">
                            <button class="segment-btn-a" data-value="en">en</button>
                            <button class="segment-btn-a" data-value="em">em</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="po">por</button> <!-- Error gramatical (preposici√≥n diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="33" style="display:none;">
                            <button class="segment-btn-a" data-value="una">una</button>
                            <button class="segment-btn-a" data-value="un√°">un√°</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="unos">unos</button> <!-- Error gramatical (art√≠culo definido) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="34" style="display:none;">
                            <button class="segment-btn-a" data-value="monta√±a,">monta√±a</button>
                            <button class="segment-btn-a" data-value="montana,">montana</button> <!-- Error ortogr√°fico (sin √±) -->
                            <button class="segment-btn-a" data-value="playa,">playa</button> <!-- Error tem√°tico (concepto similar) -->
                        </div>
                        
                        <div class="segment-options-a" data-dialog="11" data-part="35" style="display:none;">
                            <button class="segment-btn-a" data-value="he">he</button>
                            <button class="segment-btn-a" data-value="je">je</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="han">han</button> <!-- Error gramatical (3a persona plural) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="36" style="display:none;">
                            <button class="segment-btn-a" data-value="comido">comido</button>
                            <button class="segment-btn-a" data-value="comi√≥">comi√≥</button> <!-- Error gramatical (pasado simple) -->
                            <button class="segment-btn-a" data-value="frito">frito</button> <!-- Error tem√°tico (acci√≥n diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="37" style="display:none;">
                            <button class="segment-btn-a" data-value="ca√±a">ca√±a</button>
                            <button class="segment-btn-a" data-value="algodon">algodon</button> <!-- Error ortogr√°fico (sin acento) -->
                            <button class="segment-btn-a" data-value="zumo">zumo</button> <!-- Error tem√°tico (dulce diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="38" style="display:none;">
                            <button class="segment-btn-a" data-value="de">de</button>
                            <button class="segment-btn-a" data-value="d√©">d√©</button> <!-- Error ortogr√°fico/gramatical -->
                            <button class="segment-btn-a" data-value="del">del</button> <!-- Error gramatical (contracci√≥n) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="39" style="display:none;">
                            <button class="segment-btn-a" data-value="az√∫car">az√∫car</button>
                            <button class="segment-btn-a" data-value="as√∫car">as√∫car</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="miel">miel</button> <!-- Error tem√°tico (endulzante diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="40" style="display:none;">
                            <button class="segment-btn-a" data-value="y">y</button>
                            <button class="segment-btn-a" data-value="i">i</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="e">e</button> <!-- Error gramatical (conjunci√≥n alternativa) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="41" style="display:none;">
                            <button class="segment-btn-a" data-value="he">he</button>
                            <button class="segment-btn-a" data-value="e">e</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="hab√≠a">hab√≠a</button> <!-- Error gramatical (copret√©rito) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="42" style="display:none;">
                            <button class="segment-btn-a" data-value="tomado">tomado</button>
                            <button class="segment-btn-a" data-value="tomad√≥">tomad√≥</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="tirado">tirado</button> <!-- Error tem√°tico (verbo diferente) -->
                        </div>
                       
                        <div class="segment-options-a" data-dialog="11" data-part="43" style="display:none;">
                            <button class="segment-btn-a" data-value="fotos.">fotos</button>
                            <button class="segment-btn-a" data-value="foto.">foto</button> <!-- Error gramatical (singular) -->
                            <button class="segment-btn-a" data-value="fot√≥grafos.">fot√≥grafos</button> <!-- Error tem√°tico (medio diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="44" style="display:none;">
                            <button class="segment-btn-a" data-value="¬°Ha">¬°Ha</button>
                            <button class="segment-btn-a" data-value="¬°A">¬°A</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="¬°Han">¬°Han</button> <!-- Error gramatical (plural) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="45" style="display:none;">
                            <button class="segment-btn-a" data-value="sido">sido</button>
                            <button class="segment-btn-a" data-value="sidoo">sidoo</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="estado">estado</button> <!-- Error tem√°tico (verbo similar) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="46" style="display:none;">
                            <button class="segment-btn-a" data-value="el">el</button>
                            <button class="segment-btn-a" data-value="√©l">√©l</button> <!-- Error ortogr√°fico/gramatical -->
                            <button class="segment-btn-a" data-value="un">un</button> <!-- Error gramatical (art√≠culo indefinido) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="47" style="display:none;">
                            <button class="segment-btn-a" data-value="mejor">mejor</button>
                            <button class="segment-btn-a" data-value="major">major</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="peor">peor</button> <!-- Error tem√°tico (ant√≥nimo) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="48" style="display:none;">
                            <button class="segment-btn-a" data-value="d√≠a">d√≠a</button>
                            <button class="segment-btn-a" data-value="dia">dia</button> <!-- Error ortogr√°fico (sin acento) -->
                            <button class="segment-btn-a" data-value="mes">mes</button> <!-- Error tem√°tico (tiempo diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="49" style="display:none;">
                            <button class="segment-btn-a" data-value="del">del</button>
                            <button class="segment-btn-a" data-value="d√©l">d√©l</button> <!-- Error ortogr√°fico -->
                            <button class="segment-btn-a" data-value="al">al</button> <!-- Error gramatical (contracci√≥n diferente) -->
                        </div>
                        <div class="segment-options-a" data-dialog="11" data-part="50" style="display:none;">
                            <button class="segment-btn-a" data-value="a√±o!">a√±o</button>
                            <button class="segment-btn-a" data-value="ano!">ano</button> <!-- Error ortogr√°fico (sin √±) -->
                            <button class="segment-btn-a" data-value="mess!">mess</button> <!-- Error tem√°tico (tiempo diferente) -->
                        </div>
                    </div>
                    
                    
                    <div class="response-container-a">
                        <p class="response-display-a" id="response11">Tu respuesta aparecer√° aqu√≠</p>
                        <p class="help-text-a" id="help-text-11">Haz clic en cualquier palabra para editarla</p>
                        <button class="edit-button-a" id="edit-btn-11" style="display:none;">
                            <span id="edit-icon-11">‚úèÔ∏è</span> <span id="edit-text-11">Editar respuesta</span>
                        </button>
                    </div>
                    <input type="hidden" name="com11" id="com11Input">
                </div>
            </div>
            <div class="button-container">
                <button class="btn" onclick="cambiarSeccion('comunicacion')" style="padding:7px;">Volver <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">Comunicaci√≥n</p>
                </button>

                <button class="btn" onclick="cambiarSeccion('resultados')" style="padding: 7px;">Siguiente <p style="font-size:9px; color:greenyellow; padding: 1px;margin: 0;">Resultados</p>

                </button>
            </div>
        </section>

        <!-- Resultados -->
        <section id="resultados" class="section">
            <header>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                    <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Resultados del examen</span>
                </h1>
            </header>
            <div class="content">
                <div class="results">
                    <div class="score" style="background: linear-gradient(135deg, #3867d6, #7f53ac); color: white; padding: 15px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(56,103,214,0.2); font-weight: 600; letter-spacing: 1.5px; margin: 30px auto; max-width: 200px; text-align: center; animation: scoreAppear 1.2s ease-out, scoreGlow 2s infinite alternate, scoreBackground 8s infinite;">
                        <span style="display: inline-block; animation: scoreCountUp 2.5s ease-out forwards;">40/40</span>
                    </div>

                    <div class="result-item" style="background-color: #ececec;border-radius: 10%;padding: 20px;">
                        <h3 style="text-align: center;">Comprensi√≥n de Lectura</h3>
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="position: relative; width: 90px; height: 90px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                                <svg width="120" height="120" viewBox="0 0 90 90" style="display:block; position: absolute;">
                                    <!-- Fondo hex√°gono -->
                                    <polygon points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#e3e9ff" stroke-width="8"/>
                                    <!-- Hex√°gono animado -->
                                    <polygon id="cl-anim-hex" points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#3867d6" stroke-width="8"
                                        stroke-dasharray="250"
                                        stroke-dashoffset="210"
                                        style="stroke-linecap: round; animation: hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards;"/>
                                </svg>
                                <span id="cl-score" style="position:absolute;top:10;left:10;font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#3867d6,#7f53ac);-webkit-background-clip:text;background-clip:text;color:transparent;animation:pulse 1.2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);">6/6</span>
                            </div>
                        </div>
                    </div>
                    <div class="result-item" style="background-color: #ececec;border-radius: 10%;padding: 20px;">
                        <h3 style="text-align: center;">Gram√°tica</h3>
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="position: relative; width: 90px; height: 90px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                                <svg width="120" height="120" viewBox="0 0 90 90" style="display:block; position: absolute;">
                                    <!-- Fondo hex√°gono -->
                                    <polygon points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#e3e9ff" stroke-width="8"/>
                                    <!-- Hex√°gono animado -->
                                    <polygon id="g-anim-hex" points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#3867d6" stroke-width="8"
                                        stroke-dasharray="250"
                                        stroke-dashoffset="210"
                                        style="stroke-linecap: round; animation: hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards;"/>
                                </svg>
                                <span id="g-score" style="position:absolute;top:10;left:10;font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#3867d6,#7f53ac);-webkit-background-clip:text;background-clip:text;color:transparent;animation:pulse 1.2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);">7/7</span>
                            </div>
                        </div>
                    </div>
                
                    <div class="result-item" style="background-color: #ececec;border-radius: 10%;padding: 20px;">
                        <h3 style="text-align: center;">L√©xico</h3>
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="position: relative; width: 90px; height: 90px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                                <svg width="120" height="120" viewBox="0 0 90 90" style="display:block; position: absolute;">
                                    <!-- Fondo hex√°gono -->
                                    <polygon points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#e3e9ff" stroke-width="8"/>
                                    <!-- Hex√°gono animado -->
                                    <polygon id="g-anim-hex" points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#3867d6" stroke-width="8"
                                        stroke-dasharray="250"
                                        stroke-dashoffset="210"
                                        style="stroke-linecap: round; animation: hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards;"/>
                                </svg>
                                <span id="g-score" style="position:absolute;top:10;left:10;font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#3867d6,#7f53ac);-webkit-background-clip:text;background-clip:text;color:transparent;animation:pulse 1.2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);">7/7</span>
                            </div>
                        </div>
                    </div>
                    <div class="result-item" style="background-color: #ececec;border-radius: 10%;padding: 20px;">
                        <h3 style="text-align: center;">Comprensi√≥n auditiva</h3>
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="position: relative; width: 90px; height: 90px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                                <svg width="120" height="120" viewBox="0 0 90 90" style="display:block; position: absolute;">
                                    <!-- Fondo hex√°gono -->
                                    <polygon points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#e3e9ff" stroke-width="8"/>
                                    <!-- Hex√°gono animado -->
                                    <polygon id="g-anim-hex" points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#3867d6" stroke-width="8"
                                        stroke-dasharray="250"
                                        stroke-dashoffset="210"
                                        style="stroke-linecap: round; animation: hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards;"/>
                                </svg>
                                <span id="g-score" style="position:absolute;top:10;left:10;font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#3867d6,#7f53ac);-webkit-background-clip:text;background-clip:text;color:transparent;animation:pulse 1.2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);">7/7</span>
                            </div>
                        </div>
                    </div>
                    <div class="result-item" style="background-color: #ececec;border-radius: 10%;padding: 20px;">
                        <h3 style="text-align: center;">Comunicaci√≥n</h3>
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="position: relative; width: 90px; height: 90px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                                <svg width="120" height="120" viewBox="0 0 90 90" style="display:block; position: absolute;">
                                    <!-- Fondo hex√°gono -->
                                    <polygon points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#e3e9ff" stroke-width="8"/>
                                    <!-- Hex√°gono animado -->
                                    <polygon id="g-anim-hex" points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#3867d6" stroke-width="8"
                                        stroke-dasharray="250"
                                        stroke-dashoffset="210"
                                        style="stroke-linecap: round; animation: hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards;"/>
                                </svg>
                                <span id="g-score" style="position:absolute;top:10;left:10;font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#3867d6,#7f53ac);-webkit-background-clip:text;background-clip:text;color:transparent;animation:pulse 1.2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);">6/6</span>
                            </div>
                        </div>
                    </div>
                    <div class="result-item" style="background-color: #ececec;border-radius: 10%;padding: 20px;">
                        <h3 style="text-align: center;">Producci√≥n escrita</h3>
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="position: relative; width: 90px; height: 90px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                                <svg width="120" height="120" viewBox="0 0 90 90" style="display:block; position: absolute;">
                                    <!-- Fondo hex√°gono -->
                                    <polygon points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#e3e9ff" stroke-width="8"/>
                                    <!-- Hex√°gono animado -->
                                    <polygon id="g-anim-hex" points="45,10 80,30 80,65 45,85 10,65 10,30"
                                        fill="none" stroke="#3867d6" stroke-width="8"
                                        stroke-dasharray="250"
                                        stroke-dashoffset="210"
                                        style="stroke-linecap: round; animation: hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards;"/>
                                </svg>
                                <span id="g-score" style="position:absolute;top:10;left:10;font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#3867d6,#7f53ac);-webkit-background-clip:text;background-clip:text;color:transparent;animation:pulse 1.2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);">7/7</span>
                            </div>
                        </div>
                    </div>
                   

                    <center>
                        <button class="btn" onclick="cambiarSeccion('inicio')" style="padding: 15px 40px; font-size: 1.1em; border-radius: 30px; background: linear-gradient(90deg, #3867d6 60%, #7f53ac 100%); transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(56,103,214,0.3);">
                            <span style="margin-right: 10px;">‚Üê</span>Volver al inicio
                        </button>
                    </center>
                </div>
            </div>
        </section>

        <footer>
            <p style="font-size: 0.7em; text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                ¬© 2025 Examen interactivo A1<br>
                <span style="color: #3867d6; font-weight: 500;">Prof. Faouzi ElHilali</span><br>
                Todos los derechos reservados
            </p>
        </footer>
    </div>
<!-- Timer del examen -->
<div class="exam-timer" id="examTimer">
    <span class="exam-timer-icon">‚è±Ô∏è</span>
    <span id="timerDisplay">120:00</span>
</div>

<!-- Modal de tiempo agotado -->
<div class="timeout-modal" id="timeoutModal">
    <div class="timeout-modal-content">
        <div class="timeout-modal-header">
            ¬°Tiempo agotado!
        </div>
        <div class="timeout-modal-body">
            <p>Se ha terminado el tiempo asignado para el examen.</p>
            <p>Ser√°s dirigido a la p√°gina de resultados.</p>
            <button class="timeout-modal-button"  id="timeoutButton">Ver resultados</button>
        </div>
    </div>
</div>
    <script>



// Generar identificador personalizado si no existe
let identificador = localStorage.getItem('identificadorUnico');
if (!identificador) {
    // Recupera nombre y apellido del formulario o localStorage
    let nombre = localStorage.getItem('examUserNombre') || '';
    let apellido = localStorage.getItem('examUserApellido') || '';
    // Si a√∫n no est√°n en localStorage, puedes obtenerlos del input si es el primer login
    if (!nombre && document.getElementById('nombre')) nombre = document.getElementById('nombre').value.trim();
    if (!apellido && document.getElementById('apellido')) apellido = document.getElementById('apellido').value.trim();

    // Solo genera si ambos existen
    if (nombre && apellido) {
        identificador = generarIdentificadorPersonalizado(nombre, apellido);
        localStorage.setItem('identificadorUnico', identificador);
    }
}

function generarIdentificadorPersonalizado(nombre, apellido) {
    // Limpiar espacios y pasar a min√∫sculas para las posiciones
    nombre = nombre.trim();
    apellido = apellido.trim();

    // Primera letra
    const primeraNombre = nombre[0].toUpperCase();
    const primeraApellido = apellido[0].toUpperCase();

    // Posiciones alfab√©ticas (A=1, B=2, ..., Z=26)
    const posPrimeraNombre = (primeraNombre.charCodeAt(0) - 64).toString();
    const posPrimeraApellido = (primeraApellido.charCodeAt(0) - 64).toString();

    // √öltima letra
    const ultimaNombre = nombre[nombre.length - 1].toLowerCase();
    const ultimaApellido = apellido[apellido.length - 1].toLowerCase();

    // Posiciones alfab√©ticas de las √∫ltimas letras
    const posUltimaNombre = (ultimaNombre.charCodeAt(0) - 96).toString();
    const posUltimaApellido = (ultimaApellido.charCodeAt(0) - 96).toString();

    // Longitudes
    const lenNombre = nombre.length.toString();
    const lenApellido = apellido.length.toString();

    // Formato final
    return `${primeraNombre}${primeraApellido}-${posPrimeraNombre}${posPrimeraApellido}-${ultimaNombre}${ultimaApellido}-${posUltimaNombre}${posUltimaApellido}-${lenNombre}${lenApellido}`;
}



// L√≥gica del formulario de login
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const nombreInput = document.getElementById('nombre');
    const apellidoInput = document.getElementById('apellido');
    const nombreError = document.getElementById('nombre-error');
    const apellidoError = document.getElementById('apellido-error');
    const startExamBtn = document.getElementById('startExamBtn');
    
    // A√±adir clase de pulsaci√≥n al bot√≥n despu√©s de cargar la p√°gina
    setTimeout(() => {
        startExamBtn.classList.add('pulsate');
    }, 2000);
    
    // Comprobar si ya hay informaci√≥n guardada y rellenar el formulario
    const savedNombre = localStorage.getItem('examUserNombre');
    const savedApellido = localStorage.getItem('examUserApellido');
    
    if (savedNombre) {
        nombreInput.value = savedNombre;
    }
    
    if (savedApellido) {
        apellidoInput.value = savedApellido;
    }
      // Asegurarse de que los campos est√©n vac√≠os al cargar la p√°gina
    nombreInput.value = '';
    apellidoInput.value = '';
 // Modifica la funci√≥n de env√≠o del formulario de login
loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validar campos
    const nombre = nombreInput.value.trim();
    const apellido = apellidoInput.value.trim();
    
    if (!nombre) {
        nombreError.textContent = "Por favor, introduce tu nombre";
        nombreError.style.display = 'block';
        return;
    }
    
    if (!apellido) {
        apellidoError.textContent = "Por favor, introduce tu apellido";
        apellidoError.style.display = 'block';
        return;
    }
    
    // PRIMERO guardar el nombre actual como el √∫ltimo utilizado
    localStorage.setItem('lastExamUserNombre', nombre);
    localStorage.setItem('lastExamUserApellido', apellido);
    
    // LUEGO guardar los datos de la sesi√≥n actual
    localStorage.setItem('examUserNombre', nombre);
    localStorage.setItem('examUserApellido', apellido);
    localStorage.setItem('examStartTime', new Date().toISOString());
    
    // Generar identificador personalizado
    const identificador = generarIdentificadorPersonalizado(nombre, apellido);
    localStorage.setItem('identificadorUnico', identificador);
    
    // Mostrar animaci√≥n en el bot√≥n
    startExamBtn.textContent = 'Cargando...';
    startExamBtn.disabled = true;
    
    // Verificar identificador antes de continuar
    verificarIdentificadorAntesDeComenzar(nombre, apellido, identificador);


});
    
    // Validaci√≥n en tiempo real
    nombreInput.addEventListener('input', function() {
        if (this.value.trim()) {
            nombreError.style.display = 'none';
        }
    });
    
    apellidoInput.addEventListener('input', function() {
        if (this.value.trim()) {
            apellidoError.style.display = 'none';
        }
    });
});


// L√≥gica del timer del examen
// Guardar y restaurar el estado del timer
let examTimerInterval;
let remainingSeconds = 120* 60; //  minutos en segundos por defecto

function startExamTimer() {
    const timerElement = document.getElementById('examTimer');
    const timerDisplay = document.getElementById('timerDisplay');
    const DURATION_SECONDS = 120 * 60; // 120 minutos

    // Si no hay tiempo de inicio, lo guardamos
    let examStartTimestamp = localStorage.getItem('examStartTimestamp');
    if (!examStartTimestamp) {
        examStartTimestamp = Date.now();
        localStorage.setItem('examStartTimestamp', examStartTimestamp);
        localStorage.setItem('examDurationSeconds', DURATION_SECONDS);
    }

    // Calcular segundos restantes en base al tiempo real
    const duration = parseInt(localStorage.getItem('examDurationSeconds'), 10) || DURATION_SECONDS;
    function getRemainingSeconds() {
        const now = Date.now();
        const elapsed = Math.floor((now - parseInt(localStorage.getItem('examStartTimestamp'), 10)) / 1000);
        return Math.max(duration - elapsed, 0);
    }

    // Mostrar el timer con animaci√≥n
    setTimeout(() => {
        timerElement.classList.add('active');
    }, 1000);

    function updateTimer() {
        const remainingSeconds = getRemainingSeconds();
        const minutes = Math.floor(remainingSeconds / 60);
        const seconds = remainingSeconds % 60;
        timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

        // Cambiar colores seg√∫n el tiempo restante
        if (remainingSeconds <= 300) {
            timerElement.classList.add('critical');
        } else if (remainingSeconds <= 600) {
            timerElement.classList.add('warning');
            timerElement.classList.remove('critical');
        } else {
            timerElement.classList.remove('warning', 'critical');
        }

        if (remainingSeconds <= 0) {
            clearInterval(examTimerInterval);
            localStorage.removeItem('examStartTimestamp');
            localStorage.removeItem('examDurationSeconds');
            showTimeoutModal();
        }
    }

    // Actualizar el display inmediatamente
    updateTimer();

    // Iniciar el intervalo para actualizar el timer
    if (window.examTimerInterval) clearInterval(window.examTimerInterval);
    window.examTimerInterval = setInterval(updateTimer, 1000);
}

function showTimeoutModal() {
    const timeoutModal = document.getElementById('timeoutModal');
    const timeoutButton = document.getElementById('timeoutButton');
    
    // Guardar la hora de finalizaci√≥n en localStorage
    const endTime = new Date().toISOString();
    localStorage.setItem('examEndTime', endTime);
    
    // Ocultar el timer
    const timerElement = document.getElementById('examTimer');
    if (timerElement) {
        timerElement.classList.remove('active');
        timerElement.style.opacity = 0;
        timerElement.style.visibility = 'hidden';
    }
    
    // Primero, eliminamos cualquier listener existente
    timeoutButton.replaceWith(timeoutButton.cloneNode(true));
    
    // Obtenemos el bot√≥n nuevamente despu√©s de clonarlo
    const newTimeoutButton = document.getElementById('timeoutButton');
    timeoutModal.classList.add('active');
    
    // A√±adimos el comportamiento igual al bot√≥n "Siguiente Resultados"
    newTimeoutButton.addEventListener('click', function() {
        timeoutModal.classList.remove('active');
        
        // Enviar datos del examen
        enviarDatosExamen();
        
        // Calcular las puntuaciones como lo hace el bot√≥n original
        const puntajeCL = calcularPuntajeComprension();
        const puntajeG = calcularPuntajeGramatica();
        const puntajeL = calcularPuntajeLexico();
        const puntajeA = calcularPuntajeAuditiva();
        const puntajeC = calcularPuntajeComunicacion();
        const puntajeP = calcularPuntajeProduccion();
        
        let total = puntajeCL + puntajeG + puntajeL + puntajeA + puntajeC + puntajeP;
        if (total > 40) total = 40;
        
        // Cambiar a la secci√≥n de resultados
        cambiarSeccion('resultados');
        
        // Actualizar los valores en la p√°gina de resultados
        const resultados = document.querySelector('#resultados .results');
        if (resultados) {
            // Actualiza la puntuaci√≥n total
            const scoreDiv = resultados.querySelector('.score');
            if (scoreDiv) {
                scoreDiv.innerHTML = `
                    <span style="display:block;font-size:2.5rem;font-weight:700;line-height:1.1;">
                        ${Number(total).toFixed(1)}
                    </span>
                    <span style="display:block;font-size:1.2rem;font-weight:400;line-height:1.1;">
                        /40
                    </span>
                `;
            }
            
            // Actualiza cada secci√≥n
            const cl = resultados.querySelector('.result-item:nth-child(2) span');
            if (cl) cl.textContent = `${puntajeCL}/6`;
            const g = resultados.querySelector('.result-item:nth-child(3) span');
            if (g) g.textContent = `${puntajeG}/7`;
            const l = resultados.querySelector('.result-item:nth-child(4) span');
            if (l) l.textContent = `${puntajeL}/7`;
            const a = resultados.querySelector('.result-item:nth-child(5) span');
            if (a) a.textContent = `${puntajeA}/7`;
            const c = resultados.querySelector('.result-item:nth-child(6) span');
            if (c) c.textContent = `${puntajeC}/6`;
            const p = resultados.querySelector('.result-item:nth-child(7) span');
            if (p) p.textContent = `${puntajeP}/7`;
        }
    });
}



// Modificar la funci√≥n de inicio para empezar el timer
const originalCambiarSeccion = window.cambiarSeccion;
window.cambiarSeccion = function(seccionId) {
    originalCambiarSeccion(seccionId);
    
    // Iniciar el timer en todas las secciones del examen excepto login, inicio y resultados
    if ((seccionId === 'comprension' || seccionId === 'comprension-auditiva' || 
         seccionId === 'lexico' || seccionId === 'gramatica' || 
         seccionId === 'comunicacion' || seccionId === 'produccion') && !examTimerInterval) {
        startExamTimer();
        forzarAparicionTimer();
    }
};



document.addEventListener('DOMContentLoaded', function() {
    const audio = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('audioPlayBtn');
    const counter = document.getElementById('audioCount');
    let remaining = 3;
    let isPlaying = false;

    if (audio && playBtn && counter) {
        // Precarga el audio para evitar problemas
        audio.load();
        
        playBtn.addEventListener('click', function() {
            if (remaining <= 0 || isPlaying) return;
            
            // Intenta reproducir y maneja errores
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                isPlaying = true;
                audio.currentTime = 0;
                playBtn.disabled = true;
                playBtn.textContent = "üîä Reproduciendo...";
                
                playPromise.catch(error => {
                    // Si hay error de reproducci√≥n, restaura el estado
                    console.error("Error al reproducir:", error);
                    isPlaying = false;
                    playBtn.disabled = false;
                    playBtn.textContent = "‚ñ∂Ô∏è Continuar audio";
                    
                    // Intentar mostrar el mensaje del error
                    alert("No se pudo reproducir el audio. Intenta hacer clic de nuevo o verifica que tu navegador permita reproducci√≥n de audio.");
                });
            }
        });
// ...existing code...
audio.addEventListener('ended', function() {
    remaining--;
    localStorage.setItem('audioCount', remaining); // Guarda el contador
    isPlaying = false;

    // Crear nuevo contador
    const newCounter = document.createElement('span');
    newCounter.id = 'audioCount';
    newCounter.className = 'audio-count-anim';
    newCounter.style = 'display:inline-block;min-width:22px;text-align:center;background:#dc3545;color:white;border-radius:50%;margin-left:8px;font-size:0.85em;padding:3px;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2);';
    newCounter.textContent = remaining;

    // Animaci√≥n elegante
    newCounter.classList.remove('pop');
    void newCounter.offsetWidth;
    newCounter.classList.add('pop');

    if (remaining > 0) {
        playBtn.disabled = false;
        playBtn.innerHTML = '<i style="display:inline-block;font-size:1.2em;margin-right:5px;">üéß</i> Escuchar audio ';
        playBtn.appendChild(newCounter);

        // Reasignar evento click
        playBtn.onclick = function() {
            if (remaining <= 0 || isPlaying) return;
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                isPlaying = true;
                audio.currentTime = 0;
                playBtn.disabled = true;
                playBtn.textContent = "üîä Reproduciendo...";
                playPromise.catch(error => {
                    isPlaying = false;
                    playBtn.disabled = false;
                    playBtn.textContent = "‚ñ∂Ô∏è Continuar audio";
                    alert("No se pudo reproducir el audio. Intenta hacer clic de nuevo o verifica que tu navegador permita reproducci√≥n de audio.");
                });
            }
        };
    } else {
        playBtn.disabled = true;
        playBtn.innerHTML = '<span style="color:#e67e22;font-weight:500;font-size:1em;display:inline-block;animation:pulseMessage 0.5s infinite;">Has agotado tus 3 escuchas</span>';
    }
});
// ...existing code...
    }
});




   setTimeout(function() {
                                    var hex = document.getElementById('cl-anim-hex');
                                    if(hex) {
                                        hex.style.animation = "hexProgress 1.2s cubic-bezier(.68,-0.55,.27,1.55) forwards";
                                    }
                                }, 300);

/* --- L√≥gica de puntuaci√≥n Comprensi√≥n de Lectura --- */
function calcularPuntajeComprension() {
    const respuestas = {
        vf1: "F",
        vf2: "V",
        vf3: "F",
        vf4: "V",
        vf5: "F",
        sm1: "b",
        sm2: "b",
        sm3: "b",
        comp1: "m√≥vil",
        comp2: "paella",
        comp3: "M√©xico",
        comp4: "Per√∫"
    };
    let puntaje = 0;

    Object.keys(respuestas).forEach(nombre => {
        // Para radio
        const radio = document.querySelector(`[name="${nombre}"]:checked`);
        // Para select o input text
        const input = document.querySelector(`[name="${nombre}"]`);

        let valor = null;
        if (radio) {
            valor = radio.value;
        } else if (input && input.tagName === "SELECT") {
            valor = input.value;
            if (!valor || valor === "" || valor === "---" || valor === "Selecciona...") return;
        } else if (input && input.type === "text") {
            valor = input.value;
            if (!valor || valor.trim() === "") return;
        } else {
            return;
        }

        if (nombre === "comp1" && valor.includes("m√≥vil")) valor = "m√≥vil";
        if (valor.trim().toLowerCase() === respuestas[nombre].toLowerCase()) {
            puntaje += 0.5;
        }
    });
    // M√°ximo 6 puntos
    if (puntaje > 6) puntaje = 6;
    return Math.round(puntaje * 100) / 100;
}

/* --- L√≥gica de puntuaci√≥n Gram√°tica --- */
function calcularPuntajeGramatica() {
    const respuestas = {
        conj1: "va",
        conj2: "gusta",
        conj3: "sabe",
        conj4: "hablan",
        verbo1: "hay",
        verbo2: "es",
        verbo3: "est√°n",
        verbo4: "est√°",
        perf1: "has viajado",
        perf2: "hemos probado",
        perf3: "han hablado",
        prep1: "de",
        prep2: "por",
        prep3: "para"
    };
    let puntaje = 0;

    Object.keys(respuestas).forEach(nombre => {
        const input = document.querySelector(`[name="${nombre}"]`);
        if (input && input.value.trim().toLowerCase() === respuestas[nombre].toLowerCase()) {
            puntaje += 0.5;
        }
    });
    // M√°ximo 7 puntos
    if (puntaje > 7) puntaje = 7;
    return Math.round(puntaje * 100) / 100;
}

/* --- L√≥gica de puntuaci√≥n L√©xico --- */
function calcularPuntajeLexico() {
    const respuestas = {
        lex1: "flan",
        lex2: "vino",
        lex3: "pasta",
        lex4: "trabajo",
        lexico1: "c",
        lexico2: "a",
        lexico3: "d",
        lexico4: "b",
        lexico5: "e",
        lexav1: "maleta",
        lexav2: "mapa",
        lexav3: "billete",
        lexav4: "gu√≠a",
        lexav5: "ba√±ador"
    };
    let puntaje = 0;

    Object.keys(respuestas).forEach(nombre => {
        const radio = document.querySelector(`[name="${nombre}"]:checked`);
        const input = document.querySelector(`[name="${nombre}"]`);
        let valor = null;
        if (radio) {
            valor = radio.value;
        } else if (input && input.tagName === "SELECT") {
            valor = input.value;
            if (!valor || valor === "" || valor === "---" || valor === "Selecciona...") return;
        } else if (input && input.type === "text") {
            valor = input.value;
            if (!valor || valor.trim() === "") return;
        } else {
            return;
        }
        if (valor.trim().toLowerCase() === respuestas[nombre].toLowerCase()) {
            puntaje += 0.5;
        }
    });
    // M√°ximo 7 puntos
    if (puntaje > 7) puntaje = 7;
    return Math.round(puntaje * 100) / 100;
}

function calcularPuntajeAuditiva() {
    const respuestas = {
    audio1: "b", // b) De M√©xico.
    audio2: "a", // a) Juega al f√∫tbol. (Carlos: "Los s√°bados juego al f√∫tbol con amigos")
    audio3: "c", // c) Va a caf√©s con su hermana. (Sophie: "me gusta visitar museos o ir a caf√©s con mi hermana")
    audio4: "b", // b) Cerca del r√≠o Sena. (Sophie: "en Par√≠s hay muchos restaurantes mexicanos. Est√°n cerca del r√≠o Sena")
    audio5: "b", // b) Una chaqueta y botas. (Carlos: "Llevo una chaqueta, botas, una mochila y mi c√°mara de fotos")
    audio6: "c", // c) M√∫sica cl√°sica. (Sophie: "me encanta la m√∫sica cl√°sica")
    audio7: "b", // b) Visita museos o va a caf√©s con su hermana. (Es lo que Sophie hace los fines de semana)
    audio8: "b", // b) Un libro, tel√©fono y un paraguas. (Sophie: "siempre llevo un libro, mi tel√©fono y un paraguas")
    audio9: "a", // a) Rock. (Carlos: "A m√≠ me gusta m√°s el rock")
    audio10: "b" // b) Canc√∫n. (Carlos: "en M√©xico hay playas muy bonitas. ¬øConoces Canc√∫n?")
};
    let puntaje = 0;
    Object.keys(respuestas).forEach(nombre => {
        // Busca todos los radios de ese grupo
        const radios = document.getElementsByName(nombre);
        let seleccionado = null;
        radios.forEach(radio => {
            if (radio.checked) seleccionado = radio.value;
        });
        if (seleccionado && seleccionado.trim().toLowerCase() === respuestas[nombre].toLowerCase()) {
            puntaje += 0.7;
        }
    });
    if (puntaje > 7) puntaje = 7;
    return Math.round(puntaje * 100) / 100;
}

/* --- L√≥gica de puntuaci√≥n Comunicaci√≥n --- */
function calcularPuntajeComunicacion() {
    const respuestas = [
        "Me llamo Pedro.",
        "Soy de Espa√±a.",
        "Quiero un caf√© con leche.",
        "No, gracias. Esto es todo.",
        "Voy a ir al cine con amigos.",
        "Pienso ir al gimnasio por la tarde.",
        "El a√±o pasado he viajado con mi familia.",
        "Me ha gustado comida y la gente.",
        "Me gusta la m√∫sica pop.",
        "En mi tiempo libre me gusta leer y ver series."
    ];
    let puntaje = 0;
    let totalPalabras = 0;

    for (let i = 1; i <= respuestas.length; i++) {
        const input = document.getElementById(`com${i}Input`);
        if (input) {
            const respuestaUsuario = (input.value || "").trim();
            const respuestaCorrecta = respuestas[i - 1].trim();
            const palabrasUsuario = respuestaUsuario.split(/\s+/);
            const palabrasCorrectas = respuestaCorrecta.split(/\s+/);
            totalPalabras += palabrasCorrectas.length;
            for (let j = 0; j < palabrasCorrectas.length; j++) {
                if (
                    palabrasUsuario[j] &&
                    palabrasUsuario[j].replace(/[.,;:!?]/g, '').toLowerCase() ===
                    palabrasCorrectas[j].replace(/[.,;:!?]/g, '').toLowerCase()
                ) {
                    puntaje += 0.1;
                }
            }
        }
    }
    if (puntaje > 6) puntaje = 6;
    return Math.round(puntaje * 100) / 100;
}

/* --- L√≥gica de puntuaci√≥n Producci√≥n Escrita --- */
function calcularPuntajeProduccion() {
    const respuestas = [
        "Por la tarde hago deberes y juego con mi perro.",
        "Los viernes veo pel√≠culas con mi familia.",
        "Este a√±o he ido a un parque de atracciones con mis primos.",
        "He montado en una monta√±a, he comido ca√±a de az√∫car y he tomado fotos.",
        "¬°Ha sido el mejor d√≠a del a√±o!"
    ];
    let puntaje = 0;
    const input = document.getElementById('com11Input');
    if (input) {
        const respuestaUsuario = (input.value || "").trim();
        const respuestaCorrecta = respuestas.join(' ').trim();
        const palabrasUsuario = respuestaUsuario.split(/\s+/);
        const palabrasCorrectas = respuestaCorrecta.split(/\s+/);
        for (let j = 0; j < palabrasCorrectas.length; j++) {
            if (
                palabrasUsuario[j] &&
                palabrasUsuario[j].replace(/[.,;:!?]/g, '').toLowerCase() ===
                palabrasCorrectas[j].replace(/[.,;:!?]/g, '').toLowerCase()
            ) {
                puntaje += 0.1;
            }
        }
    }
    if (puntaje >= 4.95) {
        puntaje = 7;
    } else if (puntaje > 5) {
        puntaje = 5;
    }
    if (puntaje > 7) puntaje = 7;
    return Math.round(puntaje * 100) / 100;
}



/* --- Actualiza la secci√≥n de resultados al entrar --- */
document.querySelectorAll('button.btn[onclick*="resultados"]').forEach(btn => {
    btn.addEventListener('click', function() {
        const puntajeCL = calcularPuntajeComprension();
        const puntajeG = calcularPuntajeGramatica();
        const puntajeL = calcularPuntajeLexico();
        const puntajeA = calcularPuntajeAuditiva();
        const puntajeC = calcularPuntajeComunicacion();
        const puntajeP = calcularPuntajeProduccion();
       
        let total = puntajeCL + puntajeG + puntajeL + + puntajeA + puntajeC + puntajeP ;
        if (total > 40) total = 40;
        const resultados = document.querySelector('#resultados .results');
        if (resultados) {
            // Actualiza la puntuaci√≥n total
            const scoreDiv = resultados.querySelector('.score');
            if (scoreDiv) {
                // Mostrar la nota arriba y el 40 debajo, con solo un decimal
                scoreDiv.innerHTML = `
                    <span style="display:block;font-size:2.5rem;font-weight:700;line-height:1.1;">
                        ${Number(total).toFixed(1)}
                    </span>
                    <span style="display:block;font-size:1.2rem;font-weight:400;line-height:1.1;">
                        /40
                    </span>
                `;
            }

            // Actualiza cada secci√≥n
            const cl = resultados.querySelector('.result-item:nth-child(2) span');
            if (cl) cl.textContent = `${puntajeCL}/6`;
            const g = resultados.querySelector('.result-item:nth-child(3) span');
            if (g) g.textContent = `${puntajeG}/7`;
            const l = resultados.querySelector('.result-item:nth-child(4) span');
            if (l) l.textContent = `${puntajeL}/7`;
            const a = resultados.querySelector('.result-item:nth-child(5) span');
            if (a) a.textContent = `${puntajeA}/7`;
            const c = resultados.querySelector('.result-item:nth-child(6) span');
            if (c) c.textContent = `${puntajeC}/6`;
            const p = resultados.querySelector('.result-item:nth-child(7) span');
            if (p) p.textContent = `${puntajeP}/7`;
            
        }
    });
});

const vocalButtons = document.querySelectorAll('.vocal-btn');
vocalButtons.forEach(button => {
    button.addEventListener('click', function() {
        const fieldId = this.getAttribute('data-field');
        const vocal = this.getAttribute('data-vocal');
        const inputField = document.getElementById(fieldId);
        
        if (inputField) {
            const startPos = inputField.selectionStart;
            const endPos = inputField.selectionEnd;
            const currentText = inputField.value;
            const newText = currentText.substring(0, startPos) + vocal + currentText.substring(endPos);
            
            inputField.value = newText;
            inputField.selectionStart = startPos + 1;
            inputField.selectionEnd = startPos + 1;
            inputField.focus();
            reproducirSonido();
        }
    });
});

const audioClick = new Audio('https://assets.mixkit.co/active_storage/sfx/3005/3005-preview.mp3');

function reproducirSonido() {
    const audioClone = audioClick.cloneNode();
    audioClone.volume = 0.3;
    audioClone.play().catch(error => {
        console.log('Error al reproducir el sonido:', error);
    });
}

// Add event listeners to radio buttons
const radios = document.querySelectorAll('input[type="radio"]');
radios.forEach(radio => {
    radio.addEventListener('click', reproducirSonido);
});

// Add event listeners to select elements (dropdown menus)
const selects = document.querySelectorAll('select');
selects.forEach(select => {
    select.addEventListener('change', reproducirSonido);
});

// Funci√≥n para reproducir un sonido espec√≠fico para el bot√≥n de siguiente
function playNextSound() {
    // Crear un elemento de audio si no existe
    let audioElement = document.getElementById('nextSound');
    if (!audioElement) {
        audioElement = document.createElement('audio');
        audioElement.id = 'nextSound';
        // Usar el sonido Geometry Dash para los botones de siguiente
        audioElement.src = 'https://www.myinstants.com/media/sounds/geometry-dash-click-sound.mp3';
        audioElement.preload = 'auto';
        audioElement.volume = 0.5; // Volumen al 50%
        document.body.appendChild(audioElement);
    }
    
    // Reiniciar y reproducir el sonido
    audioElement.currentTime = 0;
    audioElement.play().catch(error => {
        console.log("Reproducci√≥n autom√°tica bloqueada por el navegador. El usuario debe interactuar primero.");
    });
}
        // Funci√≥n para reproducir un sonido espec√≠fico para el bot√≥n de reset
function playResetSound() {
    // Crear un elemento de audio si no existe
    let audioElement = document.getElementById('resetSound');
    if (!audioElement) {
        audioElement = document.createElement('audio');
        audioElement.id = 'resetSound';
        // Usar sonido espec√≠fico para el bot√≥n de reset
        audioElement.src = 'https://www.myinstants.com/media/sounds/dog-clicker_IygBqAk.mp3';
        audioElement.preload = 'auto';
        audioElement.volume = 0.5; // Volumen al 50%
        document.body.appendChild(audioElement);
    }
    
    // Reiniciar y reproducir el sonido
    audioElement.currentTime = 0;
    audioElement.play().catch(error => {
        console.log("Reproducci√≥n autom√°tica bloqueada por el navegador. El usuario debe interactuar primero.");
    });
}
        // Funci√≥n para reproducir un sonido espec√≠fico para el bot√≥n de edici√≥n
function playEditSound() {
    // Crear un elemento de audio si no existe
    let audioElement = document.getElementById('editSound');
    if (!audioElement) {
        audioElement = document.createElement('audio');
        audioElement.id = 'editSound';
        // Usar un sonido diferente para el bot√≥n de editar
        audioElement.src = 'https://www.myinstants.com/media/sounds/click.mp3';
        audioElement.preload = 'auto';
        audioElement.volume = 0.5; // Volumen al 50%
        document.body.appendChild(audioElement);
    }
    
    // Reiniciar y reproducir el sonido
    audioElement.currentTime = 0;
    audioElement.play().catch(error => {
        console.log("Reproducci√≥n autom√°tica bloqueada por el navegador. El usuario debe interactuar primero.");
    });
}


// Funci√≥n para reproducir el sonido al pulsar un bot√≥n de segmento
function playSelectSound() {
    // Crear un elemento de audio si no existe
    let audioElement = document.getElementById('selectSound');
    if (!audioElement) {
        audioElement = document.createElement('audio');
        audioElement.id = 'selectSound';
        // Usar espec√≠ficamente el sonido solicitado
        audioElement.src = 'https://www.soundjay.com/buttons/sounds/button-19.mp3';
        audioElement.preload = 'auto';
        audioElement.volume = 0.5; // Volumen al 50%
        document.body.appendChild(audioElement);
    }
    
    // Reiniciar y reproducir el sonido
    audioElement.currentTime = 0;
    audioElement.play().catch(error => {
        console.log("Reproducci√≥n autom√°tica bloqueada por el navegador. El usuario debe interactuar primero.");
    });
}


        // Variables globales
        const dialogResponses = {};
        
        // Funci√≥n para barajar arrays
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

// Array de respuestas correctas para las preguntas de Comprensi√≥n de Lectura
const comprensionRespuestas = {
    // Verdadero o Falso
    vf1: "F", // Marta es de Madrid - FALSO (Marta es de Colombia, de Bogot√°)
    vf2: "V", // Los domingos, a Marta le gusta pasear por el parque - VERDADERO
    vf3: "F", // Laura lleva gafas de sol cuando viaja - FALSO (Es Marta quien lleva gafas de sol)
    vf4: "V", // Marta sabe bailar salsa - VERDADERO
    vf5: "F", // Laura ha visitado M√©xico - FALSO (Laura ha estado en Italia y Francia)
    
    // Selecci√≥n m√∫ltiple
    sm1: "b", // Marta los s√°bados: b) Va al cine con amigos
    sm2: "b", // En Madrid, los caf√©s colombianos est√°n: b) Cerca de la Plaza Mayor
    sm3: "b", // Laura en el restaurante pide de postre: b) Flan
    
    // Completar frases
    comp1: "m√≥vil", // Marta lleva a la playa: ba√±ador, gafas de sol, crema solar y su m√≥vil
    comp2: "paella", // Laura sabe cocinar paella y hablar ingl√©s
    comp3: "M√©xico", // Marta ha visitado M√©xico y
    comp4: "Per√∫" // Per√∫
};

// Array de respuestas correctas para la secci√≥n de Gram√°tica
const gramaticaRespuestas = {
    // 4. Conjugaci√≥n en presente (5 puntos)
    conj1: "va", // Los s√°bados, Marta va al cine con amigos
    conj2: "gusta", // A Laura le gusta nadar y correr
    conj3: "sabe", // Marta sabe bailar salsa muy bien
    conj4: "hablan", // Laura y Marta hablan sobre sus viajes
    
    // 5. Conjugaci√≥n: Ser, Estar y Haber (5 puntos)
    verbo1: "hay", // En Madrid hay muchos caf√©s colombianos
    verbo2: "es", // Laura es de Espa√±a, concretamente de Madrid
    verbo3: "est√°n", // Los caf√©s colombianos est√°n en el centro de Madrid  
    verbo4: "est√°", // Marta est√° muy contenta porque va a viajar
    

    perf1: "has viajado", // ¬øHas viajado a Espa√±a alguna vez?
    perf2: "hemos probado", // Nosotros nunca hemos probado el caf√© colombiano
    perf3: "han hablado", // Laura y Marta han hablado de sus experiencias de viaje
    
    // 7. Preposiciones (5 puntos)
    prep1: "de", // Marta es de Colombia
    prep2: "por", // Marta pasea por el parque los domingos
    prep3: "para" // Laura lleva ropa c√≥moda para viajar
};

// Array de respuestas correctas para la secci√≥n de L√©xico
const lexicoRespuestas = {
    // 8. L√©xico: Elimina el intruso (4 puntos)
    lex1: "flan", // Intruso entre lugares: cine, parque, museo, flan (el flan es un alimento)
    lex2: "vino", // Intruso entre ropa/accesorios de playa: ba√±ador, gafas de sol, zapatillas, vino (el vino es una bebida)
    lex3: "pasta", // Intruso entre bebidas/postre: agua, sopa, flan, vino (la sopa es un plato principal, no bebida ni postre)
    lex4: "trabajo", // Intruso entre actividades: leer, correr, bailar, trabajo (trabajo es un lugar/obligaci√≥n, no una actividad de ocio)
    
    // 9. L√©xico: Viajes y ocio (6 puntos) - Relaciona definiciones
    lexico1: "c", // Maleta = c) Objeto donde guardas tu ropa para viajar
    lexico2: "a", // Gu√≠a = a) Persona que explica y acompa√±a a los turistas
    lexico3: "d", // Mapa = d) Dibujo que muestra ciudades, calles y caminos
    lexico4: "b", // Excursi√≥n = b) Salida o viaje corto para conocer un lugar
    lexico5: "e", // Billete = f) Documento necesario para viajar en tren, avi√≥n o autob√∫s
    
    // 10. L√©xico: Selecci√≥n m√∫ltiple avanzada (8 puntos)
    lexav1: "maleta", // Para guardar ropa al viajar
    lexav2: "mapa", // Para saber c√≥mo llegar a un lugar   
    lexav3: "billete", // Lo que necesitas para entrar al cine o viajar en tren
    lexav4: "gu√≠a", // Lo que lees para informaci√≥n sobre una ciudad
    lexav5: "ba√±ador", // Lo que necesitas para nadar en la playa

};
// Array de respuestas correctas para la secci√≥n de Comprensi√≥n Auditiva
const comprensionAuditivaRespuestas = {
    audio1: "b", // b) De M√©xico.
    audio2: "a", // a) Juega al f√∫tbol. (Carlos: "Los s√°bados juego al f√∫tbol con amigos")
    audio3: "c", // c) Va a caf√©s con su hermana. (Sophie: "me gusta visitar museos o ir a caf√©s con mi hermana")
    audio4: "b", // b) Cerca del r√≠o Sena. (Sophie: "en Par√≠s hay muchos restaurantes mexicanos. Est√°n cerca del r√≠o Sena")
    audio5: "b", // b) Una chaqueta y botas. (Carlos: "Llevo una chaqueta, botas, una mochila y mi c√°mara de fotos")
    audio6: "c", // c) M√∫sica cl√°sica. (Sophie: "me encanta la m√∫sica cl√°sica")
    audio7: "b", // b) Visita museos o va a caf√©s con su hermana. (Es lo que Sophie hace los fines de semana)
    audio8: "b", // b) Un libro, tel√©fono y un paraguas. (Sophie: "siempre llevo un libro, mi tel√©fono y un paraguas")
    audio9: "a", // a) Rock. (Carlos: "A m√≠ me gusta m√°s el rock")
    audio10: "b" // b) Canc√∫n. (Carlos: "en M√©xico hay playas muy bonitas. ¬øConoces Canc√∫n?")

};

        // Funci√≥n para validar respuestas
        function validateAnswer(dialogId, answer) {
            // Normalizar la respuesta (quitar espacios extra)
            const normalizedAnswer = answer.trim();
            
            // Validar seg√∫n el di√°logo
            switch(dialogId) {
                case '1': // Primera pregunta
                    // Comprobar si la respuesta es "Me llamo Pedro."
                    return normalizedAnswer === "Me llamo Pedro.";
                    
                case '2': // Segunda pregunta
                    // Comprobar si la respuesta es "Soy de Espa√±a."
                    return normalizedAnswer === "Soy de Espa√±a.";
                    
                 case '3': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "Quiero un caf√© con leche.";
                    
                    case '4': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "No, gracias. Esto es todo.";

                    case '5': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "Voy a ir al cine con amigos.";      
                    
                    case '6': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "Pienso ir al gimnasio por la tarde.";  

                    case '7': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "El a√±o pasado he viajado con mi familia.";  

                    case '8': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "Me ha gustado comida y la gente.";  

                    case '9': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "Me gusta la m√∫sica pop.";  

                    case '10': // Tercera pregunta (en la cafeter√≠a)
                    // Comprobar si la respuesta es "Quiero un caf√© con leche, por favor."
                    return normalizedAnswer === "En mi tiempo libre me gusta leer y ver series.";  

                default:
                    return false;
            }
        }

            // Funci√≥n para validar respuesta
    function validateAnswer2(dialogId, answer) {
        // Normalizar la respuesta (quitar espacios extra)
        const normalizedAnswer = answer.trim();
        
        // Solo validamos para el di√°logo 1
        if (dialogId === '11') {
            // Posibles respuestas correctas para rutina diaria y experiencias pasadas
            const validResponses = [
                "Por la tarde hago deberes y juego con mi perro.",
                "Los viernes veo pel√≠culas con mi familia.",
                "Este a√±o he ido a un parque de atracciones con mis primos.",
                "He montado en una monta√±a, he comido ca√±a de az√∫car y he tomado fotos.",
                "¬°Ha sido el mejor d√≠a del a√±o!"
            ];
            
            // Verificar si la respuesta del usuario coincide con alguna de las respuestas v√°lidas
            return validResponses.some(response => 
                normalizedAnswer.toLowerCase() === response.toLowerCase());
        }
        
        return false;
    }

        // Funci√≥n para cambiar entre secciones
function cambiarSeccion(seccionId) {
    playNextSound();
    document.querySelectorAll('.section').forEach(seccion => {
        seccion.classList.remove('active');
    });
    
    document.getElementById(seccionId).classList.add('active');
    window.scrollTo(0, 0);

    // Guardar la secci√≥n activa en localStorage
    localStorage.setItem('activeSection', seccionId);

    if (seccionId === 'produccion') {
        const initialOptions = document.querySelector('.segment-options-a[data-dialog="1"][data-part="1"]');
        if (initialOptions) shuffleButtons(initialOptions);
    }
    
    // Si es la secci√≥n de Comprensi√≥n Auditiva, restaurar el timer
    if (seccionId === 'comprension-auditiva') {
        const timerElement = document.getElementById('examTimer');
        if (timerElement && !examTimerInterval) {
            startExamTimer();
            forzarAparicionTimer();
        }
    }
}
        
// Modifica la funci√≥n updateResponseDisplay para eliminar la validaci√≥n visual
function updateResponseDisplay(dialogId, partId, value) {
    const responseDisplay = document.getElementById(`response${dialogId}`);
    const hiddenInput = document.getElementById(`com${dialogId}Input`);
    
    if (!dialogResponses[dialogId]) dialogResponses[dialogId] = [];
    dialogResponses[dialogId][partId - 1] = value;
    
    if (partId === '1') {
        responseDisplay.textContent = value;
    } else {
        const currentText = responseDisplay.textContent;
        const needsSpace = !currentText.endsWith(' ') && 
                           !value.startsWith(' ') && 
                           !value.startsWith(',') && 
                           !value.startsWith('.') && 
                           !value.startsWith('?');
        responseDisplay.textContent = currentText + (needsSpace ? ' ' : '') + value;
    }
    
    hiddenInput.value = responseDisplay.textContent;
    
    // Eliminar la validaci√≥n que cambia el color y a√±ade el s√≠mbolo de verificaci√≥n
    // Simplemente dejamos la ventana como est√° sin cambiar su estilo
    
    const nextPart = parseInt(partId) + 1;
    const nextSegment = document.querySelector(`[data-dialog="${dialogId}"][data-part="${nextPart}"]`);
    
    if (nextSegment) {
        shuffleButtons(nextSegment);
        nextSegment.style.display = 'flex';
        
        if (partId === '1') {
            const editButton = document.getElementById(`edit-btn-${dialogId}`);
            if (editButton) {
                editButton.style.display = 'flex';
                const resetButton = editButton.parentElement.querySelector('.reset-button-a');
                if (resetButton) resetButton.style.display = 'flex';
            }
        }
    } else {
        const editButton = document.getElementById(`edit-btn-${dialogId}`);
        if (editButton) {
            editButton.style.display = 'flex';
            const resetButton = editButton.parentElement.querySelector('.reset-button-a');
            if (resetButton) resetButton.style.display = 'flex';
        }
    }
}
        
// Modifica la funci√≥n resetDialog para incluir la reproducci√≥n de audio en los botones recreados
function resetDialog(dialogId) {
    // Ocultar todas las opciones
    const allOptions = document.querySelectorAll(`.segment-options-a[data-dialog="${dialogId}"]`);
    allOptions.forEach(option => {
        option.style.display = 'none';
        
        // Importante: recrear TODOS los botones, no solo los de la primera parte
        const buttons = option.querySelectorAll('.segment-btn-a');
        buttons.forEach(btn => {
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);
            
            // Asignar nuevo evento a cada bot√≥n, INCLUYENDO la reproducci√≥n de sonido
            newBtn.addEventListener('click', function() {
                // Reproducir sonido (esta parte faltaba)
                playSelectSound();
                
                // Resto de la funcionalidad original
                const dialogId = this.parentElement.getAttribute('data-dialog');
                const partId = this.parentElement.getAttribute('data-part');
                const selectedValue = this.getAttribute('data-value');
                
                updateResponseDisplay(dialogId, partId, selectedValue);
                
                this.parentElement.style.display = 'none';
                
                const nextPart = parseInt(partId) + 1;
                const nextSegment = document.querySelector(`[data-dialog="${dialogId}"][data-part="${nextPart}"]`);
                if (nextSegment) {
                    shuffleButtons(nextSegment);
                    nextSegment.style.display = 'flex';
                }
            });
        });
    });
    
 
    // Mostrar solo las opciones iniciales
    const initialOptions = document.querySelector(`.segment-options-a[data-dialog="${dialogId}"][data-part="1"]`);
    if (initialOptions) {
        shuffleButtons(initialOptions);
        initialOptions.style.display = 'flex';
    }
    
    // Resetear el texto de respuesta
    const responseDisplay = document.getElementById(`response${dialogId}`);
    if (responseDisplay) {
        responseDisplay.textContent = 'Tu respuesta aparecer√° aqu√≠';
        responseDisplay.style.backgroundColor = '#fff';
        responseDisplay.style.borderColor = '#ccc';
        responseDisplay.classList.remove('editing-mode');
        
        // Eliminar marcas de verificaci√≥n
        const existingMarks = responseDisplay.querySelectorAll('.correct-mark');
        existingMarks.forEach(mark => mark.remove());
    }
    
    // Ocultar texto de ayuda
    const helpText = document.getElementById(`help-text-${dialogId}`);
    if (helpText) {
        helpText.style.display = 'none';
    }
    
    // Limpiar campo oculto
    const hiddenInput = document.getElementById(`com${dialogId}Input`);
    if (hiddenInput) {
        hiddenInput.value = '';
    }
    
    // Limpiar respuestas almacenadas
    dialogResponses[dialogId] = [];
    
    // Ocultar bot√≥n de edici√≥n
    const editButton = document.getElementById(`edit-btn-${dialogId}`);
    if (editButton) {
        editButton.style.display = 'none';
        document.getElementById(`edit-icon-${dialogId}`).textContent = '‚úèÔ∏è';
        document.getElementById(`edit-text-${dialogId}`).textContent = 'Editar respuesta';
        editButton.style.backgroundColor = '#3867d6';
        
        // Ocultar bot√≥n de reinicio
        const resetButtonContainer = editButton.parentElement.querySelector('.reset-button-container-a');
        if (resetButtonContainer) {
            const resetButton = resetButtonContainer.querySelector('.reset-button-a');
            if (resetButton) {
                resetButton.style.display = 'none';
            }
        }
    }
}
        
        // Funci√≥n para barajar los botones dentro de un contenedor
        function shuffleButtons(container) {
            const buttons = Array.from(container.querySelectorAll('.segment-btn-a'));
            const parent = buttons[0]?.parentNode;
            if (!parent) return;
            
            buttons.forEach(btn => parent.removeChild(btn));
            shuffleArray(buttons);
            buttons.forEach(btn => parent.appendChild(btn));
        }
        
     // Funci√≥n para mostrar opciones espec√≠ficas para una palabra
function showOptionsForWord(dialogId, partId) {
    document.querySelectorAll(`.segment-options-a[data-dialog="${dialogId}"]`).forEach(option => {
        option.style.display = 'none';
    });
    
    const targetOptions = document.querySelector(`.segment-options-a[data-dialog="${dialogId}"][data-part="${partId}"]`);
    if (targetOptions) {
        shuffleButtons(targetOptions);
        targetOptions.style.display = 'flex';
        
        targetOptions.querySelectorAll('.segment-btn-a').forEach(btn => {
            btn.disabled = false;
            btn.classList.remove('selected');
            
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);
            
            newBtn.addEventListener('click', function() {
                // Reproducir sonido al hacer clic en el bot√≥n durante la edici√≥n
                playSelectSound();
                
                const value = this.getAttribute('data-value');
                const editingWord = document.querySelector('.word-segment-a.editing');
                
                if (editingWord) {
                    editingWord.textContent = value;
                    editingWord.classList.remove('editing');
                    
                    const dialogId = editingWord.dataset.dialogId;
                    const responseDisplay = document.getElementById(`response${dialogId}`);
                    const hiddenInput = document.getElementById(`com${dialogId}Input`);
                    
                    let newText = '';
                    responseDisplay.querySelectorAll('.word-segment-a').forEach((span, idx) => {
                        newText += span.textContent;
                        if (idx < responseDisplay.querySelectorAll('.word-segment-a').length - 1) {
                            const nextSpan = responseDisplay.querySelectorAll('.word-segment-a')[idx + 1];
                            if (!span.textContent.endsWith(' ') && 
                                !nextSpan.textContent.startsWith(' ') && 
                                !nextSpan.textContent.match(/^[,.?!;:]/)) {
                                newText += ' ';
                            }
                        }
                    });
                    
                    hiddenInput.value = newText;
                    targetOptions.style.display = 'none';
                    
                    editingWord.style.backgroundColor = '#e3e9ff';
                    setTimeout(() => {
                        editingWord.style.backgroundColor = '#f0f8ff';
                    }, 300);
                }
            });
        });
    } else {
        const firstOptions = document.querySelector(`.segment-options-a[data-dialog="${dialogId}"][data-part="1"]`);
        if (firstOptions) firstOptions.style.display = 'flex';
    }
}

        // Inicializaci√≥n al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // Crear botones de reinicio para todos los di√°logos
            function createResetButtons() {
                for (let i = 1; i <= 11; i++) {
                    const editButton = document.getElementById(`edit-btn-${i}`);
                    if (editButton) {
                        let buttonsContainer = editButton.parentElement.querySelector('.buttons-container-a');
                        
                        if (!buttonsContainer) {
                            buttonsContainer = document.createElement('div');
                            buttonsContainer.className = 'buttons-container-a';
                            const editButtonParent = editButton.parentElement;
                            editButtonParent.insertBefore(buttonsContainer, editButton);
                            buttonsContainer.appendChild(editButton);
                        }
                        
                        let resetButton = buttonsContainer.querySelector('.reset-button-a');
                        
                        if (!resetButton) {
                            const resetButtonContainer = document.createElement('div');
                            resetButtonContainer.className = 'reset-button-container-a';
                            
                            resetButton = document.createElement('button');
                            resetButton.className = 'reset-button-a';
                            resetButton.innerHTML = '‚Ü∫';
                            resetButton.title = 'Reiniciar respuesta';
                            resetButton.setAttribute('aria-label', 'Reiniciar respuesta');
                            resetButton.style.display = 'none';
                            
                            resetButton.addEventListener('click', function() {
                                resetDialog(i);
                                playResetSound();
                            });
                            
                            resetButtonContainer.appendChild(resetButton);
                            buttonsContainer.appendChild(resetButtonContainer);
                        }
                    }
                }
            }
            
            createResetButtons();
            
            // Configurar eventos para los botones de segmento
            document.querySelectorAll('.segment-btn-a').forEach(button => {
                button.addEventListener('click', function() {
                    playSelectSound();
                    const dialogId = this.parentElement.getAttribute('data-dialog');
                    const partId = this.parentElement.getAttribute('data-part');
                    const selectedValue = this.getAttribute('data-value');
                    
                    updateResponseDisplay(dialogId, partId, selectedValue);
                    
                    this.parentElement.style.display = 'none';
                    
                    const nextPart = parseInt(partId) + 1;
                    const nextSegment = document.querySelector(`[data-dialog="${dialogId}"][data-part="${nextPart}"]`);
                    if (nextSegment) {
                        nextSegment.style.display = 'flex';
                        
                        if (partId === '1') {
                            const editButton = document.getElementById(`edit-btn-${dialogId}`);
                            if (editButton) {
                                editButton.style.display = 'flex';
                                const resetButton = editButton.parentElement.querySelector('.reset-button-a');
                                if (resetButton) resetButton.style.display = 'flex';
                            }
                        }
                    }
                });
            });
            
            // Configurar eventos para los botones de edici√≥n
            for (let dialogId = 1; dialogId <= 11; dialogId++) {
                const editButton = document.getElementById(`edit-btn-${dialogId}`);
                if (editButton) {
                    const responseDisplay = document.getElementById(`response${dialogId}`);
                    const helpText = document.getElementById(`help-text-${dialogId}`);
                    
                    editButton.addEventListener('click', function() {
                        playEditSound();
                        if (!responseDisplay.classList.contains('editing-mode')) {
                            responseDisplay.classList.add('editing-mode');
                            document.getElementById(`edit-icon-${dialogId}`).textContent = '‚úì';
                            document.getElementById(`edit-text-${dialogId}`).textContent = 'Finalizar edici√≥n';
                            this.style.backgroundColor = '#28a745';
                            
                            if (helpText) helpText.style.display = 'block';
                            
                            document.querySelectorAll(`.segment-options-a[data-dialog="${dialogId}"]`).forEach(option => {
                                option.style.display = 'none';
                            });
                            
                            if (responseDisplay.textContent !== 'Tu respuesta aparecer√° aqu√≠' && 
                                responseDisplay.textContent !== 'Selecciona...' && 
                                responseDisplay.textContent !== '') {
                                const originalText = responseDisplay.textContent;
                                const words = originalText.split(/\s+/);
                                responseDisplay.innerHTML = '';
                                
                                words.forEach((word, index) => {
                                    if (word.trim()) {
                                        const wordSpan = document.createElement('span');
                                        wordSpan.textContent = word;
                                        wordSpan.className = 'word-segment-a';
                                        wordSpan.dataset.dialogId = dialogId.toString();
                                        wordSpan.dataset.partId = (index + 1).toString();
                                        
                                        wordSpan.addEventListener('click', function() {
                                            document.querySelectorAll('.word-segment-a').forEach(span => {
                                                span.classList.remove('editing');
                                            });
                                            this.classList.add('editing');
                                            showOptionsForWord(this.dataset.dialogId, this.dataset.partId);
                                        });
                                        
                                        responseDisplay.appendChild(wordSpan);
                                        if (index < words.length - 1) {
                                            responseDisplay.appendChild(document.createTextNode(' '));
                                        }
                                    }
                                });
                            }
                        } else {
                            responseDisplay.classList.remove('editing-mode');
                            document.getElementById(`edit-icon-${dialogId}`).textContent = '‚úèÔ∏è';
                            document.getElementById(`edit-text-${dialogId}`).textContent = 'Editar respuesta';
                            this.style.backgroundColor = '#3867d6';
                            
                            if (helpText) helpText.style.display = 'none';
                            
                            let currentText = '';
                            const spans = responseDisplay.querySelectorAll('.word-segment-a');
                            spans.forEach((span, idx) => {
                                currentText += span.textContent;
                                if (idx < spans.length - 1) {
                                    if (!span.textContent.endsWith(' ') && 
                                        !spans[idx + 1].textContent.match(/^[,.?!;:]/)) {
                                        currentText += ' ';
                                    }
                                }
                            });
                            
                            responseDisplay.innerHTML = '';
                            responseDisplay.textContent = currentText;
                            
                            document.querySelectorAll(`.segment-options-a[data-dialog="${dialogId}"]`).forEach(option => {
                                option.style.display = 'none';
                            });
                            
                            const words = currentText.split(/\s+/).filter(w => w.trim().length > 0);
                            const nextPartId = words.length + 1;
                            const totalParts = document.querySelectorAll(`.segment-options-a[data-dialog="${dialogId}"]`).length;
                            
                            if (nextPartId <= totalParts && currentText !== 'Tu respuesta aparecer√° aqu√≠' && 
                                currentText !== 'Selecciona...' && currentText !== '') {
                                const nextPart = document.querySelector(`[data-dialog="${dialogId}"][data-part="${nextPartId}"]`);
                                if (nextPart) nextPart.style.display = 'flex';
                            } else if (currentText === 'Tu respuesta aparecer√° aqu√≠' || currentText === 'Selecciona...' || currentText === '') {
                                const initialOptions = document.querySelector(`[data-dialog="${dialogId}"][data-part="1"]`);
                                if (initialOptions) initialOptions.style.display = 'flex';
                            }
                            
                            if (validateAnswer(dialogId.toString(), responseDisplay.textContent)) {
                                responseDisplay.style.backgroundColor = '#d4edda';
                                responseDisplay.style.borderColor = '#28a745';
                                
                                if (!responseDisplay.querySelector('.correct-mark')) {
                                    const checkMark = document.createElement('span');
                                    checkMark.textContent = ' ‚úì';
                                    checkMark.style.color = '#28a745';
                                    checkMark.style.fontWeight = 'bold';
                                    checkMark.className = 'correct-mark';
                                    responseDisplay.appendChild(checkMark);
                                }
                            }
                        }
                    });
                }
            }
            
            // Barajar los botones iniciales
            const initialOptions = document.querySelector('.segment-options-a[data-dialog="1"][data-part="1"]');
            if (initialOptions) shuffleButtons(initialOptions);
        });

        // Agregar estilos para la barra de navegaci√≥n r√°pida
document.head.insertAdjacentHTML('beforeend', `
<style>
    .quick-nav {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 5px;
        margin-bottom: 15px;
        font-size: 14px;
    }
    
    .quick-nav-item {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        background-color: #f0f0f0;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
        border: 1px solid #ddd;
    }
    
    .quick-nav-item:hover {
        background-color: #e3e9ff;
        transform: translateY(-2px);
    }
    
    .quick-nav-item.active {
        background-color: #3867d6;
        color: white;
        border-color: #3867d6;
    }
    
    .quick-nav-tooltip {
        position: absolute;
        background-color: #333;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
        bottom: 40px;
        transform: translateX(-50%);
        white-space: nowrap;
    }
    
    .quick-nav-item:hover .quick-nav-tooltip {
        opacity: 1;
    }
</style>
`);

// Crear y a√±adir la barra de navegaci√≥n debajo de cada barra de progreso
document.addEventListener('DOMContentLoaded', function() {
    // Datos de navegaci√≥n: iniciales y nombres completos
    const navigationData = [
         
        { id: 'comprension', initial: 'CL', name: 'Comprensi√≥n Lectora' },
        { id: 'gramatica', initial: 'G', name: 'Gram√°tica' },
        { id: 'lexico', initial: 'L', name: 'L√©xico' },
        { id: 'comprension-auditiva', initial: 'CA', name: 'Comprensi√≥n Auditiva' },
        { id: 'comunicacion', initial: 'CM', name: 'Comunicaci√≥n' },
        { id: 'produccion', initial: 'PE', name: 'Producci√≥n Escrita' },
       
    ];
    
    // A√±adir la barra de navegaci√≥n a cada secci√≥n
    document.querySelectorAll('.progress-container').forEach(container => {
        // Crear el contenedor de navegaci√≥n r√°pida
        const quickNav = document.createElement('div');
        quickNav.className = 'quick-nav';
        
        // A√±adir los botones con iniciales
        navigationData.forEach(item => {
            const navItem = document.createElement('div');
            navItem.className = 'quick-nav-item';
            navItem.textContent = item.initial;
            navItem.onclick = function() {
                playNextSound(); // Usar el mismo sonido que los botones de navegaci√≥n normales
                cambiarSeccion(item.id);
            };
            
            // A√±adir tooltip
            const tooltip = document.createElement('span');
            tooltip.className = 'quick-nav-tooltip';
            tooltip.textContent = item.name;
            navItem.appendChild(tooltip);
            
            quickNav.appendChild(navItem);
        });
        
        // Insertar despu√©s de la barra de progreso
        container.parentNode.insertBefore(quickNav, container.nextSibling);
    });
    
    // Actualizar navegaci√≥n cuando cambie la secci√≥n activa
    const updateActiveNavigation = function() {
        const activeSection = document.querySelector('.section.active');
        if (activeSection) {
            const activeSectionId = activeSection.id;
            
            // Actualizar todos los botones de navegaci√≥n r√°pida
            document.querySelectorAll('.quick-nav-item').forEach(item => {
                item.classList.remove('active');
                
                // Encontrar el √≠ndice correspondiente al bot√≥n
                const itemIndex = Array.from(item.parentNode.children).indexOf(item);
                const correspondingNav = navigationData[itemIndex];
                
                if (correspondingNav && correspondingNav.id === activeSectionId) {
                    item.classList.add('active');
                }
            });
        }
    };
    
    // Sobreescribir la funci√≥n cambiarSeccion para actualizar la navegaci√≥n
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        setTimeout(updateActiveNavigation, 100); // Peque√±o retraso para asegurar que la clase active ya est√° aplicada
    };
    
    // Inicializar estado activo
    updateActiveNavigation();
});
document.head.insertAdjacentHTML('beforeend', `
<style>
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }
    
    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    .confirmation-modal {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 450px;
        padding: 0;
        transform: translateY(20px);
        transition: transform 0.3s ease;
        overflow: hidden;
    }
    
    .modal-overlay.active .confirmation-modal {
        transform: translateY(0);
    }
    
    .modal-header {
        background: linear-gradient(90deg, #3867d6, #7f53ac);
        color: white;
        padding: 20px;
        font-size: 1.3em;
        font-weight: 600;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
    }
    
    .modal-body {
        padding: 30px 25px;
        text-align: center;
        font-size: 1.1em;
        color: #444;
    }
    
    .modal-buttons {
        display: flex;
        padding: 0 25px 25px;
        gap: 15px;
        justify-content: center;
    }
    
    .modal-btn {
        padding: 8px 5px;
        border-radius: 30px;
        border: none;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        flex: 1;
        max-width: 150px;
    }
    
    .modal-btn-primary {
        background: linear-gradient(90deg, #3867d6, #7f53ac);
        color: white;
        box-shadow: 0 4px 5px rgba(56, 103, 214, 0.25);
    }
    
    .modal-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 5px rgba(56, 103, 214, 0.35);
    }
    
    .modal-btn-secondary {
        background: #f0f0f0;
        color: #444;
    }
    
    .modal-btn-secondary:hover {
        background: #e0e0e0;
    }
    
    @keyframes modalAppear {
        0% { opacity: 0; transform: scale(0.8); }
        70% { opacity: 1; transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .confirmation-modal {
        animation: modalAppear 0.4s forwards;
    }
</style>
`);

// Luego, a√±ade el HTML del modal al final del body
document.body.insertAdjacentHTML('beforeend', `
<div class="modal-overlay" id="confirmationModal">
    <div class="confirmation-modal">
        <div class="modal-header">
            Finalizar examen
        </div>
        <div class="modal-body">
            ¬øHas terminado el examen y quieres ver tus resultados?
        </div>
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-secondary" id="btnCancelar">
                No, volver
            </button>
            <button class="modal-btn modal-btn-primary" id="btnConfirmar">
                S√≠, ver resultados
            </button>
        </div>
    </div>
</div>
`);

// Finalmente, modifica todas las instancias del bot√≥n para que muestren el modal en lugar de cambiar de secci√≥n directamente
document.querySelectorAll('button.btn[onclick*="cambiarSeccion(\'resultados\')"]').forEach(btn => {
    btn.removeAttribute('onclick');
    btn.addEventListener('click', function() {
        playNextSound(); // Mantiene el sonido original
        document.getElementById('confirmationModal').classList.add('active');
    });
});

// A√±ade la l√≥gica para los botones del modal
// A√±ade la l√≥gica para los botones del modal
document.getElementById('btnConfirmar').addEventListener('click', function() {
    // Ocultar el modal de confirmaci√≥n
    document.getElementById('confirmationModal').classList.remove('active');
    
    // Detener y ocultar el timer
    if (examTimerInterval) {
        clearInterval(examTimerInterval);
        const timerElement = document.getElementById('examTimer');
        if (timerElement) {
            timerElement.classList.remove('active');
            timerElement.style.opacity = 0;
            timerElement.style.visibility = 'hidden';
        }
    }
    
    // Guardar la hora de finalizaci√≥n en localStorage
    const endTime = new Date().toISOString();
    localStorage.setItem('examEndTime', endTime);
    
    // Cambiar a la secci√≥n de resultados
    cambiarSeccion('resultados');
});

document.getElementById('btnCancelar').addEventListener('click', function() {
    document.getElementById('confirmationModal').classList.remove('active');
});

// Opcional: permitir cerrar el modal haciendo clic fuera de √©l
document.getElementById('confirmationModal').addEventListener('click', function(e) {
    if (e.target === this) {
        this.classList.remove('active');
    }
});
// Arreglo para el bot√≥n espec√≠fico de producci√≥n que lleva a resultados
document.addEventListener('DOMContentLoaded', function() {
    const btnProduccionResultados = document.querySelector('#produccion .button-container .btn:last-child');
    
    if (btnProduccionResultados) {
        // Eliminamos cualquier onclick existente
        btnProduccionResultados.removeAttribute('onclick');
        
        // A√±adimos el evento directamente
        btnProduccionResultados.addEventListener('click', function() {
            playNextSound();
            document.getElementById('confirmationModal').classList.add('active');
        });
        console.log('Modal configurado correctamente en el bot√≥n de producci√≥n');
    } else {
        console.log('No se encontr√≥ el bot√≥n en la secci√≥n de producci√≥n');
    }
});
document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n para ocultar/mostrar el footer seg√∫n la secci√≥n activa
    function toggleFooterVisibility() {
        const footer = document.querySelector('footer');
        const loginSection = document.getElementById('login');
        const activeSection = localStorage.getItem('activeSection'); // <-- Obtiene la secci√≥n activa de localStorage
        
        if (footer && loginSection) {
            // Si la secci√≥n de login o ranking est√° activa, ocultar el footer
            if (loginSection.classList.contains('active') || activeSection === 'ranking') { // <-- Comprueba si la secci√≥n activa es "ranking"
                footer.style.display = 'none';
            } else {
                footer.style.display = 'block';
            }
        }
    }
    
    // Ejecutar al cargar la p√°gina
    toggleFooterVisibility();
    
    // Modificar la funci√≥n cambiarSeccion para actualizar la visibilidad del footer
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        toggleFooterVisibility();
    };
});

// Agregar esta funci√≥n dentro del script existente
document.addEventListener('DOMContentLoaded', function() {
    // Obtener elementos existentes
    const introContainer = document.querySelector('.intro-container p');
    
    // Verificar si existen datos en localStorage
    const nombreUsuario = localStorage.getItem('examUserNombre');
    const apellidoUsuario = localStorage.getItem('examUserApellido');
    
    // Si existe nombre y apellido guardados, personalizar el mensaje de bienvenida
    if (nombreUsuario && apellidoUsuario && introContainer) {
        introContainer.innerHTML = `Bienvenido <strong>${nombreUsuario} ${apellidoUsuario}</strong> al examen interactivo que evaluar√° tus habilidades en espa√±ol A1.`;
    }
});
// A√±ade esta funci√≥n al final de tu script
document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n para mostrar el nombre del alumno junto al timer
function mostrarNombreEnTimer() {
    const timerElement = document.getElementById('examTimer');
    const nombreUsuario = localStorage.getItem('examUserNombre');
    const apellidoUsuario = localStorage.getItem('examUserApellido');
    
    if (timerElement && nombreUsuario && apellidoUsuario) {
        // Eliminar el nombre anterior si existe
        const nombreExistente = document.getElementById('studentName');
        if (nombreExistente) {
            nombreExistente.remove();
        }
        // Crear el elemento para mostrar el nombre
        const nombreElement = document.createElement('span');
        nombreElement.id = 'studentName';
        nombreElement.style.marginLeft = '15px';
        nombreElement.style.fontWeight = '500';
        nombreElement.style.fontSize = '0.9rem';
        nombreElement.style.color = 'white';
        nombreElement.style.whiteSpace = 'nowrap';
        nombreElement.innerHTML = `<strong>${nombreUsuario[0].toUpperCase()}. ${apellidoUsuario.charAt(0).toUpperCase() + apellidoUsuario.slice(1)}</strong>`;
        
        // A√±adir el nombre al timer
        timerElement.appendChild(nombreElement);
        
        // Ajustar el estilo del timer para acomodar el nombre
        timerElement.style.paddingRight = '20px';
        timerElement.style.maxWidth = 'none';
    }
}
    
    // Modificar la funci√≥n startExamTimer para que tambi√©n muestre el nombre
    const originalStartExamTimer = window.startExamTimer;
    window.startExamTimer = function() {
        // Llamar a la funci√≥n original
        originalStartExamTimer();
        
        // A√±adir el nombre despu√©s de que se muestre el timer
        setTimeout(mostrarNombreEnTimer, 1100);
    };
});

// Funci√≥n para enviar datos a la hoja de c√°lculo
function enviarDatosExamen() {
    console.log("Iniciando env√≠o de datos del examen...");
    
    // Recuperar datos almacenados
    const nombre = localStorage.getItem('examUserNombre') || 'No disponible';
    const apellido = localStorage.getItem('examUserApellido') || 'No disponible';
    
    // Obtener puntuaci√≥n total e individuales calculadas
    const puntajeCL = calcularPuntajeComprension();
    const puntajeG = calcularPuntajeGramatica();
    const puntajeL = calcularPuntajeLexico();
    const puntajeA = calcularPuntajeAuditiva();
    const puntajeC = calcularPuntajeComunicacion();
    const puntajeP = calcularPuntajeProduccion();
    
    let puntuacionTotal = puntajeCL + puntajeG + puntajeL + puntajeA + puntajeC + puntajeP;
    if (puntuacionTotal > 40) puntuacionTotal = 40;
    puntuacionTotal = Number(puntuacionTotal).toFixed(1);
    
    console.log(`Puntuaci√≥n calculada: ${puntuacionTotal}/40`);
    
    // Recuperar timestamps
    const fechaInicioStr = localStorage.getItem('examStartTime');
    const fechaFinStr = localStorage.getItem('examEndTime');
    
    if (fechaInicioStr) {
        const fechaInicioObj = new Date(fechaInicioStr);
        const fechaFinObj = fechaFinStr ? new Date(fechaFinStr) : new Date();
        
        // Formatear fecha y hora
        const fechaInicio = fechaInicioObj.toLocaleDateString('es-ES');
        const horaInicio = fechaInicioObj.toLocaleTimeString('es-ES');
        const horaFin = fechaFinObj.toLocaleTimeString('es-ES');
        
        // Calcular duraci√≥n
        const duracionMs = fechaFinObj - fechaInicioObj;
        const duracionMinutos = Math.floor(duracionMs / 60000);
        const duracionSegundos = Math.floor((duracionMs % 60000) / 1000);
        const duracionStr = `${duracionMinutos}m ${duracionSegundos}s`;
        
        console.log(`Duraci√≥n del examen: ${duracionStr}`);
        
        // Detectar navegador
        const navegador = detectarNavegador();
        
        // URL del script de Google Apps Script
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';
        
        // Crear objeto con los datos actualizados (incluyendo puntajes individuales)
     // Dentro de la funci√≥n enviarDatosExamen()
const identificador = localStorage.getItem('identificadorUnico') || '';
const datosExamen = {
    nombre: nombre,
    apellido: apellido,
    puntuacion: puntuacionTotal,
    fecha: fechaInicio,
    horaInicio: horaInicio,
    horaFin: horaFin,
    duracion: duracionStr,
    navegador: navegador,
    clectura: puntajeCL.toString(),
    gramatica: puntajeG.toString(),
    lexico: puntajeL.toString(),
    auditiva: puntajeA.toString(),
    comunicacion: puntajeC.toString(),
    escrita: puntajeP.toString(),
    identificador: identificador // <-- A√±ade esta l√≠nea
};
        
        console.log("Datos a enviar:", datosExamen);
        
        // M√©todo principal usando fetch con no-cors
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(datosExamen)
        })
        .then(response => {
            console.log('Respuesta recibida:', response);
            alert('¬°Tus resultados han sido enviados correctamente!');
            return response;
        })
        .catch(error => {
            console.error('Error al enviar datos:', error);
            alert('Hubo un problema al enviar tus resultados. Por favor, avisa al profesor.');
            
            // Si falla fetch, intentamos con el m√©todo alternativo
            usarMetodoAlternativo(scriptURL, datosExamen);
            localStorage.removeItem('identificadorUnico');
        });
    } else {
        console.error('No se encontr√≥ la hora de inicio del examen en localStorage');
    }
}

// M√©todo alternativo usando iframe y formulario
function usarMetodoAlternativo(url, datos) {
    console.log("Usando m√©todo alternativo de env√≠o por iframe...");
    
    // Crear un iframe temporal
    const iframe = document.createElement('iframe');
    iframe.name = 'hiddenFrame';
    iframe.style.display = 'none';
    document.body.appendChild(iframe);
    
    // Crear un formulario
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = url;
    form.target = 'hiddenFrame';
    
    // A√±adir los datos como campos ocultos
    for (const key in datos) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = key;
        input.value = datos[key];
        form.appendChild(input);
    }
    
    // A√±adir y enviar el formulario
    document.body.appendChild(form);
    form.submit();
    
    // Eliminar elementos despu√©s del env√≠o
    setTimeout(() => {
        form.remove();
        iframe.remove();
        alert('Datos enviados mediante m√©todo alternativo');
    }, 5000);
}

// Asegurarse de llamar a enviarDatosExamen en los momentos correctos
document.addEventListener('DOMContentLoaded', function() {
    // 1. Cuando el usuario hace clic en "S√≠, ver resultados" en el modal de confirmaci√≥n
    const btnConfirmar = document.getElementById('btnConfirmar');
    if (btnConfirmar) {
        btnConfirmar.addEventListener('click', function() {
            console.log("Bot√≥n de confirmaci√≥n pulsado, enviando datos...");
            enviarDatosExamen();
        });
    }
    
    // 2. Cuando se agota el tiempo y el usuario hace clic en "Ver resultados"
    const timeoutButton = document.getElementById('timeoutButton');
    if (timeoutButton) {
        timeoutButton.addEventListener('click', function() {
            console.log("Bot√≥n de tiempo agotado pulsado, enviando datos...");
            enviarDatosExamen();
        });
    }
});

// Funci√≥n para detectar el navegador del usuario
function detectarNavegador() {
    const userAgent = navigator.userAgent;
    let navegadorNombre = "Desconocido";
    
    if (userAgent.indexOf("Firefox") > -1) {
        navegadorNombre = "Firefox";
    } else if (userAgent.indexOf("SamsungBrowser") > -1) {
        navegadorNombre = "Samsung Internet";
    } else if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) {
        navegadorNombre = "Opera";
    } else if (userAgent.indexOf("Trident") > -1 || userAgent.indexOf("MSIE") > -1) {
        navegadorNombre = "Internet Explorer";
    } else if (userAgent.indexOf("Edge") > -1) {
        navegadorNombre = "Microsoft Edge (Legacy)";
    } else if (userAgent.indexOf("Edg") > -1) {
        navegadorNombre = "Microsoft Edge (Chromium)";
    } else if (userAgent.indexOf("Chrome") > -1) {
        navegadorNombre = "Chrome";
    } else if (userAgent.indexOf("Safari") > -1) {
        navegadorNombre = "Safari";
    }
    
    return navegadorNombre;
}
// A√±adir dentro del evento DOMContentLoaded o antes de la funci√≥n cambiarSeccion
document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n para actualizar el t√≠tulo de la p√°gina de resultados
  // Funci√≥n para actualizar el t√≠tulo de la p√°gina de resultados
function actualizarTituloResultados() {
    const nombreUsuario = localStorage.getItem('examUserNombre');
    const apellidoUsuario = localStorage.getItem('examUserApellido');
    
    if (nombreUsuario && apellidoUsuario) {
        const tituloResultados = document.querySelector('#resultados header h1 span');
        if (tituloResultados) {
            tituloResultados.innerHTML = `Resultados del examen de <br> <strong style="background: linear-gradient(90deg, #9d50bb, #e3647d); -webkit-background-clip: text; background-clip: text; color: transparent; padding: 0 2px;">${nombreUsuario} ${apellidoUsuario}</strong>`;
        }
    }
}
    
    // Ejecutar al cargar la p√°gina
    actualizarTituloResultados();
    
    // Modificar la funci√≥n cambiarSeccion para actualizar el t√≠tulo cuando se cambia a resultados
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'resultados') {
            actualizarTituloResultados();
        }
    };
});


// Reemplazar el bot√≥n "Volver al inicio" por "Comparar resultados"
document.addEventListener('DOMContentLoaded', function() {
    // Buscar el bot√≥n existente y reemplazarlo
    const resultadosBtn = document.querySelector('#resultados .btn');
    if (resultadosBtn) {
        resultadosBtn.innerHTML = `
            <span style="margin:1px;">üìä</span>Ranking
        `;
        resultadosBtn.removeAttribute('onclick');
        resultadosBtn.addEventListener('click', function() {
            playNextSound();
            cambiarSeccion('ranking');
        });
    }
    
    // Buscar el contenedor del bot√≥n en la secci√≥n de resultados
    const resultadosButtonContainer = document.querySelector('#resultados .content .results center');
    
    if (resultadosButtonContainer) {
        // Crear el bot√≥n de cerrar sesi√≥n
        const cerrarSesionBtnResultados = document.createElement('button');
        cerrarSesionBtnResultados.id = 'cerrarSesionBtnResultados';
        cerrarSesionBtnResultados.className = 'btn';
        cerrarSesionBtnResultados.innerHTML = '<span style="margin-right: 1px;">üö™</span>Cerrar sesi√≥n';
        cerrarSesionBtnResultados.style = 'margin-top: 15px; padding: 15px 40px; font-size: 1.1em; border-radius: 30px; background: linear-gradient(90deg, #e74c3c, #c0392b); transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);';
        
        // A√±adir el bot√≥n despu√©s del bot√≥n "Comparar resultados"
        resultadosButtonContainer.appendChild(cerrarSesionBtnResultados);
        
        // A√±adir el evento al bot√≥n
        cerrarSesionBtnResultados.addEventListener('click', function() {
            playNextSound(); // Reproducir sonido
            const logoutModal = document.getElementById('logoutModal');
            if (logoutModal) {
                logoutModal.classList.add('active');
            }
        });
    }

    
    // A√±adir la nueva secci√≥n de Ranking
    const rankingSection = document.createElement('section');
    rankingSection.id = 'ranking';
    rankingSection.className = 'section';
    rankingSection.innerHTML = `
        <header>
            <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; position: relative; overflow: hidden; animation: titleFadeIn 0.8s ease-out;">
                <span style="background: linear-gradient(90deg, #3867d6, #7f53ac, #3867d6); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: gradientShift 5s ease infinite;">Ranking de resultados</span>
            </h1>
        </header>
        <div class="content">
            <div class="ranking-container" style="max-width: 800px; margin: 0 auto;">
                <div class="loading-indicator" style="text-align: center; padding: 40px;">
                    <div style="display: inline-block; width: 50px; height: 50px; border: 5px solid rgba(56,103,214,0.3); border-radius: 50%; border-top-color: #3867d6; animation: spin 1s linear infinite;"></div>
                    <p style="margin-top: 20px; color: #666;">Cargando resultados...</p>
                </div>
                <div class="ranking-table" style="border-radius: 12px; overflow-x: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-height: 400px; overflow-y: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
            <thead>
                <tr style="background: linear-gradient(90deg, #3867d6, #7f53ac); color: white; text-align: left;">
                    <th style="padding: 12px 15px; font-weight: 600; width:40px;"></th>
                    <th style="padding: 12px 15px; font-weight: 600;">Usuario</th>
                    <th style="padding: 12px 15px; font-weight: 600; text-align:right;">Pts.</th>
                </tr>
            </thead>
            <tbody id="rankingBody">
                            <!-- Los resultados se insertar√°n aqu√≠ desde JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="error-message" style="display: none; text-align: center; padding: 30px; color: #dc3545; background: #f8d7da; border-radius: 10px; margin-top: 20px;">
                    <p style="font-weight: 500; margin-bottom: 10px;">No se pudieron cargar los resultados</p>
                    <p style="font-size: 0.9em;">Por favor, int√©ntalo de nuevo m√°s tarde o contacta con el profesor.</p>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="cambiarSeccion('resultados')" style="padding: 10px 10px; font-size: 1.1em; border-radius: 30px; background: linear-gradient(90deg, #3867d6 60%, #7f53ac 100%); transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(56,103,214,0.3);">
                        <span style="margin-right: 10px;">‚Üê</span>Volver a mis resultados
                    </button>
                    <!-- Nuevo bot√≥n para cerrar sesi√≥n -->
                    <button id="cerrarSesionBtn" class="btn" style="margin-top: 15px; padding: 10px 10px; font-size: 1.1em; border-radius: 30px; background: linear-gradient(90deg, #e74c3c, #c0392b); transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);">
                        <span style="margin-right: 10px;">üö™</span>Cerrar sesi√≥n
                    </button>
                </div>
            </div>
            
        </div>
        <div style="text-align: center; margin-top: 25px; font-size: 0.8rem; color: #999;">
    <p style="font-size: 0.7em; text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
        ¬© 2025 Ranking de Ex√°menes A1<br>
        <span style="color: #3867d6; font-weight: 500;">Prof. Faouzi ElHilali</span><br>
        Todos los derechos reservados
    </p>
</div>
    `;
    
    // A√±adir estilos para la animaci√≥n de carga
    document.head.insertAdjacentHTML('beforeend', `
           <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ranking-table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
        }

        .ranking-table table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Segoe UI', sans-serif;
            font-size: 1em;
        }

        .ranking-table thead tr {
            background: linear-gradient(90deg, #3867d6, #7f53ac);
            color: white;
        }

        .ranking-table th,
        .ranking-table td {
            padding: 16px 20px;
            text-align: left;
        }

        .ranking-table tbody tr:nth-child(even) {
            background-color: #f5f8ff;
        }

        .ranking-table tbody tr:hover {
            background-color: #e6ecff;
        }

        .ranking-medal {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 28px;
            margin-right: 8px;
            font-weight: bold;
            vertical-align: middle;
        }

        .medal-gold {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            box-shadow: 0 2px 6px rgba(255, 215, 0, 0.5);
        }

        .medal-silver {
            background: linear-gradient(45deg, #C0C0C0, #A9A9A9);
            box-shadow: 0 2px 6px rgba(192, 192, 192, 0.5);
        }

        .medal-bronze {
            background: linear-gradient(45deg, #CD7F32, #8B4513);
            box-shadow: 0 2px 6px rgba(205, 127, 50, 0.5);
        }

        .highlight-row {
            background: linear-gradient(to right, #fff2cc, #fce8b2);
            font-weight: 600;
            color: #2b2b2b;
            position: relative;
            border-top: 2px solid #f3d27a;
            border-bottom: 2px solid #f3d27a;
            z-index: 1;
        }

        .highlight-row {
            background: linear-gradient(to right, #fff2cc, #fce8b2);
            font-weight: 600;
            color: #2b2b2b;
            position: relative;
            border-top: 2px solid #f3d27a;
            border-bottom: 2px solid #f3d27a;
            z-index: 1;
        }

        /* Estilos para el modal de confirmaci√≥n de cierre de sesi√≥n */
        .logout-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .logout-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .logout-modal {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            padding: 0;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            overflow: hidden;
            animation: modalAppear 0.4s forwards;
        }
        
        .logout-modal-header {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 600;
            text-align: center;
        }
        
        .logout-modal-body {
            padding: 30px 25px;
            text-align: center;
            color: #444;
            font-size: 1.1em;
        }
        
        .logout-modal-buttons {
            display: flex;
            padding: 0 25px 25px;
            gap: 15px;
            justify-content: center;
        }
        
        .logout-modal-btn {
            padding: 12px 10px;
            border-radius: 30px;
            border: none;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            max-width: 180px;
        }
        
        .logout-modal-btn-primary {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.25);
        }
        
        .logout-modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(231, 76, 60, 0.35);
        }
        
        .logout-modal-btn-secondary {
            background: #f0f0f0;
            color: #444;
        }
        
        .logout-modal-btn-secondary:hover {
            background: #e0e0e0;
        }
        </style>
    `);
    
    // A√±adir la secci√≥n al contenedor principal
    document.querySelector('.container').appendChild(rankingSection);
    
    // A√±adir modal de confirmaci√≥n para cerrar sesi√≥n
    const logoutModal = document.createElement('div');
    logoutModal.className = 'logout-modal-overlay';
    logoutModal.id = 'logoutModal';
    logoutModal.innerHTML = `
        <div class="logout-modal">
            <div class="logout-modal-header">
                Cerrar sesi√≥n
            </div>
            <div class="logout-modal-body">
                <p>¬øEst√°s seguro de que quieres cerrar la sesi√≥n?</p>
                <p style="font-size: 3em; margin-top: 10px; color: #666;">ü§î</p>
            </div>
            <div class="logout-modal-buttons">
                <button class="logout-modal-btn logout-modal-btn-secondary" id="cancelarLogoutBtn">
                    Cancelar
                </button>
                <button class="logout-modal-btn logout-modal-btn-primary" id="confirmarLogoutBtn">
                    Cerrar sesi√≥n
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(logoutModal);
    

    
    // Funci√≥n para cargar los datos del ranking
    function cargarRanking() {
        // Solo cargar datos si se muestra la secci√≥n
        if (!document.getElementById('ranking').classList.contains('active')) return;
        
        const loadingIndicator = document.querySelector('#ranking .loading-indicator');
        const rankingTable = document.querySelector('#ranking .ranking-table');
        const errorMessage = document.querySelector('#ranking .error-message');
        
        // Mostrar indicador de carga, ocultar tabla y mensajes de error
        loadingIndicator.style.display = 'block';
        rankingTable.style.display = 'none';
        errorMessage.style.display = 'none';
        
        // URL del script de Google Apps Script (doGet)
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';
        
        // Obtener el nombre y apellido del usuario actual para destacar su fila
        const nombreUsuario = localStorage.getItem('examUserNombre');
        const apellidoUsuario = localStorage.getItem('examUserApellido');
        
        // Hacer la solicitud para obtener los resultados
     fetch(scriptURL)
        .then(response => response.json())
        .then(data => {
                // Ocultar indicador de carga
                loadingIndicator.style.display = 'none';
                
                if (data && data.resultados && Array.isArray(data.resultados)) {
                    // Filtrar resultados para eliminar entradas con valores por defecto
                    let resultados = data.resultados.filter(resultado => {
                        // Eliminar entradas con "No disponible", "Nombre", "Apellido" o vac√≠as
                        return (
                            resultado.nombre !== "No disponible" && 
                            resultado.nombre !== "Nombre" && 
                            resultado.apellido !== "No disponible" && 
                            resultado.apellido !== "Apellido" &&
                            resultado.nombre.trim() !== "" &&
                            resultado.apellido.trim() !== ""
                        );
                    });
                    
                    // Ordenar los resultados de mayor a menor puntuaci√≥n
                    resultados = resultados.sort((a, b) => {
                        return parseFloat(b.puntuacion) - parseFloat(a.puntuacion);
                    });
                    
                    // Generar las filas de la tabla
                    const rankingBody = document.getElementById('rankingBody');
                    rankingBody.innerHTML = '';
                    
                    if (resultados.length === 0) {
                        // Si no hay resultados v√°lidos despu√©s del filtrado
                        errorMessage.style.display = 'block';
                        errorMessage.querySelector('p:first-child').textContent = 'No hay resultados disponibles';
                        errorMessage.querySelector('p:last-child').textContent = 'S√© el primero en completar el examen.';
                        return;
                    }
                    
    resultados.forEach((resultado, index) => {
        const fila = document.createElement('tr');
        
        // Comprobar si es el usuario actual para destacar su fila
        const esUsuarioActual = resultado.nombre === nombreUsuario && 
                              resultado.apellido === apellidoUsuario;
        
        if (esUsuarioActual) {
            fila.classList.add('highlight-row');
        }
        
        // A√±adir clases de medalla para los tres primeros
        let posicionHTML = '';
        if (index === 0) {
            posicionHTML = '<span class="ranking-medal medal-gold">1</span>';
        } else if (index === 1) {
            posicionHTML = '<span class="ranking-medal medal-silver">2</span>';
        } else if (index === 2) {
            posicionHTML = '<span class="ranking-medal medal-bronze">3</span>';
        } else {
            posicionHTML = `<span style="display:inline-block;width:28px;text-align:center;font-weight:bold;">${index + 1}</span>`;
        }
        
        // Aqu√≠ separamos la posici√≥n en su propia celda
        fila.innerHTML = `
            <td style="text-align:center;padding-right:0;width:40px;">${posicionHTML}</td>
            <td style="padding-left:5px;">${resultado.nombre} ${resultado.apellido}</td>
            <td style="text-align:right;font-weight:600;">${resultado.puntuacion}</td>
        `;

        
        
        rankingBody.appendChild(fila);

    });
                    
                    // Mostrar la tabla
                    rankingTable.style.display = 'block';
                } else {
                    // Mostrar mensaje de error si no hay datos v√°lidos
                    errorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error al cargar el ranking:', error);
                loadingIndicator.style.display = 'none';
                errorMessage.style.display = 'block';
            });
    }
    
    // Modificar la funci√≥n cambiarSeccion para cargar el ranking cuando se accede a esa secci√≥n
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'ranking') {
            cargarRanking();
        }
    };
});

// Soluci√≥n para el bot√≥n de cerrar sesi√≥n (colocar justo antes del fin del script)
document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n que asigna todos los eventos necesarios
function inicializarBotonesCierreSesion() {
    console.log("Inicializando todos los botones de cerrar sesi√≥n...");
    
    // Array con todos los IDs de botones de cerrar sesi√≥n
    const botonesCierreSesion = [
        'cerrarSesionBtn',                  // En ranking
        'cerrarSesionBtnResultados',        // En resultados
        'cerrarSesionBtnYaParticipaste'     // En ya-participaste
    ];
    
    // Asignar el mismo comportamiento a todos los botones
    botonesCierreSesion.forEach(id => {
        const boton = document.getElementById(id);
        if (boton) {
            // Eliminar cualquier evento existente clonando el bot√≥n
            const nuevoBoton = boton.cloneNode(true);
            boton.parentNode.replaceChild(nuevoBoton, boton);
            
            // Asignar el nuevo evento
            nuevoBoton.addEventListener('click', function() {
                console.log(`Bot√≥n ${id} clickeado`);
                playNextSound();
                
                // Mostrar modal de confirmaci√≥n
                const logoutModal = document.getElementById('logoutModal');
                if (logoutModal) {
                    logoutModal.classList.add('active');
                } else {
                    console.error("Modal de logout no encontrado");
                }
            });
        }
    });

        
        // Asignar evento al bot√≥n Cancelar del modal
        if (cancelarLogoutBtn) {
            cancelarLogoutBtn.addEventListener('click', function() {
                playNextSound(); // Reproducir sonido
                console.log("Bot√≥n cancelar clickeado");
                if (logoutModal) {
                    logoutModal.classList.remove('active');
                }
            });
        }
        
        // Asignar evento al bot√≥n Confirmar del modal
        if (confirmarLogoutBtn) {
            confirmarLogoutBtn.addEventListener('click', function() {
    playNextSound(); // Reproducir sonido
    console.log("Bot√≥n confirmar clickeado");
    
    // AQU√ç DEBES INSERTAR EL BLOQUE:
    const ultimoNombre = localStorage.getItem('examUserNombre');
    const ultimoApellido = localStorage.getItem('examUserApellido');
    if (ultimoNombre) localStorage.setItem('lastExamUserNombre', ultimoNombre);
    if (ultimoApellido) localStorage.setItem('lastExamUserApellido', ultimoApellido);

    // Limpiar localStorage
    localStorage.removeItem('examTimerRemaining');
    localStorage.removeItem('examUserNombre');
    localStorage.removeItem('examUserApellido');
    localStorage.removeItem('examStartTime');
    localStorage.removeItem('examEndTime');
                
                // Ocultar modal
                if (logoutModal) {
                    logoutModal.classList.remove('active');
                }
                
                // Redirigir a la pantalla de login
                cambiarSeccion('login');
                
                   // Restaurar el bot√≥n de inicio a su estado original
        const startExamBtn = document.getElementById('startExamBtn');
        if (startExamBtn) {
            startExamBtn.textContent = 'Comenzar Examen';
            startExamBtn.disabled = false;
        }
                // Mostrar mensaje de confirmaci√≥n
                const loginContainer = document.getElementById('login');
                if (loginContainer) {
                    const mensaje = document.createElement('div');
                    mensaje.style = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #d4edda;
            color: #155724;
            padding: 25px 40px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            z-index: 2000;
            animation: fadeInOut 2.5s forwards;
        `;
                    mensaje.textContent = 'Sesi√≥n cerrada correctamente';
                    loginContainer.appendChild(mensaje);
                    
                    // Eliminar mensaje despu√©s de 3 segundos
                    setTimeout(() => {
                        if (mensaje.parentNode) {
                            mensaje.parentNode.removeChild(mensaje);
                        }
                    }, 3000);
                }
            });
        }
    }
    
    // Inicializar eventos inmediatamente
    inicializarBotonesCierreSesion();
    
    // Tambi√©n inicializar cuando se cambie a la secci√≥n de ranking
    const originalCambiarSeccion = window.cambiarSeccion;
    if (originalCambiarSeccion && !window.cambiarSeccionParcheado) {
        window.cambiarSeccionParcheado = true; // Evitar m√∫ltiples asignaciones
        window.cambiarSeccion = function(seccionId) {
            originalCambiarSeccion(seccionId);
            if (seccionId === 'ranking') {
                // Dar un peque√±o tiempo para asegurar que el DOM est√° actualizado
                setTimeout(inicializarBotonesCierreSesion, 200);
            }
        };
    }
});

// Asignar eventos directamente si el DOM ya est√° cargado
if (document.readyState === "complete" || document.readyState === "interactive") {
    const cerrarSesionBtn = document.getElementById('cerrarSesionBtn');
    const logoutModal = document.getElementById('logoutModal');
    
    if (cerrarSesionBtn && logoutModal) {
        cerrarSesionBtn.onclick = function() {
            logoutModal.classList.add('active');
            console.log("Modal activado directamente");
        };
    }
}

// ...existing code...
function cambiarSeccion(seccionId) {
    playNextSound();
    document.querySelectorAll('.section').forEach(seccion => {
        seccion.classList.remove('active');
    });
    document.getElementById(seccionId).classList.add('active');
    window.scrollTo(0, 0);

    // Guardar la secci√≥n activa en localStorage
    localStorage.setItem('activeSection', seccionId);

    // OCULTAR EL TIMER EN RESULTADOS Y RANKING
    const timerElement = document.getElementById('examTimer');
    if (timerElement) {
        if (seccionId === 'resultados' || seccionId === 'ranking') {
            timerElement.classList.remove('active');
            timerElement.style.opacity = 0;
            timerElement.style.visibility = 'hidden';
        }
    }

    if (seccionId === 'produccion') {
        const initialOptions = document.querySelector('.segment-options-a[data-dialog="1"][data-part="1"]');
        if (initialOptions) shuffleButtons(initialOptions);
    }
    // ...resto de tu funci√≥n...
}

// Al cargar la p√°gina, restaurar la secci√≥n activa si existe
document.addEventListener('DOMContentLoaded', function() {
    const activeSection = localStorage.getItem('activeSection');
    if (activeSection) {
        cambiarSeccion(activeSection);
        // Si la secci√≥n activa es Comprensi√≥n Auditiva, iniciar el timer
        if (activeSection === 'comprension-auditiva') {
            const timerElement = document.getElementById('examTimer');
            if (timerElement && !examTimerInterval) {
                startExamTimer();
                forzarAparicionTimer();
            }
        }
    } else {
        // Si no hay secci√≥n guardada, mostrar la secci√≥n de login
        cambiarSeccion('login');
    }
});
// Guardar y restaurar respuestas de los formularios en localStorage
function guardarRespuestasFormularios() {
    // Guardar respuestas de los radio buttons
    document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
        localStorage.setItem(`radio_${radio.name}`, radio.value);
    });
    
    // Guardar respuestas de los select
    document.querySelectorAll('select').forEach(select => {
        if (select.value) {
            localStorage.setItem(`select_${select.name}`, select.value);
        }
    });
    
    // Guardar respuestas de los input text
    document.querySelectorAll('input[type="text"]').forEach(input => {
        if (input.value.trim()) {
            localStorage.setItem(`text_${input.id || input.name}`, input.value);
        }
    });
    
    // Guardar respuestas de di√°logos
    for (let i = 1; i <= 11; i++) {
        const hiddenInput = document.getElementById(`com${i}Input`);
        if (hiddenInput && hiddenInput.value) {
            localStorage.setItem(`dialog_${i}`, hiddenInput.value);
            
            // Guardar el estado de visualizaci√≥n de las opciones
            const dialogOptions = document.querySelectorAll(`.segment-options-a[data-dialog="${i}"]`);
            dialogOptions.forEach(option => {
                const partId = option.getAttribute('data-part');
                localStorage.setItem(`dialog_option_${i}_${partId}`, option.style.display);
            });
        }
    }
    
    // Guardar el estado de los botones de edici√≥n
    for (let i = 1; i <= 11; i++) {
        const editBtn = document.getElementById(`edit-btn-${i}`);
        if (editBtn) {
            localStorage.setItem(`edit_btn_${i}_display`, editBtn.style.display);
        }
    }
}

// Restaurar respuestas guardadas
function restaurarRespuestasFormularios() {
    // Restaurar radio buttons
    document.querySelectorAll('input[type="radio"]').forEach(radio => {
        const savedValue = localStorage.getItem(`radio_${radio.name}`);
        if (savedValue && savedValue === radio.value) {
            radio.checked = true;
        }
    });
    
    // Restaurar selects
    document.querySelectorAll('select').forEach(select => {
        const savedValue = localStorage.getItem(`select_${select.name}`);
        if (savedValue) {
            select.value = savedValue;
        }
    });
    
    // Restaurar inputs text
    document.querySelectorAll('input[type="text"]').forEach(input => {
        const savedValue = localStorage.getItem(`text_${input.id || input.name}`);
        if (savedValue) {
            input.value = savedValue;
        }
    });
    
    // Restaurar di√°logos
    for (let i = 1; i <= 11; i++) {
        const hiddenInput = document.getElementById(`com${i}Input`);
        const responseDisplay = document.getElementById(`response${i}`);
        
        if (hiddenInput && responseDisplay) {
            const savedValue = localStorage.getItem(`dialog_${i}`);
            if (savedValue) {
                hiddenInput.value = savedValue;
                responseDisplay.textContent = savedValue;
                
                // Restaurar el estado de visualizaci√≥n de las opciones
                const dialogOptions = document.querySelectorAll(`.segment-options-a[data-dialog="${i}"]`);
                dialogOptions.forEach(option => {
                    const partId = option.getAttribute('data-part');
                    const displayState = localStorage.getItem(`dialog_option_${i}_${partId}`);
                    if (displayState) {
                        option.style.display = displayState;
                    }
                });
                
                // Restaurar bot√≥n de edici√≥n
                const editBtn = document.getElementById(`edit-btn-${i}`);
                if (editBtn) {
                    const btnDisplay = localStorage.getItem(`edit_btn_${i}_display`);
                    if (btnDisplay) {
                        editBtn.style.display = btnDisplay;
                    }
                }
                
                // Si hay una respuesta, mostrar el bot√≥n de reset
                if (savedValue !== 'Tu respuesta aparecer√° aqu√≠' && savedValue.trim() !== '') {
                    const resetButton = document.querySelector(`.response-container-a:nth-child(${i * 2}) .reset-button-a`);
                    if (resetButton) {
                        resetButton.style.display = 'flex';
                    }
                }
            }
        }
    }
    
    // Restaurar el audio
    const audioPlayer = document.getElementById('audioPlayer');
    const audioCount = document.getElementById('audioCount');
    if (audioPlayer && audioCount) {
        const savedCount = localStorage.getItem('audioCount');
        if (savedCount) {
            audioCount.textContent = savedCount;
            if (parseInt(savedCount) <= 0) {
                const playBtn = document.getElementById('audioPlayBtn');
                if (playBtn) {
                    playBtn.disabled = true;
                    playBtn.innerHTML = '<span style="color:#e67e22;font-weight:500;font-size:1em;display:inline-block;animation:pulseMessage 0.5s infinite;">Has agotado tus 3 escuchas</span>';
                    audioCount.style.display = "none";
                }
            }
        }
    }
}

// A√±adir evento para guardar las respuestas antes de refrescar la p√°gina
window.addEventListener('beforeunload', guardarRespuestasFormularios);

// Restaurar respuestas al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    restaurarRespuestasFormularios();
});

// Modificar evento de audio para guardar el contador
const originalAudioEndedEvent = document.getElementById('audioPlayer')?.onended;
if (document.getElementById('audioPlayer')) {
    document.getElementById('audioPlayer').addEventListener('ended', function() {
        // Ejecutar comportamiento original si existe
        if (typeof originalAudioEndedEvent === 'function') {
            originalAudioEndedEvent();
        }
        
        // Guardar contador de audio
        const counter = document.getElementById('audioCount');
        if (counter) {
            localStorage.setItem('audioCount', counter.textContent);
        }
    });
}

// Guardar respuestas cada vez que hay un cambio
document.addEventListener('change', function(e) {
    if (e.target.matches('input[type="radio"], select, input[type="text"]')) {
        guardarRespuestasFormularios();
    }
});

// Guardar respuestas cuando se interact√∫a con los segmentos de di√°logo
document.addEventListener('click', function(e) {
    if (e.target.matches('.segment-btn-a, .edit-button-a, .reset-button-a')) {
        // Usar setTimeout para asegurar que se guardan los cambios despu√©s de que se actualiza la UI
        setTimeout(guardarRespuestasFormularios, 100);
    }
});

// Funci√≥n para limpiar datos espec√≠ficos al reiniciar un di√°logo
const originalResetDialog = window.resetDialog;
window.resetDialog = function(dialogId) {
    originalResetDialog(dialogId);
    
    // Limpiar datos guardados para este di√°logo espec√≠fico
    localStorage.removeItem(`dialog_${dialogId}`);
    
    // Limpiar opciones de di√°logo
    const dialogOptions = document.querySelectorAll(`.segment-options-a[data-dialog="${dialogId}"]`);
    dialogOptions.forEach(option => {
        const partId = option.getAttribute('data-part');
        localStorage.removeItem(`dialog_option_${dialogId}_${partId}`);
    });
    
    // Limpiar estado del bot√≥n de edici√≥n
    localStorage.removeItem(`edit_btn_${dialogId}_display`);
    
    // Guardar el nuevo estado (primera opci√≥n visible, resto ocultas)
    setTimeout(guardarRespuestasFormularios, 100);
};

// Modificar el cierre de sesi√≥n para limpiar tambi√©n los datos de formularios
const originalConfirmarLogout = document.getElementById('confirmarLogoutBtn')?.onclick;
if (document.getElementById('confirmarLogoutBtn')) {
    document.getElementById('confirmarLogoutBtn').addEventListener('click', function() {
        // Ejecutar comportamiento original si existe
        if (typeof originalConfirmarLogout === 'function') {
            originalConfirmarLogout();
        }
        
        // Limpiar datos de formularios
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('radio_') || key.startsWith('select_') || 
                key.startsWith('text_') || key.startsWith('dialog_') || 
                key.startsWith('edit_btn_') || key === 'audioCount') {
                localStorage.removeItem(key);
            }
        }
    });
}

// Guardar la posici√≥n actual del audio al salir de la p√°gina
document.getElementById('audioPlayer')?.addEventListener('timeupdate', function() {
    localStorage.setItem('audioPlayerTime', this.currentTime);
});

// Restaurar la posici√≥n del audio al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    const audioPlayer = document.getElementById('audioPlayer');
    if (audioPlayer) {
        const savedTime = localStorage.getItem('audioPlayerTime');
        if (savedTime) {
            audioPlayer.currentTime = parseFloat(savedTime);
        }
    }
});

// Asegurar que se guarde la posici√≥n correctamente antes de refrescar
window.addEventListener('beforeunload', function() {
    const audioPlayer = document.getElementById('audioPlayer');
    if (audioPlayer && !audioPlayer.paused) {
        localStorage.setItem('audioPlayerTime', audioPlayer.currentTime);
    }
});

// Guardar el estado de reproducci√≥n (reproduciendo o pausado)
document.getElementById('audioPlayer')?.addEventListener('play', function() {
    localStorage.setItem('audioPlayerPlaying', 'true');
});

document.getElementById('audioPlayer')?.addEventListener('pause', function() {
    localStorage.setItem('audioPlayerPlaying', 'false');
});

// Modificar el evento click del bot√≥n para restaurar la posici√≥n del audio
document.addEventListener('DOMContentLoaded', function() {
    const audioPlayer = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('audioPlayBtn');
    
    if (audioPlayer && playBtn) {
        // Guardar el evento click original
        const originalClickHandler = playBtn.onclick;
        
        // Reemplazar con nuevo manejador
        playBtn.onclick = function(event) {
            // Restaurar la posici√≥n guardada antes de reproducir
            const savedTime = localStorage.getItem('audioPlayerTime');
            if (savedTime) {
                audioPlayer.currentTime = parseFloat(savedTime);
            }
            
            // Luego ejecutar el comportamiento original si existe
            if (typeof originalClickHandler === 'function') {
                originalClickHandler.call(this, event);
            } else {
                // Si no hay manejador original, reproducir el audio directamente
                const remaining = parseInt(document.getElementById('audioCount')?.textContent || '0');
                if (remaining > 0) {
                    audioPlayer.play();
                }
            }
        };
    }
    
    // Restaurar el estado de reproducci√≥n al cargar la p√°gina
    if (audioPlayer) {
        const wasPlaying = localStorage.getItem('audioPlayerPlaying');
        if (wasPlaying === 'true') {
            const remaining = parseInt(document.getElementById('audioCount')?.textContent || '0');
            if (remaining > 0) {
                setTimeout(() => {
                    if (playBtn && !playBtn.disabled) {
                        playBtn.click();
                    }
                }, 500);
            }
        }
    }
});

// Controlar el comportamiento al refrescar secciones espec√≠ficas
window.addEventListener('beforeunload', function(event) {
    const currentSection = localStorage.getItem('activeSection');
    const exemptSections = ['login', 'inicio', 'resultados', 'ranking'];
    
    // Si la secci√≥n actual est√° en la lista de exentas, no guardar formularios
    if (exemptSections.includes(currentSection)) {
        // No hacer nada especial, solo permitir el refresco normal
        return;
    } else {
        // Para otras secciones, guardar respuestas como est√° configurado
        guardarRespuestasFormularios();
    }
});

// Modificar la restauraci√≥n para respetar las secciones exentas
document.addEventListener('DOMContentLoaded', function() {
    const currentSection = localStorage.getItem('activeSection');
    const exemptSections = ['login', 'inicio', 'resultados', 'ranking'];
    
    if (!exemptSections.includes(currentSection)) {
        // Solo restaurar respuestas para secciones no exentas
        restaurarRespuestasFormularios();
    }
    
    // Secci√≥n espec√≠fica para login: limpiar campos siempre
    if (currentSection === 'login') {
        const nombreInput = document.getElementById('nombre');
        const apellidoInput = document.getElementById('apellido');
        
        if (nombreInput) nombreInput.value = '';
        if (apellidoInput) apellidoInput.value = '';
    }
});
// Mejorar la funci√≥n de cierre de sesi√≥n para borrar todos los datos del formulario
document.addEventListener('DOMContentLoaded', function() {
    // Obtener referencia al bot√≥n de confirmar logout despu√©s de que el DOM est√© listo
    const confirmarLogoutBtn = document.getElementById('confirmarLogoutBtn');
    
    if (confirmarLogoutBtn) {
        // Reemplazar el evento click existente con una implementaci√≥n completa
        confirmarLogoutBtn.addEventListener('click', function() {
            console.log("Limpiando todos los datos del formulario...");
            
            // Reproducir sonido
            playNextSound();
            
            // Borrar todos los radio buttons
            document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
                radio.checked = false;
            });
            
            // Borrar todos los selects
            document.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });
            
            // Borrar todos los campos de texto
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.value = '';
            });
            
            // Reiniciar todos los di√°logos
            for (let i = 1; i <= 11; i++) {
                const responseDisplay = document.getElementById(`response${i}`);
                const hiddenInput = document.getElementById(`com${i}Input`);
                
                if (responseDisplay) {
                    responseDisplay.textContent = 'Tu respuesta aparecer√° aqu√≠';
                    responseDisplay.style.backgroundColor = '#fff';
                    responseDisplay.style.borderColor = '#ccc';
                    responseDisplay.classList.remove('editing-mode');
                }
                
                if (hiddenInput) {
                    hiddenInput.value = '';
                }
                
                // Ocultar todas las opciones de segmentos excepto la primera
                document.querySelectorAll(`.segment-options-a[data-dialog="${i}"]`).forEach(option => {
                    if (option.getAttribute('data-part') === '1') {
                        option.style.display = 'flex';
                    } else {
                        option.style.display = 'none';
                    }
                });
                
                // Ocultar botones de edici√≥n y reset
                const editButton = document.getElementById(`edit-btn-${i}`);
                if (editButton) {
                    editButton.style.display = 'none';
                }
                
                const resetContainer = document.querySelector(`.response-container-a:nth-child(${i * 2}) .reset-button-container-a`);
                if (resetContainer) {
                    const resetButton = resetContainer.querySelector('.reset-button-a');
                    if (resetButton) {
                        resetButton.style.display = 'none';
                    }
                }
            }
            
            // Reiniciar contador de audio
            const audioCount = document.getElementById('audioCount');
            if (audioCount) {
                audioCount.textContent = '3';
                audioCount.style.display = 'inline-block';
            }
            
            const playBtn = document.getElementById('audioPlayBtn');
            if (playBtn) {
                playBtn.disabled = false;
                playBtn.innerHTML = '<i style="display:inline-block;font-size:1.2em;margin-right:5px;">üéß</i> Pulsar audio <span id="audioCount" class="audio-count-anim" style="display:inline-block;min-width:22px;text-align:center;background:#dc3545;color:white;border-radius:50%;margin-left:8px;font-size:0.85em;padding:3px;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2);">3</span>';
            }
            
            // Limpiar todos los datos guardados en localStorage relacionados con formularios
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('radio_') || 
                    key.startsWith('select_') || 
                    key.startsWith('text_') || 
                    key.startsWith('dialog_') || 
                    key.startsWith('edit_btn_') || 
                    key === 'audioCount' || 
                    key === 'audioPlayerTime' || 
                    key === 'audioPlayerPlaying') {
                    localStorage.removeItem(key);
                }
            });
            
            // Limpiar localStorage espec√≠fico del examen
            localStorage.removeItem('examTimerRemaining');
            localStorage.removeItem('examUserNombre');
            localStorage.removeItem('examUserApellido');
            localStorage.removeItem('examStartTime');
            localStorage.removeItem('examEndTime');
            localStorage.removeItem('activeSection');
            localStorage.removeItem('examStartTimestamp');
localStorage.removeItem('examDurationSeconds');
            
            // Ocultar modal
            const logoutModal = document.getElementById('logoutModal');
            if (logoutModal) {
                logoutModal.classList.remove('active');
            }
            
            // Redirigir a la pantalla de login
            cambiarSeccion('login');
            
            // Restaurar el bot√≥n de inicio a su estado original
            const startExamBtn = document.getElementById('startExamBtn');
            if (startExamBtn) {
                startExamBtn.textContent = 'Comenzar Examen';
                startExamBtn.disabled = false;
            }
            
            // Mostrar mensaje de confirmaci√≥n
            const loginContainer = document.getElementById('login');
            if (loginContainer) {
                const mensaje = document.createElement('div');
                mensaje.style = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #d4edda;
                    color: #155724;
                    padding: 25px 40px;
                    border-radius: 10px;
                    text-align: center;
                    font-size: 1.2em;
                    font-weight: 600;
                    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
                    z-index: 2000;
                    animation: fadeInOut 2.5s forwards;
                `;
                mensaje.textContent = 'Sesi√≥n cerrada correctamente';
                loginContainer.appendChild(mensaje);
                
                // Eliminar mensaje despu√©s de 3 segundos
                setTimeout(() => {
                    if (mensaje.parentNode) {
                        mensaje.parentNode.removeChild(mensaje);
                    }
                }, 3000);
            }
            
            console.log("Datos del formulario limpiados correctamente");
        }, { once: false });
    }
    
    // Hacer lo mismo para el bot√≥n de cerrar sesi√≥n en resultados
    const cerrarSesionBtnResultados = document.getElementById('cerrarSesionBtnResultados');
    if (cerrarSesionBtnResultados) {
        cerrarSesionBtnResultados.addEventListener('click', function() {
            playNextSound();
            const logoutModal = document.getElementById('logoutModal');
            if (logoutModal) {
                logoutModal.classList.add('active');
            }
        });
    }
});

// A√±adir la animaci√≥n de fadeInOut si no existe
document.head.insertAdjacentHTML('beforeend', `
<style>
    @keyframes fadeInOut {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        20% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
        30% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        70% { opacity: 1; }
        100% { opacity: 0; transform: translate(-50%, -50%); }
    }
</style>
`);

/* Pausar el audio al cambiar de secci√≥n y permitir reanudarlo */
(function() {
    // Guardar referencia al audio y bot√≥n play
    let audioPlayer, playBtn;
    document.addEventListener('DOMContentLoaded', function() {
        audioPlayer = document.getElementById('audioPlayer');
        playBtn = document.getElementById('audioPlayBtn');
    });

    // Sobrescribir cambiarSeccion para pausar el audio si est√° sonando
    const cambiarSeccionOriginal = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        // Pausar el audio si est√° reproduci√©ndose
        if (audioPlayer && !audioPlayer.paused && !audioPlayer.ended) {
            audioPlayer.pause();
            // Cambiar el texto del bot√≥n para indicar que se puede reanudar
            if (playBtn && playBtn.disabled) {
                playBtn.disabled = false;
                playBtn.textContent = "‚ñ∂Ô∏è Reanudar audio";
            }
        }
        cambiarSeccionOriginal(seccionId);
    };

    // Al hacer click en el bot√≥n de audio, reanudar si est√° pausado
    document.addEventListener('DOMContentLoaded', function() {
        if (playBtn && audioPlayer) {
            playBtn.addEventListener('click', function() {
                // Si el audio est√° pausado y no ha terminado, reanudar
                if (audioPlayer.paused && audioPlayer.currentTime > 0 && !audioPlayer.ended) {
                    audioPlayer.play();
                    playBtn.textContent = "üîä Reproduciendo...";
                    playBtn.disabled = true;
                }
            });
        }
    });
})();

function forzarAparicionTimer() {
    const timerElement = document.getElementById('examTimer');
    if (timerElement) {
        timerElement.classList.add('active');
        timerElement.style.opacity = 1;
        timerElement.style.visibility = 'visible';
    }
}

window.onload = function() {
    // Selecciona el bot√≥n "Comenzar Examen" en la secci√≥n de inicio
    const btnComenzar = document.querySelector('#inicio .btn[onclick*="comprension"]');
    if (btnComenzar) {
        btnComenzar.addEventListener('click', function() {
            // Forzar refresco de la secci√≥n de comprensi√≥n y mostrar el timer
            setTimeout(() => {
                cambiarSeccion('comprension');
                forzarAparicionTimer();
            }, 100);
        });
    }
};
   function enviarIdentificadorAlServidor() {
    const identificador = localStorage.getItem('identificadorUnico') || '';
    const nombre = localStorage.getItem('examUserNombre') || '';
    const apellido = localStorage.getItem('examUserApellido') || '';
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';

    if (identificador && nombre && apellido) {
        const datos = {
            nombre: nombre,
            apellido: apellido,
            identificador: identificador,
            evento: 'login' // Para distinguir este env√≠o
        };
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(datos)
        })
        .then(() => {
            console.log('Identificador enviado al servidor al loguear');
        })
        .catch(error => {
            console.error('Error al enviar identificador:', error);
        });
    }
}

function mostrarSeccionYaParticipaste() {
    playNextSound(); document.querySelectorAll('.section').forEach(seccion => seccion.classList.remove('active'));
    document.getElementById('ya-participaste').classList.add('active');
    
    // Actualiza el nombre del usuario
    const nombreUsuario = localStorage.getItem('examUserNombre') || '';
    const apellidoUsuario = localStorage.getItem('examUserApellido') || '';
    
    // Buscar el elemento h1 en la secci√≥n (sin depender del id espec√≠fico)
    const saludoElement = document.querySelector('#ya-participaste h1');
    if (saludoElement && nombreUsuario && apellidoUsuario) {
        saludoElement.innerHTML = `
            <span style="
                background: linear-gradient(90deg, #4CAF50, #CDDC39, #8BC34A); 
                -webkit-background-clip: text; 
                background-clip: text; 
                color: transparent; 
                padding: 0 4px;
                font-size: 1.6rem;
                font-weight: 600;
                text-shadow: 0px 1px 2px rgba(0,0,0,0.1);
                letter-spacing: 0.5px;
            "><span style="color: black">Hola</span>, ${nombreUsuario} ${apellidoUsuario}</span>
        `;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Verificar si la secci√≥n activa es ya-participaste al cargar la p√°gina
    const activeSection = localStorage.getItem('activeSection');
    
    if (activeSection === 'ya-participaste') {
        // Asegurar que se muestra la secci√≥n
        document.querySelectorAll('.section').forEach(seccion => seccion.classList.remove('active'));
        document.getElementById('ya-participaste').classList.add('active');
        
        // Restaurar el saludo personalizado
        const nombreUsuario = localStorage.getItem('examUserNombre') || '';
        const apellidoUsuario = localStorage.getItem('examUserApellido') || '';
        
        // Buscar el elemento h1 dentro de ya-participaste
        const saludoElement = document.querySelector('#ya-participaste h1');
        
        if (saludoElement && nombreUsuario && apellidoUsuario) {
            console.log("Restaurando saludo para:", nombreUsuario, apellidoUsuario);
            
            saludoElement.innerHTML = `
                <span style="
                    background: linear-gradient(90deg, #4CAF50, #CDDC39, #8BC34A); 
                    -webkit-background-clip: text; 
                    background-clip: text; 
                    color: transparent; 
                    padding: 0 4px;
                    font-size: 1.6rem;
                    font-weight: 600;
                    text-shadow: 0px 1px 2px rgba(0,0,0,0.1);
                    letter-spacing: 0.5px;
                "><span style="color: black">Hola</span>, ${nombreUsuario} ${apellidoUsuario}</span>
            `;
        } else {
            console.log("No se pudo restaurar el saludo. Elementos faltantes:", {
                saludoElement: !!saludoElement,
                nombreUsuario,
                apellidoUsuario
            });
        }
    }
});

document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n para ocultar contenedores al iniciar sesi√≥n o cambiar a la secci√≥n ya-participaste
    function ocultarContenedoresResultados() {
        // Ocultar ranking
        const rankingContainer = document.getElementById('rankingContainer');
        if (rankingContainer) {
            rankingContainer.style.display = 'none';
        }
        
        // Ocultar resultados individuales
        const resultadosPrevios = document.getElementById('resultadosPrevios');
        if (resultadosPrevios) {
            resultadosPrevios.style.display = 'none';
        }
    }
    
    // Aplicar al cargar la p√°gina (por si se recarga)
    ocultarContenedoresResultados();
    
    // A√±adir al formulario de login un evento para resetear los contenedores
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
        const originalSubmitHandler = loginForm.onsubmit;
        loginForm.onsubmit = function(e) {
            // Ejecutar handler original primero
            if (originalSubmitHandler) {
                originalSubmitHandler.call(this, e);
            }
            
            // Ocultar contenedores
            ocultarContenedoresResultados();
        };
    }
    
    // Modificar la funci√≥n cambiarSeccion para ocultar los contenedores
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'ya-participaste') {
            // Ocultar contenedores al cambiar a esta secci√≥n
            ocultarContenedoresResultados();
        }
    };
});

// Estilos CSS mejorados para los botones de la secci√≥n ya-participaste
document.head.insertAdjacentHTML('beforeend', `
<style>
/* Estilos comunes para todos los botones de la secci√≥n */
#ya-participaste .btn {
  display: inline-block;
  padding: 1px 0px; /* Aumentado el padding horizontal a 50px */
  font-size: 1.1em;
  font-weight: 600;
  text-align: center;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  position: relative;
  overflow: hidden;
  max-width: 230px; /* A√±adido ancho m√°ximo para control */
}
  

  
  /* Hover y efectos activos para todos los botones */
  #ya-participaste .btn:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  }
  
  #ya-participaste .btn:active {
    transform: translateY(1px);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
  }
  
  /* Bot√≥n Ver resultados */
  #verResultadosBtn {
    background: linear-gradient(90deg, #3867d6, #7f53ac);
    color: white;
    box-shadow: 0 4px 15px rgba(56, 103, 214, 0.25);
  }
  
  /* Bot√≥n Comparar resultados */
  #compararResultadosBtn {
    background: linear-gradient(90deg, #7f53ac, #9d50bb);
    color: white;
    box-shadow: 0 4px 15px rgba(127, 83, 172, 0.25);
  }
  
  /* Bot√≥n Cerrar sesi√≥n */
  #cerrarSesionBtnYaParticipaste {
    background: linear-gradient(90deg, #e74c3c, #c0392b);
    color: white;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.25);
  }
  
  /* Efecto de ondas al hacer clic */
  #ya-participaste .btn::after {
    content: '';
    display: block;
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
    background-repeat: no-repeat;
    background-position: 50%;
    transform: scale(10, 10);
    opacity: 0;
    transition: transform 0.5s, opacity 0.8s;
  }
  
  #ya-participaste .btn:active::after {
    transform: scale(0, 0);
    opacity: 0.3;
    transition: 0s;
  }
  
  /* Contenedores de los botones */
  #ya-participaste .btn-container {
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  /* Pantallas peque√±as */
  @media (max-width: 576px) {
    #ya-participaste .btn {
      width: 100%;
      margin: 8px 0;
      padding: 10px 20px;
      font-size: 1em;
    }
  }
</style>
`);

// Modifica la estructura HTML para aplicar las clases a los contenedores
document.getElementById('ya-participaste').innerHTML = `
    <div style="text-align:center; margin-top:60px;">
        <h1 id="yaParticipasteSaludo" style="margin-bottom: 5px; font-size: 1.4rem;">
            <span style="background: linear-gradient(90deg, #9d50bb, #e3647d); -webkit-background-clip: text; background-clip: text; color: transparent; padding: 0 2px;"></span>
        </h1>
        <h2 style="color:#e74c3c; margin-bottom: 15px;">Ya has participado en el examen</h2>
        <p style="font-size:1.2em; color:#444;">Contacta con tu profesor si crees que es un error.</p>
        
        <!-- Grupo de Ver Resultados -->
        <div class="btn-container">
            <!-- Bot√≥n para ver resultados -->
            <button id="verResultadosBtn" class="btn">
                <span style="margin-right: 10px;">üìä</span>Ver tus resultados
            </button>
            
            <!-- Contenedor para mostrar los resultados justo despu√©s del bot√≥n -->
            <div id="resultadosPrevios" style="display: none; margin-top: 30px; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 600px; margin-left: auto; margin-right: auto;">
                <h3 style="color: #3867d6; margin-bottom: 20px;">Tus resultados del examen</h3>
                <div class="resultados-contenedor">
                    <p class="cargando-resultados">Cargando tus resultados...</p>
                </div>
            </div>
        </div>
        
        <!-- Grupo de Comparar Resultados -->
        <div class="btn-container">
            <!-- Nuevo bot√≥n para comparar resultados -->
            <button id="compararResultadosBtn" class="btn">
                <span style="margin-right: 10px;">üìà</span>Ranking
            </button>
            
            <!-- Contenedor para el ranking (se sit√∫a aqu√≠, despu√©s del bot√≥n) -->
           <div id="rankingContainer" style="display: none; margin-top: 30px; background: white; border-radius: 15px; padding: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 800px; width: 100%; margin-left: auto; margin-right: auto;">
    <h3 style="color: #3867d6; margin-bottom: 20px;">Ranking de resultados</h3>
    <div class="ranking-table" style="border-radius: 12px; overflow-x: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-height: 400px; overflow-y: auto; position: relative;">
        <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
            <thead>
                <tr style="background: linear-gradient(90deg, #3867d6, #7f53ac); color: white; text-align: left;">
                    <th style="padding: 12px 15px; font-weight: 600; width:40px;"></th>
                    <th style="padding: 12px 15px; font-weight: 600;">Usuario</th>
                    <th style="padding: 12px 15px; font-weight: 600; text-align:right;">Pts.</th>
                </tr>
            </thead>
            <tbody id="rankingBodyYaParticipaste">
                <!-- Los resultados se insertar√°n aqu√≠ desde JavaScript -->
            </tbody>
        </table>
    </div>
</div>
        
        <!-- Bot√≥n de cerrar sesi√≥n (ahora despu√©s de ambos contenedores) -->
        <div class="btn-container">
            <button id="cerrarSesionBtnYaParticipaste" class="btn">
                <span style="margin-right: 10px;">üö™</span>Cerrar sesi√≥n
            </button>
        </div>
    </div>
`;

// Modificar la funcionalidad del bot√≥n "Comparar resultados"
document.addEventListener('DOMContentLoaded', function() {
    // Primero, crear el contenedor de ranking si no existe
    let rankingContainer = document.getElementById('rankingContainer');
    if (!rankingContainer) {
        // Crear el contenedor de ranking justo despu√©s del contenedor de resultados
        const resultadosPrevios = document.getElementById('resultadosPrevios');
        rankingContainer = document.createElement('div');
        rankingContainer.id = 'rankingContainer';
        rankingContainer.style = 'display: none; margin-top: 30px; background: white; border-radius: 15px; padding: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 600px; width: 100%;';
        rankingContainer.innerHTML = `
            <h3 style="color: #3867d6; margin-bottom: 20px;">Ranking de resultados</h3>
            <div class="ranking-contenedor" style="max-width: 600px; width: 100%">
                <p class="cargando-ranking">Cargando ranking...</p>
            </div>
        `;
        
        if (resultadosPrevios && resultadosPrevios.parentNode) {
            resultadosPrevios.parentNode.insertBefore(rankingContainer, resultadosPrevios.nextSibling);
        } else {
            // Si no se encuentra el contenedor de resultados, buscar en ya-participaste
            const yaParticipaste = document.getElementById('ya-participaste');
            if (yaParticipaste) {
                const contenedor = yaParticipaste.querySelector('div');
                if (contenedor) {
                    contenedor.appendChild(rankingContainer);
                }
            }
        }
    }

    // Asignar funcionalidad al bot√≥n de comparar resultados
    const compararResultadosBtn = document.getElementById('compararResultadosBtn');
    if (compararResultadosBtn) {
        compararResultadosBtn.addEventListener('click', function() {
            playNextSound(); // Reproducir sonido
            cargarRanking();
        });
    }

    // Funci√≥n para cargar el ranking
    window.cargarRanking = function() {
        // Mostrar el contenedor de ranking
        const rankingContainer = document.getElementById('rankingContainer');
        rankingContainer.style.display = 'block';

        // Ocultar el contenedor de resultados si est√° visible
        const resultadosPrevios = document.getElementById('resultadosPrevios');
        if (resultadosPrevios) {
            resultadosPrevios.style.display = 'none';
        }
        
        // Mostrar animaci√≥n de carga
        const rankingContenedor = rankingContainer.querySelector('.ranking-contenedor');
        rankingContenedor.innerHTML = `
            <div style="text-align: center; padding: 30px;">
                <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid rgba(56,103,214,0.3); border-radius: 50%; border-top-color: #3867d6; animation: spin 1s linear infinite;"></div>
                <p style="margin-top: 15px; color: #666;">Cargando ranking...</p>
            </div>
        `;
        
        // Obtener la URL del script de Google Apps Script
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';
        
        // Obtener el nombre y apellido del usuario actual para destacar su fila
        const nombreUsuario = localStorage.getItem('examUserNombre');
        const apellidoUsuario = localStorage.getItem('examUserApellido');
        
        // Hacer la solicitud para obtener los resultados
        fetch(scriptURL)
            .then(response => response.json())
            .then(data => {
                if (data && data.resultados && Array.isArray(data.resultados)) {
                    // Filtrar resultados para eliminar entradas con valores por defecto
                    let resultados = data.resultados.filter(resultado => {
                        // Eliminar entradas con "No disponible", "Nombre", "Apellido" o vac√≠as
                        return (
                            resultado.nombre !== "No disponible" && 
                            resultado.nombre !== "Nombre" && 
                            resultado.apellido !== "No disponible" && 
                            resultado.apellido !== "Apellido" &&
                            resultado.nombre.trim() !== "" &&
                            resultado.apellido.trim() !== ""
                        );
                    });
                    
                    // Ordenar los resultados de mayor a menor puntuaci√≥n
                    resultados = resultados.sort((a, b) => {
                        return parseFloat(b.puntuacion) - parseFloat(a.puntuacion);
                    });
                    
                    if (resultados.length === 0) {
                        // Si no hay resultados v√°lidos despu√©s del filtrado
                        rankingContenedor.innerHTML = `
                            <div style="text-align: center; padding: 30px; color: #666; animation: fadeIn 0.5s ease-out;">
                                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="1.5" style="margin-bottom: 15px;">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                <p style="font-size: 1.2em; margin-bottom: 10px;">No hay resultados disponibles</p>
                                <p style="color: #888;">S√© el primero en completar el examen.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Crear la tabla de ranking
                    let tablaHTML = `
                        <div class="ranking-table" style="border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.95em;">
                                <thead>
                                    <tr style="background: linear-gradient(90deg, #3867d6, #7f53ac); color: white; text-align: left;">
                                        <th style="padding: 12px 15px; font-weight: 600; width:40px;"></th>
                                        <th style="padding: 12px 15px; font-weight: 600;">Usuario</th>
                                        <th style="padding: 12px 15px; font-weight: 600; text-align:right;">Pts.</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    // Generar las filas de la tabla
                    resultados.forEach((resultado, index) => {
                        // Comprobar si es el usuario actual para destacar su fila
                        const esUsuarioActual = resultado.nombre === nombreUsuario && 
                                             resultado.apellido === apellidoUsuario;
                        
                        // A√±adir clases de medalla para los tres primeros
                        let posicionHTML = '';
                        if (index === 0) {
                            posicionHTML = '<span class="ranking-medal medal-gold">1</span>';
                        } else if (index === 1) {
                            posicionHTML = '<span class="ranking-medal medal-silver">2</span>';
                        } else if (index === 2) {
                            posicionHTML = '<span class="ranking-medal medal-bronze">3</span>';
                        } else {
                            posicionHTML = `<span style="display:inline-block;width:28px;text-align:center;font-weight:bold;">${index + 1}</span>`;
                        }
                        
                        tablaHTML += `
                            <tr ${esUsuarioActual ? 'class="highlight-row"' : ''} style="border-bottom: 1px solid #f0f0f0;">
                                <td style="text-align:center;padding:10px 10px;padding-right:0;width:40px;">${posicionHTML}</td>
                                <td style="padding:10px 15px;padding-left:5px;">${resultado.nombre} ${resultado.apellido}</td>
                                <td style="padding:10px 15px;text-align:right;font-weight:600;">${resultado.puntuacion}</td>
                            </tr>
                        `;
                    });
                    
                  tablaHTML += `
                                </tbody>
                            </table>
                        </div>
                        <!-- Flecha para cerrar el contenedor -->
                        <div style="text-align: center; margin-top: 20px;">
                            <button id="cerrarRankingFlecha" style="
                                width: 30px;
                                height: 30px;
                                bottom: -15px;
                                background: linear-gradient(145deg, #ffffff, #f0f0f0);
                                border-radius: 50%;
                                border: none;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                cursor: pointer;
                                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                                transition: all 0.3s ease;
                                margin: 0 auto;
                                z-index: 10;
                            ">
                                <span style="color: #666; font-size: 18px;">‚ñ≤</span>
                            </button>
                        </div>
                    `;
                    
                    
                    // Actualizar el contenido del ranking
                    rankingContenedor.innerHTML = tablaHTML;
                    
                    // Asegurar que los estilos de ranking est√©n incluidos
                    if (!document.getElementById('estilos-ranking')) {
                        const estilosRanking = document.createElement('style');
                        estilosRanking.id = 'estilos-ranking';
                        estilosRanking.textContent = `
                            .ranking-medal {
                                display: inline-block;
                                width: 28px;
                                height: 28px;
                                border-radius: 50%;
                                color: white;
                                text-align: center;
                                line-height: 28px;
                                font-weight: bold;
                                vertical-align: middle;
                            }
                            
                            .medal-gold {
                                background: linear-gradient(45deg, #FFD700, #FFA500);
                                box-shadow: 0 2px 6px rgba(255, 215, 0, 0.5);
                            }
                            
                            .medal-silver {
                                background: linear-gradient(45deg, #C0C0C0, #A9A9A9);
                                box-shadow: 0 2px 6px rgba(192, 192, 192, 0.5);
                            }
                            
                            .medal-bronze {
                                background: linear-gradient(45deg, #CD7F32, #8B4513);
                                box-shadow: 0 2px 6px rgba(205, 127, 50, 0.5);
                            }
                            
                            .highlight-row {
                                background: linear-gradient(to right, #fff2cc, #fce8b2);
                                font-weight: 600;
                                color: #2b2b2b;
                                position: relative;
                                border-top: 2px solid #f3d27a;
                                border-bottom: 2px solid #f3d27a;
                                z-index: 1;
                            }
                        `;
                        document.head.appendChild(estilosRanking);
                    }
                    
                    // Agregar evento de click a la flecha para cerrar el contenedor
                    setTimeout(() => {
                        const cerrarFlecha = document.getElementById('cerrarRankingFlecha');
                        if (cerrarFlecha) {
                            cerrarFlecha.addEventListener('click', function() {
                                rankingContainer.style.display = 'none';
                            });
                            
                            // A√±adir efectos hover
                            cerrarFlecha.addEventListener('mouseover', function() {
                                this.style.transform = 'translateX(-50%) translateY(-3px)';
                                this.style.boxShadow = '0 5px 12px rgba(0,0,0,0.3)';
                            });
                            
                            cerrarFlecha.addEventListener('mouseout', function() {
                                this.style.transform = 'translateX(-50%)';
                                this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                            });
                        }
                    }, 200);
                } else {
                    // Mostrar mensaje de error si no hay datos v√°lidos
                    rankingContenedor.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #e74c3c; animation: fadeIn 0.5s ease-out;">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="1.5" style="margin-bottom: 15px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            <p style="font-size: 1.2em; margin-bottom: 10px;">Error al cargar el ranking</p>
                            <p style="color: #888;">Por favor, int√©ntalo de nuevo m√°s tarde.</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error al cargar el ranking:', error);
                rankingContenedor.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #e74c3c; animation: fadeIn 0.5s ease-out;">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="1.5" style="margin-bottom: 15px;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        <p style="font-size: 1.2em; margin-bottom: 10px;">Error al cargar el ranking</p>
                        <p style="color: #888;">Por favor, int√©ntalo de nuevo m√°s tarde.</p>
                    </div>
                `;
            });
    };

    // Reinicializar el bot√≥n cuando se cambia a la secci√≥n ya-participaste
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'ya-participaste') {
            // Ocultar el contenedor de ranking al cambiar a esta secci√≥n
            const rankingContainer = document.getElementById('rankingContainer');
            if (rankingContainer) {
                rankingContainer.style.display = 'none';
            }
            
            // Reinicializar el bot√≥n de comparar resultados
            const compararResultadosBtn = document.getElementById('compararResultadosBtn');
            if (compararResultadosBtn) {
                compararResultadosBtn.replaceWith(compararResultadosBtn.cloneNode(true));
                const newBtn = document.getElementById('compararResultadosBtn');
                newBtn.addEventListener('click', function() {
                    playNextSound();
                    cargarRanking();
                });
            }
        }
    };
});

function verificarIdentificadorAntesDeComenzar(nombre, apellido, identificador) {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';
    const startExamBtn = document.getElementById('startExamBtn');
    if (startExamBtn) {
        startExamBtn.textContent = 'Cargando...';
        startExamBtn.disabled = true;
    }

    // Devolver la promesa de fetch para poder encadenarla
    return fetch(`${scriptURL}?identificador=${encodeURIComponent(identificador)}`)
        .then(response => response.json())
        .then(data => {
            if (data.existe && !data.puedeRepetir) {
                // Usuario ya particip√≥
                localStorage.setItem('activeSection', 'ya-participaste');
                
                // Mostrar secci√≥n ya-participaste directamente
                mostrarSeccionYaParticipaste();
                
                // Retornar un valor que indique que ya se manej√≥ la redirecci√≥n
                return { redireccionCompletada: true };
            } 
            
            // Usuario nuevo o puede repetir
            localStorage.setItem('activeSection', 'inicio');
            enviarIdentificadorAlServidor();
            
            // Actualizar mensaje de bienvenida
            const introContainer = document.querySelector('.intro-container p');
            if (introContainer) {
                introContainer.innerHTML = `Bienvenido <strong>${nombre} ${apellido}</strong> al examen interactivo que evaluar√° tus habilidades en espa√±ol A1.`;
            }
            
            // Redireccionar a inicio
            cambiarSeccion('inicio');
            
            // Retornar un valor que indique que se complet√≥ la redirecci√≥n normal
            return { redireccionCompletada: false };
        })
        .catch(error => {
            console.error('Error al verificar el identificador:', error);
            alert('Error al verificar el identificador. Intenta de nuevo.');
            cambiarSeccion('inicio');
            return { redireccionCompletada: false };
        })
        .finally(() => {
            if (startExamBtn) {
                startExamBtn.textContent = 'Comenzar Examen';
                startExamBtn.disabled = false;
            }
        });
}
document.addEventListener('DOMContentLoaded', function() {
    // Asignar funcionalidad al bot√≥n de ver resultados
    const verResultadosBtn = document.getElementById('verResultadosBtn');
    if (verResultadosBtn) {
        verResultadosBtn.addEventListener('click', function() {
          // Reproducir sonido
            const identificador = localStorage.getItem('identificadorUnico');
            if (identificador) {
                buscarResultadosUsuario(identificador);
            } else {
                alert('No se pudo identificar al usuario. Por favor, inicia sesi√≥n nuevamente.');
            }
        });
    }
    
    // Inicializar el bot√≥n cuando se cambia a esta secci√≥n (c√≥digo existente)
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'ya-participaste') {
            // Reinicializar los botones
            const cerrarSesionBtn = document.getElementById('cerrarSesionBtnYaParticipaste');
            if (cerrarSesionBtn) {
                cerrarSesionBtn.replaceWith(cerrarSesionBtn.cloneNode(true));
                const newBtn = document.getElementById('cerrarSesionBtnYaParticipaste');
                newBtn.addEventListener('click', function() {
                   
                    const logoutModal = document.getElementById('logoutModal');
                    if (logoutModal) {
                        logoutModal.classList.add('active');
                    }
                });
            }
            
            // Inicializar el bot√≥n de ver resultados
            const verResultadosBtn = document.getElementById('verResultadosBtn');
            if (verResultadosBtn) {
                verResultadosBtn.replaceWith(verResultadosBtn.cloneNode(true));
                const newBtn = document.getElementById('verResultadosBtn');
                newBtn.addEventListener('click', function() {
                    playNextSound();
                    const identificador = localStorage.getItem('identificadorUnico');
                    if (identificador) {
                        buscarResultadosUsuario(identificador);
                    } else {
                        alert('No se pudo identificar al usuario. Por favor, inicia sesi√≥n nuevamente.');
                    }
                });
            }
            
            // Ocultar el contenedor de resultados al cambiar a esta secci√≥n
            const resultadosDiv = document.getElementById('resultadosPrevios');
            if (resultadosDiv) {
                resultadosDiv.style.display = 'none';
            }
        }
    };
});
function buscarResultadosUsuario(identificador) {
    // Mostrar el contenedor de resultados y mensaje de carga
    const resultadosDiv = document.getElementById('resultadosPrevios');
    resultadosDiv.style.display = 'block';
    
    // A√±adir animaci√≥n de carga
    const contenedorResultados = resultadosDiv.querySelector('.resultados-contenedor');
    contenedorResultados.innerHTML = `
        <div style="text-align: center; padding: 30px;">
            <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid rgba(56,103,214,0.3); border-radius: 50%; border-top-color: #3867d6; animation: spin 1s linear infinite;"></div>
            <p style="margin-top: 15px; color: #666;">Cargando tus resultados...</p>
        </div>
    `;
    
    // Obtener la URL del script de Google Apps Script
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';
    
    // Hacer la solicitud para obtener los datos del usuario espec√≠fico
    fetch(`${scriptURL}?identificador=${encodeURIComponent(identificador)}&buscar=true`)
        .then(response => {
            // Verificar si la respuesta es correcta
            if (!response.ok) {
                throw new Error('Error en la respuesta del servidor: ' + response.status);
            }
            
            // Intentar procesar como JSON, pero manejar el caso de respuesta no-JSON
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                return response.json();
            } else {
                // Si no es JSON, intentar obtener el texto y parsear manualmente
                return response.text().then(text => {
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.error('Error al parsear respuesta:', text);
                        throw new Error('Formato de respuesta no v√°lido');
                    }
                });
            }
        })
        .then(data => {
            console.log('Datos recibidos del servidor:', data);
            
            if (data && data.resultados && data.resultados.length > 0) {
                const resultado = data.resultados[0]; // Tomamos el primer resultado que coincida
                console.log('Resultado encontrado:', resultado);
                
                // Asegurar que todos los valores sean correctos, usando valores por defecto si no existen
                const puntuacion = resultado.puntuacion || '0';
                const clectura = resultado.clectura || '0';
                const gramatica = resultado.gramatica || '0';
                const lexico = resultado.lexico || '0';
                const auditiva = resultado.auditiva || '0';
                const comunicacion = resultado.comunicacion || '0';
                const escrita = resultado.escrita || '0';
                const fecha = resultado.fecha || 'No disponible';
                const duracion = resultado.duracion || 'No disponible';
                const horaInicio = resultado.horaInicio || 'No disponible';
                const horaFin = resultado.horaFin || 'No disponible';
                
                // Calcular los porcentajes para los gr√°ficos circulares
                const clecturaPct = Math.max(0, Math.min(100, (parseFloat(clectura) / 6 * 100)));
                const gramaticaPct = Math.max(0, Math.min(100, (parseFloat(gramatica) / 7 * 100)));
                const lexicoPct = Math.max(0, Math.min(100, (parseFloat(lexico) / 7 * 100)));
                const auditivaPct = Math.max(0, Math.min(100, (parseFloat(auditiva) / 7 * 100)));
                const comunicacionPct = Math.max(0, Math.min(100, (parseFloat(comunicacion) / 6 * 100)));
                const escritaPct = Math.max(0, Math.min(100, (parseFloat(escrita) / 7 * 100)));
                
                // Crear el HTML con los resultados animados
                contenedorResultados.innerHTML = `
                    <div style="position: relative;">
                        <div class="score" style="background: linear-gradient(135deg, #3867d6, #7f53ac); color: white; padding: 15px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(56,103,214,0.2); font-weight: 600; letter-spacing: 1.5px; margin: 20px auto; max-width: 200px; text-align: center; animation: scoreAppear 1.2s cubic-bezier(0.165, 0.84, 0.44, 1);">
                            <span style="display:block;font-size:2.5rem;font-weight:700;line-height:1.1;">
                                ${puntuacion}
                            </span>
                            <span style="display:block;font-size:1.2rem;font-weight:400;line-height:1.1;">
                                /40
                            </span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <!-- Comprensi√≥n Lectora -->
                            <div class="result-item" style="background: linear-gradient(145deg, #ffffff, #f0f0f0); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 5px 5px 15px rgba(0,0,0,0.05), -5px -5px 15px rgba(255,255,255,0.6); transition: all 0.3s ease; animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.1s; opacity: 0; transform: translateY(20px);">
                                <div style="position: relative; width: 70px; height: 70px; margin: 0 auto 15px;">
                                    <svg width="70" height="70" viewBox="0 0 36 36">
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e6e6e6" stroke-width="3"></circle>
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#3867d6" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="${100 - clecturaPct}" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease; animation: progressCircle 1.5s ease-out forwards;"></circle>
                                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="10" font-weight="bold" fill="#333">${clectura}/6</text>
                                    </svg>
                                </div>
                                <h4 style="margin: 0; color: #444; font-size: 1rem;">C. Lectora</h4>
                            </div>
                            
                            <!-- Gram√°tica -->
                            <div class="result-item" style="background: linear-gradient(145deg, #ffffff, #f0f0f0); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 5px 5px 15px rgba(0,0,0,0.05), -5px -5px 15px rgba(255,255,255,0.6); transition: all 0.3s ease; animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.2s; opacity: 0; transform: translateY(20px);">
                                <div style="position: relative; width: 70px; height: 70px; margin: 0 auto 15px;">
                                    <svg width="70" height="70" viewBox="0 0 36 36">
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e6e6e6" stroke-width="3"></circle>
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#7f53ac" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="${100 - gramaticaPct}" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease; animation: progressCircle 1.5s ease-out forwards;"></circle>
                                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="10" font-weight="bold" fill="#333">${gramatica}/7</text>
                                    </svg>
                                </div>
                                <h4 style="margin: 0; color: #444; font-size: 1rem;">Gram√°tica</h4>
                            </div>
                            
                            <!-- L√©xico -->
                            <div class="result-item" style="background: linear-gradient(145deg, #ffffff, #f0f0f0); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 5px 5px 15px rgba(0,0,0,0.05), -5px -5px 15px rgba(255,255,255,0.6); transition: all 0.3s ease; animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.3s; opacity: 0; transform: translateY(20px);">
                                <div style="position: relative; width: 70px; height: 70px; margin: 0 auto 15px;">
                                    <svg width="70" height="70" viewBox="0 0 36 36">
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e6e6e6" stroke-width="3"></circle>
                                       <circle cx="18" cy="18" r="16" fill="none" stroke="#f9a825" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="${100 - lexicoPct}" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease; animation: progressCircle 1.5s ease-out forwards;"></circle>
                                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="10" font-weight="bold" fill="#333">${lexico}/7</text>
                                    </svg>
                                </div>
                                <h4 style="margin: 0; color: #444; font-size: 1rem;">L√©xico</h4>
                            </div>
                            
                            <!-- Comprensi√≥n Auditiva -->
                            <div class="result-item" style="background: linear-gradient(145deg, #ffffff, #f0f0f0); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 5px 5px 15px rgba(0,0,0,0.05), -5px -5px 15px rgba(255,255,255,0.6); transition: all 0.3s ease; animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.4s; opacity: 0; transform: translateY(20px);">
                                <div style="position: relative; width: 70px; height: 70px; margin: 0 auto 15px;">
                                    <svg width="70" height="70" viewBox="0 0 36 36">
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e6e6e6" stroke-width="3"></circle>
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e3647d" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="${100 - auditivaPct}" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease; animation: progressCircle 1.5s ease-out forwards;"></circle>
                                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="10" font-weight="bold" fill="#333">${auditiva}/7</text>
                                    </svg>
                                </div>
                                <h4 style="margin: 0; color: #444; font-size: 1rem;">C. Auditiva</h4>
                            </div>
                            
                            <!-- Comunicaci√≥n -->
                            <div class="result-item" style="background: linear-gradient(145deg, #ffffff, #f0f0f0); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 5px 5px 15px rgba(0,0,0,0.05), -5px -5px 15px rgba(255,255,255,0.6); transition: all 0.3s ease; animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.5s; opacity: 0; transform: translateY(20px);">
                                <div style="position: relative; width: 70px; height: 70px; margin: 0 auto 15px;">
                                    <svg width="70" height="70" viewBox="0 0 36 36">
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e6e6e6" stroke-width="3"></circle>
                                         <circle cx="18" cy="18" r="16" fill="none" stroke="#2d3436" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="${100 - comunicacionPct}" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease; animation: progressCircle 1.5s ease-out forwards;"></circle>
                                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="10" font-weight="bold" fill="#333">${comunicacion}/6</text>
                                    </svg>
                                </div>
                                <h4 style="margin: 0; color: #444; font-size: 1rem;">Comunicaci√≥n</h4>
                            </div>
                            
                            <!-- Producci√≥n Escrita -->
                            <div class="result-item" style="background: linear-gradient(145deg, #ffffff, #f0f0f0); border-radius: 15px; padding: 20px; text-align: center; box-shadow: 5px 5px 15px rgba(0,0,0,0.05), -5px -5px 15px rgba(255,255,255,0.6); transition: all 0.3s ease; animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.6s; opacity: 0; transform: translateY(20px);">
                                <div style="position: relative; width: 70px; height: 70px; margin: 0 auto 15px;">
                                    <svg width="70" height="70" viewBox="0 0 36 36">
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#e6e6e6" stroke-width="3"></circle>
                                        <circle cx="18" cy="18" r="16" fill="none" stroke="#4CAF50" stroke-width="3" stroke-dasharray="100" stroke-dashoffset="${100 - escritaPct}" style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease; animation: progressCircle 1.5s ease-out forwards;"></circle>
                                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="10" font-weight="bold" fill="#333">${escrita}/7</text>
                                    </svg>
                                </div>
                                <h4 style="margin: 0; color: #444; font-size: 1rem;">P. Escrita</h4>
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(145deg, #f8f9fa, #eaeaea); padding: 20px; border-radius: 15px; margin-top: 20px; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1); animation: fadeIn 0.5s ease-out forwards; animation-delay: 0.7s; opacity: 0;">
                            <h4 style="margin-top: 0; color: #3867d6; border-bottom: 1px solid rgba(56, 103, 214, 0.2); padding-bottom: 8px; margin-bottom: 12px;">Detalles del examen</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <p style="margin: 8px 0;"><strong style="color: #555;">üìÖ Fecha:</strong> <span style="color: #666;">${fecha}</span></p>
                                <p style="margin: 8px 0;"><strong style="color: #555;">‚è±Ô∏è Duraci√≥n:</strong> <span style="color: #666;">${duracion}</span></p>
                                <p style="margin: 8px 0;"><strong style="color: #555;">üïí Inicio:</strong> <span style="color: #666;">${horaInicio}</span></p>
                                <p style="margin: 8px 0;"><strong style="color: #555;">üèÅ Fin:</strong> <span style="color: #666;">${horaFin}</span></p>
                            </div>
                        </div>

                        <!-- Flecha para cerrar el contenedor -->
                        <div id="cerrarResultadosFlecha" style="
                            position: absolute;
                            bottom: -15px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 30px;
                            height: 30px;
                            background: linear-gradient(145deg, #ffffff, #f0f0f0);
                            border-radius: 50%;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            cursor: pointer;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                            transition: all 0.3s ease;
                            z-index: 10;
                        ">
                            <span style="color: #666; font-size: 18px;">‚ñ≤</span>
                        </div>
                    </div>
                `;
                
                // A√±adir estilos para las animaciones si no existen
                if (!document.getElementById('resultados-estilos-animados')) {
                    const estilosAnimados = document.createElement('style');
                    estilosAnimados.id = 'resultados-estilos-animados';
                    estilosAnimados.textContent = `
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(20px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        
                        @keyframes progressCircle {
                            from { stroke-dashoffset: 100; }
                            to { stroke-dashoffset: var(--final-offset, 0); }
                        }
                        
                        @keyframes scoreAppear {
                            0% { opacity: 0; transform: scale(0.7); }
                            70% { opacity: 1; transform: scale(1.1); }
                            100% { transform: scale(1); }
                        }
                        
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        
                        .result-item:hover {
                            transform: translateY(-5px);
                            box-shadow: 7px 7px 20px rgba(0,0,0,0.1), -7px -7px 20px rgba(255,255,255,0.9);
                        }
                    `;
                    document.head.appendChild(estilosAnimados);
                }
                
                // Configurar los valores finales de stroke-dashoffset para cada c√≠rculo
                setTimeout(() => {
                    const circles = document.querySelectorAll('#resultadosPrevios circle:nth-child(2)');
                    circles.forEach(circle => {
                        const offset = circle.getAttribute('stroke-dashoffset');
                        circle.style.setProperty('--final-offset', offset);
                    });
                }, 100);
                
                // Agregar evento de click a la flecha para cerrar el contenedor
                setTimeout(() => {
                    const cerrarFlecha = document.getElementById('cerrarResultadosFlecha');
                    if (cerrarFlecha) {
                        cerrarFlecha.addEventListener('click', function() {
                            resultadosDiv.style.display = 'none';
                        });
                        
                        // A√±adir efectos hover
                        cerrarFlecha.addEventListener('mouseover', function() {
                            this.style.transform = 'translateX(-50%) translateY(-3px)';
                            this.style.boxShadow = '0 5px 12px rgba(0,0,0,0.3)';
                        });
                        
                        cerrarFlecha.addEventListener('mouseout', function() {
                            this.style.transform = 'translateX(-50%)';
                            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                        });
                    }
                }, 200);
                
            } else {
                // Si no hay resultados, mostrar un mensaje
                contenedorResultados.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #666; animation: fadeIn 0.5s ease-out;">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="1.5" style="margin-bottom: 15px;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <p style="font-size: 1.2em; margin-bottom: 10px;">No se encontraron resultados</p>
                        <p style="color: #888;">Si crees que es un error, contacta con tu profesor.</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error al buscar resultados:', error);
            contenedorResultados.innerHTML = `
                <div style="text-align: center; padding: 30px; color: #e74c3c; animation: fadeIn 0.5s ease-out;">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="1.5" style="margin-bottom: 15px;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                    <p style="font-size: 1.2em; margin-bottom: 10px;">Error al cargar los resultados</p>
                    <p style="color: #888;">Por favor, int√©ntalo de nuevo m√°s tarde.</p>
                </div>
            `;
        });
}

// Modificar la funci√≥n para que al cerrar sesi√≥n, se elimine tambi√©n el estado de los resultados
document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n para limpiar todos los datos al cerrar sesi√≥n
 function limpiarDatosAlCerrarSesion() {
    // Limpiar localStorage pero MANTENER los √∫ltimos datos de usuario
    // NO borrar lastExamUserNombre y lastExamUserApellido
    
    localStorage.removeItem('examTimerRemaining');
    localStorage.removeItem('examUserNombre');
    localStorage.removeItem('examUserApellido');
    localStorage.removeItem('examStartTime');
    localStorage.removeItem('examEndTime');
    localStorage.removeItem('activeSection');
    localStorage.removeItem('examStartTimestamp');
    localStorage.removeItem('examDurationSeconds');
    localStorage.removeItem('identificadorUnico');
    localStorage.removeItem('ultimaVisualizacionResultados');
    
    // Ocultar resultados previos
    const resultadosDiv = document.getElementById('resultadosPrevios');
    if (resultadosDiv) {
        resultadosDiv.style.display = 'none';
        
        // Limpiar contenido
        const contenedorResultados = resultadosDiv.querySelector('.resultados-contenedor');
        if (contenedorResultados) {
            contenedorResultados.innerHTML = '';
        }
    }
}
    
    // Asignar la funci√≥n a todos los botones de cerrar sesi√≥n
    const botonesCierreSesion = [
        'confirmarLogoutBtn',
        'cerrarSesionBtn',
        'cerrarSesionBtnResultados',
        'cerrarSesionBtnYaParticipaste'
    ];
    
    botonesCierreSesion.forEach(id => {
        const boton = document.getElementById(id);
        if (boton) {
            // A√±adir la limpieza de datos al evento de click
            boton.addEventListener('click', limpiarDatosAlCerrarSesion);
        }
    });
    
    // Modificar la funci√≥n cambiarSeccion para ocultar los resultados al cambiar a ya-participaste
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'ya-participaste') {
            // Asegurar que el contenedor de resultados est√© oculto cada vez que se cambia a esta secci√≥n
            const resultadosDiv = document.getElementById('resultadosPrevios');
            if (resultadosDiv) {
                resultadosDiv.style.display = 'none';
            }
            
            // Reinicializar los botones
            const cerrarSesionBtn = document.getElementById('cerrarSesionBtnYaParticipaste');
            if (cerrarSesionBtn) {
                cerrarSesionBtn.replaceWith(cerrarSesionBtn.cloneNode(true));
                const newBtn = document.getElementById('cerrarSesionBtnYaParticipaste');
                newBtn.addEventListener('click', function() {
                    playNextSound();
                    const logoutModal = document.getElementById('logoutModal');
                    if (logoutModal) {
                        logoutModal.classList.add('active');
                    }
                });
                // A√±adir el evento de limpieza al nuevo bot√≥n
                newBtn.addEventListener('click', limpiarDatosAlCerrarSesion);
            }
            
            // Reinicializar el bot√≥n de ver resultados
            const verResultadosBtn = document.getElementById('verResultadosBtn');
            if (verResultadosBtn) {
                verResultadosBtn.replaceWith(verResultadosBtn.cloneNode(true));
                const newBtn = document.getElementById('verResultadosBtn');
                newBtn.addEventListener('click', function() {
                    playNextSound();
                    const identificador = localStorage.getItem('identificadorUnico');
                    if (identificador) {
                        buscarResultadosUsuario(identificador);
                    } else {
                        alert('No se pudo identificar al usuario. Por favor, inicia sesi√≥n nuevamente.');
                    }
                });
            }
        }
    };
});

document.addEventListener('DOMContentLoaded', function() {
    // Funci√≥n para aplicar estilos a los botones de la secci√≥n de resultados
    function aplicarEstilosModernos() {
        // Buscar los botones en la secci√≥n de resultados
        const resultadosBtn = document.querySelector('#resultados .btn');
        const cerrarSesionBtnResultados = document.getElementById('cerrarSesionBtnResultados');
        
        if (resultadosBtn) {
            resultadosBtn.className = 'btn btn-estilo-moderno';
            resultadosBtn.style = 'display: inline-block; padding: 10px 30px; font-size: 1.1em; font-weight: 600; text-align: center; border-radius: 30px; border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden; margin-top: 15px; max-width: 230px; background: linear-gradient(90deg, #7f53ac, #9d50bb); color: white;';
            
            // Agregar efecto hover mediante eventos
            resultadosBtn.addEventListener('mouseover', function() {
                this.style.transform = 'translateY(-3px) scale(1.02)';
                this.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.15)';
            });
            
            resultadosBtn.addEventListener('mouseout', function() {
                this.style.transform = '';
                this.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
            });
            
            resultadosBtn.addEventListener('mousedown', function() {
                this.style.transform = 'translateY(1px)';
                this.style.boxShadow = '0 3px 10px rgba(0, 0, 0, 0.1)';
            });
        }
        
        if (cerrarSesionBtnResultados) {
            cerrarSesionBtnResultados.className = 'btn btn-estilo-moderno';
            cerrarSesionBtnResultados.style = 'display: inline-block; padding: 10px 12px; font-size: 1.1em; font-weight: 600; text-align: center; border-radius: 30px; border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden; margin-top: 15px; max-width: 230px; background: linear-gradient(90deg, #e74c3c, #c0392b); color: white;';
            
            // Agregar efecto hover mediante eventos
            cerrarSesionBtnResultados.addEventListener('mouseover', function() {
                this.style.transform = 'translateY(-3px) scale(1.02)';
                this.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.15)';
            });
            
            cerrarSesionBtnResultados.addEventListener('mouseout', function() {
                this.style.transform = '';
                this.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
            });
            
            cerrarSesionBtnResultados.addEventListener('mousedown', function() {
                this.style.transform = 'translateY(1px)';
                this.style.boxShadow = '0 3px 10px rgba(0, 0, 0, 0.1)';
            });
        }
        
        // Tambi√©n podemos agregar un estilo global para el efecto de ondas al hacer clic
        document.head.insertAdjacentHTML('beforeend', `
        <style>
            .btn-estilo-moderno::after {
                content: '';
                display: block;
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                pointer-events: none;
                background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
                background-repeat: no-repeat;
                background-position: 50%;
                transform: scale(10, 10);
                opacity: 0;
                transition: transform 0.5s, opacity 0.8s;
            }
            
            .btn-estilo-moderno:active::after {
                transform: scale(0, 0);
                opacity: 0.3;
                transition: 0s;
            }
        </style>
        `);
    }
    
    // Llamar a la funci√≥n cuando se cambie a la secci√≥n de resultados
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'resultados') {
            // Dar tiempo a que se cargue el DOM
            setTimeout(aplicarEstilosModernos, 100);
        }
    };
    
    // Tambi√©n ejecutar al cargar la p√°gina
    setTimeout(aplicarEstilosModernos, 200);
});

document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const nombreInput = document.getElementById('nombre');
    const apellidoInput = document.getElementById('apellido');
    const nombreError = document.getElementById('nombre-error');
    const apellidoError = document.getElementById('apellido-error');
    const startExamBtn = document.getElementById('startExamBtn');
    
    // A√±adir clase de pulsaci√≥n al bot√≥n despu√©s de cargar la p√°gina
    setTimeout(() => {
        startExamBtn.classList.add('pulsate');
    }, 2000);
    
    // Comprobar si hay informaci√≥n guardada de inicios de sesi√≥n previos
    const savedNombre = localStorage.getItem('lastExamUserNombre');
    const savedApellido = localStorage.getItem('lastExamUserApellido');
    
    // Rellenar el formulario con los datos previos si existen
    if (savedNombre) {
        nombreInput.value = savedNombre;
    }
    
    if (savedApellido) {
        apellidoInput.value = savedApellido;
    }
    
    // Modifica la funci√≥n de env√≠o del formulario de login

    

    
    // Validaci√≥n en tiempo real
    nombreInput.addEventListener('input', function() {
        if (this.value.trim()) {
            nombreError.style.display = 'none';
        }
    });
    
    apellidoInput.addEventListener('input', function() {
        if (this.value.trim()) {
            apellidoError.style.display = 'none';
        }
    });
});
document.addEventListener('DOMContentLoaded', function() {
const originalCambiarSeccion = window.cambiarSeccion;
window.cambiarSeccion = function(seccionId) {
    originalCambiarSeccion(seccionId);

    if (seccionId === 'login') {
        setTimeout(() => {
            const nombreInput = document.getElementById('nombre');
            const apellidoInput = document.getElementById('apellido');
            const savedNombre = localStorage.getItem('lastExamUserNombre') || '';
            const savedApellido = localStorage.getItem('lastExamUserApellido') || '';
            if (nombreInput) nombreInput.value = savedNombre;
            if (apellidoInput) apellidoInput.value = savedApellido;
        }, 100);
    }
};
});

// Agregar flecha animada al pie de la tabla de ranking cuando se hace scroll
document.addEventListener('DOMContentLoaded', function() {
    // Crear el estilo para la flecha animada
// Crear el estilo para la flecha animada
// Crear el estilo para la flecha animada
const arrowStyles = document.createElement('style');
arrowStyles.textContent = `
    .scroll-arrow {
        position: absolute;
        bottom: -15px; /* Cambiado de 10px a -15px para bajar la posici√≥n */
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-top: 20px solid rgba(56, 103, 214, 0.9); /* M√°s opaco para mejor visibilidad */
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 2));
        opacity: 0;
    
        animation: arrowBounce 1.5s infinite;
        pointer-events: none;
        z-index: 100;
    }
    
    @keyframes arrowBounce {
        0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
        40% { transform: translateX(-50%) translateY(-15px); } /* Animaci√≥n m√°s pronunciada */
        60% { transform: translateX(-50%) translateY(-8px); }
    }
    
    .scroll-arrow.visible {
        opacity: 1;
    }
`;
document.head.appendChild(arrowStyles);

// Funci√≥n para manejar la visualizaci√≥n de la flecha seg√∫n el scroll
function setupScrollArrow() {
    // Si estamos en la secci√≥n de ranking
    if (document.getElementById('ranking').classList.contains('active')) {
        const rankingTable = document.querySelector('#ranking .ranking-table');
        const rankingBody = document.getElementById('rankingBody');
        
        if (rankingTable && rankingBody) {
            // Crear la flecha si no existe
            let scrollArrow = document.querySelector('.scroll-arrow');
            if (!scrollArrow) {
                scrollArrow = document.createElement('div');
                scrollArrow.className = 'scroll-arrow';
                
                // A√±adir la flecha al contenedor de la tabla
                rankingTable.appendChild(scrollArrow);
                
                // Asegurar que el rankingTable tenga posici√≥n relativa
                rankingTable.style.position = 'relative';
            }
            
            // Posicionar la flecha en una posici√≥n fija al pie del div
            scrollArrow.style.position = 'fixed';
            
            // Calcular la posici√≥n espec√≠fica basada en el contenedor
            const tableRect = rankingTable.getBoundingClientRect();
            const arrowBottom = tableRect.bottom - 50; // 50px desde el fondo del contenedor
            
            scrollArrow.style.bottom = `${window.innerHeight - arrowBottom}px`;
            scrollArrow.style.left = `${tableRect.left + tableRect.width / 2}px`;
            scrollArrow.style.transform = 'translateX(-50%)';
            
            // Funci√≥n para mostrar/ocultar la flecha seg√∫n el scroll
            function checkScroll() {
                const isScrollable = rankingTable.scrollHeight > rankingTable.clientHeight;
                const hasScrolledToBottom = Math.abs((rankingTable.scrollHeight - rankingTable.scrollTop) - rankingTable.clientHeight) < 10;
                
                // Recalcular la posici√≥n en caso de que haya cambiado
                const tableRect = rankingTable.getBoundingClientRect();
                const arrowBottom = tableRect.bottom - 2;
                
                scrollArrow.style.bottom = `${window.innerHeight - arrowBottom}px`;
                scrollArrow.style.left = `${tableRect.left + tableRect.width / 2}px`;
                
                // Mostrar la flecha si hay contenido para scrollear y no estamos al final
                if (isScrollable && !hasScrolledToBottom) {
                    scrollArrow.classList.add('visible');
                } else {
                    scrollArrow.classList.remove('visible');
                }
            }
            
            // Verificar inicialmente
            checkScroll();
            
            // Escuchar eventos de scroll en la tabla y en la ventana
            rankingTable.addEventListener('scroll', checkScroll);
            window.addEventListener('resize', checkScroll);
            document.addEventListener('scroll', checkScroll);
            
            // Verificar peri√≥dicamente para mantener la posici√≥n actualizada
            const intervalCheck = setInterval(() => {
                if (document.getElementById('ranking').classList.contains('active')) {
                    checkScroll();
                } else {
                    clearInterval(intervalCheck);
                    window.removeEventListener('resize', checkScroll);
                    document.removeEventListener('scroll', checkScroll);
                }
            }, 200);
        }
    }
}
    
    // Llamar a la funci√≥n cuando se cambie a la secci√≥n de ranking
    const originalCambiarSeccion = window.cambiarSeccion;
    window.cambiarSeccion = function(seccionId) {
        originalCambiarSeccion(seccionId);
        
        if (seccionId === 'ranking') {
            // Dar tiempo para que se cargue la tabla
            setTimeout(setupScrollArrow, 500);
        }
    };
    
    // Comprobar al cargar la p√°gina
    setTimeout(setupScrollArrow, 1000);
    
    // Tambi√©n activar cada vez que se cargue el ranking
    const cargarRankingOriginal = window.cargarRanking;
    if (cargarRankingOriginal) {
        window.cargarRanking = function() {
            cargarRankingOriginal.apply(this, arguments);
            setTimeout(setupScrollArrow, 1000);
        };
    }
});

function cargarRankingYaParticipaste() {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyi_nLJ1kGCilsk88ne86TeZHJ46FPGVhI2KXI64I4mGbyJDog9XNGcP83Wtzz0xuve1A/exec';
    fetch(scriptURL)
        .then(response => response.json())
        .then(data => {
            const rankingBody = document.getElementById('rankingBodyYaParticipaste');
            rankingBody.innerHTML = '';
            if (data && data.resultados && Array.isArray(data.resultados)) {
                let resultados = data.resultados.filter(r =>
                    r.nombre && r.apellido && r.nombre !== "Nombre" && r.apellido !== "Apellido"
                );
                resultados = resultados.sort((a, b) => parseFloat(b.puntuacion) - parseFloat(a.puntuacion));
                // Obtener usuario logueado
                const nombreUsuario = localStorage.getItem('examUserNombre');
                const apellidoUsuario = localStorage.getItem('examUserApellido');
                resultados.forEach((r, i) => {
                    const fila = document.createElement('tr');
                    let pos = i + 1;
                    let posHTML = '';
                    if (pos === 1) posHTML = '<span class="ranking-medal medal-gold">1</span>';
                    else if (pos === 2) posHTML = '<span class="ranking-medal medal-silver">2</span>';
                    else if (pos === 3) posHTML = '<span class="ranking-medal medal-bronze">3</span>';
                    else posHTML = `<span class="ranking-pos-num">${pos}</span>`;
                    fila.innerHTML = `
                        <td style="text-align:center;">${posHTML}</td>
                        <td>${r.nombre} ${r.apellido}</td>
                        <td style="text-align:right;">${r.puntuacion}</td>
                    `;
                    // Aplica la sombra dorada si es el usuario logueado
                    if (
                        r.nombre.trim().toLowerCase() === (nombreUsuario || '').trim().toLowerCase() &&
                        r.apellido.trim().toLowerCase() === (apellidoUsuario || '').trim().toLowerCase()
                    ) {
                        fila.classList.add('highlight-row');
                    }
                    rankingBody.appendChild(fila);
                });
            }
            setupScrollArrowYaParticipaste();
        });
}
function setupScrollArrowYaParticipaste() {
    const rankingTable = document.querySelector('#rankingContainer .ranking-table');
    if (!rankingTable) return;
    let scrollArrow = rankingTable.querySelector('.scroll-arrow');
    if (!scrollArrow) {
        scrollArrow = document.createElement('div');
        scrollArrow.className = 'scroll-arrow';
        rankingTable.appendChild(scrollArrow);
    }

    // Usa position: fixed para la flecha
    scrollArrow.style.position = 'fixed';

    function checkScroll() {
        const isScrollable = rankingTable.scrollHeight > rankingTable.clientHeight;
        const hasScrolledToBottom = Math.abs((rankingTable.scrollHeight - rankingTable.scrollTop) - rankingTable.clientHeight) < 10;

        // Calcula la posici√≥n igual que en el ranking principal
        const tableRect = rankingTable.getBoundingClientRect();
        const arrowBottom = tableRect.bottom - 1; // Ajusta el 50 si quieres subir/bajar la flecha
        scrollArrow.style.bottom = `${window.innerHeight - arrowBottom}px`;
        scrollArrow.style.left = `${tableRect.left + tableRect.width / 2}px`;
        scrollArrow.style.transform = 'translateX(-50%)';

        if (isScrollable && !hasScrolledToBottom) {
            scrollArrow.classList.add('visible');
        } else {
            scrollArrow.classList.remove('visible');
        }
    }

    rankingTable.addEventListener('scroll', checkScroll);
    window.addEventListener('resize', checkScroll);
    document.addEventListener('scroll', checkScroll);
    checkScroll();
}
document.getElementById('compararResultadosBtn').addEventListener('click', function() {
    playNextSound();
    cargarRankingYaParticipaste();
    document.getElementById('rankingContainer').style.display = 'block';
});

    </script>
    
</body>
</html>                                                                                         
