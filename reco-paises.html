<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Países del mundo</title>
    <style>
        /* Estilos de la barra superior */
        .top-status-bar {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto 5px auto;
            gap: 2px;
            position: relative;
            z-index: 10;
        }

        .pill {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 1.0em;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            background: #fff;
            min-width: 60px;
            justify-content: center;
            letter-spacing: 0.3px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .back-arrow {
            background: #fff;
            color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            gap: 8px;
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-arrow:hover {
            background-color: #f5f5f5;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .back-arrow i {
            color: #333;
        }        .pill-faltan {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(255,107,53,0.15);
            gap: 8px;
            border: none;
        }

        .pill-correctas {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(40, 167, 69, 0.15);
            gap: 8px;
            border: none;
        }

        .pill-incorrectas {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(220, 53, 69, 0.15);
            gap: 8px;
            border: none;
        }

        .pill-progreso {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(78,205,196,0.15);
            font-weight: 600;
            font-size: 1.0em;
            min-width: 60px;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
        }

        .pill-progreso:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(78,205,196,0.2);
        }

        /* Estilos básicos */
        body, html {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #505255, #00020a);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        #flashcard-container-wrapper {
            position: relative;
            width: calc(100% - 20px);
            max-width: 600px;
        }
        #flashcard-container {
            width: 100%;
            height: 500px;
            max-height: 500px;
            perspective: 1000px; /* Para el efecto 3D */
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
            background: linear-gradient(to right, #1f3658, #3558e3);
            border: 3px solid #aab0b4;
            margin: 0;
        }
        .flashcard, .results-card {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0.2, 0.2, 1);
            border-radius: 15px;
            cursor: pointer;
            display: none;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .flashcard.is-visible { display: flex; }
        
        /* Parte frontal y trasera de la tarjeta */
        .front, .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Oculta la cara trasera al girar */
            border-radius: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
    
        .card-back {
            transform: rotateY(180deg); /* Gira la parte trasera */
        }
    
        /* Estilo de la parte frontal */
        .front img, .back img { width: 100%; height: 100%; }
    
        /* Estilo de la parte trasera */
        .back {
    width: 100%;
    background: linear-gradient(to bottom, rgba(73, 115, 189, 0.95), rgba(14, 40, 92, 0.9)); /* Fondo azul oscuro */
    color: #ffffff; /* Color del texto */
    transform: rotateY(180deg); /* Rotación para el efecto */
    padding: 20px; /* Margen interno */
    text-align: center; /* Centrado horizontal */
    font-size: 3rem; /* Tamaño del texto */
    font-family: 'Playfair Display', serif; /* Fuente elegante */
    border-radius: 10px; /* Bordes redondeados */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Sombra más pronunciada */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); /* Sombra del texto más fuerte */
    display: flex; /* Flexbox para el centrado */
    justify-content: center; /* Centrar horizontalmente */
    align-items: center; /* Centrar verticalmente */
    flex-direction: column; /* Asegura que el texto fluya en columnas */
    height: 100%; /* Usa toda la altura disponible */
    max-width: 100%; /* Limita el ancho máximo */
    margin: 0 auto; /* Centra dentro del contenedor */
    line-height: 1.4; /* Espaciado entre líneas */
}

        /* Ocultar texto cuando está en modo escucha */
        .back.hidden-text {
            color: transparent;
            text-shadow: none;
        }

        /* Indicador de escucha de voz */
        .listening-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 1.5rem;
            text-align: center;
            animation: pulse 1s infinite;
            z-index: 10;
        }

        @keyframes pulse {
            0% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
        }

        /* Contador moderno y elegante */
        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 25px;
        }

        .countdown-number {
            font-size: 8rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            animation: countdownPulse 1s ease-in-out;
            z-index: 1001;
        }

        @keyframes countdownPulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .countdown-circle {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: countdownRotate 1s linear;
        }

        @keyframes countdownRotate {
            0% { transform: rotate(0deg) scale(0.8); border-color: rgba(255, 255, 255, 0.3); }
            50% { transform: rotate(180deg) scale(1.1); border-color: rgba(255, 255, 255, 0.8); }
            100% { transform: rotate(360deg) scale(1); border-color: rgba(255, 255, 255, 0.5); }
        }

.back::before, .back::after {
    content: '';
    position: absolute;
    width: 150px; /* Ajusta el tamaño de la forma */
    height: 150px; /* Ajusta el tamaño de la forma */
    background: rgba(255, 255, 255, 0.3); /* Círculos más claros y visibles */
    border-radius: 50%; /* Forma circular */
    z-index: 0; /* Coloca detrás del texto */
}

.back::before {
    top: -30px; /* Ajusta la posición */
    left: -30px; /* Ajusta la posición */
}

.back::after {
    bottom: -30px; /* Ajusta la posición */
    right: -30px; /* Ajusta la posición */
}

    
        /* El efecto de voltear */
        .flashcard.flipped {
            transform: rotateY(180deg); /* Al hacer clic, se voltea la tarjeta */
        }
    
/* Contenedor de botones */
.button-container {
    width: 100%;
    max-width: 370px;
    display: flex;
    justify-content: space-evenly; /* Espacio uniforme entre todos los botones */
    align-items: center;
    padding: 10px 0px;
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    margin-top: 10px;
}



/* Botones individuales */
.button {
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 50px;
    background-color: #3498db;
    color: #fff;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}
     
        .button:hover { transform: translateY(-3px); }





.overlay-text {
    position: absolute;
    z-index: 1; /* Colocar por encima del contenido */
    color: white; /* Color del texto */
    font-size: 2rem; /* Tamaño del texto */
    font-weight: bold; /* Texto en negrita */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra del texto */
    text-align: left; /* Alineación a la izquierda */
    pointer-events: none; /* No interferir con los clics */
    margin: 5%; /* Margen relativo */
    line-height: 1.5; /* Espaciado entre líneas */
    top: 40%; /* Posición específica desde arriba */
    left: 0%; /* Posición específica desde la izquierda */
}

/* Estilos para .overlay-text1 */
.overlay-text1 {
    position: absolute;
    top: 5px;
    z-index: 1;
    color: rgb(185, 232, 203); /* Color específico */
    font-size: 2rem; /* Tamaño del texto */
    font-weight: bold; /* Texto en negrita */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra del texto */
    text-align: center; /* Centrado */
    pointer-events: none; /* No interferir con clics */
    display: inline-block; /* Comportamiento inline */
    animation: pulse 1.5s infinite; /* Animación pulsante */
}

/* Estilos para .overlay-text2 */
.overlay-text2 {
    position: absolute;
    z-index: 1;
    color: white; /* Color del texto */
    font-size: 2rem; /* Tamaño del texto */
    font-weight: bold; /* Negrita */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra del texto */
    text-align: left; /* Alineación a la izquierda */
    pointer-events: none; /* No interferir con clics */
    margin: 30px; /* Márgenes específicos */
    top: 40%; /* Posición específica desde arriba */
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes moveLeftToRight {
  0% {
    transform: translateX(0); /* Posición inicial */
  }
  50% {
    transform: translateX(10px); /* Mueve hacia la derecha */
  }
  100% {
    transform: translateX(0); /* Vuelve a la posición original */
  }
}



.back-arrow {
    background: #fff;
    color: #333;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    gap: 8px;
    border: 1px solid rgba(0,0,0,0.05);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.back-arrow:hover {
    background-color: #f5f5f5;
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.back-arrow i {
    color: #333;
}

.intentos-back {
    position: absolute;
    top: 18px;
    left: 0;
    width: 100%;
    text-align: center;
    font-size: 0.9rem;
    font-weight: bold;
    color: #f0e49c;
    z-index: 2;
    pointer-events: none;
}

.pill-intentos {
    background: linear-gradient(135deg, #ebac6d 0%, #a88f07 100%);
    color: #fff;
    box-shadow: 0 2px 6px rgba(255, 78, 80, 0.15);
    border-radius: 20px;
    padding: 2px 2px;
    font-size: 0.9em;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    margin-bottom: 4px;
}
.pill-intentos i {
    font-size: 0.9em;
}


@keyframes intentosFlash {
  0% { box-shadow: 0 0 0 0 #fff700, 0 2px 6px rgba(255, 78, 80, 0.15); }
  50% { box-shadow: 0 0 16px 8px #fff700, 0 2px 6px rgba(255, 78, 80, 0.15); }
  100% { box-shadow: 0 0 0 0 #fff700, 0 2px 6px rgba(255, 78, 80, 0.15); }
}
.pill-intentos.flash {
  animation: intentosFlash 0.7s;
}

/* --- NUEVO EFECTO DE ADVERTENCIA --- */
@keyframes intentosWarningFlash {
  0% { box-shadow: 0 0 0 0 #ffae00, 0 2px 6px rgba(255, 120, 80, 0.15); }
  50% { box-shadow: 0 0 16px 8px #ffae00, 0 2px 6px rgba(255, 120, 80, 0.15); }
  100% { box-shadow: 0 0 0 0 #ffae00, 0 2px 6px rgba(255, 120, 80, 0.15); }
}
.pill-intentos.flash-warning {
  animation: intentosWarningFlash 0.7s;
}
.super-pulse-indicator {
    position: fixed !important; /* Usar fixed en lugar de absolute */
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    text-align: center;
    z-index: 999 !important; /* Z-index muy alto */
    width: 100%;
    pointer-events: none; /* Para que no interfiera con los clics */
}

.super-pulse-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 25px;
}

.pulse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    border: 3px solid rgba(255, 255, 255, 0.8);
}

.pulse-ring-1 {
    width: 60px;
    height: 60px;
    animation: superPulseRing 2s infinite ease-out;
    border-color: rgba(255, 215, 0, 0.9);
}

.pulse-ring-2 {
    width: 80px;
    height: 80px;
    animation: superPulseRing 2s infinite ease-out;
    animation-delay: 0.5s;
    border-color: rgba(0, 255, 127, 0.7);
}

.pulse-ring-3 {
    width: 100px;
    height: 100px;
    animation: superPulseRing 2s infinite ease-out;
    animation-delay: 1s;
    border-color: rgba(255, 69, 0, 0.6);
}

.pulse-ring-4 {
    width: 120px;
    height: 120px;
    animation: superPulseRing 2s infinite ease-out;
    animation-delay: 1.5s;
    border-color: rgba(138, 43, 226, 0.5);
}

@keyframes superPulseRing {
    0% {
        transform: translate(-50%, -50%) scale(0.3);
        opacity: 1;
        border-width: 4px;
    }
    50% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0.8;
        border-width: 2px;
    }
    100% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0;
        border-width: 1px;
    }
}

.pulse-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #f8fafc 0%, #e0e7ef 100%);
    background-size: 400% 400%;
    animation: centerGradient 3s ease infinite, centerBounce 1.5s ease-in-out infinite;
    border-radius: 50%;
    width: 70px;
    height: 70px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(120, 180, 255, 0.25);
}

@keyframes centerGradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes centerBounce {
    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    50% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
}

.mic-emoji {
    font-size: 2rem;
    margin-bottom: 0.5px;
    margin-top: 0;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    animation: micWiggle 2s ease-in-out infinite;
    display: flex;
    align-items: center;
    justify-content: center;
}

@keyframes micWiggle {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
}

.sound-waves {
    display: flex;
    gap: 6px;
    margin-top: 0;
    margin-bottom: 0;
    justify-content: center;
    align-items: center;
}

.wave-dot {
    width: 4px;
    height: 4px;
    background: #e0c605;
    border-radius: 50%;
    animation: waveUp 1s ease-in-out infinite;
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
}

.wave-dot:nth-child(1) { animation-delay: 0s; }
.wave-dot:nth-child(2) { animation-delay: 0.2s; }
.wave-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes waveUp {
    0%, 100% { transform: translateY(0px) scale(1); opacity: 0.7; }
    50% { transform: translateY(-8px) scale(1.3); opacity: 1; }
}

.floating-emojis {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.floating-emoji {
    position: absolute;
    font-size: 1.2rem;
    animation: floatAround 4s ease-in-out infinite;
    opacity: 0.8;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.e1 { 
    top: 10%; 
    left: 10%; 
    animation-delay: 0s;
    animation-duration: 3s;
}
.e2 { 
    top: 20%; 
    right: 10%; 
    animation-delay: 0.5s;
    animation-duration: 3.5s;
}
.e3 {
    bottom: 10%;
    left: 10%;
    animation-delay: 1s;
    animation-duration: 4s;
    animation-name: floatAroundE3 !important;
}
.e4 { 
    bottom: 10%; 
    right: 15%; 
    animation-delay: 1.5s;
    animation-duration: 3.2s;
}
.e5 { 
    top: 50%; 
    left: -10%; 
    animation-delay: 2s;
    animation-duration: 3.8s;
}
.e6 { 
    top: 50%; 
    right: -10%; 
    animation-delay: 2.5s;
    animation-duration: 3.3s;
}

@keyframes floatAround {
    0%, 100% { 
        transform: translateY(0px) translateX(0px) rotate(0deg) scale(1); 
        opacity: 0.6;
    }
    25% { 
        transform: translateY(-15px) translateX(10px) rotate(90deg) scale(1.2); 
        opacity: 1;
    }
    50% { 
        transform: translateY(-10px) translateX(-5px) rotate(180deg) scale(0.9); 
        opacity: 0.8;
    }
    75% { 
        transform: translateY(-20px) translateX(15px) rotate(270deg) scale(1.1); 
        opacity: 1;
    }
}

@keyframes floatAroundE3 {
    0%, 100% {
        transform: translateY(0px) translateX(0px) rotate(0deg) scale(1);
        opacity: 0.7;
    }
    25% {
        transform: translateY(-1px) translateX(20px) rotate(20deg) scale(1.1);
        opacity: 1;
    }
    50% {
        transform: translateY(1px) translateX(15px) rotate(40deg) scale(1.05);
        opacity: 0.9;
    }
    75% {
        transform: translateY(0px) translateX(-10px) rotate(10deg) scale(1.1);
        opacity: 1;
    }
}

.super-pulse-text {
    color: #fff;
    font-size: 1.4rem;
    font-weight: bold;
    margin-bottom: 8px;
    text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 2px 4px rgba(0,0,0,0.5);
    animation: textGlow 2s ease-in-out infinite;
}

@keyframes textGlow {
    0%, 100% { 
        text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 2px 4px rgba(0,0,0,0.5);
        transform: scale(1);
    }
    50% { 
        text-shadow: 0 0 20px rgba(255,215,0,1), 0 0 30px rgba(255,215,0,0.8), 0 2px 4px rgba(0,0,0,0.5);
        transform: scale(1.02);
    }
}

.super-pulse-subtitle {
    color: #ffeb3b;
    font-size: 1.1rem;
    font-weight: 600;
    animation: subtitleSlide 4s ease-in-out infinite;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

@keyframes subtitleSlide {
    0%, 100% { 
        transform: translateX(0px); 
        opacity: 0.8; 
    }
    25% { 
        transform: translateX(5px); 
        opacity: 1; 
    }
    50% { 
        transform: translateX(-5px); 
        opacity: 0.9; 
    }
    75% { 
        transform: translateX(3px); 
        opacity: 1; 
    }
}

.back .super-pulse-indicator {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    z-index: 999 !important;
    width: auto !important;
    height: auto !important;
}

.super-pulse-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 25px;
    z-index: 1000;
}

/* Añade esto en tu sección de estilos */
@keyframes fadeInOut {
    0% { 
        opacity: 0;
        transform: scale(0.8) translateY(20px);
    }
    20% { 
        opacity: 1;
        transform: scale(1.1) translateY(0);
    }
    80% { 
        opacity: 1;
        transform: scale(1) translateY(0);
    }
    100% { 
        opacity: 0;
        transform: scale(0.8) translateY(-20px);
    }
}

.mensaje-error {
    position: absolute;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    font-size: 2rem;
    font-weight: bold;
    color: #ff6b6b;
    text-align: center;
    text-shadow: 0 0 10px rgba(255, 107, 107, 0.5),
                 0 0 20px rgba(255, 107, 107, 0.3),
                 0 0 30px rgba(255, 107, 107, 0.2);
    z-index: 1000;
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
    padding: 20px 40px;
    border-radius: 15px;
    backdrop-filter: blur(5px);
    border: 2px solid rgba(255, 107, 107, 0.2);
    animation: errorAppearNew 0.5s ease-out, errorDisappearNew 0.5s ease-in 1.5s forwards;
}

@keyframes errorAppearNew {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) perspective(500px) rotateX(-45deg);
        filter: brightness(2);
    }
    50% {
        transform: translate(-50%, -50%) perspective(500px) rotateX(5deg);
        filter: brightness(1.5);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) perspective(500px) rotateX(0);
        filter: brightness(1);
    }
}

@keyframes errorDisappearNew {
    0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        filter: brightness(1);
    }
    50% {
        transform: translate(-50%, -50%) scale(1.1);
        filter: brightness(1.2);
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
        filter: brightness(0);
    }
}

@keyframes respuestaGlow {
    0%, 100% { 
        text-shadow: 0 0 10px rgba(255,255,255,0.5),
                     0 0 20px rgba(255,255,255,0.3);
        transform: scale(1);
    }
    50% { 
        text-shadow: 0 0 15px rgba(255,255,255,0.8),
                     0 0 25px rgba(255,255,255,0.5),
                     0 0 35px rgba(255,255,255,0.3);
        transform: scale(1.05);
    }
}

        .button:hover { transform: translateY(-3px); }

        .button:disabled {
            background-color: #bdc3c7;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

.overlay-text {
    position: absolute;
    }

    @keyframes errorGlow {
  0% {
    box-shadow: 0 0 0 0 #ff3b3b, 0 2px 6px rgba(220,53,69,0.15);
    background: linear-gradient(135deg, #ff3b3b 0%, #c82333 100%);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 24px 12px #ff3b3b, 0 2px 16px rgba(220,53,69,0.25);
    background: linear-gradient(135deg, #ff3b3b 40%, #ffb3b3 100%);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 0 0 #ff3b3b, 0 2px 6px rgba(220,53,69,0.15);
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    transform: scale(1);
  }
}
.pill-incorrectas.glow-error {
  animation: errorGlow 0.7s;
}

@keyframes correctGlow {
  0% {
    box-shadow: 0 0 0 0 #00e676, 0 2px 6px rgba(40,167,69,0.15);
    background: linear-gradient(135deg, #00e676 0%, #218838 100%);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 24px 12px #00e676, 0 2px 16px rgba(40,167,69,0.25);
    background: linear-gradient(135deg, #00e676 40%, #b9f6ca 100%);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 0 0 #00e676, 0 2px 6px rgba(40,167,69,0.15);
    background: linear-gradient(135deg, #28a745 0%, #218838 100%);
    transform: scale(1);
  }
}
.pill-correctas.glow-correct {
  animation: correctGlow 0.7s;
}

@keyframes faltanGlow {
  0% {
    box-shadow: 0 0 0 0 #ffb347, 0 2px 6px rgba(255,107,53,0.15);
    background: linear-gradient(135deg, #ffb347 0%, #f7931e 100%);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 24px 12px #ffb347, 0 2px 16px rgba(255,107,53,0.25);
    background: linear-gradient(135deg, #ffb347 40%, #fff3cd 100%);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 0 0 #ffb347, 0 2px 6px rgba(255,107,53,0.15);
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    transform: scale(1);
  }
}
.pill-faltan.glow-faltan {
  animation: faltanGlow 0.7s;
}

.flashcard.transition-out {
    animation: cardSlideUp 0.5s forwards;
    z-index: 2;
}
.flashcard.transition-in {
    animation: cardSlideIn 0.5s forwards;
    z-index: 3;
}
@keyframes cardSlideUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-120%) scale(0.95); opacity: 0; }
}
@keyframes cardSlideIn {
    0% { transform: translateY(120%) scale(0.95); opacity: 0; }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

.countdown-inline {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 32px;
    animation: fadeInOut 4s;
    z-index: 10;
    position: relative;
}

.countdown-inline-circle {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4ecdc4 0%, #3558e3 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    box-shadow: 0 4px 16px rgba(78,205,196,0.18);
    border: 3px solid #fff;
}

.countdown-inline-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 2px 8px rgba(0,0,0,0.18);
    letter-spacing: 1px;
}

.countdown-inline-text {
    font-size: 1.1rem;
    color: #e0e7ef;
    margin-top: 2px;
    font-weight: 500;
    text-shadow: 0 1px 3px rgba(0,0,0,0.12);
}

.pulse-timer {
    animation: pulse 1s;
}

.flashcard.transition-out {
    animation: cardSlideLeft 0.5s forwards;
    z-index: 2;
}
.flashcard.transition-in {
    animation: cardSlideFromRight 0.5s forwards;
    z-index: 3;
}
@keyframes cardSlideLeft {
    0% { transform: translateX(0) scale(1); opacity: 1; }
    100% { transform: translateX(-120%) scale(0.95); opacity: 0; }
}
@keyframes cardSlideFromRight {
    0% { transform: translateX(120%) scale(0.95); opacity: 0; }
    100% { transform: translateX(0) scale(1); opacity: 1; }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-20px);
    }
    60% {
        transform: translateY(-10px);
    }
}

/* === ANIMACIONES DE EUFORIA (Alegres y eufóricas) === */
@keyframes euforiaEntrance {
    0% { 
        opacity: 0; 
        transform: scale(0.3) rotate(-180deg); 
        background: linear-gradient(135deg, #ff7675 0%, #fd79a8 50%, #fdcb6e 100%);
    }
    50% { 
        transform: scale(1.2) rotate(0deg); 
        background: linear-gradient(135deg, #00b894 0%, #00cec9 50%, #0984e3 100%);
    }
    100% { 
        opacity: 1; 
        transform: scale(1) rotate(0deg); 
        background: linear-gradient(135deg, #28a745 0%, #20c997 50%, #17a2b8 100%);
    }
}

@keyframes celebrationBounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
    10% { transform: translateY(-30px) rotate(15deg) scale(1.2); }
    30% { transform: translateY(-15px) rotate(-10deg) scale(1.1); }
    60% { transform: translateY(-25px) rotate(12deg) scale(1.15); }
    90% { transform: translateY(-10px) rotate(-8deg) scale(1.05); }
}

@keyframes euforiaWiggle {
    0%, 100% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(5deg) scale(1.05); }
    50% { transform: rotate(0deg) scale(1.1); }
    75% { transform: rotate(-5deg) scale(1.05); }
}

@keyframes happyFloat {
    0%, 100% { transform: translateY(0px) scale(1); opacity: 0.9; }
    50% { transform: translateY(-15px) scale(1.02); opacity: 1; }
}

@keyframes sparkle {
    0%, 100% { opacity: 0.8; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
}

/* === ANIMACIONES DE PÉRDIDA (Tristes y desanimadas) === */
@keyframes sadFadeIn {
    0% { 
        opacity: 0; 
        transform: scale(1.2); 
        filter: brightness(0.3);
    }
    100% { 
        opacity: 1; 
        transform: scale(1); 
        filter: brightness(1);
    }
}

@keyframes sadDrop {
    0% { transform: translateY(0px) rotate(0deg); }
    20% { transform: translateY(10px) rotate(-2deg); }
    40% { transform: translateY(5px) rotate(1deg); }
    60% { transform: translateY(8px) rotate(-1deg); }
    80% { transform: translateY(3px) rotate(0.5deg); }
    100% { transform: translateY(0px) rotate(0deg); }
}

@keyframes disappointedSway {
    0%, 100% { transform: rotate(0deg) translateX(0px); }
    33% { transform: rotate(-2deg) translateX(-5px); }
    66% { transform: rotate(2deg) translateX(5px); }
}

@keyframes gentleFloat {
    0%, 100% { transform: translateY(0px); opacity: 0.9; }
    50% { transform: translateY(-8px); opacity: 0.7; }
}

@keyframes fadingHope {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 0.5; }
}

/* === ANIMACIONES DE EMPATE (Neutrales y equilibradas) === */
@keyframes neutralZoom {
    0% { 
        opacity: 0; 
        transform: scale(0.8); 
    }
    50% { 
        transform: scale(1.05); 
    }
    100% { 
        opacity: 1; 
        transform: scale(1); 
    }
}

@keyframes balanceSway {
    0%, 100% { transform: rotate(-8deg); }
    50% { transform: rotate(8deg); }
}

@keyframes steadyPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.03); opacity: 0.95; }
}

@keyframes calmWave {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    33% { transform: translateY(-5px) translateX(3px); }
    66% { transform: translateY(0px) translateX(-3px); }
}

@keyframes steadyGlow {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 1; }
}

/* === ANIMACIONES DE EUFORIA MÁXIMA (Perfecto) === */
@keyframes rainbowBackground {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes perfectEntrance {
    0% { 
        opacity: 0; 
        transform: scale(0.1) rotate(720deg); 
        filter: brightness(3);
    }
    50% { 
        transform: scale(1.3) rotate(360deg); 
        filter: brightness(2);
    }
    100% { 
        opacity: 1; 
        transform: scale(1) rotate(0deg); 
        filter: brightness(1);
    }
}

@keyframes perfectExplosion {
    0%, 100% { 
        transform: translateY(0) rotate(0deg) scale(1); 
        filter: drop-shadow(0 0 20px gold);
    }
    25% { 
        transform: translateY(-40px) rotate(90deg) scale(1.4); 
        filter: drop-shadow(0 0 40px gold);
    }
    50% { 
        transform: translateY(-20px) rotate(180deg) scale(1.2); 
        filter: drop-shadow(0 0 60px gold);
    }
    75% { 
        transform: translateY(-30px) rotate(270deg) scale(1.3); 
        filter: drop-shadow(0 0 40px gold);
    }
}

@keyframes perfectShine {
    0%, 100% { 
        text-shadow: 0 0 20px rgba(255,255,255,1), 0 0 40px gold, 0 0 60px gold;
        transform: scale(1);
    }
    50% { 
        text-shadow: 0 0 30px rgba(255,255,255,1), 0 0 60px gold, 0 0 80px gold, 0 0 100px gold;
        transform: scale(1.1);
    }
}

@keyframes goldenGlow {
    0%, 100% { 
        transform: translateY(0px) scale(1); 
        opacity: 0.95; 
        color: #FFD700;
    }
    50% { 
        transform: translateY(-10px) scale(1.05); 
        opacity: 1; 
        color: #FFA500;
    }
}

@keyframes diamondSpark {
    0%, 100% { 
        opacity: 0.9; 
        transform: scale(1) rotate(0deg);
        color: #E6E6FA;
    }
    25% { 
        opacity: 1; 
        transform: scale(1.1) rotate(5deg);
        color: #FFD700;
    }
    50% { 
        opacity: 1; 
        transform: scale(1.05) rotate(-5deg);
        color: #FF69B4;
    }
    75% { 
        opacity: 1; 
        transform: scale(1.1) rotate(3deg);
        color: #00CED1;
    }
}

/* Animación alternante para botones */
@keyframes alternatePulse {
    0%, 50% {
        transform: scale(1);
        box-shadow: 0 4px 15px rgba(0,200,81,0.2);
    }
    25% {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0,200,81,0.4);
    }
}

@keyframes alternatePulseIncorrect {
    0%, 50% {
        transform: scale(1);
        box-shadow: 0 4px 15px rgba(255,87,34,0.2);
    }
    75% {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(255,87,34,0.4);
    }
}

/* === ESTILOS PARA MODALES MODERNOS DE PALABRAS === */
@keyframes fadeInOverlay {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes expandToFullscreen {
    from { 
        width: 400px;
        height: 500px;
        border-radius: 25px;
    }
    to { 
        width: 100vw;
        height: 100vh;
        border-radius: 0;
    }
}

@keyframes slideInModal {
    from { 
        transform: translateY(-30px) scale(0.95);
        opacity: 0;
    }
    to { 
        transform: translateY(0) scale(1);
        opacity: 1;
    }
}

@keyframes wordCardFadeIn {
    from { 
        transform: translateY(10px);
        opacity: 0;
    }
    to { 
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 90%;
    max-height: 85vh;
    overflow: hidden;
    animation: slideInModal 0.4s ease-out;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.modal-header {
    padding: 30px 30px 20px;
    text-align: center;
    position: relative;
}

.modal-title-row {
    margin-bottom: 8px;
}

.modal-title {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
    color: #1f2937;
    letter-spacing: -0.5px;
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 4px;
}

.correct-modal .modal-title {
    text-decoration-color: #10b981;
}

.incorrect-modal .modal-title {
    text-decoration-color: #ef4444;
}

.modal-stats {
    font-size: 0.95rem;
    color: #6b7280;
    font-weight: 500;
}

.modal-content {
    padding: 0 30px 20px;
    max-height: 50vh;
    overflow-y: auto;
}

.words-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
}

.word-card {
    background: rgba(255, 255, 255, 0.7);
    border-radius: 12px;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    transition: all 0.2s ease;
    animation: wordCardFadeIn 0.3s ease-out;
    animation-fill-mode: both;
}

.word-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.correct-word {
    border-left: 4px solid #10b981;
}

.incorrect-word {
    border-left: 4px solid #ef4444;
}

.word-text {
    font-size: 1.1rem;
    font-weight: 600;
    color: #374151;
    flex: 1;
}

.word-checkmark {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9rem;
    margin-left: 12px;
}

.correct-word .word-checkmark {
    background: #10b981;
    color: white;
}

.incorrect-word .word-checkmark {
    background: #ef4444;
    color: white;
}

.no-words-message {
    text-align: center;
    padding: 40px 20px;
    color: #6b7280;
}

.no-words-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: 16px;
}

.no-words-message p {
    font-size: 1.1rem;
    font-weight: 500;
    margin: 0;
}

.modal-footer {
    padding: 20px 30px 30px;
    text-align: center;
}

.modal-close-btn {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    border: none;
    color: white;
    padding: 14px 32px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    min-width: 120px;
}

.modal-close-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
}

.modal-close-btn:active {
    transform: translateY(0);
}

.correct-btn {
    background: linear-gradient(135deg, #10b981, #059669);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.correct-btn:hover {
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
}

.incorrect-btn {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.incorrect-btn:hover {
    box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
}

/* Animación escalonada para las tarjetas de palabras */
.word-card:nth-child(1) { animation-delay: 0s; }
.word-card:nth-child(2) { animation-delay: 0.05s; }
.word-card:nth-child(3) { animation-delay: 0.1s; }
.word-card:nth-child(4) { animation-delay: 0.15s; }
.word-card:nth-child(5) { animation-delay: 0.2s; }
.word-card:nth-child(6) { animation-delay: 0.25s; }
.word-card:nth-child(7) { animation-delay: 0.3s; }
.word-card:nth-child(8) { animation-delay: 0.35s; }

/* === ESTILOS PARA MODAL DE BANDERA === */
.flag-card-container {
    width: 100%;
    height: 500px;
    max-height: 500px;
    max-width: 400px;
    background: linear-gradient(to right, #1f3658, #3558e3);
    border-radius: 25px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    border: 3px solid #aab0b4;
    overflow: hidden;
    position: relative;
    animation: slideInModal 0.4s ease-out;
    display: flex;
    flex-direction: column;
}

.flag-controls-floating {
    position: absolute;
    top: 15px;
    right: 15px;
    display: flex;
    gap: 8px;
    z-index: 10;
}

.flag-control-btn {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.1);
    color: #374151;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(10px);
}

.flag-control-btn:hover {
    background: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
}

.flag-control-btn.close-btn {
    background: rgba(239, 68, 68, 0.9);
    color: white;
    border-color: rgba(239, 68, 68, 0.3);
}

.flag-control-btn.close-btn:hover {
    background: rgba(239, 68, 68, 1);
    transform: translateY(-2px) scale(1.05);
}

.flag-card-body-full {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    overflow: hidden;
    position: relative;
    border-radius: 0 0 22px 22px;
}

.flag-display {
    width: 100%;
    height: 100%;
    border-radius: 0 0 22px 22px;
    box-shadow: none;
    border: none;
    transition: all 0.3s ease;
    display: block;
}

/* Responsive design para modal de bandera */
@media (max-width: 480px) {
    .flag-card-container {
        width: 100%;
        height: 700px;
        max-height: 700px;
        max-width: 400px;
        margin: 10px;
        border-radius: 25px;
        border: 3px solid #aab0b4;
        background: linear-gradient(to right, #1f3658, #3558e3);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }
    
    .flag-controls-floating {
        top: 10px;
        right: 10px;
        gap: 6px;
    }
    
    .flag-card-body-full {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        overflow: hidden;
        position: relative;
        border-radius: 0 0 22px 22px;
    }
    
    .flag-display {
        width: 100%;
        height: 100%;
        border-radius: 0 0 22px 22px;
        box-shadow: none;
        border: none;
        transition: all 0.3s ease;
        display: block;
    }
    
    .flag-control-btn {
        width: 36px;
        height: 36px;
        border-radius: 10px;
    }
    
    /* Ocultar el botón de pantalla completa en móviles */
    .fullscreen-btn {
        display: none !important;
    }
}

.flag-modal {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow: hidden;
    animation: slideInModal 0.4s ease-out;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.flag-header {
    padding: 20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
}

.flag-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
    color: #1f2937;
    letter-spacing: -0.3px;
}

.flag-close-btn {
    background: rgba(239, 68, 68, 0.1);
    border: none;
    color: #ef4444;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.flag-close-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    transform: scale(1.1);
}

.flag-content {
    padding: 30px;
    text-align: center;
    background: linear-gradient(135deg, #f8fafc, #f1f5f9);
}

.flag-image {
    max-width: 100%;
    height: auto;
    max-height: 300px;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
    border: 2px solid rgba(255, 255, 255, 0.8);
}

.flag-image:hover {
    transform: scale(1.02);
}

/* Cursor pointer para las tarjetas clickeables */
.word-card {
    cursor: pointer;
}

.word-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

/* Responsive design para modal de bandera */
@media (max-width: 480px) {
    .flag-modal {
        width: 95%;
        margin: 10px;
    }
    
    .flag-header {
        padding: 15px 20px;
    }
    
    .flag-content {
        padding: 20px;
    }
    
    .flag-title {
        font-size: 1.3rem;
    }
    
    .flag-image {
        max-height: 200px;
    }
}

/* Responsive design */
@media (max-width: 480px) {
    .modal-container {
        width: 95%;
        margin: 10px;
    }
    
    .modal-header {
        padding: 20px 20px 15px;
    }
    
    .modal-content {
        padding: 0 20px 15px;
    }
    
    .modal-footer {
        padding: 15px 20px 20px;
    }
    
    .words-container {
        grid-template-columns: 1fr;
    }
    
    .modal-title {
        font-size: 1.5rem;
    }
    
    .word-card {
        padding: 12px 16px;
    }
    
    .word-text {
        font-size: 1rem;
    }
}

    </style>
 
</head>
<body>

<div class="top-status-bar">

    <div class="pill back-arrow" onclick="goBack()">
        <span><i class="fas fa-arrow-left"></i></span>
    </div>
  <div class="pill pill-faltan">
    <span>T: <span id="total-cards"></span></span>
  </div>
    <div class="pill pill-correctas">
        <span><i class="fas fa-check"></i> <span id="correctas-count">0</span></span>
    </div>
    <div class="pill pill-incorrectas">
        <span><i class="fas fa-times"></i> <span id="incorrectas-count">0</span></span>
    </div>
</div>


    <div id="flashcard-container-wrapper">

<!--------------------------------------------------------------------->

<div id="flashcard-container">
       <div class="flashcard">
        <div class="front">                 
            <img src="https://flagcdn.com/w640/es.png" alt="España" loading="lazy">
        </div>
        <div class="back">España</div>
    </div>















        </div>
    </div>
    <audio id="soundResetButton" src="https://fawzinoo.github.io/audios/bellding-254774.mp3" preload="auto"></audio>
    <audio id="shuffleSound" src="https://fawzinoo.github.io/audios/naipe.mp3" preload="auto"></audio>

    <div class="button-container">
        <button class="button" id="reset-button" onclick="location.reload()">Reiniciar</button>
        <button class="button" id="shuffle-button" style="background-color: #9b59b6;">
            <i class="fas fa-random"></i> Mezclar
        </button>
    </div>
    

    <!-- Análisis de audio para verificación fonética -->
    <script src="https://unpkg.com/meyda/dist/web/meyda.min.js"></script>

    <!-- Agregar la librería de confeti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>

        

        function vibrar(ms = 80) {
    if (window.navigator && window.navigator.vibrate) {
        window.navigator.vibrate(ms);
    }
}

        function playErrorSound() {
    const errorAudio = new Audio('https://fawzinoo.github.io/audios/error.mp3');
    errorAudio.volume = 0.5;
    errorAudio.play().catch(() => {});
}

function goBack() {
    // Puedes personalizar esta función según lo que necesites
    if (document.referrer) {
        window.history.back(); // Regresa a la página anterior
    } else {
        // Si no hay página anterior, puedes redirigir a una página específica
        window.location.href = 'https://fawzinoo.github.io/Rep/Vocabulario.html'; // Cambia por la URL que necesites
    }
}

// --- NUEVO SISTEMA DE RECONOCIMIENTO DE VOZ (CLIENTE) ---

let mediaRecorder;
let audioChunks = [];
let isRecording = false;

// Sistema de tarjetas completadas
let completedCards = new Set();
let correctCount = 0;
let incorrectCount = 0;
let currentCardIndex = 0;
let voiceAttempts = 0; // Contador para los intentos de voz
let canFlipBack = true;
let canFlip = true; // Controla si se puede voltear la tarjeta

// Función para normalizar el texto: quitar acentos, puntuación y a minúsculas.
function normalizeText(text) {
    if (!text) return "";
    return text.trim();
}


function startVoiceRecognition(targetWord, backElement) {
    // Web Speech API (reconocimiento de voz del navegador)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        alert("Tu navegador no soporta reconocimiento de voz.");
        return;
    }
    const recognition = new SpeechRecognition();
    recognition.lang = 'es-ES';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    showListeningIndicator(backElement, "Grabando...");

    recognition.onresult = function(event) {
        const spokenWord = event.results[0][0].transcript;
        handleVoiceResult(spokenWord, targetWord, backElement);
    };

    recognition.onerror = function(event) {
        console.error("Error de reconocimiento:", event.error); // Muestra el error en la consola para depuración
        removeListeningIndicator();
        const card = backElement.closest('.flashcard');

        // Si el error es 'no-speech' o un problema de red, simplemente voltea la tarjeta
        // para que el usuario pueda volver a intentarlo haciendo clic de nuevo.
        if (event.error === "no-speech" || event.error === "network") {
            if (card && card.classList.contains('flipped')) {
                card.classList.remove('flipped');
            }
            return;
        }
        
        // Para otros errores, no hacemos nada drástico, solo paramos.
        // El alert() se ha eliminado para no interrumpir al usuario.
    };

    recognition.onend = function() {
        removeListeningIndicator();
    };

    recognition.start();
}
function handleVoiceResult(spokenWord, targetWord, backElement) {
    // Desactiva el botón de mezclar en el primer intento.
    document.getElementById('shuffle-button').disabled = true;

    if (!spokenWord || spokenWord.trim() === "") {
        removeListeningIndicator();
        setBackAttempts(backElement, 2 - voiceAttempts);
        backElement.classList.remove('hidden-text');
        setTimeout(() => {
            const card = backElement.closest('.flashcard');
            if (card && card.classList.contains('flipped')) {
                startVoiceRecognition(targetWord, backElement);
            }
        }, 2000);
        return;
    }
    const normalizedSpoken = spokenWord.trim();
    const normalizedTarget = targetWord.trim();
    const card = backElement.closest('.flashcard');

    if (palabrasSimilares(normalizedSpoken, normalizedTarget)) {
        correctCount++;
        
        // AGREGAR la palabra a la lista de correctas
        correctWords.push(targetWord);
        
        canFlipBack = true; 
        playSuccessSound();

        // Mostrar contador y nombre del país debajo SOLO si acierta
        backElement.innerHTML = '';
        
        // Si se acierta al primer intento (voiceAttempts es 0), el contador se pone a 1.
        // Si se acierta al segundo (voiceAttempts es 1), el contador se pone a 0.
        setBackAttempts(backElement, 2 - (voiceAttempts + 1));

        voiceAttempts = 0; // Reiniciar para la siguiente tarjeta

        const nombrePais = document.createElement('div');
        nombrePais.style.marginTop = '40px';
        nombrePais.textContent = targetWord;
        backElement.appendChild(nombrePais);
        backElement.classList.remove('hidden-text');
        
        canFlip = false; // Deshabilitar volteo antes de mostrar la respuesta

        setTimeout(() => {
            if (audios[flashcards.indexOf(card)]) {
                stopAllAudios();
                audios[flashcards.indexOf(card)].play().catch(e => {});
                audios[flashcards.indexOf(card)].addEventListener('ended', () => showCountdown(card), { once: true });
            } else {
                showCountdown(card);
            }
        }, 1000);

    } else {
        voiceAttempts++;
        removeListeningIndicator();

        if (voiceAttempts < 2) {
            playErrorSound();
            // Primer intento fallido: solo muestra el mensaje de error elegante y centrado
            backElement.innerHTML = '';
            setBackAttempts(backElement, 2 - voiceAttempts); // Solo actualiza el contador de intentos
            
            const mensajeError = document.createElement('div');
            mensajeError.className = 'mensaje-error';
            mensajeError.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <div>Incorrecto</div>
            `;
            backElement.appendChild(mensajeError);
            backElement.classList.remove('hidden-text');

            // Eliminar el mensaje después de 2 segundos y reiniciar la grabación
            setTimeout(() => {
                mensajeError.remove(); // Elimina solo el mensaje de error
                if (card.classList.contains('flipped')) {
                    startVoiceRecognition(targetWord, backElement);
                }
            }, 2000);

        } else {
            // Segundo (último) intento fallido
            playErrorSound();
            incorrectCount++;
            
            // AGREGAR la palabra a la lista de incorrectas
            incorrectWords.push(targetWord);
            
            voiceAttempts = 0;
            canFlipBack = false;
            canFlip = false; // Deshabilitar volteo antes de mostrar la respuesta
            removeListeningIndicator(backElement);

            // 1. Limpia TODO el contenido del reverso (incluyendo contadores)
            backElement.innerHTML = '';
            backElement.classList.remove('hidden-text');

            // 2. Muestra el mensaje de "Incorrecto"
            const mensajeError = document.createElement('div');
            mensajeError.className = 'mensaje-error';
            mensajeError.innerHTML = `<i class="fas fa-exclamation-circle"></i>
                <div>Incorrecto</div>`;
            backElement.appendChild(mensajeError);

            // 3. Después de un delay, muestra SOLO la respuesta correcta (sin ningún contador)
            setTimeout(() => {
                canFlip = false; // Deshabilitar volteo cuando se muestra la respuesta
                // Elimina cualquier contador de intentos y residuos
                backElement.querySelectorAll('.intentos-back').forEach(el => el.remove());
                backElement.innerHTML = ''; // LIMPIA TODO
                const respuestaCorrecta = document.createElement('div');
                respuestaCorrecta.textContent = targetWord;
                respuestaCorrecta.style.animation = 'respuestaGlow 1.5s infinite';
                backElement.appendChild(respuestaCorrecta);

                // Reproduce el audio si existe
                const audioIndex = flashcards.indexOf(card);
                if (audios[audioIndex]) {
                    stopAllAudios();
                    audios[audioIndex].play().catch(() => {});
                }
            }, 2000);

            // 4. Avanza a la siguiente tarjeta después de todo
            setTimeout(() => {
                goToNextCard();
            }, 5000);
        }
    }
    updateCounters();
}

function palabrasSimilares(a, b) {
    // Normalizar ambas cadenas para una comparación flexible:
    // 1. Eliminar espacios al principio y al final.
    // 2. Convertir todo a minúsculas.
    // 3. Eliminar puntos y comas que pueda añadir el reconocimiento de voz.
    const normA = a.trim().toLowerCase().replace(/[.,]/g, '');
    const normB = b.trim().toLowerCase().replace(/[.,]/g, '');
    
    return normA === normB;
}

function showListeningIndicator(backElement, text = '🎤<br>Habla ahora') {
    backElement.querySelectorAll('.listening-indicator').forEach(el => el.remove());
    
    const indicator = document.createElement('div');
    indicator.className = 'listening-indicator super-pulse-indicator';
   indicator.innerHTML = `
    <div class="super-pulse-container">
        <div class="pulse-ring pulse-ring-1"></div>
        <div class="pulse-ring pulse-ring-2"></div>
        <div class="pulse-ring pulse-ring-3"></div>
        <div class="pulse-ring pulse-ring-4"></div>
        <div class="pulse-center">
            <div class="mic-emoji">🎤</div>
            <div class="sound-waves">
                <span class="wave-dot"></span>
                <span class="wave-dot"></span>
                <span class="wave-dot"></span>
            </div>
        </div>
        <div class="floating-emojis">
            <span class="floating-emoji e1">🤖</span>
            <span class="floating-emoji e2">🦄</span>
            <span class="floating-emoji e3">🚀</span>
            <span class="floating-emoji e4">🧠</span>
            <span class="floating-emoji e5">💡</span>
            <span class="floating-emoji e6">🥳</span>
        </div>
    </div>
    <div class="super-pulse-text">¡Habla más fuerte y claro!</div>
   
`;
    backElement.appendChild(indicator);
}

// --- FIN DEL NUEVO SISTEMA DE VOZ ---

function removeListeningIndicator(backElement = null) {
    if (backElement) {
        backElement.querySelectorAll('.listening-indicator').forEach(el => el.remove());
    } else {
        document.querySelectorAll('.flashcard').forEach(card => {
            if (!card.classList.contains('flipped')) {
                const back = card.querySelector('.back');
                if (back) {
                    back.querySelectorAll('.listening-indicator').forEach(el => el.remove());
                }
            }
        });
    }
}
let isShuffling = false;

document.getElementById('shuffle-button').addEventListener('click', () => {
    if (isShuffling) return;
    isShuffling = true;
    vibrar(80); 
    document.getElementById('shuffleSound').play().catch(() => {});
    shuffleCards();
    setTimeout(() => { isShuffling = false; }, 800); // Evita abusos rápidos
});

function playSuccessSound() {
    const successAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUYrTp66hVFApGn+DyvmwhBSuBzvLZiTUJGmmm6eSnVBQKRZ/g8r5wIQUvgM/z1oUzByt2xvLaizsIHGjA+N2cQQ');
    successAudio.volume = 0.3;
    successAudio.play().catch(() => {});
}

function showCountdown(card) {
    // Elimina cualquier timer previo
    const back = card.querySelector('.back');
    back.querySelectorAll('.countdown-inline').forEach(el => el.remove());

    // Verificar si es la última tarjeta
    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
    const remainingCards = flashcards.filter((_, index) => !completedCards.has(index)).length;
    const isLastCard = remainingCards <= 1; // 1 porque la actual aún no se ha marcado como completada

    // Crea el contenedor del timer
    const timerDiv = document.createElement('div');
    timerDiv.className = 'countdown-inline';
    const messageText = isLastCard ? 'Finalizando...' : 'Siguiente tarjeta en...';
    timerDiv.innerHTML = `
        <div class="countdown-inline-circle">
            <span class="countdown-inline-number">3</span>
        </div>
        <div class="countdown-inline-text">${messageText}</div>
    `;
    back.appendChild(timerDiv);

    let count = 3;
    const numberSpan = timerDiv.querySelector('.countdown-inline-number');

    function updateCounter() {
        numberSpan.textContent = count;
        timerDiv.classList.remove('pulse-timer');
        void timerDiv.offsetWidth;
        timerDiv.classList.add('pulse-timer');
        if (count > 0) {
            count--;
            setTimeout(updateCounter, 1000);
        } else {
            timerDiv.remove();
            goToNextCard();
        }
    }
    updateCounter();
}

function goToNextCard() {
    // Reactivar el botón de mezclar al pasar a la siguiente tarjeta
    document.getElementById('shuffle-button').disabled = false;

    // REPRODUCIR SONIDO DE NAIPE al cambiar de tarjeta
    document.getElementById('shuffleSound').play().catch(() => {});

    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
    completedCards.add(currentCardIndex);
    updateCardCounter();
    
    canFlipBack = true; // Permitir voltear en la nueva tarjeta
    canFlip = true; // Rehabilitar volteo para la nueva tarjeta
    updateCounters();
    voiceAttempts = 0; // Reiniciar intentos para la nueva tarjeta

    let nextIndex = -1;
    for (let i = 0; i < flashcards.length; i++) {
        if (!completedCards.has(i)) {
            nextIndex = i;
            break;
        }
    }
    
    if (nextIndex !== -1) {
        currentCardIndex = nextIndex;
        showCard(currentCardIndex);
    } else {
        // Decidir qué función llamar según el resultado
        if (correctCount > incorrectCount) {
            // Verificar si es perfecto (sin errores)
            if (incorrectCount === 0) {
                showCompletionEuforiaMaxima(); // PERFECTO: sin errores
            } else {
                showCompletioneuforia(); // GANA: con algunos errores
            }
        } else if (incorrectCount > correctCount) {
            showCompletionPerdida(); // Perdió: mensaje motivacional
        } else {
            showCompletionEmpate(); // Empate: mensaje equilibrado
        }
    }
}

function showCard(index) {
    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
flashcards.forEach(card => {
    card.classList.remove('is-visible', 'flipped');
    const back = card.querySelector('.back');
    // Elimina cualquier contador de intentos
    back.querySelectorAll('.intentos-back').forEach(el => el.remove());
    if (card.dataset.answer) {
        back.innerHTML = card.dataset.answer;
    }
});

    if (flashcards[index]) {
        flashcards[index].classList.add('is-visible');
    }
    updateCounters();
}

function updateProgress() {
    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
    const totalCards = flashcards.length;
    const percentage = totalCards > 0 ? Math.round((completedCards.size / totalCards) * 100) : 0;
    const porcentajeDiv = document.getElementById('porcentaje-guardado');
    if (porcentajeDiv) {
        porcentajeDiv.textContent = `${percentage}%`;
    }
}

function updateCounters() {
    // Correctas
    const correctasPill = document.querySelector('.pill-correctas');
    const prevCorrect = Number(correctasPill.getAttribute('data-prev') || 0);
    document.getElementById('correctas-count').textContent = correctCount;

    if (correctCount > prevCorrect) {
        correctasPill.classList.remove('glow-correct');
        void correctasPill.offsetWidth; // Reinicia animación
        correctasPill.classList.add('glow-correct');
    }
    correctasPill.setAttribute('data-prev', correctCount);

    // Incorrectas
    const incorrectasPill = document.querySelector('.pill-incorrectas');
    const prevIncorrect = Number(incorrectasPill.getAttribute('data-prev') || 0);
    document.getElementById('incorrectas-count').textContent = incorrectCount;

    if (incorrectCount > prevIncorrect) {
        incorrectasPill.classList.remove('glow-error');
        void incorrectasPill.offsetWidth; // Reinicia animación
        incorrectasPill.classList.add('glow-error');
    }
    incorrectasPill.setAttribute('data-prev', incorrectCount);

    updateCardCounter();
}

function showCompletionEuforiaMaxima() {
    // Reproducir audio de victoria máxima
    const audioVictoriaMaxima = new Audio('https://fawzinoo.github.io/audios/victoriamaxima.mp3');
    audioVictoriaMaxima.play().catch(error => {
        console.log('Error al reproducir audio de victoria máxima:', error);
    });
    
    // Crear overlay que cubra toda la pantalla
    const fullScreenOverlay = document.createElement('div');
    fullScreenOverlay.id = 'euforia-maxima-overlay';
    fullScreenOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
        background: linear-gradient(45deg, #FFD700 0%, #FFA500 25%, #FF4500 50%, #FF1493 75%, #9932CC 100%);
        background-size: 400% 400%;
        animation: rainbowBackground 3s ease infinite, perfectEntrance 1s ease-out;
    `;
    
    fullScreenOverlay.innerHTML = `
        <div id="trophy-container" style="font-size: 4rem; margin-bottom: 20px; animation: perfectExplosion 1.5s infinite;">🏆</div>
        <div style="font-size: 4rem; font-weight: bold; margin-bottom: 15px; text-shadow: 0 0 20px rgba(255,255,255,1); animation: perfectShine 2s ease-in-out infinite;">
            ¡PERFECTO!
        </div>
        <div style="font-size: 2.5rem; margin-bottom: 10px; opacity: 0.95; animation: goldenGlow 2.5s ease-in-out infinite;">
            ¡Sin errores! ¡Eres increíble!
        </div>
        <div style="font-size: 1.8rem; opacity: 0.9; animation: diamondSpark 2s infinite;">
            ¡PUNTUACIÓN MÁXIMA!
        </div>
    `;
    
    // Añadir el overlay al body
    document.body.appendChild(fullScreenOverlay);
    
    // Efecto de confeti DOBLE para perfecto
    confetti({
        particleCount: 200,
        spread: 100,
        origin: { y: 0.4 }
    });
    
    // Segundo confeti con delay
    setTimeout(() => {
        confetti({
            particleCount: 150,
            spread: 80,
            origin: { y: 0.7 }
        });
    }, 500);
    
    // DETENER la animación de la copa después de 3 segundos
    setTimeout(() => {
        const trophyContainer = fullScreenOverlay.querySelector('#trophy-container');
        if (trophyContainer) {
            trophyContainer.style.animation = 'none';
        }
    }, 3000);
    
    // Después de 7 segundos, quitar el overlay y mostrar el mensaje final
    setTimeout(() => {
        fullScreenOverlay.remove();
        showCompletionMessage();
    }, 7000);
}

function showCompletioneuforia() {
    // Reproducir audio de victoria normal
    const audioVictoriaNormal = new Audio('https://fawzinoo.github.io/audios/victorianormal.mp3');
    audioVictoriaNormal.play().catch(error => {
        console.log('Error al reproducir audio de victoria normal:', error);
    });
    
    // Crear overlay que cubra toda la pantalla
    const fullScreenOverlay = document.createElement('div');
    fullScreenOverlay.id = 'euforia-overlay';
    fullScreenOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
        background: linear-gradient(135deg, #28a745 0%, #20c997 50%, #17a2b8 100%);
        animation: euforiaEntrance 0.8s ease-out;
    `;
    
    fullScreenOverlay.innerHTML = `
        <div style="font-size: 6rem; margin-bottom: 20px; animation: celebrationBounce 1.2s infinite;">🥇</div>
        <div style="font-size: 3.5rem; font-weight: bold; margin-bottom: 15px; text-shadow: 0 4px 8px rgba(0,0,0,0.3); animation: euforiaWiggle 1.5s ease-in-out infinite;">
            ¡FANTÁSTICO!
        </div>
        <div style="font-size: 2rem; margin-bottom: 10px; opacity: 0.9; animation: happyFloat 2s ease-in-out infinite;">
            ¡Excelente resultado!
        </div>
        <div style="font-size: 1.5rem; opacity: 0.8; animation: sparkle 1.8s infinite;">
            Calculando puntuación...
        </div>
    `;
    
    // Añadir el overlay al body
    document.body.appendChild(fullScreenOverlay);
    
    // Efecto de confeti normal
    confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 }
    });
    
    // Después de 7 segundos, quitar el overlay y mostrar el mensaje final
    setTimeout(() => {
        fullScreenOverlay.remove();
        showCompletionMessage();
    }, 7000);
}

function showCompletionPerdida() {
    // Crear overlay que cubra toda la pantalla
    const fullScreenOverlay = document.createElement('div');
    fullScreenOverlay.id = 'perdida-overlay';
    fullScreenOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
        background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 50%, #fd79a8 100%);
        animation: sadFadeIn 1s ease-in;
    `;
    
    fullScreenOverlay.innerHTML = `
        <div style="font-size: 6rem; margin-bottom: 20px; animation: sadDrop 2s ease-out infinite;">😔</div>
        <div style="font-size: 3.5rem; font-weight: bold; margin-bottom: 15px; text-shadow: 0 4px 8px rgba(0,0,0,0.3); animation: disappointedSway 2.5s ease-in-out infinite;">
            ¡A seguir practicando!
        </div>
        <div style="font-size: 2rem; margin-bottom: 10px; opacity: 0.9; animation: gentleFloat 3s ease-in-out infinite;">
            La práctica hace al maestro
        </div>
        <div style="font-size: 1.5rem; opacity: 0.8; animation: fadingHope 2.2s infinite;">
            Calculando resultados...
        </div>
    `;
    
    // Añadir el overlay al body
    document.body.appendChild(fullScreenOverlay);
    
    // NO hay confeti para perdida
    
    // Después de 3 segundos, quitar el overlay y mostrar el mensaje final
    setTimeout(() => {
        fullScreenOverlay.remove();
        showCompletionMessage();
    }, 7000);
}

function showCompletionEmpate() {
    // Reproducir audio de empate (palpitaciones)
    const audioEmpate = new Audio('https://fawzinoo.github.io/audios/empate.mp3');
    audioEmpate.play().catch(error => {
        console.log('Error al reproducir audio de empate:', error);
    });
    
    // Crear overlay que cubra toda la pantalla
    const fullScreenOverlay = document.createElement('div');
    fullScreenOverlay.id = 'empate-overlay';
    fullScreenOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-align: center;
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
        animation: neutralZoom 0.6s ease-out;
    `;
    
    fullScreenOverlay.innerHTML = `
        <div style="font-size: 6rem; margin-bottom: 20px; animation: balanceSway 2s ease-in-out infinite;">⚖️</div>
        <div style="font-size: 3.5rem; font-weight: bold; margin-bottom: 15px; text-shadow: 0 4px 8px rgba(0,0,0,0.3); animation: steadyPulse 2s infinite;">
            ¡Empate perfecto!
        </div>
        <div style="font-size: 2rem; margin-bottom: 10px; opacity: 0.9; animation: calmWave 2.5s ease-in-out infinite;">
            Resultado equilibrado
        </div>
        <div style="font-size: 1.5rem; opacity: 0.8; animation: steadyGlow 2s infinite;">
            Analizando desempeño...
        </div>
    `;
    
    // Añadir el overlay al body
    document.body.appendChild(fullScreenOverlay);
    
    // NO hay confeti para empate
    
    // Después de 3 segundos, quitar el overlay y mostrar el mensaje final
    setTimeout(() => {
        fullScreenOverlay.remove();
        showCompletionMessage();
    }, 9000);
}
function showCompletionMessage() {
    const container = document.getElementById('flashcard-container');
    
    if (correctCount > incorrectCount) {
        if (incorrectCount === 0) {
            // CASO 1A: Victoria PERFECTA (sin errores) - Diseño moderno dorado/negro
            container.innerHTML = `
                <div style="
                    display: flex; 
                    flex-direction: column; 
                    justify-content: center; 
                    align-items: center; 
                    height: 100%; 
                    color: white; 
                    text-align: center;
                    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
                    border-radius: 25px;
                    position: relative;
                    overflow: hidden;
                    border: 2px solid #FFD700;
                ">
                    <div style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: radial-gradient(circle at 30% 20%, rgba(255,215,0,0.1) 0%, transparent 50%),
                                    radial-gradient(circle at 70% 80%, rgba(255,215,0,0.05) 0%, transparent 50%);
                    "></div>
                    
                    <div id="final-trophy" style="font-size: 4rem; margin-bottom: 30px; animation: perfectExplosion 2s infinite; filter: drop-shadow(0 0 20px #FFD700);">🏆</div>
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(26,26,26,0.95) 0%, rgba(45,45,45,0.95) 100%);
                        padding: 25px 35px;
                        border-radius: 20px;
                        backdrop-filter: blur(20px);
                        border: 1px solid rgba(255,215,0,0.3);
                        box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 20px rgba(255,215,0,0.1);
                        margin-bottom: 20px;
                        width: 280px;
                    ">
                        <div style="font-size: 1.1rem; margin-bottom: 20px; color: #FFD700; font-weight: 600; letter-spacing: 1px;">
                            ⭐ PUNTUACIÓN MÁXIMA ⭐
                        </div>
                        <div id="correct-words-btn" style="
                            font-size: 1.1rem; 
                            color: #ffffff; 
                            margin-bottom: 15px;
                            cursor: pointer;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #00C851 0%, #00A041 100%);
                            border-radius: 12px;
                            border: 1px solid rgba(0,200,81,0.3);
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(0,200,81,0.2);
                            font-weight: 500;
                            animation: pulse 2s infinite;
                            width: 100%;
                            box-sizing: border-box;
                            text-align: left;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,200,81,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,200,81,0.2)'">
                            ✅ Correctas: ${correctCount} (Ver)
                        </div>
                        <div style="
                            font-size: 1.1rem; 
                            color: white; 
                            opacity: 0.7; 
                            font-weight: 500;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, rgba(136,136,136,0.2) 0%, rgba(136,136,136,0.1) 100%);
                            border-radius: 12px;
                            border: 1px solid rgba(136,136,136,0.3);
                            width: 100%;
                            box-sizing: border-box;
                            text-align: left;
                        ">
                            ❌ Incorrectas: ${incorrectCount}
                        </div>
                        <div style="font-size: 1rem; opacity: 0.8; margin-top: 8px; color: #FFD700; font-weight: 400; text-align: center;">
                            Precisión: ${Math.round((correctCount / (correctCount + incorrectCount)) * 100)}%
                        </div>
                    </div>
                </div>
            `;
        } else {
            // CASO 1B: Victoria NORMAL - Diseño moderno azul/gris
            container.innerHTML = `
                <div style="
                    display: flex; 
                    flex-direction: column; 
                    justify-content: center; 
                    align-items: center; 
                    height: 100%; 
                    color: white; 
                    text-align: center;
                    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
                    border-radius: 25px;
                    position: relative;
                    overflow: hidden;
                    border: 2px solid #4FC3F7;
                ">
                    <div style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: radial-gradient(circle at 30% 20%, rgba(79,195,247,0.1) 0%, transparent 50%),
                                    radial-gradient(circle at 70% 80%, rgba(79,195,247,0.05) 0%, transparent 50%);
                    "></div>
                    
                    <div id="celebration-emoji" style="font-size: 4rem; margin-bottom: 30px; animation: perfectExplosion 2s infinite; filter: drop-shadow(0 0 20px #4FC3F7);">🥇</div>
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(30,60,114,0.95) 0%, rgba(42,82,152,0.95) 100%);
                        padding: 25px 35px;
                        border-radius: 20px;
                        backdrop-filter: blur(20px);
                        border: 1px solid rgba(79,195,247,0.3);
                        box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 20px rgba(79,195,247,0.1);
                        margin-bottom: 20px;
                        width: 280px;
                    ">
                        <div style="font-size: 1.1rem; margin-bottom: 20px; color: #4FC3F7; font-weight: 600; letter-spacing: 1px;">
                            ¡ENHORABUENA!
                        </div>
                         <div id="correct-words-btn" style="
                            font-size: 1.1rem; 
                            color: #ffffff; 
                            margin-bottom: 15px;
                            cursor: pointer;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #00C851 0%, #00A041 100%);
                            border-radius: 12px;
                            border: 1px solid rgba(0,200,81,0.3);
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(0,200,81,0.2);
                            font-weight: 500;
                            animation: alternatePulse 4s infinite;
                            width: 100%;
                            box-sizing: border-box;
                            text-align: left;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,200,81,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,200,81,0.2)'">
                            ✅ Correctas: ${correctCount} (Ver)
                        </div>
                        <div id="incorrect-words-btn" style="
                              font-size: 1.1rem; 
                            color: white; 
                            margin-bottom: 15px;
                            cursor: pointer;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
                            border-radius: 12px;
                            border: 1px solid rgba(255,87,34,0.3);
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(255,87,34,0.2);
                            font-weight: 500;
                            animation: alternatePulseIncorrect 4s infinite;
                            width: 100%;
                            box-sizing: border-box;
                            text-align: left;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,87,34,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,87,34,0.2)'">
                            ❌ Incorrectas: ${incorrectCount} (Ver)
                        </div>
                        <div style="font-size: 1rem; opacity: 0.8; margin-top: 8px; color: #B0BEC5; font-weight: 400; text-align: center;">
                            Precisión: ${Math.round((correctCount/(correctCount+incorrectCount))*100)}%
                        </div>
                    </div>
                </div>
            `;
        }
    } else if (incorrectCount > correctCount) {
        // CASO 2: Pérdida - Diseño moderno púrpura/gris
        container.innerHTML = `
            <div style="
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                height: 100%; 
                color: white; 
                text-align: center;
                background: linear-gradient(135deg, #4A148C 0%, #6A1B9A 50%, #4A148C 100%);
                border-radius: 25px;
                position: relative;
                overflow: hidden;
                border: 2px solid #BA68C8;
            ">
                <div style="font-size: 4rem; margin-bottom: 25px; filter: drop-shadow(0 0 15px #BA68C8);">😔</div>
              
               
                <div style="
                    background: linear-gradient(135deg, rgba(74,20,140,0.95) 0%, rgba(106,27,154,0.95) 100%);
                    padding: 20px 30px;
                    border-radius: 18px;
                    backdrop-filter: blur(20px);
                    border: 1px solid rgba(186,104,200,0.3);
                    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                    width: 280px;
                ">
                 <div style="font-size: 1.1rem; margin-bottom: 20px; color: #4FC3F7; font-weight: 600; letter-spacing: 1px;">
                            ¡A SEGUIR PRACTICANDO!
                        </div>
                    <div id="correct-words-btn" style="
                        font-size: 1.1rem; 
                        margin-bottom: 12px;
                        cursor: pointer;
                        padding: 12px 20px;
                        background: linear-gradient(135deg, #00C851 0%, #00A041 100%);
                        border-radius: 12px;
                        border: 1px solid rgba(0,200,81,0.3);
                        color: #fff;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0,200,81,0.2);
                        font-weight: 500;
                        animation: alternatePulse 4s infinite;
                        width: 100%;
                        box-sizing: border-box;
                        text-align: left;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,200,81,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,200,81,0.2)'">
                        ✅ Correctas: ${correctCount} (Ver)
                    </div>
                    <div id="incorrect-words-btn" style="
                        font-size: 1.1rem;
                        cursor: pointer;
                        padding: 12px 20px;
                        background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
                        border-radius: 12px;
                        border: 1px solid rgba(255,87,34,0.3);
                        color: #fff;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(255,87,34,0.2);
                        font-weight: 500;
                        animation: alternatePulseIncorrect 4s infinite;
                        width: 100%;
                        box-sizing: border-box;
                        text-align: left;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,87,34,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,87,34,0.2)'">
                        ❌ Incorrectas: ${incorrectCount} (Ver)
                    </div>
                    <div style="font-size: 1rem; opacity: 0.8; margin-top: 8px; color: #BA68C8; font-weight: 400; text-align: center;">
                        Precisión: ${Math.round((correctCount/(correctCount+incorrectCount))*100)}%
                    </div>
                </div>
            </div>
        `;
    } else {
        // CASO 3: Empate - Diseño moderno gris/plateado
        container.innerHTML = `
            <div style="
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                height: 100%; 
                color: white; 
                text-align: center;
                background: linear-gradient(135deg, #37474F 0%, #546E7A 50%, #37474F 100%);
                border-radius: 25px;
                position: relative;
                overflow: hidden;
                border: 2px solid #90A4AE;
            ">
                <div style="font-size: 4rem; margin-bottom: 25px; filter: drop-shadow(0 0 15px #90A4AE);">⚖️</div>
             
               
                <div style="
                    background: linear-gradient(135deg, rgba(55,71,79,0.95) 0%, rgba(84,110,122,0.95) 100%);
                    padding: 20px 30px;
                    border-radius: 18px;
                    backdrop-filter: blur(20px);
                    border: 1px solid rgba(144,164,174,0.3);
                    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                    width: 280px;
                ">
                   <div style="font-size: 1.1rem; margin-bottom: 20px; color: #4FC3F7; font-weight: 600; letter-spacing: 1px;">
                            ¡EMPATE PERFECTO!
                        </div>
                      <div id="correct-words-btn" style="
                        font-size: 1.1rem; 
                        margin-bottom: 12px;
                        cursor: pointer;
                        padding: 12px 20px;
                        background: linear-gradient(135deg, #00C851 0%, #00A041 100%);
                        border-radius: 12px;
                        border: 1px solid rgba(0,200,81,0.3);
                        color: #fff;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0,200,81,0.2);
                        font-weight: 500;
                        animation: alternatePulse 4s infinite;
                        width: 100%;
                        box-sizing: border-box;
                        text-align: left;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,200,81,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,200,81,0.2)'">
                        ✅ Correctas: ${correctCount} (Ver)
                    </div>
                    <div id="incorrect-words-btn" style="
                        font-size: 1.1rem;
                        cursor: pointer;
                        padding: 12px 20px;
                        background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
                        border-radius: 12px;
                        border: 1px solid rgba(255,87,34,0.3);
                        color: #fff;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(255,87,34,0.2);
                        font-weight: 500;
                        animation: alternatePulseIncorrect 4s infinite;
                        width: 100%;
                        box-sizing: border-box;
                        text-align: left;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,87,34,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,87,34,0.2)'">
                        ❌ Incorrectas: ${incorrectCount} (Ver)
                    </div>
                    <div style="font-size: 1rem; opacity: 0.8; margin-top: 8px; color: #90A4AE; font-weight: 400; text-align: center;">
                        Precisión: ${Math.round((correctCount/(correctCount+incorrectCount))*100)}%
                    </div>
                </div>
            </div>
        `;
    }

    // DETENER SOLO las animaciones del fondo y elementos decorativos después de 3 segundos
    // PERO MANTENER la animación pulse del botón verde
    setTimeout(() => {
        const finalTrophy = document.getElementById('final-trophy');
        const celebrationEmoji = document.getElementById('celebration-emoji');
        const containerDiv = container.firstElementChild;
        
        if (finalTrophy) finalTrophy.style.animation = 'none';
        if (celebrationEmoji) celebrationEmoji.style.animation = 'none';
        if (containerDiv) containerDiv.style.animation = 'none';
        
        // ⭐ NO detener la animación pulse del botón verde
        // Línea eliminada: if (correctBtn) correctBtn.style.animation = 'none';
    }, 3000);

    // AÑADIR EVENT LISTENERS para los botones clicables
    setTimeout(() => {
        const correctBtn = document.getElementById('correct-words-btn');
        const incorrectBtn = document.getElementById('incorrect-words-btn');

        if (correctBtn) {
            correctBtn.addEventListener('click', showCorrectWords);
        }
        
        if (incorrectBtn) {
            incorrectBtn.addEventListener('click', showIncorrectWords);
        }
    }, 100);
}

// Función para mostrar palabras correctas
function showCorrectWords() {
    const overlay = document.createElement('div');
    overlay.id = 'correct-words-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 0;
        animation: fadeInOverlay 0.3s ease-out forwards;
    `;
    
    const wordsHtml = correctWords.length > 0 
        ? correctWords.map(word => `
            <div class="word-card correct-word" onclick="showCountryFlag('${word}')">
                <span class="word-text">${word}</span>
                <div class="word-checkmark">✓</div>
            </div>
        `).join('')
        : '<div class="no-words-message"><span class="no-words-icon">🎯</span><p>No hay palabras acertadas</p></div>';
    
    overlay.innerHTML = `
        <div class="modal-container correct-modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2 class="modal-title">Palabras Acertadas</h2>
                </div>
                <div class="modal-stats">${correctWords.length} ${correctWords.length === 1 ? 'palabra' : 'palabras'}</div>
            </div>
            
            <div class="modal-content">
                <div class="words-container">
                    ${wordsHtml}
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-close-btn correct-btn" onclick="document.getElementById('correct-words-overlay').remove()">
                    <span>Cerrar</span>
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Cerrar modal al hacer clic en el fondo
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            overlay.remove();
        }
    });
}

// Función para mostrar palabras incorrectas
function showIncorrectWords() {
    const overlay = document.createElement('div');
    overlay.id = 'incorrect-words-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 0;
        animation: fadeInOverlay 0.3s ease-out forwards;
    `;
    
    const wordsHtml = incorrectWords.length > 0 
        ? incorrectWords.map(word => `
            <div class="word-card incorrect-word" onclick="showCountryFlag('${word}')">
                <span class="word-text">${word}</span>
                <div class="word-checkmark">✗</div>
            </div>
        `).join('')
        : '<div class="no-words-message"><span class="no-words-icon">🎯</span><p>No hay palabras incorrectas</p></div>';
    
    overlay.innerHTML = `
        <div class="modal-container incorrect-modal">
            <div class="modal-header">
                <div class="modal-title-row">
                    <h2 class="modal-title">Palabras Incorrectas</h2>
                </div>
                <div class="modal-stats">${incorrectWords.length} ${incorrectWords.length === 1 ? 'palabra' : 'palabras'}</div>
            </div>
            
            <div class="modal-content">
                <div class="words-container">
                    ${wordsHtml}
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-close-btn incorrect-btn" onclick="document.getElementById('incorrect-words-overlay').remove()">
                    <span>Cerrar</span>
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Cerrar modal al hacer clic en el fondo
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            overlay.remove();
        }
    });
}

// Variables para rastrear palabras correctas e incorrectas
let correctWords = [];
let incorrectWords = [];

// Mapeo de países a códigos de bandera
const countryFlags = {
    'España': 'es',
    'Marruecos': 'ma', 
    'México': 'mx',
    'Argentina': 'ar',
    'Francia': 'fr',
    'Italia': 'it',
    'Alemania': 'de',
    'Brasil': 'br',
    'Chile': 'cl',
    'Peru': 'pe',
    'Colombia': 'co',
    'Portugal': 'pt',
    'Grecia': 'gr',
    'Turquía': 'tr',
    'Japón': 'jp',
    'China': 'cn',
    'India': 'in',
    'Rusia': 'ru',
    'Canadá': 'ca',
    'Australia': 'au'
};

// Variable global para el overlay de bandera
let currentFlagOverlay = null;

// Función para mostrar la bandera del país
function showCountryFlag(countryName) {
    // Cerrar overlay anterior si existe
    if (currentFlagOverlay) {
        currentFlagOverlay.remove();
        currentFlagOverlay = null;
    }
    
    const flagCode = countryFlags[countryName];
    if (!flagCode) {
        console.log(`No se encontró código de bandera para: ${countryName}`);
        return;
    }
    
    const flagUrl = `https://flagcdn.com/w640/${flagCode}.png`;
    
    const overlay = document.createElement('div');
    overlay.id = 'flag-modal-overlay';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 15000;
        opacity: 0;
        animation: fadeInOverlay 0.3s ease-out forwards;
    `;
    
    // Guardar referencia global
    currentFlagOverlay = overlay;
    
    overlay.innerHTML = `
        <div class="flag-card-container">
            <div class="flag-controls-floating">
                <button class="flag-control-btn fullscreen-btn" title="Pantalla completa">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </button>
                <button class="flag-control-btn restore-btn" title="Restituir" style="display: none;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
                <button class="flag-control-btn close-btn" title="Cerrar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="flag-card-body-full">
                <img id="flag-image" src="${flagUrl}" alt="Bandera de ${countryName}" class="flag-display" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzZiNzI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+SW1hZ2VuIG5vIGRpc3BvbmlibGU8L3RleHQ+PC9zdmc+'" />
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Agregar event listeners después de crear el HTML
    const fullscreenBtn = overlay.querySelector('.fullscreen-btn');
    const restoreBtn = overlay.querySelector('.restore-btn');
    const closeBtn = overlay.querySelector('.close-btn');
    
    if (fullscreenBtn) {
        fullscreenBtn.addEventListener('click', toggleFullscreen);
    }
    
    if (restoreBtn) {
        restoreBtn.addEventListener('click', exitFullscreen);
    }
    
    if (closeBtn) {
        closeBtn.addEventListener('click', closeFlagModal);
    }
    
    // Cerrar modal al hacer clic en el fondo
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            closeFlagModal();
        }
    });
}

// Funciones para pantalla completa
function toggleFullscreen() {
    if (!currentFlagOverlay) return;
    
    const flagContainer = currentFlagOverlay.querySelector('.flag-card-container');
    const fullscreenBtn = currentFlagOverlay.querySelector('.fullscreen-btn');
    const restoreBtn = currentFlagOverlay.querySelector('.restore-btn');
    
    if (!flagContainer || !fullscreenBtn || !restoreBtn) return;
    
    // Añadir clase para pantalla completa
    flagContainer.classList.add('fullscreen-mode');
    
    // Cambiar visibilidad de botones
    fullscreenBtn.style.display = 'none';
    restoreBtn.style.display = 'flex';
    
    // Aplicar estilos de pantalla completa al contenedor
    flagContainer.style.cssText = `
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        max-height: none !important;
        z-index: 20000 !important;
        border-radius: 0 !important;
        border: none !important;
        background: linear-gradient(to right, #1f3658, #3558e3) !important;
        display: flex !important;
        flex-direction: column !important;
        overflow: hidden !important;
        animation: expandToFullscreen 0.3s ease-out !important;
    `;
    
    // Ocultar el overlay de fondo
    currentFlagOverlay.style.background = 'transparent';
}

function exitFullscreen() {
    if (!currentFlagOverlay) return;
    
    const flagContainer = currentFlagOverlay.querySelector('.flag-card-container');
    const fullscreenBtn = currentFlagOverlay.querySelector('.fullscreen-btn');
    const restoreBtn = currentFlagOverlay.querySelector('.restore-btn');
    
    if (!flagContainer || !fullscreenBtn || !restoreBtn) return;
    
    // Remover clase de pantalla completa
    flagContainer.classList.remove('fullscreen-mode');
    
    // Cambiar visibilidad de botones
    fullscreenBtn.style.display = 'flex';
    restoreBtn.style.display = 'none';
    
    // Restaurar estilos originales del contenedor
    flagContainer.style.cssText = `
        width: 100%;
        height: 500px;
        max-height: 500px;
        max-width: 400px;
        background: linear-gradient(to right, #1f3658, #3558e3);
        border-radius: 25px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        border: 3px solid #aab0b4;
        overflow: hidden;
        position: relative;
        animation: slideInModal 0.4s ease-out;
        display: flex;
        flex-direction: column;
    `;
    
    // Restaurar el overlay de fondo
    currentFlagOverlay.style.background = 'rgba(0, 0, 0, 0.9)';
}

// Función para cerrar el modal de bandera
function closeFlagModal() {
    if (currentFlagOverlay) {
        currentFlagOverlay.remove();
        currentFlagOverlay = null;
    }
}




const baseUrl = 'https://fawzinoo.github.io/audios/';
const audioFiles = [
    'espana.mp3', 'marruecos.mp3', 'mexico.mp3', 'argentina.mp3', 'colombia.mp3',
    'peru.mp3', 'chile.mp3', 'venezuela.mp3', 'ecuador.mp3', 'bolivia.mp3',
    'paraguay.mp3', 'uruguay.mp3', 'guatemala.mp3', 'cuba.mp3', 'republica-dominicana.mp3',
    'Honduras.mp3', 'Nicaragua.mp3', 'costa-rica.mp3', 'panama.mp3', 'el-salvador.mp3',
    'guinea-ecuatorial.mp3', 'Estados-unidos.mp3', 'canada.mp3', 'brazil.mp3', 'francia.mp3',
    'alemania.mp3', 'holanda.mp3', 'belgica.mp3', 'dinamarca.mp3', 'italia.mp3',
    'reino-unido.mp3', 'rusia.mp3', 'china.mp3', 'japon.mp3', 'corea-del-sur.mp3',
    'india.mp3', 'australia.mp3', 'sudafrica.mp3', 'egipto.mp3', 'nigeria.mp3',
    'turquia.mp3', 'arabia-saudi.mp3', 'iran.mp3'
];

const audios = audioFiles.map(file => {
    const audio = new Audio();
    audio.preload = 'none';
    audio.src = baseUrl + file;
    return audio;
});

const flashcards = Array.from(document.querySelectorAll('.flashcard'));

function shuffleCards() {
    stopAllAudios();
document.querySelectorAll('.countdown-overlay, .mensaje-error, .listening-indicator').forEach(el => el.remove());


    // 1. Obtener los datos de todas las tarjetas.
const allCardData = flashcards.map((card, index) => ({
    frontImg: card.querySelector('.front img').src,
    frontAlt: card.querySelector('.front img').alt,
    // CORRECTO: usar el texto del reverso real
    backText: card.querySelector('.back').textContent.trim(),
    audio: audios[index]
}));

    // 2. Separar los datos de las tarjetas en pendientes y completadas.
    const remainingCardData = [];
    const completedCardData = [];
    allCardData.forEach((data, index) => {
        if (completedCards.has(index)) {
            completedCardData.push(data);
        } else {
            remainingCardData.push(data);
        }
    });

    // 3. Barajar solo las tarjetas pendientes.
    for (let i = remainingCardData.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [remainingCardData[i], remainingCardData[j]] = [remainingCardData[j], remainingCardData[i]];
    }

    // 4. Crear el nuevo mazo: pendientes barajadas primero, luego las completadas.
    const newCardOrder = [...remainingCardData, ...completedCardData];

    // 5. Actualizar el DOM y los audios según el nuevo orden.
flashcards.forEach((card, index) => {
    const data = newCardOrder[index];
    card.classList.remove('is-visible', 'flipped');
    card.querySelector('.front img').src = data.frontImg;
    card.querySelector('.front img').alt = data.frontAlt;
    // Restaurar el texto original del reverso por si había cambiado a "Incorrecto"
    const back = card.querySelector('.back');
// Elimina cualquier contador de intentos antes de restaurar el texto
back.querySelectorAll('.intentos-back').forEach(el => el.remove());
back.innerHTML = data.backText;
    // --- ACTUALIZA EL data-answer TAMBIÉN ---
    card.dataset.answer = data.backText;
    audios[index] = data.audio;
});

    // 6. Actualizar el estado para reflejar el nuevo orden.
    setTimeout(() => {
        // Las tarjetas completadas ahora están al final del mazo.
        // Sus nuevos índices van desde `remainingCardData.length` hasta el final.
        const newCompletedCards = new Set();
        for (let i = 0; i < completedCardData.length; i++) {
            newCompletedCards.add(remainingCardData.length + i);
        }
        
        completedCards = newCompletedCards; // Reemplazar el set antiguo por el nuevo.
        currentCardIndex = 0; // Empezar desde la primera tarjeta pendiente.
        
        showCard(currentCardIndex);
        updateCounters(); // Actualizar los contadores en la UI sin reiniciarlos.
    }, 10);
    voiceAttempts = 0;
canFlipBack = true;
}

function getCountryText(backElement) {
    // Clonamos el nodo para no modificar el original
    const clone = backElement.cloneNode(true);
    // Buscamos y eliminamos el contador de intentos si existe
    const attemptsDiv = clone.querySelector('.intentos-back');
    if (attemptsDiv) {
        attemptsDiv.remove();
    }
    // Devolvemos el texto limpio
    return clone.textContent.trim();
}

flashcards.forEach((card) => {
    // Guardar la respuesta correcta original en un atributo data-answer SOLO una vez
    if (!card.dataset.answer) {
        const back = card.querySelector('.back');
        card.dataset.answer = back.textContent.trim();
    }

    card.addEventListener('click', () => {
        if (!canFlip) {
            // Opcional: Agregar feedback visual cuando no se puede voltear
            card.style.transform = 'scale(0.98)';
            setTimeout(() => {
                card.style.transform = '';
            }, 150);
            return; // No permitir voltear si canFlip es false
        }
        
        vibrar(60); 
        const backElement = card.querySelector('.back');
if (card.classList.contains('flipped')) {
    card.classList.remove('flipped');
    stopAllAudios();
    // Limpia cualquier contador de intentos al volver a front
    backElement.querySelectorAll('.intentos-back').forEach(el => el.remove());
            setBackAttempts(backElement, 2 - voiceAttempts);
            // NO detengas ni reinicies el reconocimiento de voz aquí
        } else {
            // Volteo de front a back: solo si quedan intentos
if (voiceAttempts < 2) {
    card.classList.add('flipped');
    backElement.classList.add('hidden-text');
    setBackAttempts(backElement, 2 - voiceAttempts);
    const correctWord = card.dataset.answer;
    showListeningIndicator(backElement, "Grabando...");
    if (!isRecording) {
        startVoiceRecognition(correctWord, backElement);
    }
} else {
    canFlip = false; // Deshabilitar volteo cuando se agotan intentos
    incorrectCount++;
    voiceAttempts = 0;
    backElement.innerHTML = '';
    // NO LLAMES a setBackAttempts aquí
    backElement.classList.remove('hidden-text');
    setTimeout(() => {
        goToNextCard();
    }, 1500);
}
        }
    });
});
window.addEventListener('DOMContentLoaded', () => {
    showCard(currentCardIndex);
    updateCounters();
    if (audios[0]) {
        audios[0].load();
    }
});

function updateCardCounter() {
    const pillFaltan = document.querySelector('.pill-faltan');
    const totalCardsElem = document.getElementById('total-cards');
    const prevValue = Number(pillFaltan.getAttribute('data-prev') || 0);

    const remaining = flashcards.length - completedCards.size;
    totalCardsElem.textContent = remaining;

    if (remaining !== prevValue) {
        pillFaltan.classList.remove('glow-faltan');
        void pillFaltan.offsetWidth; // Reinicia animación
        pillFaltan.classList.add('glow-faltan');
    }
    pillFaltan.setAttribute('data-prev', remaining);
}

window.addEventListener('load', () => {
    document.getElementById('soundResetButton').play().catch(e => console.log(e));
});

function stopAllAudios() {
    audios.forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
    });
}

document.getElementById('reset-button').addEventListener('click', () => {
    vibrar(80);
    const soundResetButton = document.getElementById('soundResetButton');
    soundResetButton.play().catch(e => console.log(e));
    setTimeout(() => location.reload(), 500);
});


function setBackAttempts(backElement, attemptsLeft, mensajeExtra = "") {
    // Elimina TODOS los contadores de intentos antes de crear uno nuevo
    backElement.querySelectorAll('.intentos-back').forEach(el => el.remove());

    // Ya no mostramos ningún contador visual de intentos.
    // Si quieres mostrar un mensaje extra, puedes hacerlo aquí:
    if (mensajeExtra) {
        const extraDiv = document.createElement('div');
        extraDiv.className = 'mensaje-extra';
        extraDiv.style.marginTop = '10px';
        extraDiv.innerHTML = mensajeExtra;
        backElement.prepend(extraDiv);
    }
}


    </script>
    
    
</body>
</html>
