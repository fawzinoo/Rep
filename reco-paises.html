<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Países del mundo</title>
    <style>
        /* Estilos de la barra superior */
        .top-status-bar {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto 5px auto;
            gap: 2px;
            position: relative;
            z-index: 10;
        }

        .pill {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 1.0em;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            background: #fff;
            min-width: 60px;
            justify-content: center;
            letter-spacing: 0.3px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .back-arrow {
            background: #fff;
            color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            gap: 8px;
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-arrow:hover {
            background-color: #f5f5f5;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .back-arrow i {
            color: #333;
        }        .pill-faltan {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(255,107,53,0.15);
            gap: 8px;
            border: none;
        }

        .pill-correctas {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(40, 167, 69, 0.15);
            gap: 8px;
            border: none;
        }

        .pill-incorrectas {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(220, 53, 69, 0.15);
            gap: 8px;
            border: none;
        }

        .pill-progreso {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: #fff;
            box-shadow: 0 2px 6px rgba(78,205,196,0.15);
            font-weight: 600;
            font-size: 1.0em;
            min-width: 60px;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
        }

        .pill-progreso:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(78,205,196,0.2);
        }

        /* Estilos básicos */
        body, html {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #505255, #00020a);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        #flashcard-container-wrapper {
            position: relative;
            width: calc(100% - 20px);
            max-width: 600px;
        }
        #flashcard-container {
            width: 100%;
            height: 500px;
            max-height: 500px;
            perspective: 1000px; /* Para el efecto 3D */
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
            background: linear-gradient(to right, #1f3658, #3558e3);
            border: 3px solid #aab0b4;
            margin: 0;
        }
        .flashcard, .results-card {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0.2, 0.2, 1);
            border-radius: 15px;
            cursor: pointer;
            display: none;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .flashcard.is-visible { display: flex; }
        
        /* Parte frontal y trasera de la tarjeta */
        .front, .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Oculta la cara trasera al girar */
            border-radius: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
    
        .card-back {
            transform: rotateY(180deg); /* Gira la parte trasera */
        }
    
        /* Estilo de la parte frontal */
        .front img, .back img { width: 100%; height: 100%; }
    
        /* Estilo de la parte trasera */
        .back {
    width: 100%;
    background: linear-gradient(to bottom, rgba(73, 115, 189, 0.95), rgba(14, 40, 92, 0.9)); /* Fondo azul oscuro */
    color: #ffffff; /* Color del texto */
    transform: rotateY(180deg); /* Rotación para el efecto */
    padding: 20px; /* Margen interno */
    text-align: center; /* Centrado horizontal */
    font-size: 3rem; /* Tamaño del texto */
    font-family: 'Playfair Display', serif; /* Fuente elegante */
    border-radius: 10px; /* Bordes redondeados */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Sombra más pronunciada */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); /* Sombra del texto más fuerte */
    display: flex; /* Flexbox para el centrado */
    justify-content: center; /* Centrar horizontalmente */
    align-items: center; /* Centrar verticalmente */
    flex-direction: column; /* Asegura que el texto fluya en columnas */
    height: 100%; /* Usa toda la altura disponible */
    max-width: 100%; /* Limita el ancho máximo */
    margin: 0 auto; /* Centra dentro del contenedor */
    line-height: 1.4; /* Espaciado entre líneas */
}

        /* Ocultar texto cuando está en modo escucha */
        .back.hidden-text {
            color: transparent;
            text-shadow: none;
        }

        /* Indicador de escucha de voz */
        .listening-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 1.5rem;
            text-align: center;
            animation: pulse 1s infinite;
            z-index: 10;
        }

        @keyframes pulse {
            0% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
        }

        /* Contador moderno y elegante */
        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 25px;
        }

        .countdown-number {
            font-size: 8rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            animation: countdownPulse 1s ease-in-out;
            z-index: 1001;
        }

        @keyframes countdownPulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .countdown-circle {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: countdownRotate 1s linear;
        }

        @keyframes countdownRotate {
            0% { transform: rotate(0deg) scale(0.8); border-color: rgba(255, 255, 255, 0.3); }
            50% { transform: rotate(180deg) scale(1.1); border-color: rgba(255, 255, 255, 0.8); }
            100% { transform: rotate(360deg) scale(1); border-color: rgba(255, 255, 255, 0.5); }
        }

.back::before, .back::after {
    content: '';
    position: absolute;
    width: 150px; /* Ajusta el tamaño de la forma */
    height: 150px; /* Ajusta el tamaño de la forma */
    background: rgba(255, 255, 255, 0.3); /* Círculos más claros y visibles */
    border-radius: 50%; /* Forma circular */
    z-index: 0; /* Coloca detrás del texto */
}

.back::before {
    top: -30px; /* Ajusta la posición */
    left: -30px; /* Ajusta la posición */
}

.back::after {
    bottom: -30px; /* Ajusta la posición */
    right: -30px; /* Ajusta la posición */
}

    
        /* El efecto de voltear */
        .flashcard.flipped {
            transform: rotateY(180deg); /* Al hacer clic, se voltea la tarjeta */
        }
    
/* Contenedor de botones */
.button-container {
    width: 100%;
    max-width: 370px;
    display: flex;
    justify-content: space-evenly; /* Espacio uniforme entre todos los botones */
    align-items: center;
    padding: 10px 0px;
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    margin-top: 10px;
}



/* Botones individuales */
.button {
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 50px;
    background-color: #3498db;
    color: #fff;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}
     
        .button:hover { transform: translateY(-3px); }





.overlay-text {
    position: absolute;
    z-index: 1; /* Colocar por encima del contenido */
    color: white; /* Color del texto */
    font-size: 2rem; /* Tamaño del texto */
    font-weight: bold; /* Texto en negrita */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra del texto */
    text-align: left; /* Alineación a la izquierda */
    pointer-events: none; /* No interferir con los clics */
    margin: 5%; /* Margen relativo */
    line-height: 1.5; /* Espaciado entre líneas */
    top: 40%; /* Posición específica desde arriba */
    left: 0%; /* Posición específica desde la izquierda */
}

/* Estilos para .overlay-text1 */
.overlay-text1 {
    position: absolute;
    top: 5px;
    z-index: 1;
    color: rgb(185, 232, 203); /* Color específico */
    font-size: 2rem; /* Tamaño del texto */
    font-weight: bold; /* Texto en negrita */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra del texto */
    text-align: center; /* Centrado */
    pointer-events: none; /* No interferir con clics */
    display: inline-block; /* Comportamiento inline */
    animation: pulse 1.5s infinite; /* Animación pulsante */
}

/* Estilos para .overlay-text2 */
.overlay-text2 {
    position: absolute;
    z-index: 1;
    color: white; /* Color del texto */
    font-size: 2rem; /* Tamaño del texto */
    font-weight: bold; /* Negrita */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra del texto */
    text-align: left; /* Alineación a la izquierda */
    pointer-events: none; /* No interferir con clics */
    margin: 30px; /* Márgenes específicos */
    top: 40%; /* Posición específica desde arriba */
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes moveLeftToRight {
  0% {
    transform: translateX(0); /* Posición inicial */
  }
  50% {
    transform: translateX(10px); /* Mueve hacia la derecha */
  }
  100% {
    transform: translateX(0); /* Vuelve a la posición original */
  }
}



.back-arrow {
    background: #fff;
    color: #333;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    gap: 8px;
    border: 1px solid rgba(0,0,0,0.05);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.back-arrow:hover {
    background-color: #f5f5f5;
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.back-arrow i {
    color: #333;
}

.intentos-back {
    position: absolute;
    top: 18px;
    left: 0;
    width: 100%;
    text-align: center;
    font-size: 0.9rem;
    font-weight: bold;
    color: #f0e49c;
    z-index: 2;
    pointer-events: none;
}

.pill-intentos {
    background: linear-gradient(135deg, #ebac6d 0%, #a88f07 100%);
    color: #fff;
    box-shadow: 0 2px 6px rgba(255, 78, 80, 0.15);
    border-radius: 20px;
    padding: 2px 2px;
    font-size: 0.9em;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    margin-bottom: 4px;
}
.pill-intentos i {
    font-size: 0.9em;
}


@keyframes intentosFlash {
  0% { box-shadow: 0 0 0 0 #fff700, 0 2px 6px rgba(255, 78, 80, 0.15); }
  50% { box-shadow: 0 0 16px 8px #fff700, 0 2px 6px rgba(255, 78, 80, 0.15); }
  100% { box-shadow: 0 0 0 0 #fff700, 0 2px 6px rgba(255, 78, 80, 0.15); }
}
.pill-intentos.flash {
  animation: intentosFlash 0.7s;
}

/* --- NUEVO EFECTO DE ADVERTENCIA --- */
@keyframes intentosWarningFlash {
  0% { box-shadow: 0 0 0 0 #ffae00, 0 2px 6px rgba(255, 120, 80, 0.15); }
  50% { box-shadow: 0 0 16px 8px #ffae00, 0 2px 6px rgba(255, 120, 80, 0.15); }
  100% { box-shadow: 0 0 0 0 #ffae00, 0 2px 6px rgba(255, 120, 80, 0.15); }
}
.pill-intentos.flash-warning {
  animation: intentosWarningFlash 0.7s;
}
.super-pulse-indicator {
    position: fixed !important; /* Usar fixed en lugar de absolute */
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    text-align: center;
    z-index: 999 !important; /* Z-index muy alto */
    width: 100%;
    pointer-events: none; /* Para que no interfiera con los clics */
}

.super-pulse-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 25px;
}

.pulse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    border: 3px solid rgba(255, 255, 255, 0.8);
}

.pulse-ring-1 {
    width: 60px;
    height: 60px;
    animation: superPulseRing 2s infinite ease-out;
    border-color: rgba(255, 215, 0, 0.9);
}

.pulse-ring-2 {
    width: 80px;
    height: 80px;
    animation: superPulseRing 2s infinite ease-out;
    animation-delay: 0.5s;
    border-color: rgba(0, 255, 127, 0.7);
}

.pulse-ring-3 {
    width: 100px;
    height: 100px;
    animation: superPulseRing 2s infinite ease-out;
    animation-delay: 1s;
    border-color: rgba(255, 69, 0, 0.6);
}

.pulse-ring-4 {
    width: 120px;
    height: 120px;
    animation: superPulseRing 2s infinite ease-out;
    animation-delay: 1.5s;
    border-color: rgba(138, 43, 226, 0.5);
}

@keyframes superPulseRing {
    0% {
        transform: translate(-50%, -50%) scale(0.3);
        opacity: 1;
        border-width: 4px;
    }
    50% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0.8;
        border-width: 2px;
    }
    100% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0;
        border-width: 1px;
    }
}

.pulse-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #f8fafc 0%, #e0e7ef 100%);
    background-size: 400% 400%;
    animation: centerGradient 3s ease infinite, centerBounce 1.5s ease-in-out infinite;
    border-radius: 50%;
    width: 70px;
    height: 70px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(120, 180, 255, 0.25);
}

@keyframes centerGradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes centerBounce {
    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    50% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
}

.mic-emoji {
    font-size: 2rem;
    margin-bottom: 0.5px;
    margin-top: 0;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    animation: micWiggle 2s ease-in-out infinite;
    display: flex;
    align-items: center;
    justify-content: center;
}

@keyframes micWiggle {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
}

.sound-waves {
    display: flex;
    gap: 6px;
    margin-top: 0;
    margin-bottom: 0;
    justify-content: center;
    align-items: center;
}

.wave-dot {
    width: 4px;
    height: 4px;
    background: #e0c605;
    border-radius: 50%;
    animation: waveUp 1s ease-in-out infinite;
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
}

.wave-dot:nth-child(1) { animation-delay: 0s; }
.wave-dot:nth-child(2) { animation-delay: 0.2s; }
.wave-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes waveUp {
    0%, 100% { transform: translateY(0px) scale(1); opacity: 0.7; }
    50% { transform: translateY(-8px) scale(1.3); opacity: 1; }
}

.floating-emojis {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.floating-emoji {
    position: absolute;
    font-size: 1.2rem;
    animation: floatAround 4s ease-in-out infinite;
    opacity: 0.8;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.e1 { 
    top: 10%; 
    left: 10%; 
    animation-delay: 0s;
    animation-duration: 3s;
}
.e2 { 
    top: 20%; 
    right: 10%; 
    animation-delay: 0.5s;
    animation-duration: 3.5s;
}
.e3 {
    bottom: 10%;
    left: 10%;
    animation-delay: 1s;
    animation-duration: 4s;
    animation-name: floatAroundE3 !important;
}
.e4 { 
    bottom: 10%; 
    right: 15%; 
    animation-delay: 1.5s;
    animation-duration: 3.2s;
}
.e5 { 
    top: 50%; 
    left: -10%; 
    animation-delay: 2s;
    animation-duration: 3.8s;
}
.e6 { 
    top: 50%; 
    right: -10%; 
    animation-delay: 2.5s;
    animation-duration: 3.3s;
}

@keyframes floatAround {
    0%, 100% { 
        transform: translateY(0px) translateX(0px) rotate(0deg) scale(1); 
        opacity: 0.6;
    }
    25% { 
        transform: translateY(-15px) translateX(10px) rotate(90deg) scale(1.2); 
        opacity: 1;
    }
    50% { 
        transform: translateY(-10px) translateX(-5px) rotate(180deg) scale(0.9); 
        opacity: 0.8;
    }
    75% { 
        transform: translateY(-20px) translateX(15px) rotate(270deg) scale(1.1); 
        opacity: 1;
    }
}

@keyframes floatAroundE3 {
    0%, 100% {
        transform: translateY(0px) translateX(0px) rotate(0deg) scale(1);
        opacity: 0.7;
    }
    25% {
        transform: translateY(-1px) translateX(20px) rotate(20deg) scale(1.1);
        opacity: 1;
    }
    50% {
        transform: translateY(1px) translateX(15px) rotate(40deg) scale(1.05);
        opacity: 0.9;
    }
    75% {
        transform: translateY(0px) translateX(-10px) rotate(10deg) scale(1.1);
        opacity: 1;
    }
}

.super-pulse-text {
    color: #fff;
    font-size: 1.4rem;
    font-weight: bold;
    margin-bottom: 8px;
    text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 2px 4px rgba(0,0,0,0.5);
    animation: textGlow 2s ease-in-out infinite;
}

@keyframes textGlow {
    0%, 100% { 
        text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 2px 4px rgba(0,0,0,0.5);
        transform: scale(1);
    }
    50% { 
        text-shadow: 0 0 20px rgba(255,215,0,1), 0 0 30px rgba(255,215,0,0.8), 0 2px 4px rgba(0,0,0,0.5);
        transform: scale(1.02);
    }
}

.super-pulse-subtitle {
    color: #ffeb3b;
    font-size: 1.1rem;
    font-weight: 600;
    animation: subtitleSlide 4s ease-in-out infinite;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

@keyframes subtitleSlide {
    0%, 100% { 
        transform: translateX(0px); 
        opacity: 0.8; 
    }
    25% { 
        transform: translateX(5px); 
        opacity: 1; 
    }
    50% { 
        transform: translateX(-5px); 
        opacity: 0.9; 
    }
    75% { 
        transform: translateX(3px); 
        opacity: 1; 
    }
}

.back .super-pulse-indicator {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    z-index: 999 !important;
    width: auto !important;
    height: auto !important;
}

.super-pulse-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 25px;
    z-index: 1000;
}

/* Añade esto en tu sección de estilos */
@keyframes fadeInOut {
    0% { 
        opacity: 0;
        transform: scale(0.8) translateY(20px);
    }
    20% { 
        opacity: 1;
        transform: scale(1.1) translateY(0);
    }
    80% { 
        opacity: 1;
        transform: scale(1) translateY(0);
    }
    100% { 
        opacity: 0;
        transform: scale(0.8) translateY(-20px);
    }
}

.mensaje-error {
    position: absolute;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    font-size: 2rem;
    font-weight: bold;
    color: #ff6b6b;
    text-align: center;
    text-shadow: 0 0 10px rgba(255, 107, 107, 0.5),
                 0 0 20px rgba(255, 107, 107, 0.3),
                 0 0 30px rgba(255, 107, 107, 0.2);
    z-index: 1000;
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
    padding: 20px 40px;
    border-radius: 15px;
    backdrop-filter: blur(5px);
    border: 2px solid rgba(255, 107, 107, 0.2);
    animation: errorAppearNew 0.5s ease-out, errorDisappearNew 0.5s ease-in 1.5s forwards;
}

@keyframes errorAppearNew {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) perspective(500px) rotateX(-45deg);
        filter: brightness(2);
    }
    50% {
        transform: translate(-50%, -50%) perspective(500px) rotateX(5deg);
        filter: brightness(1.5);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) perspective(500px) rotateX(0);
        filter: brightness(1);
    }
}

@keyframes errorDisappearNew {
    0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        filter: brightness(1);
    }
    50% {
        transform: translate(-50%, -50%) scale(1.1);
        filter: brightness(1.2);
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
        filter: brightness(0);
    }
}

@keyframes respuestaGlow {
    0%, 100% { 
        text-shadow: 0 0 10px rgba(255,255,255,0.5),
                     0 0 20px rgba(255,255,255,0.3);
        transform: scale(1);
    }
    50% { 
        text-shadow: 0 0 15px rgba(255,255,255,0.8),
                     0 0 25px rgba(255,255,255,0.5),
                     0 0 35px rgba(255,255,255,0.3);
        transform: scale(1.05);
    }
}

        .button:hover { transform: translateY(-3px); }

        .button:disabled {
            background-color: #bdc3c7;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

.overlay-text {
    position: absolute;
    }

    @keyframes errorGlow {
  0% {
    box-shadow: 0 0 0 0 #ff3b3b, 0 2px 6px rgba(220,53,69,0.15);
    background: linear-gradient(135deg, #ff3b3b 0%, #c82333 100%);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 24px 12px #ff3b3b, 0 2px 16px rgba(220,53,69,0.25);
    background: linear-gradient(135deg, #ff3b3b 40%, #ffb3b3 100%);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 0 0 #ff3b3b, 0 2px 6px rgba(220,53,69,0.15);
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    transform: scale(1);
  }
}
.pill-incorrectas.glow-error {
  animation: errorGlow 0.7s;
}

@keyframes correctGlow {
  0% {
    box-shadow: 0 0 0 0 #00e676, 0 2px 6px rgba(40,167,69,0.15);
    background: linear-gradient(135deg, #00e676 0%, #218838 100%);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 24px 12px #00e676, 0 2px 16px rgba(40,167,69,0.25);
    background: linear-gradient(135deg, #00e676 40%, #b9f6ca 100%);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 0 0 #00e676, 0 2px 6px rgba(40,167,69,0.15);
    background: linear-gradient(135deg, #28a745 0%, #218838 100%);
    transform: scale(1);
  }
}
.pill-correctas.glow-correct {
  animation: correctGlow 0.7s;
}

@keyframes faltanGlow {
  0% {
    box-shadow: 0 0 0 0 #ffb347, 0 2px 6px rgba(255,107,53,0.15);
    background: linear-gradient(135deg, #ffb347 0%, #f7931e 100%);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 24px 12px #ffb347, 0 2px 16px rgba(255,107,53,0.25);
    background: linear-gradient(135deg, #ffb347 40%, #fff3cd 100%);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 0 0 #ffb347, 0 2px 6px rgba(255,107,53,0.15);
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    transform: scale(1);
  }
}
.pill-faltan.glow-faltan {
  animation: faltanGlow 0.7s;
}

.flashcard.transition-out {
    animation: cardSlideUp 0.5s forwards;
    z-index: 2;
}
.flashcard.transition-in {
    animation: cardSlideIn 0.5s forwards;
    z-index: 3;
}
@keyframes cardSlideUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-120%) scale(0.95); opacity: 0; }
}
@keyframes cardSlideIn {
    0% { transform: translateY(120%) scale(0.95); opacity: 0; }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

.countdown-inline {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 32px;
    animation: fadeInOut 4s;
    z-index: 10;
    position: relative;
}

.countdown-inline-circle {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4ecdc4 0%, #3558e3 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    box-shadow: 0 4px 16px rgba(78,205,196,0.18);
    border: 3px solid #fff;
}

.countdown-inline-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 2px 8px rgba(0,0,0,0.18);
    letter-spacing: 1px;
}

.countdown-inline-text {
    font-size: 1.1rem;
    color: #e0e7ef;
    margin-top: 2px;
    font-weight: 500;
    text-shadow: 0 1px 3px rgba(0,0,0,0.12);
}

.pulse-timer {
    animation: pulse 1s;
}

.flashcard.transition-out {
    animation: cardSlideLeft 0.5s forwards;
    z-index: 2;
}
.flashcard.transition-in {
    animation: cardSlideFromRight 0.5s forwards;
    z-index: 3;
}
@keyframes cardSlideLeft {
    0% { transform: translateX(0) scale(1); opacity: 1; }
    100% { transform: translateX(-120%) scale(0.95); opacity: 0; }
}
@keyframes cardSlideFromRight {
    0% { transform: translateX(120%) scale(0.95); opacity: 0; }
    100% { transform: translateX(0) scale(1); opacity: 1; }
}
    </style>
 
</head>
<body>

<div class="top-status-bar">

    <div class="pill back-arrow" onclick="goBack()">
        <span><i class="fas fa-arrow-left"></i></span>
    </div>
  <div class="pill pill-faltan">
    <span>T: <span id="total-cards"></span></span>
  </div>
    <div class="pill pill-correctas">
        <span><i class="fas fa-check"></i> <span id="correctas-count">0</span></span>
    </div>
    <div class="pill pill-incorrectas">
        <span><i class="fas fa-times"></i> <span id="incorrectas-count">0</span></span>
    </div>
</div>


    <div id="flashcard-container-wrapper">

<!--------------------------------------------------------------------->

<div id="flashcard-container">
       <div class="flashcard">
        <div class="front">                 
            <img src="https://flagcdn.com/w640/es.png" alt="España" loading="lazy">
        </div>
        <div class="back">España</div>
    </div>

    <!-- 2. Marruecos -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/ma.png" alt="Marruecos" loading="lazy">
        </div>
        <div class="back">Marruecos</div>
    </div>

    <!-- 3. México -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/mx.png" alt="México" loading="lazy">
        </div>
        <div class="back">México</div>
    </div>

    <!-- 4. Argentina -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/ar.png" alt="Argentina" loading="lazy">
        </div>
        <div class="back">Argentina</div>
    </div>

    <!-- 5. Colombia -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/co.png" alt="Colombia" loading="lazy">
        </div>
        <div class="back">Colombia</div>
    </div>

    <!-- 6. Perú -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/pe.png" alt="Perú" loading="lazy">
        </div>
        <div class="back">Perú</div>
    </div>

    <!-- 7. Chile -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/cl.png" alt="Chile" loading="lazy">
        </div>
        <div class="back">Chile</div>
    </div>

    <!-- 8. Venezuela -->
    <div class="flashcard">
        <div class="front">
            <img src="https://flagcdn.com/w640/ve.png" alt="Venezuela" loading="lazy">
        </div>
        <div class="back">Venezuela</div>
    </div>













        </div>
    </div>
    <audio id="soundResetButton" src="https://fawzinoo.github.io/audios/bellding-254774.mp3" preload="auto"></audio>
    <audio id="shuffleSound" src="https://fawzinoo.github.io/audios/naipe.mp3" preload="auto"></audio>

    <div class="button-container">
        <button class="button" id="reset-button" onclick="location.reload()">Reiniciar</button>
        <button class="button" id="shuffle-button" style="background-color: #9b59b6;">
            <i class="fas fa-random"></i> Mezclar
        </button>
    </div>
    

    <!-- Análisis de audio para verificación fonética -->
    <script src="https://unpkg.com/meyda/dist/web/meyda.min.js"></script>

    <!-- Agregar la librería de confeti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>

        

        function vibrar(ms = 80) {
    if (window.navigator && window.navigator.vibrate) {
        window.navigator.vibrate(ms);
    }
}

        function playErrorSound() {
    const errorAudio = new Audio('https://fawzinoo.github.io/audios/error.mp3');
    errorAudio.volume = 0.5;
    errorAudio.play().catch(() => {});
}

function goBack() {
    // Puedes personalizar esta función según lo que necesites
    if (document.referrer) {
        window.history.back(); // Regresa a la página anterior
    } else {
        // Si no hay página anterior, puedes redirigir a una página específica
        window.location.href = 'https://fawzinoo.github.io/Rep/Vocabulario.html'; // Cambia por la URL que necesites
    }
}

// --- NUEVO SISTEMA DE RECONOCIMIENTO DE VOZ (CLIENTE) ---

let mediaRecorder;
let audioChunks = [];
let isRecording = false;

// Sistema de tarjetas completadas
let completedCards = new Set();
let correctCount = 0;
let incorrectCount = 0;
let currentCardIndex = 0;
let voiceAttempts = 0; // Contador para los intentos de voz
let canFlipBack = true;

// Función para normalizar el texto: quitar acentos, puntuación y a minúsculas.
function normalizeText(text) {
    if (!text) return "";
    return text.trim();
}


function startVoiceRecognition(targetWord, backElement) {
    // Web Speech API (reconocimiento de voz del navegador)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        alert("Tu navegador no soporta reconocimiento de voz.");
        return;
    }
    const recognition = new SpeechRecognition();
    recognition.lang = 'es-ES';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    showListeningIndicator(backElement, "Grabando...");

    recognition.onresult = function(event) {
        const spokenWord = event.results[0][0].transcript;
        handleVoiceResult(spokenWord, targetWord, backElement);
    };

    recognition.onerror = function(event) {
        console.error("Error de reconocimiento:", event.error); // Muestra el error en la consola para depuración
        removeListeningIndicator();
        const card = backElement.closest('.flashcard');

        // Si el error es 'no-speech' o un problema de red, simplemente voltea la tarjeta
        // para que el usuario pueda volver a intentarlo haciendo clic de nuevo.
        if (event.error === "no-speech" || event.error === "network") {
            if (card && card.classList.contains('flipped')) {
                card.classList.remove('flipped');
            }
            return;
        }
        
        // Para otros errores, no hacemos nada drástico, solo paramos.
        // El alert() se ha eliminado para no interrumpir al usuario.
    };

    recognition.onend = function() {
        removeListeningIndicator();
    };

    recognition.start();
}
function handleVoiceResult(spokenWord, targetWord, backElement) {
    // Desactiva el botón de mezclar en el primer intento.
    document.getElementById('shuffle-button').disabled = true;

    if (!spokenWord || spokenWord.trim() === "") {
        removeListeningIndicator();
        setBackAttempts(backElement, 2 - voiceAttempts);
        backElement.classList.remove('hidden-text');
        setTimeout(() => {
            const card = backElement.closest('.flashcard');
            if (card && card.classList.contains('flipped')) {
                startVoiceRecognition(targetWord, backElement);
            }
        }, 2000);
        return;
    }
    const normalizedSpoken = spokenWord.trim();
    const normalizedTarget = targetWord.trim();
    const card = backElement.closest('.flashcard');

    if (palabrasSimilares(normalizedSpoken, normalizedTarget)) {
        correctCount++;
        
        canFlipBack = true; 
        playSuccessSound();

        // Mostrar contador y nombre del país debajo SOLO si acierta
        backElement.innerHTML = '';
        
        // Si se acierta al primer intento (voiceAttempts es 0), el contador se pone a 1.
        // Si se acierta al segundo (voiceAttempts es 1), el contador se pone a 0.
        setBackAttempts(backElement, 2 - (voiceAttempts + 1));

        voiceAttempts = 0; // Reiniciar para la siguiente tarjeta

        const nombrePais = document.createElement('div');
        nombrePais.style.marginTop = '40px';
        nombrePais.textContent = targetWord;
        backElement.appendChild(nombrePais);
        backElement.classList.remove('hidden-text');

        setTimeout(() => {
            if (audios[flashcards.indexOf(card)]) {
                stopAllAudios();
                audios[flashcards.indexOf(card)].play().catch(e => {});
                audios[flashcards.indexOf(card)].addEventListener('ended', () => showCountdown(card), { once: true });
            } else {
                showCountdown(card);
            }
        }, 1000);

    } else {
        voiceAttempts++;
        removeListeningIndicator();

        if (voiceAttempts < 2) {
            playErrorSound();
            // Primer intento fallido: solo muestra el mensaje de error elegante y centrado
            backElement.innerHTML = '';
            setBackAttempts(backElement, 2 - voiceAttempts); // Solo actualiza el contador de intentos
            
            const mensajeError = document.createElement('div');
            mensajeError.className = 'mensaje-error';
            mensajeError.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <div>Incorrecto</div>
            `;
            backElement.appendChild(mensajeError);
            backElement.classList.remove('hidden-text');

            // Eliminar el mensaje después de 2 segundos y reiniciar la grabación
            setTimeout(() => {
                mensajeError.remove(); // Elimina solo el mensaje de error
                if (card.classList.contains('flipped')) {
                    startVoiceRecognition(targetWord, backElement);
                }
            }, 2000);

        } else {
           
// Segundo (último) intento fallido
// Segundo (último) intento fallido
playErrorSound();
incorrectCount++;
voiceAttempts = 0;
canFlipBack = false;
removeListeningIndicator(backElement);

// 1. Limpia TODO el contenido del reverso (incluyendo contadores)
backElement.innerHTML = '';
backElement.classList.remove('hidden-text');

// 2. Muestra el mensaje de "Incorrecto"
const mensajeError = document.createElement('div');
mensajeError.className = 'mensaje-error';
mensajeError.innerHTML = `<i class="fas fa-exclamation-circle"></i>
    <div>Incorrecto</div>`;
backElement.appendChild(mensajeError);

// 3. Después de un delay, muestra SOLO la respuesta correcta (sin ningún contador)
setTimeout(() => {
    // Elimina cualquier contador de intentos y residuos
    backElement.querySelectorAll('.intentos-back').forEach(el => el.remove());
    backElement.innerHTML = ''; // LIMPIA TODO
    const respuestaCorrecta = document.createElement('div');
    respuestaCorrecta.textContent = targetWord;
    respuestaCorrecta.style.animation = 'respuestaGlow 1.5s infinite';
    backElement.appendChild(respuestaCorrecta);

    // Reproduce el audio si existe
    const audioIndex = flashcards.indexOf(card);
    if (audios[audioIndex]) {
        stopAllAudios();
        audios[audioIndex].play().catch(() => {});
    }
}, 2000);

// 4. Avanza a la siguiente tarjeta después de todo
setTimeout(() => {
    goToNextCard();
}, 5000);
        }
    }
    updateCounters();
}
// ...existing code...

function palabrasSimilares(a, b) {
    // Normalizar ambas cadenas para una comparación flexible:
    // 1. Eliminar espacios al principio y al final.
    // 2. Convertir todo a minúsculas.
    // 3. Eliminar puntos y comas que pueda añadir el reconocimiento de voz.
    const normA = a.trim().toLowerCase().replace(/[.,]/g, '');
    const normB = b.trim().toLowerCase().replace(/[.,]/g, '');
    
    return normA === normB;
}

function showListeningIndicator(backElement, text = '🎤<br>Habla ahora') {
    backElement.querySelectorAll('.listening-indicator').forEach(el => el.remove());
    
    const indicator = document.createElement('div');
    indicator.className = 'listening-indicator super-pulse-indicator';
   indicator.innerHTML = `
    <div class="super-pulse-container">
        <div class="pulse-ring pulse-ring-1"></div>
        <div class="pulse-ring pulse-ring-2"></div>
        <div class="pulse-ring pulse-ring-3"></div>
        <div class="pulse-ring pulse-ring-4"></div>
        <div class="pulse-center">
            <div class="mic-emoji">🎤</div>
            <div class="sound-waves">
                <span class="wave-dot"></span>
                <span class="wave-dot"></span>
                <span class="wave-dot"></span>
            </div>
        </div>
        <div class="floating-emojis">
            <span class="floating-emoji e1">🤖</span>
            <span class="floating-emoji e2">🦄</span>
            <span class="floating-emoji e3">🚀</span>
            <span class="floating-emoji e4">🧠</span>
            <span class="floating-emoji e5">💡</span>
            <span class="floating-emoji e6">🥳</span>
        </div>
    </div>
    <div class="super-pulse-text">¡Habla más fuerte y claro!</div>
   
`;
    backElement.appendChild(indicator);
}

// --- FIN DEL NUEVO SISTEMA DE VOZ ---

function removeListeningIndicator(backElement = null) {
    if (backElement) {
        backElement.querySelectorAll('.listening-indicator').forEach(el => el.remove());
    } else {
        document.querySelectorAll('.flashcard').forEach(card => {
            if (!card.classList.contains('flipped')) {
                const back = card.querySelector('.back');
                if (back) {
                    back.querySelectorAll('.listening-indicator').forEach(el => el.remove());
                }
            }
        });
    }
}
let isShuffling = false;

document.getElementById('shuffle-button').addEventListener('click', () => {
    if (isShuffling) return;
    isShuffling = true;
    vibrar(80); 
    document.getElementById('shuffleSound').play().catch(() => {});
    shuffleCards();
    setTimeout(() => { isShuffling = false; }, 800); // Evita abusos rápidos
});

function playSuccessSound() {
    const successAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUYrTp66hVFApGn+DyvmwhBSuBzvLZiTUJGmmm6eSnVBQKRZ/g8r5wIQUvgM/z1oUzByt2xvLaizsIHGjA+N2cQQ');
    successAudio.volume = 0.3;
    successAudio.play().catch(() => {});
}

function showCountdown(card) {
    // Elimina cualquier timer previo
    const back = card.querySelector('.back');
    back.querySelectorAll('.countdown-inline').forEach(el => el.remove());

    // Crea el contenedor del timer
    const timerDiv = document.createElement('div');
    timerDiv.className = 'countdown-inline';
    timerDiv.innerHTML = `
        <div class="countdown-inline-circle">
            <span class="countdown-inline-number">3</span>
        </div>
        <div class="countdown-inline-text">Siguiente tarjeta en...</div>
    `;
    back.appendChild(timerDiv);

    let count = 3;
    const numberSpan = timerDiv.querySelector('.countdown-inline-number');

    function updateCounter() {
        numberSpan.textContent = count;
        timerDiv.classList.remove('pulse-timer');
        void timerDiv.offsetWidth;
        timerDiv.classList.add('pulse-timer');
        if (count > 0) {
            count--;
            setTimeout(updateCounter, 1000);
        } else {
            timerDiv.remove();
            goToNextCard();
        }
    }
    updateCounter();
}

function goToNextCard() {
    // Reactivar el botón de mezclar al pasar a la siguiente tarjeta
    document.getElementById('shuffle-button').disabled = false;

    // REPRODUCIR SONIDO DE NAIPE al cambiar de tarjeta
    document.getElementById('shuffleSound').play().catch(() => {});

    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
    completedCards.add(currentCardIndex);
    updateCardCounter();
    
    canFlipBack = true; // Permitir voltear en la nueva tarjeta
    voiceAttempts = 0; // Reiniciar intentos para la nueva tarjeta

    let nextIndex = -1;
    for (let i = 0; i < flashcards.length; i++) {
        if (!completedCards.has(i)) {
            nextIndex = i;
            break;
        }
    }
    
    if (nextIndex !== -1) {
        currentCardIndex = nextIndex;
        showCard(currentCardIndex);
    } else {
        showCompletionMessage();
    }
}

function showCard(index) {
    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
flashcards.forEach(card => {
    card.classList.remove('is-visible', 'flipped');
    const back = card.querySelector('.back');
    // Elimina cualquier contador de intentos
    back.querySelectorAll('.intentos-back').forEach(el => el.remove());
    if (card.dataset.answer) {
        back.innerHTML = card.dataset.answer;
    }
});

    if (flashcards[index]) {
        flashcards[index].classList.add('is-visible');
    }
    updateCounters();
}

function updateProgress() {
    const flashcards = Array.from(document.querySelectorAll('.flashcard'));
    const totalCards = flashcards.length;
    const percentage = totalCards > 0 ? Math.round((completedCards.size / totalCards) * 100) : 0;
    const porcentajeDiv = document.getElementById('porcentaje-guardado');
    if (porcentajeDiv) {
        porcentajeDiv.textContent = `${percentage}%`;
    }
}

function updateCounters() {
    // Correctas
    const correctasPill = document.querySelector('.pill-correctas');
    const prevCorrect = Number(correctasPill.getAttribute('data-prev') || 0);
    document.getElementById('correctas-count').textContent = correctCount;

    if (correctCount > prevCorrect) {
        correctasPill.classList.remove('glow-correct');
        void correctasPill.offsetWidth; // Reinicia animación
        correctasPill.classList.add('glow-correct');
    }
    correctasPill.setAttribute('data-prev', correctCount);

    // Incorrectas
    const incorrectasPill = document.querySelector('.pill-incorrectas');
    const prevIncorrect = Number(incorrectasPill.getAttribute('data-prev') || 0);
    document.getElementById('incorrectas-count').textContent = incorrectCount;

    if (incorrectCount > prevIncorrect) {
        incorrectasPill.classList.remove('glow-error');
        void incorrectasPill.offsetWidth; // Reinicia animación
        incorrectasPill.classList.add('glow-error');
    }
    incorrectasPill.setAttribute('data-prev', incorrectCount);

    updateCardCounter();
}

function showCompletionMessage() {
    const container = document.getElementById('flashcard-container');
    container.innerHTML = `
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; color: white; text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 20px;">🎉</div>
            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 10px;">¡Felicidades!</div>
            <div style="font-size: 1.5rem;">Has completado todas las tarjetas</div>
        </div>
    `;
}

const baseUrl = 'https://fawzinoo.github.io/audios/';
const audioFiles = [
    'espana.mp3', 'marruecos.mp3', 'mexico.mp3', 'argentina.mp3', 'colombia.mp3',
    'peru.mp3', 'chile.mp3', 'venezuela.mp3', 'ecuador.mp3', 'bolivia.mp3',
    'paraguay.mp3', 'uruguay.mp3', 'guatemala.mp3', 'cuba.mp3', 'republica-dominicana.mp3',
    'Honduras.mp3', 'Nicaragua.mp3', 'costa-rica.mp3', 'panama.mp3', 'el-salvador.mp3',
    'guinea-ecuatorial.mp3', 'Estados-unidos.mp3', 'canada.mp3', 'brazil.mp3', 'francia.mp3',
    'alemania.mp3', 'holanda.mp3', 'belgica.mp3', 'dinamarca.mp3', 'italia.mp3',
    'reino-unido.mp3', 'rusia.mp3', 'china.mp3', 'japon.mp3', 'corea-del-sur.mp3',
    'india.mp3', 'australia.mp3', 'sudafrica.mp3', 'egipto.mp3', 'nigeria.mp3',
    'turquia.mp3', 'arabia-saudi.mp3', 'iran.mp3'
];

const audios = audioFiles.map(file => {
    const audio = new Audio();
    audio.preload = 'none';
    audio.src = baseUrl + file;
    return audio;
});

const flashcards = Array.from(document.querySelectorAll('.flashcard'));

function shuffleCards() {
    stopAllAudios();
document.querySelectorAll('.countdown-overlay, .mensaje-error, .listening-indicator').forEach(el => el.remove());


    // 1. Obtener los datos de todas las tarjetas.
const allCardData = flashcards.map((card, index) => ({
    frontImg: card.querySelector('.front img').src,
    frontAlt: card.querySelector('.front img').alt,
    // CORRECTO: usar el texto del reverso real
    backText: card.querySelector('.back').textContent.trim(),
    audio: audios[index]
}));

    // 2. Separar los datos de las tarjetas en pendientes y completadas.
    const remainingCardData = [];
    const completedCardData = [];
    allCardData.forEach((data, index) => {
        if (completedCards.has(index)) {
            completedCardData.push(data);
        } else {
            remainingCardData.push(data);
        }
    });

    // 3. Barajar solo las tarjetas pendientes.
    for (let i = remainingCardData.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [remainingCardData[i], remainingCardData[j]] = [remainingCardData[j], remainingCardData[i]];
    }

    // 4. Crear el nuevo mazo: pendientes barajadas primero, luego las completadas.
    const newCardOrder = [...remainingCardData, ...completedCardData];

    // 5. Actualizar el DOM y los audios según el nuevo orden.
flashcards.forEach((card, index) => {
    const data = newCardOrder[index];
    card.classList.remove('is-visible', 'flipped');
    card.querySelector('.front img').src = data.frontImg;
    card.querySelector('.front img').alt = data.frontAlt;
    // Restaurar el texto original del reverso por si había cambiado a "Incorrecto"
    const back = card.querySelector('.back');
// Elimina cualquier contador de intentos antes de restaurar el texto
back.querySelectorAll('.intentos-back').forEach(el => el.remove());
back.innerHTML = data.backText;
    // --- ACTUALIZA EL data-answer TAMBIÉN ---
    card.dataset.answer = data.backText;
    audios[index] = data.audio;
});

    // 6. Actualizar el estado para reflejar el nuevo orden.
    setTimeout(() => {
        // Las tarjetas completadas ahora están al final del mazo.
        // Sus nuevos índices van desde `remainingCardData.length` hasta el final.
        const newCompletedCards = new Set();
        for (let i = 0; i < completedCardData.length; i++) {
            newCompletedCards.add(remainingCardData.length + i);
        }
        
        completedCards = newCompletedCards; // Reemplazar el set antiguo por el nuevo.
        currentCardIndex = 0; // Empezar desde la primera tarjeta pendiente.
        
        showCard(currentCardIndex);
        updateCounters(); // Actualizar los contadores en la UI sin reiniciarlos.
    }, 10);
    voiceAttempts = 0;
canFlipBack = true;
}

function getCountryText(backElement) {
    // Clonamos el nodo para no modificar el original
    const clone = backElement.cloneNode(true);
    // Buscamos y eliminamos el contador de intentos si existe
    const attemptsDiv = clone.querySelector('.intentos-back');
    if (attemptsDiv) {
        attemptsDiv.remove();
    }
    // Devolvemos el texto limpio
    return clone.textContent.trim();
}

flashcards.forEach((card) => {
    // Guardar la respuesta correcta original en un atributo data-answer SOLO una vez
    if (!card.dataset.answer) {
        const back = card.querySelector('.back');
        card.dataset.answer = back.textContent.trim();
    }

    card.addEventListener('click', () => {
        vibrar(60); 
        const backElement = card.querySelector('.back');
if (card.classList.contains('flipped')) {
    card.classList.remove('flipped');
    stopAllAudios();
    // Limpia cualquier contador de intentos al volver a front
    backElement.querySelectorAll('.intentos-back').forEach(el => el.remove());
            setBackAttempts(backElement, 2 - voiceAttempts);
            // NO detengas ni reinicies el reconocimiento de voz aquí
        } else {
            // Volteo de front a back: solo si quedan intentos
if (voiceAttempts < 2) {
    card.classList.add('flipped');
    backElement.classList.add('hidden-text');
    setBackAttempts(backElement, 2 - voiceAttempts);
    const correctWord = card.dataset.answer;
    showListeningIndicator(backElement, "Grabando...");
    if (!isRecording) {
        startVoiceRecognition(correctWord, backElement);
    }
} else {
    incorrectCount++;
    voiceAttempts = 0;
    backElement.innerHTML = '';
    // NO LLAMES a setBackAttempts aquí
    backElement.classList.remove('hidden-text');
    setTimeout(() => {
        goToNextCard();
    }, 1500);
}
        }
    });
});
window.addEventListener('DOMContentLoaded', () => {
    showCard(currentCardIndex);
    updateCounters();
    if (audios[0]) {
        audios[0].load();
    }
});

function updateCardCounter() {
    const pillFaltan = document.querySelector('.pill-faltan');
    const totalCardsElem = document.getElementById('total-cards');
    const prevValue = Number(pillFaltan.getAttribute('data-prev') || 0);

    const remaining = flashcards.length - completedCards.size;
    totalCardsElem.textContent = remaining;

    if (remaining !== prevValue) {
        pillFaltan.classList.remove('glow-faltan');
        void pillFaltan.offsetWidth; // Reinicia animación
        pillFaltan.classList.add('glow-faltan');
    }
    pillFaltan.setAttribute('data-prev', remaining);
}

window.addEventListener('load', () => {
    document.getElementById('soundResetButton').play().catch(e => console.log(e));
});

function stopAllAudios() {
    audios.forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
    });
}

document.getElementById('reset-button').addEventListener('click', () => {
    vibrar(80);
    const soundResetButton = document.getElementById('soundResetButton');
    soundResetButton.play().catch(e => console.log(e));
    setTimeout(() => location.reload(), 500);
});


function setBackAttempts(backElement, attemptsLeft, mensajeExtra = "") {
    // Elimina TODOS los contadores de intentos antes de crear uno nuevo
    backElement.querySelectorAll('.intentos-back').forEach(el => el.remove());

    // Ya no mostramos ningún contador visual de intentos.
    // Si quieres mostrar un mensaje extra, puedes hacerlo aquí:
    if (mensajeExtra) {
        const extraDiv = document.createElement('div');
        extraDiv.className = 'mensaje-extra';
        extraDiv.style.marginTop = '10px';
        extraDiv.innerHTML = mensajeExtra;
        backElement.prepend(extraDiv);
    }
}


    </script>
    
    
</body>
</html>
