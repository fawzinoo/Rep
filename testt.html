<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.5">
    <title>Comunicación y Expresión</title>
    <style>
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            margin: 0;
            background: linear-gradient(120deg, #f0f4f8 0%, #e0e7ef 100%);
            min-height: 100vh;
            color: #222;
            padding: 20px;
        }
        
        .container {
            max-width: 700px;
            margin: 40px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(44,62,80,0.12);
            padding: 40px 32px 32px 32px;
        }
        
        h2 {
            font-size: 24px;
            color: #3867d6;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        h3 {
            font-size: 18px;
            color: #3867d6;
            margin-bottom: 15px;
        }
        
        .segment-options {
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .segment-btn {
            background: #e3e9ff;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            transition: all 0.2s ease;
        }
        
        .segment-btn:hover {
            background: #d0d8ff;
            transform: translateY(-2px);
        }
        
        .segment-btn.selected {
            background: #3867d6;
            color: white;
            font-weight: bold;
        }
        
        .response-display {
            min-height: 30px;
            background: #fff;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 10px 0;
            border: 1px dashed #ccc;
            transition: all 0.3s ease;
        }
        
        .edit-button {
            background: #3867d6;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 5px 0 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .edit-button:hover {
            background: #2c5ac9;
            transform: translateY(-2px);
            box-shadow: 0 3px 7px rgba(0,0,0,0.3);
        }
        
        .word-segment {
            cursor: pointer;
            padding: 3px 6px;
            margin: 0 2px;
            border-radius: 4px;
            background-color: #f0f8ff;
            transition: all 0.2s ease;
        }
        
        .word-segment:hover {
            background-color: #e3e9ff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .word-segment.editing {
            background-color: #d4edda !important;
            font-weight: bold;
            box-shadow: 0 1px 4px rgba(0,0,0,0.15);
        }
        
        .help-text {
            color: #666;
            font-style: italic;
            font-size: 12px;
            margin: 4px 0;
            display: none;
        }
        
        .dialog-situation {
            background: #f5f6fa;
            box-shadow: 0 2px 12px rgba(60,60,60,0.18);
            border-radius: 10px;
            padding: 18px 16px;
            margin-bottom: 25px;
        }
        
        .response-container {
            position: relative;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>11. Comunicación y Expresión <span style="font-weight:400;color:#888;">(10 puntos)</span></h2>
    
    <p style="margin-bottom:15px;">Construye las respuestas correctas seleccionando las opciones en orden. Haz clic en cada segmento para formar frases completas.</p>
    
    <div class="dialog-situation">
        <h3>Situación 1: Presentación</h3>
        <p style="margin-bottom:10px;"><strong>María:</strong> Hola, me llamo María. ¿Cómo te llamas?</p>
        
        <!-- Botones para la primera respuesta -->
        <div class="response-segment" data-dialog="1">
            <div class="segment-options" data-dialog="1" data-part="1">
                <button class="segment-btn" data-value="Me">Me</button>
                <button class="segment-btn" data-value="Te">Te</button>
                <button class="segment-btn" data-value="Se">Se</button>
            </div>
            <div class="segment-options" data-dialog="1" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="llamo">llamo</button>
                <button class="segment-btn" data-value="llamas">llamas</button>
                <button class="segment-btn" data-value="llaman">llaman</button>
            </div>
            <div class="segment-options" data-dialog="1" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="Pedro">Pedro</button>
                <button class="segment-btn" data-value="paula">paula</button>
                <button class="segment-btn" data-value="CarlOs">CarlOs</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response1">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-1">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-1" style="display:none;">
                <span id="edit-icon-1">✏️</span> <span id="edit-text-1">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com1" id="com1Input">
        
        <p style="margin-bottom:10px; margin-top: 20px;"><strong>María:</strong> Encantada. ¿De dónde eres?</p>
        
        <!-- Botones para la segunda respuesta -->
        <div class="response-segment" data-dialog="2">
            <div class="segment-options" data-dialog="2" data-part="1">
                <button class="segment-btn" data-value="Soy">Soy</button>
                <button class="segment-btn" data-value="Eres">Eres</button>
                <button class="segment-btn" data-value="Son">Son</button>
            </div>
            <div class="segment-options" data-dialog="2" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="de">de</button>
                <button class="segment-btn" data-value="en">en</button>
                <button class="segment-btn" data-value="desde">desde</button>
            </div>
            <div class="segment-options" data-dialog="2" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="España">España</button>
                <button class="segment-btn" data-value="colombia">colombia</button>
                <button class="segment-btn" data-value="perú">perú</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response2">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-2">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-2" style="display:none;">
                <span id="edit-icon-2">✏️</span> <span id="edit-text-2">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com2" id="com2Input">
    </div>
    
    <div class="dialog-situation">
        <h3>Situación 2: En la cafetería</h3>
        <p style="margin-bottom:10px;"><strong>Camarero:</strong> Buenos días, ¿qué desea tomar?</p>
        
        <!-- Botones para la tercera respuesta -->
        <div class="response-segment" data-dialog="3">
            <div class="segment-options" data-dialog="3" data-part="1">
                <button class="segment-btn" data-value="Quiero">Quiero</button>
                <button class="segment-btn" data-value="Tienes">Tienes</button>
                <button class="segment-btn" data-value="Puedo">Puedo</button>
            </div>
            <div class="segment-options" data-dialog="3" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="un">un</button>
                <button class="segment-btn" data-value="una">una</button>
                <button class="segment-btn" data-value="los">los</button>
            </div>
            <div class="segment-options" data-dialog="3" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="café con leche">café con leche</button>
                <button class="segment-btn" data-value="zumo de naranja">zumo de naranja</button>
                <button class="segment-btn" data-value="agua mineral">agua mineral</button>
            </div>
            <div class="segment-options" data-dialog="3" data-part="4" style="display:none;">
                <button class="segment-btn" data-value=", por favor">por favor</button>
                <button class="segment-btn" data-value=".">.</button>
                <button class="segment-btn" data-value="?">?</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response3">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-3">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-3" style="display:none;">
                <span id="edit-icon-3">✏️</span> <span id="edit-text-3">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com3" id="com3Input">
        
        <p style="margin-bottom:10px; margin-top: 20px;"><strong>Camarero:</strong> ¿Algo más?</p>
        
        <!-- Botones para la cuarta respuesta -->
        <div class="response-segment" data-dialog="4">
            <div class="segment-options" data-dialog="4" data-part="1">
                <button class="segment-btn" data-value="Sí">Sí</button>
                <button class="segment-btn" data-value="No">No</button>
                <button class="segment-btn" data-value="También">También</button>
            </div>
            <div class="segment-options" data-dialog="4" data-part="2" style="display:none;">
                <button class="segment-btn" data-value=", un">un</button>
                <button class="segment-btn" data-value=", gracias">gracias</button>
                <button class="segment-btn" data-value=", es todo">es todo</button>
            </div>
            <div class="segment-options" data-dialog="4" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="croissant">croissant</button>
                <button class="segment-btn" data-value="por ahora">por ahora</button>
                <button class="segment-btn" data-value=".">.</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response4">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-4">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-4" style="display:none;">
                <span id="edit-icon-4">✏️</span> <span id="edit-text-4">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com4" id="com4Input">
    </div>
    
    <div class="dialog-situation">
        <h3>Situación 3: Planes para el fin de semana</h3>
        <p style="margin-bottom:10px;"><strong>Amigo:</strong> ¿Qué vas a hacer este fin de semana?</p>
        
        <!-- Botones para la quinta respuesta -->
        <div class="response-segment" data-dialog="5">
            <div class="segment-options" data-dialog="5" data-part="1">
                <button class="segment-btn" data-value="Voy a">Voy a</button>
                <button class="segment-btn" data-value="Quiero">Quiero</button>
                <button class="segment-btn" data-value="Me gusta">Me gusta</button>
            </div>
            <div class="segment-options" data-dialog="5" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="ir al">ir al</button>
                <button class="segment-btn" data-value="visitar el">visitar el</button>
                <button class="segment-btn" data-value="quedarme en">quedarme en</button>
            </div>
            <div class="segment-options" data-dialog="5" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="cine con amigos">cine con amigos</button>
                <button class="segment-btn" data-value="museo de arte">museo de arte</button>
                <button class="segment-btn" data-value="casa y descansar">casa y descansar</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response5">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-5">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-5" style="display:none;">
                <span id="edit-icon-5">✏️</span> <span id="edit-text-5">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com5" id="com5Input">
        
        <p style="margin-bottom:10px; margin-top: 20px;"><strong>Amigo:</strong> ¡Qué interesante! ¿Te gustaría venir al cine conmigo el sábado?</p>
        
        <!-- Botones para la sexta respuesta -->
        <div class="response-segment" data-dialog="6">
            <div class="segment-options" data-dialog="6" data-part="1">
                <button class="segment-btn" data-value="Sí">Sí</button>
                <button class="segment-btn" data-value="No">No</button>
                <button class="segment-btn" data-value="Claro">Claro</button>
            </div>
            <div class="segment-options" data-dialog="6" data-part="2" style="display:none;">
                <button class="segment-btn" data-value=", me">me</button>
                <button class="segment-btn" data-value=", no me">no me</button>
                <button class="segment-btn" data-value=", te">te</button>
            </div>
            <div class="segment-options" data-dialog="6" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="gustaría mucho">gustaría mucho</button>
                <button class="segment-btn" data-value="gusta la idea">gusta la idea</button>
                <button class="segment-btn" data-value="encantaría ir contigo">encantaría ir contigo</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response6">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-6">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-6" style="display:none;">
                <span id="edit-icon-6">✏️</span> <span id="edit-text-6">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com6" id="com6Input">
    </div>
    
    <div class="dialog-situation">
        <h3>Situación 4: Describiendo un viaje</h3>
        <p style="margin-bottom:10px;"><strong>Profesor:</strong> Cuéntanos sobre tu último viaje.</p>
        
        <!-- Botones para la séptima respuesta -->
        <div class="response-segment" data-dialog="7">
            <div class="segment-options" data-dialog="7" data-part="1">
                <button class="segment-btn" data-value="El año pasado">El año pasado</button>
                <button class="segment-btn" data-value="La semana pasada">La semana pasada</button>
                <button class="segment-btn" data-value="Este verano">Este verano</button>
            </div>
            <div class="segment-options" data-dialog="7" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="viajé a">viajé a</button>
                <button class="segment-btn" data-value="estuve en">estuve en</button>
                <button class="segment-btn" data-value="fui a">fui a</button>
            </div>
            <div class="segment-options" data-dialog="7" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="Italia con mi familia">Italia con mi familia</button>
                <button class="segment-btn" data-value="la playa con amigos">la playa con amigos</button>
                <button class="segment-btn" data-value="Madrid por trabajo">Madrid por trabajo</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response7">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-7">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-7" style="display:none;">
                <span id="edit-icon-7">✏️</span> <span id="edit-text-7">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com7" id="com7Input">
        
        <p style="margin-bottom:10px; margin-top: 20px;"><strong>Profesor:</strong> ¿Qué te gustó más de ese lugar?</p>
        
        <!-- Botones para la octava respuesta -->
        <div class="response-segment" data-dialog="8">
            <div class="segment-options" data-dialog="8" data-part="1">
                <button class="segment-btn" data-value="Me gustó">Me gustó</button>
                <button class="segment-btn" data-value="Lo mejor fue">Lo mejor fue</button>
                <button class="segment-btn" data-value="Me encantó">Me encantó</button>
            </div>
            <div class="segment-options" data-dialog="8" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="la comida">la comida</button>
                <button class="segment-btn" data-value="el clima">el clima</button>
                <button class="segment-btn" data-value="el ambiente">el ambiente</button>
            </div>
            <div class="segment-options" data-dialog="8" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="y la gente">y la gente</button>
                <button class="segment-btn" data-value="y los museos">y los museos</button>
                <button class="segment-btn" data-value="y las playas">y las playas</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response8">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-8">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-8" style="display:none;">
                <span id="edit-icon-8">✏️</span> <span id="edit-text-8">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com8" id="com8Input">
    </div>
    
    <div class="dialog-situation">
        <h3>Situación 5: Expresando gustos</h3>
        <p style="margin-bottom:10px;"><strong>Amiga:</strong> ¿Qué tipo de música te gusta?</p>
        
        <!-- Botones para la novena respuesta -->
        <div class="response-segment" data-dialog="9">
            <div class="segment-options" data-dialog="9" data-part="1">
                <button class="segment-btn" data-value="Me gusta">Me gusta</button>
                <button class="segment-btn" data-value="Prefiero">Prefiero</button>
                <button class="segment-btn" data-value="Escucho">Escucho</button>
            </div>
            <div class="segment-options" data-dialog="9" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="la música">la música</button>
                <button class="segment-btn" data-value="el género">el género</button>
                <button class="segment-btn" data-value="el estilo">el estilo</button>
            </div>
            <div class="segment-options" data-dialog="9" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="pop y rock">pop y rock</button>
                <button class="segment-btn" data-value="clásica y jazz">clásica y jazz</button>
                <button class="segment-btn" data-value="latina y salsa">latina y salsa</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response9">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-9">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-9" style="display:none;">
                <span id="edit-icon-9">✏️</span> <span id="edit-text-9">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com9" id="com9Input">
        
        <p style="margin-bottom:10px; margin-top: 20px;"><strong>Amiga:</strong> Yo prefiero el rock. ¿Qué haces en tu tiempo libre?</p>
        
        <!-- Botones para la décima respuesta -->
        <div class="response-segment" data-dialog="10">
            <div class="segment-options" data-dialog="10" data-part="1">
                <button class="segment-btn" data-value="En mi tiempo libre">En mi tiempo libre</button>
                <button class="segment-btn" data-value="Normalmente">Normalmente</button>
                <button class="segment-btn" data-value="Cuando tengo tiempo">Cuando tengo tiempo</button>
            </div>
            <div class="segment-options" data-dialog="10" data-part="2" style="display:none;">
                <button class="segment-btn" data-value="me gusta">me gusta</button>
                <button class="segment-btn" data-value="suelo">suelo</button>
                <button class="segment-btn" data-value="prefiero">prefiero</button>
            </div>
            <div class="segment-options" data-dialog="10" data-part="3" style="display:none;">
                <button class="segment-btn" data-value="leer y ver series">leer y ver series</button>
                <button class="segment-btn" data-value="practicar deporte">practicar deporte</button>
                <button class="segment-btn" data-value="salir con amigos">salir con amigos</button>
            </div>
        </div>
        
        <div class="response-container">
            <p class="response-display" id="response10">Tu respuesta aparecerá aquí</p>
            <p class="help-text" id="help-text-10">Haz clic en cualquier palabra para editarla</p>
            <button class="edit-button" id="edit-btn-10" style="display:none;">
                <span id="edit-icon-10">✏️</span> <span id="edit-text-10">Editar respuesta</span>
            </button>
        </div>
        <input type="hidden" name="com10" id="com10Input">
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Objeto para almacenar las respuestas por diálogo y posición
        const dialogResponses = {};
        
        // Seleccionar todos los botones de segmento
        const segmentButtons = document.querySelectorAll('.segment-btn');
        
        // Para cada botón, añadir un evento de clic
        segmentButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Obtener el diálogo y la parte actual
                const dialogId = this.parentElement.getAttribute('data-dialog');
                const partId = this.parentElement.getAttribute('data-part');
                const selectedValue = this.getAttribute('data-value');
                
                // Actualizar la visualización de la respuesta
                updateResponseDisplay(dialogId, partId, selectedValue);
                
                // Ocultar el conjunto actual de botones
                this.parentElement.style.display = 'none';
                
                // Mostrar el siguiente conjunto de botones si existe
                const nextPart = parseInt(partId) + 1;
                const nextSegment = document.querySelector(`[data-dialog="${dialogId}"][data-part="${nextPart}"]`);
                if (nextSegment) {
                    nextSegment.style.display = 'flex';
                } else {
                    // Si no hay más partes, mostrar el botón de edición
                    const editButton = document.getElementById(`edit-btn-${dialogId}`);
                    if (editButton) {
                        editButton.style.display = 'flex';
                    }
                }
            });
        });
        
        // Función para actualizar la visualización de la respuesta
        function updateResponseDisplay(dialogId, partId, value) {
            const responseDisplay = document.getElementById(`response${dialogId}`);
            const hiddenInput = document.getElementById(`com${dialogId}Input`);
            
            // Si no existe un array para este diálogo, crearlo
            if (!dialogResponses[dialogId]) {
                dialogResponses[dialogId] = [];
            }
            
            // Actualizar la palabra en la posición correspondiente
            dialogResponses[dialogId][partId - 1] = value;
            
            // Si es la primera parte, reemplazar el texto predeterminado
            if (partId === '1') {
                responseDisplay.textContent = value;
            } else {
                // Añadir el nuevo valor con un espacio antes si es necesario
                const currentText = responseDisplay.textContent;
                const needsSpace = !currentText.endsWith(' ') && 
                                   !value.startsWith(' ') && 
                                   !value.startsWith(',') && 
                                   !value.startsWith('.') && 
                                   !value.startsWith('?');
                                   
                responseDisplay.textContent = currentText + (needsSpace ? ' ' : '') + value;
            }
            
            // Actualizar el valor del campo oculto
            hiddenInput.value = responseDisplay.textContent;
            
            // Aplicar un efecto de actualización
            responseDisplay.style.backgroundColor = '#f0f8ff';
            setTimeout(() => {
                responseDisplay.style.backgroundColor = '#fff';
            }, 300);
        }
        
        // Añadir botones de edición para cada respuesta
        for (let i = 1; i <= 10; i++) {
            const editButton = document.getElementById(`edit-btn-${i}`);
            const responseDisplay = document.getElementById(`response${i}`);
            const helpText = document.getElementById(`help-text-${i}`);
            
            if (editButton && responseDisplay) {
                editButton.addEventListener('click', function() {
                    // Si no estamos en modo edición
                    if (!responseDisplay.classList.contains('editing-mode')) {
                        // Activar modo edición
                        responseDisplay.classList.add('editing-mode');
                        
                        // Cambiar texto del botón
                        document.getElementById(`edit-icon-${i}`).textContent = '✓';
                        document.getElementById(`edit-text-${i}`).textContent = 'Finalizar edición';
                        this.style.backgroundColor = '#28a745';
                        
                        // Mostrar mensaje de ayuda
                        if (helpText) {
                            helpText.style.display = 'block';
                        }
                        
                        // Convertir texto en palabras clicables
                        if (responseDisplay.textContent !== 'Tu respuesta aparecerá aquí') {
                            const originalText = responseDisplay.textContent;
                            const words = originalText.split(/\s+/);
                            responseDisplay.innerHTML = '';
                            
                            words.forEach((word, index) => {
                                if (word.trim()) {
                                    const wordSpan = document.createElement('span');
                                    wordSpan.textContent = word;
                                    wordSpan.className = 'word-segment';
                                    wordSpan.dataset.dialogId = i;
                                    wordSpan.dataset.partId = (index + 1).toString();
                                    
                                    // Añadir evento de clic a cada palabra
                                    wordSpan.addEventListener('click', function() {
                                        // Quitar la marca de edición de otras palabras
                                        document.querySelectorAll('.word-segment').forEach(span => {
                                            span.classList.remove('editing');
                                        });
                                        
                                        // Marcar esta palabra como en edición
                                        this.classList.add('editing');
                                        
                                        // Mostrar opciones para esta parte específica
                                        showOptionsForWord(this.dataset.dialogId, this.dataset.partId);
                                    });
                                    
                                    responseDisplay.appendChild(wordSpan);
                                    
                                    // Añadir espacio después de cada palabra excepto la última
                                    if (index < words.length - 1) {
                                        responseDisplay.appendChild(document.createTextNode(' '));
                                    }
                                }
                            });
                        }
                    } else {
                        // Desactivar modo edición
                        responseDisplay.classList.remove('editing-mode');
                        
                        // Restaurar texto del botón
                        document.getElementById(`edit-icon-${i}`).textContent = '✏️';
                        document.getElementById(`edit-text-${i}`).textContent = 'Editar respuesta';
                        this.style.backgroundColor = '#3867d6';
                        
                        // Ocultar mensaje de ayuda
                        if (helpText) {
                            helpText.style.display = 'none';
                        }
                        
                        // Restaurar texto normal (sin spans)
                        const currentText = responseDisplay.textContent;
                        responseDisplay.innerHTML = '';
                        responseDisplay.textContent = currentText;
                        
                        // Ocultar opciones de selección
                        const options = document.querySelectorAll(`.segment-options[data-dialog="${i}"]`);
                        options.forEach(option => {
                            option.style.display = 'none';
                        });
                        
                        // Mostrar solo las opciones iniciales si no hay respuesta completa
                        if (responseDisplay.textContent === 'Tu respuesta aparecerá aquí') {
                            const initialOptions = document.querySelector(`.segment-options[data-dialog="${i}"][data-part="1"]`);
                            if (initialOptions) {
                                initialOptions.style.display = 'flex';
                            }
                        }
                    }
                });
            }
        }
        
        // Función para mostrar opciones específicas para una palabra
        function showOptionsForWord(dialogId, partId) {
            // Ocultar todas las opciones para este diálogo
            const allOptions = document.querySelectorAll(`.segment-options[data-dialog="${dialogId}"]`);
            allOptions.forEach(option => {
                option.style.display = 'none';
            });
            
            // Mostrar las opciones para esta parte específica
            const targetOptions = document.querySelector(`.segment-options[data-dialog="${dialogId}"][data-part="${partId}"]`);
            if (targetOptions) {
                // Mostrar las opciones
                targetOptions.style.display = 'flex';
                
                // Habilitar todos los botones y añadir un evento especial para el modo edición
                const buttons = targetOptions.querySelectorAll('.segment-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('selected');
                    
                    // Eliminar eventos anteriores para evitar duplicados
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    
                    // Añadir el nuevo evento para modo edición
                    newBtn.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        const editingWord = document.querySelector('.word-segment.editing');
                        
                        if (editingWord) {
                            // Reemplazar el contenido de la palabra editada
                            editingWord.textContent = value;
                            
                            // Quitar la marca de edición
                            editingWord.classList.remove('editing');
                            editingWord.style.backgroundColor = '#f0f8ff';
                            editingWord.style.fontWeight = 'normal';
                            editingWord.style.boxShadow = 'none';
                            
                            // Actualizar el campo oculto con la respuesta actualizada
                            const responseDisplay = document.getElementById(`response${dialogId}`);
                            const hiddenInput = document.getElementById(`com${dialogId}Input`);
                            
                            // Reconstruir el valor desde los spans
                            const spans = responseDisplay.querySelectorAll('.word-segment');
                            let newText = '';
                            spans.forEach((span, idx) => {
                                newText += span.textContent;
                                if (idx < spans.length - 1) {
                                    const nextSpan = spans[idx + 1];
                                    // Añadir espacio si es necesario
                                    if (!span.textContent.endsWith(' ') && 
                                        !nextSpan.textContent.startsWith(' ') && 
                                        !nextSpan.textContent.match(/^[,.?!;:]/)) {
                                        newText += ' ';
                                    }
                                }
                            });
                            
                            // Actualizar el campo oculto
                            hiddenInput.value = newText;
                            
                            // Ocultar opciones después de seleccionar
                            targetOptions.style.display = 'none';
                        } else {
                            // Comportamiento normal cuando no hay palabra en edición
                            updateResponseDisplay(dialogId, partId, value);
                        }
                    });
                });
            }
        }
        
        // Función para reiniciar un diálogo
        function resetDialog(dialogId) {
            // Ocultar todas las opciones
            const allOptions = document.querySelectorAll(`.segment-options[data-dialog="${dialogId}"]`);
            allOptions.forEach(option => {
                option.style.display = 'none';
            });
            
            // Mostrar solo las opciones iniciales
            const initialOptions = document.querySelector(`.segment-options[data-dialog="${dialogId}"][data-part="1"]`);
            if (initialOptions) {
                initialOptions.style.display = 'flex';
                
                // Habilitar todos los botones
                const buttons = initialOptions.querySelectorAll('.segment-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('selected');
                });
            }
            
            // Resetear el texto de respuesta
            const responseDisplay = document.getElementById(`response${dialogId}`);
            if (responseDisplay) {
                responseDisplay.textContent = 'Tu respuesta aparecerá aquí';
            }
            
            // Limpiar el campo oculto
            const hiddenInput = document.getElementById(`com${dialogId}Input`);
            if (hiddenInput) {
                hiddenInput.value = '';
            }
            
            // Limpiar la respuesta almacenada
            dialogResponses[dialogId] = [];
            
            // Ocultar el botón de edición
            const editButton = document.getElementById(`edit-btn-${dialogId}`);
            if (editButton) {
                editButton.style.display = 'none';
            }
        }
        
        // Añadir botones de reinicio para cada diálogo
        for (let i = 1; i <= 10; i++) {
            // Crear un botón de reinicio
            const resetButton = document.createElement('button');
            resetButton.className = 'reset-button';
            resetButton.innerHTML = '↺';
            resetButton.title = 'Reiniciar respuesta';
            resetButton.style.background = '#fff';
            resetButton.style.border = '1px solid #ccc';
            resetButton.style.borderRadius = '50%';
            resetButton.style.width = '30px';
            resetButton.style.height = '30px';
            resetButton.style.fontSize = '18px';
            resetButton.style.margin = '5px 0 15px 10px';
            resetButton.style.cursor = 'pointer';
            resetButton.style.transition = 'transform 0.3s ease';
            
            // Efecto hover
            resetButton.addEventListener('mouseover', function() {
                this.style.transform = 'rotate(30deg)';
            });
            
            resetButton.addEventListener('mouseout', function() {
                this.style.transform = 'rotate(0)';
            });
            
            // Añadir evento de clic
            resetButton.addEventListener('click', function() {
                resetDialog(i);
            });
            
            // Añadir el botón junto al botón de edición
            const editButton = document.getElementById(`edit-btn-${i}`);
            if (editButton && editButton.parentNode) {
                editButton.parentNode.appendChild(resetButton);
            }
        }
        
        // Mostrar solo las opciones iniciales para cada diálogo
        for (let i = 1; i <= 10; i++) {
            // Ocultar todas las opciones excepto la primera para cada diálogo
            const options = document.querySelectorAll(`.segment-options[data-dialog="${i}"]`);
            options.forEach(option => {
                if (option.getAttribute('data-part') !== '1') {
                    option.style.display = 'none';
                }
            });
        }
    });
</script>
</body>
</html>
