<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Reproductor de Video</title>
	<style>
		:root {
			color-scheme: light dark;
		}

        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(145deg, #f8f4ec 0%, #f2e8d5 100%);
            color: #0b1120;
            padding: 32px 20px;
            box-sizing: border-box;
        }

		.player-shell {
			--shell-pad-x: 32px;
			--shell-pad-y: 32px;
			width: min(92vw, 960px);
            --shell-pad-x: 0;
            --shell-pad-y: 0;
            padding: 0 !important;
            margin: 0 !important;
            background: transparent !important;
            box-shadow: none !important;
            backdrop-filter: none !important;
            border-radius: 0 !important;
			border-radius: 24px;
			background: rgba(10, 15, 24, 0.82);
			backdrop-filter: blur(14px);
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
			transition: padding 160ms ease, border-radius 160ms ease;
			position: relative;
		}

		h1 {
			margin: 0 0 24px;
			font-size: 1.6rem;
			font-weight: 600;
			letter-spacing: 0.04em;
		}

		video {
			width: 100%;
			display: block;
			border-radius: 18px;
			background: linear-gradient(135deg, #ffb347 0%, #ff8c42 100%);
			position: relative;
		}
		
		.video-background {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			pointer-events: none;
			z-index: 1;
			border-radius: 18px;
			box-sizing: border-box;
			opacity: 0;
			transition: opacity 0.3s ease;
			background: linear-gradient(135deg, #ffb347 0%, #ff8c42 100%);
		}
		
		.video-background.visible {
			opacity: 1;
		}
		
		.background-content {
			text-align: center;
			max-width: 600px;
			padding: 40px;
		}
		
		.background-level {
			font-size: 0.95rem;
			font-weight: 600;
			color: rgba(255, 255, 255, 0.95);
			margin-bottom: 16px;
			letter-spacing: 0.15em;
			text-transform: uppercase;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
		}
		
		.background-unit {
			font-size: 1.5rem;
			font-weight: 600;
			color: #ffffff;
			margin-bottom: 20px;
			line-height: 1.4;
			text-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
			letter-spacing: 0.02em;
		}
		
		.background-title {
			font-size: 3.5rem;
			font-weight: 700;
			color: #ffffff;
			line-height: 1.1;
			text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
			letter-spacing: -0.02em;
		}

	.controls {
		position: absolute;
		left: var(--shell-pad-x);
		right: var(--shell-pad-x);
		bottom: var(--shell-pad-y);
		padding: 18px 22px 2px 22px;
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 12px;
		background: linear-gradient(to top, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.3) 50%, transparent 100%);
		border-bottom-left-radius: 18px;
		border-bottom-right-radius: 18px;
		z-index: 2;
		padding-top: 60px;
	}		.controls button,
		.controls input[type="range"] {
			-webkit-appearance: none;
			appearance: none;
		}

		.controls button {
			width: 44px;
			height: 44px;
			border-radius: 12px;
			border: none;
			cursor: pointer;
			background: transparent;
			color: #f8fafc;
			font-size: 18px;
			display: grid;
			place-items: center;
			transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
		}

		.controls button:hover {
			background: transparent;
			box-shadow: none;
		}

		.controls button:active {
			transform: scale(0.96);
		}

		.controls button:active,
		.controls button:focus {
			background: transparent;
		}

		.controls button svg {
			width: 26px;
			height: 26px;
			fill: currentColor;
			display: none;
			filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
			stroke: currentColor;
			stroke-width: 0.5;
			stroke-linejoin: round;
			stroke-linecap: round;
		}

	#control-play[data-state="play"] .icon-play,
	#control-play[data-state="pause"] .icon-pause,
	#control-play[data-state="replay"] .icon-replay {
		display: block;
	}		#control-volume[data-state="high"] .icon-volume-high,
		#control-volume[data-state="mute"] .icon-volume-muted {
			display: block;
		}

		#control-fullscreen[data-state="enter"] .icon-enter,
		#control-fullscreen[data-state="exit"] .icon-exit {
			display: block;
		}

		.controls .progress {
			flex: 1 1 460px;
			min-width: 240px;
			display: flex;
			flex-direction: column;
			gap: 8px;
			align-items: flex-start;
		}

		.controls .progress input[type="range"] {
			flex: 1;
			width: 100%;
			height: 6px;
			background: none;
		}

		.controls .progress input[type="range"]::-webkit-slider-runnable-track {
			height: 6px;
			border-radius: 999px;
			background: linear-gradient(90deg, #38bdf8 var(--seek-filled, 0%), rgba(148, 163, 184, 0.4) var(--seek-filled, 0%));
		}

		.controls .progress input[type="range"]::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 14px;
			height: 14px;
			border-radius: 50%;
			background: #38bdf8;
			box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.22);
			margin-top: -4px;
		}

		.controls .progress input[type="range"]::-moz-range-track {
			height: 6px;
			border-radius: 999px;
			background: linear-gradient(90deg, #38bdf8 var(--seek-filled, 0%), rgba(148, 163, 184, 0.4) var(--seek-filled, 0%));
		}

		.controls .progress input[type="range"]::-moz-range-thumb {
			width: 14px;
			height: 14px;
			border-radius: 50%;
			border: none;
			background: #38bdf8;
			box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.22);
		}

		.controls .primary-controls {
			display: flex;
			flex-direction: row;
			align-items: center;
			gap: 12px;
			margin-right: auto;
			margin-right: auto;
		}

		.controls .primary-controls #control-play {
			order: 0;
		}

		.controls .primary-controls .volume {
			order: 1;
			flex: 0 0 auto;
		}

		.controls .primary-controls .timecode {
			order: 2;
		}

		.timecode {
			display: flex;
			align-items: center;
			height: 44px;
			font-variant-numeric: tabular-nums;
			font-size: 0.9rem;
			color: #f8fafc;
			margin-top: 0;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
			gap: 4px;
		}
		
		.skip-button {
			background: rgba(0, 0, 0, 0.4);
			border: none;
			padding: 8px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			width: 44px;
			height: 44px;
			color: #ffffff;
			transition: transform 0.15s ease, background 0.15s ease;
			border-radius: 4px;
             margin-bottom: 15px;
             margin-left: 8px;
             
		}
		
		.skip-button:hover {
			transform: scale(1.1);
			background: rgba(0, 0, 0, 0.6);
		}
		
		.skip-button .icon {
			width: 35px;
			height: 35px;
			display: block;
			fill: currentColor;
			filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
           
		}

		.controls .volume {
			position: relative;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-left: 0;
		}

		.controls .volume button {
			z-index: 2;
		}

		.volume.open #control-volume {
			background: transparent;
			color: #f8fafc;
			box-shadow: none;
		}

	.volume-slider {
		position: absolute;
		left: 50%;
		bottom: 100%;
		margin-bottom: 2px;
		transform: translateX(-50%);
		display: none;
		align-items: center;
		justify-content: center;
		padding: 4px 2px;
		border-radius: 10px;
		background: rgba(10, 15, 24, 0.92);
		box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);
		backdrop-filter: blur(12px);
		width: 12px;
		height: auto;
		min-height: 100px;
	}		.volume.open .volume-slider {
			display: flex;
		}

	.volume-slider input[type="range"] {
		-webkit-appearance: none;
		appearance: none;
		width: 90px;
		height: 6px;
		padding: 0;
		margin: 0;
		background: transparent;
		transform: rotate(-90deg);
		transform-origin: center;
		cursor: pointer;
	}		.volume-slider input[type="range"]::-webkit-slider-runnable-track {
			height: 6px;
			border-radius: 999px;
			background: linear-gradient(90deg, #38bdf8 var(--volume-filled, 100%), rgba(148, 163, 184, 0.35) var(--volume-filled, 100%));
		}

		.volume-slider input[type="range"]::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 0;
			height: 0;
			opacity: 0;
		}

		.volume-slider input[type="range"]::-moz-range-track {
			height: 6px;
			border-radius: 999px;
			background: linear-gradient(90deg, #38bdf8 var(--volume-filled, 100%), rgba(148, 163, 184, 0.35) var(--volume-filled, 100%));
		}

		.volume-slider input[type="range"]::-moz-range-thumb {
			width: 0;
			height: 0;
			border: none;
			opacity: 0;
		}

		.volume-slider input[type="range"]:focus-visible {
			outline: none;
			box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.35);
			border-radius: 12px;
		}

		.controls .speed {
			position: relative;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.controls .secondary-controls {
			display: flex;
			gap: 8px;
			align-items: center;
			margin-left: auto;
		}

		#control-fullscreen {
			margin-left: 0;
		}

		#speed-toggle {
			width: 44px;
			height: 44px;
			border-radius: 12px;
			border: none;
			cursor: pointer;
			display: grid;
			place-items: center;
			background: transparent;
			color: #f8fafc;
			font-size: 0.95rem;
			font-weight: 600;
			line-height: 1;
			transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
		}

		#speed-toggle:hover {
			background: transparent;
			box-shadow: none;
		}

		#speed-toggle:active {
			transform: scale(0.97);
		}

		.speed.open #speed-toggle {
			background: transparent;
			color: #f8fafc;
			box-shadow: none;
		}

		.speed-menu {
			position: absolute;
			bottom: 50px;
			right: 0;
			display: none;
			flex-direction: column;
			gap: 2px;
			padding: 8px 10px;
			border-radius: 12px;
			background: rgba(10, 15, 24, 0.92);
			box-shadow: 0 22px 44px rgba(0, 0, 0, 0.45);
			backdrop-filter: blur(12px);
			min-width: 100px;
			z-index: 5;
			max-height: calc(100vh - 200px);
			overflow-y: auto;
		}

		.speed-menu button {
			width: 100%;
			padding: 6px 10px;
			border-radius: 8px;
			border: none;
			background: transparent;
			color: rgba(226, 232, 240, 0.9);
			font-size: 0.9rem;
			text-align: left;
			cursor: pointer;
			transition: background 120ms ease, color 120ms ease;
		}

		.speed-menu button:hover,
		.speed-menu button:focus-visible {
			background: transparent;
			color: #e0f2fe;
		}

		.speed-menu button.active {
			background: transparent;
			color: #38bdf8;
		}

		.speed.open .speed-menu {
			display: flex;
		}

		.status {
			min-height: 1.5em;
			margin-top: 18px;
			color: rgba(148, 163, 184, 0.9);
			text-align: center;
		}

		@media (max-width: 680px) {
			body {
				align-items: flex-start;
				padding: 18px 0 26px;
			}

			.player-shell {
				width: calc(100% - 1px);
				margin: 0 auto;
				--shell-pad-x: 12px;
				--shell-pad-y: 28px;
				padding: var(--shell-pad-y) var(--shell-pad-x) !important;
				margin: 0 auto !important;
				border-radius: 18px;
			}

			h1 {
				font-size: 1.28rem;
				margin-bottom: 16px;
			}

			video {
				border-radius: 14px;
				height: 42vh;
				width: 100%;
				object-fit: fill;
			}
			
			.video-background {
				border-radius: 14px;
				height: 42vh;
			}

			.controls {
				gap: 8px;
				padding: 12px 14px 4px 14px;
				border-bottom-left-radius: 14px;
				border-bottom-right-radius: 14px;
			}

			.controls button,
			#speed-toggle {
				width: 36px;
				height: 36px;
				border-radius: 9px;
			}

			.controls .progress {
				order: 1;
				flex-basis: 100%;
				margin-top: 0;
			}

			.controls .primary-controls {
				order: 2;
				width: auto;
				margin-right: 0;
			}

			.controls .secondary-controls {
				order: 3;
				margin-left: auto;
			}

			.timecode {
				display: flex;
				align-items: center;
				height: 36px;
				font-size: 0.84rem;
				color: #f8fafc;
				margin-top: 0;
			}

			.speed-menu {
				bottom: 42px;
			}
		}
		
		@media (min-width: 431px) {
			.skip-button {
				margin-bottom: 8px;
			}
		}

		@media (max-width: 430px) {
			.player-shell {
				--shell-pad-x: 5px;
				--shell-pad-y: 22px;
				padding: var(--shell-pad-y) var(--shell-pad-x) !important;
			}

			.controls {
				padding: 10px 10px 14px;
				gap: 6px;
				border-bottom-left-radius: 12px;
				border-bottom-right-radius: 12px;
			}

			video {
				border-radius: 12px;
				height: 38vh;
				width: 100%;
				object-fit: fill;
			}
			
			.video-background {
				border-radius: 12px;
				height: 38vh;
			}
			
			.background-content {
				padding: 20px;
			}
			
			.background-level {
				font-size: 0.9rem;
				margin-bottom: 8px;
			}
			
			.background-unit {
				font-size: 1.3rem;
				margin-bottom: 6px;
			}
			
			.background-title {
				font-size: 1.8rem;
			}

			.timecode {
				display: flex;
				align-items: center;
				height: 32px;
				font-size: 0.8rem;
				color: #f8fafc;
				margin-top: 0;
			}

			.controls .progress input[type="range"]::-webkit-slider-thumb,
			.controls .progress input[type="range"]::-moz-range-thumb {
				width: 10px;
				height: 10px;
			}

			.speed-menu {
				bottom: 38px;
			}
		}

		a {
			color: #38bdf8;
		}

		.loading-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: none;
			align-items: center;
			justify-content: center;
			background: rgba(0, 0, 0, 0.5);
			backdrop-filter: blur(4px);
			z-index: 10;
			border-radius: 18px;
		}

		.loading-overlay.active {
			display: flex;
		}

		.spinner-container {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 16px;
		}

		.spinner {
			width: 48px;
			height: 48px;
			border: 4px solid rgba(56, 189, 248, 0.2);
			border-top-color: #38bdf8;
			border-radius: 50%;
			animation: spin 0.8s linear infinite;
		}

		.loading-text {
			color: #f8fafc;
			font-size: 0.95rem;
			font-weight: 500;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
		}

		@keyframes spin {
			to { transform: rotate(360deg); }
		}

		@media (max-width: 680px) {
			.loading-overlay {
				border-radius: 14px;
			}

			.spinner {
				width: 40px;
				height: 40px;
				border-width: 3px;
			}

			.loading-text {
				font-size: 0.88rem;
			}
		}

		@media (max-width: 430px) {
			.loading-overlay {
				border-radius: 12px;
			}

			.spinner {
				width: 36px;
				height: 36px;
			}

			.loading-text {
				font-size: 0.84rem;
			}
		}
	</style>
</head>
<body>
	<div class="player-shell">
		<h1 style="text-align: center;">Una fiesta</h1>
		<div class="loading-overlay" id="loading-overlay">
			<div class="spinner-container">
				<div class="spinner"></div>
				<div class="loading-text">Cargando video...</div>
			</div>
		</div>
		<div style="position: relative;">
			<div class="video-background visible" id="video-background">
				<div class="background-content">
					<div class="background-level">Español A1</div>
					<div class="background-unit">Unidad 1: Nosotros y nosotras</div>
					<div class="background-title">Una fiesta</div>
				</div>
			</div>
			<video id="player" src="https://ik.imagekit.io/b8cowcw9j/video1.mp4" preload="auto" playsinline tabindex="0">
				Tu navegador no puede reproducir este video.
			</video>
		</div>
		<div class="controls">
			<div class="progress" style="flex: 1 0 100%; order: 0;">
				<input id="seek" type="range" min="0" value="0" step="0.05" aria-label="Barra de progreso">
			</div>
			<div class="primary-controls" style="display: flex; flex-direction: row; align-items: center; gap: 12px;">
			<button id="control-play" type="button" aria-label="Reproducir" data-state="play">
				<svg class="icon icon-play" viewBox="0 0 32 32" aria-hidden="true"><path d="M10 6.5v19l16-9.5z"></path></svg>
				<svg class="icon icon-pause" viewBox="0 0 32 32" aria-hidden="true"><path d="M11 7h4v18h-4zm6 0h4v18h-4z"></path></svg>
				<svg class="icon icon-replay" viewBox="0 0 32 32" aria-hidden="true">
					<path d="M16 6 L16 2.5 L10.5 7 L16 11.5 L16 8 C20.4 8 24 11.6 24 16 C24 20.4 20.4 24 16 24 C11.6 24 8 20.4 8 16 L5 16 C5 22 9.9 27 16 27 C22.1 27 27 22 27 16 C27 10 22.1 5 16 5 Z"></path>
				</svg>
			</button>
				<div class="volume" id="volume-control">
					<button id="control-volume" type="button" aria-label="Silenciar" data-state="high" aria-haspopup="true" aria-expanded="false">
						<svg class="icon icon-volume-high" viewBox="0 0 32 32" aria-hidden="true"><path d="M6 12h5l6-5v18l-6-5H6zm15.5-6.5v3.3c2.2 0.9 3.5 2.6 3.5 4.7s-1.3 3.8-3.5 4.7v3.3c4-1.2 6.5-4.1 6.5-7.9s-2.6-6.7-6.5-7.9z"></path></svg>
						<svg class="icon icon-volume-muted" viewBox="0 0 32 32" aria-hidden="true"><path d="M6 12h5l6-5v18l-6-5H6zm16.8 3.6 2.6-2.6 1.6 1.6-2.6 2.6 2.6 2.6-1.6 1.6-2.6-2.6-2.6 2.6-1.6-1.6 2.6-2.6-2.6-2.6 1.6-1.6z"></path></svg>
					</button>
					<div class="volume-slider" id="volume-popover" role="presentation" aria-hidden="true">
						<input id="volume" type="range" min="0" max="1" step="0.01" value="1" aria-label="Volumen" orient="vertical">
					</div>
				</div>
				<div class="timecode" id="time">
					<span>00:00 / 00:00</span>
					<button id="rewind-10" type="button" aria-label="Retrasar 10 segundos" class="skip-button">
						<svg class="icon" viewBox="0 0 32 32" aria-hidden="true">
							<path d="M16 8c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8h-2c0 3.3-2.7 6-6 6s-6-2.7-6-6 2.7-6 6-6v3l4-4-4-4v3z"></path>
							<text x="16" y="18" text-anchor="middle" font-size="7" font-weight="bold" fill="currentColor">10</text>
						</svg>
					</button>
					<button id="forward-10" type="button" aria-label="Adelantar 10 segundos" class="skip-button">
						<svg class="icon" viewBox="0 0 32 32" aria-hidden="true">
							<path d="M16 8c4.4 0 8 3.6 8 8s-3.6 8-8 8-8-3.6-8-8h2c0 3.3 2.7 6 6 6s6-2.7 6-6-2.7-6-6-6v3l-4-4 4-4v3z"></path>
							<text x="16" y="18" text-anchor="middle" font-size="7" font-weight="bold" fill="currentColor">10</text>
						</svg>
					</button>
				</div>
		</div>
		<div class="secondary-controls">
			<div class="speed" id="speed-control">
				<button id="speed-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Cambiar velocidad">1x</button>
				<div id="speed-menu" class="speed-menu" role="menu" aria-label="Seleccionar velocidad">
					<button type="button" role="menuitemradio" data-rate="0.5">0,5×</button>
					<button type="button" role="menuitemradio" data-rate="0.75">0,75×</button>
					<button type="button" role="menuitemradio" data-rate="1" aria-checked="true">Normal</button>
					<button type="button" role="menuitemradio" data-rate="1.25">1,25×</button>
					<button type="button" role="menuitemradio" data-rate="1.5">1,5×</button>
					<button type="button" role="menuitemradio" data-rate="2">2×</button>
				</div>
			</div>
			<button id="control-fullscreen" type="button" aria-label="Pantalla completa" data-state="enter">
				<svg class="icon icon-enter" viewBox="0 0 32 32" aria-hidden="true"><path d="M6 6h8v2H8v6H6zm12 0h8v8h-2V8h-6zm6 12h2v8h-8v-2h6zm-14 6h6v2H6v-8h2z"></path></svg>
				<svg class="icon icon-exit" viewBox="0 0 32 32" aria-hidden="true">
					<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
						<path d="M16 13h-6.5V5.5"></path>
						<path d="M16 13h6.5V5.5"></path>
						<path d="M16 19h-6.5v7.5"></path>
						<path d="M16 19h6.5v7.5"></path>
					</g>
				</svg>
			</button>
		</div>
        </div>
	</div>
	<p id="status" class="status" role="alert"></p>
	<script>
		const statusEl = document.getElementById("status");
		const player = document.getElementById("player");
		const loadingOverlay = document.getElementById("loading-overlay");
		const playBtn = document.getElementById("control-play");
		const seek = document.getElementById("seek");
		const timecode = document.getElementById("time");
		const timecodeText = timecode.querySelector("span");
		const volumeBtn = document.getElementById("control-volume");
		const volumeControl = document.getElementById("volume-control");
		const volumePopover = document.getElementById("volume-popover");
		const volumeSlider = document.getElementById("volume");
		const fullBtn = document.getElementById("control-fullscreen");
		const speedControl = document.getElementById("speed-control");
		const speedToggle = document.getElementById("speed-toggle");
		const speedMenu = document.getElementById("speed-menu");
		const speedOptions = [...speedMenu.querySelectorAll("button[data-rate]")];
		const rewindBtn = document.getElementById("rewind-10");
		const forwardBtn = document.getElementById("forward-10");
		let volumeCycleStage = 0;
		let lastVolume = Number(volumeSlider.value) || 1;

		const formatTime = (seconds) => {
			if (!Number.isFinite(seconds)) {
				return "00:00";
			}
			const total = Math.max(seconds, 0);
			const h = Math.floor(total / 3600);
			const m = Math.floor((total % 3600) / 60);
			const s = Math.floor(total % 60);
			const base = `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
			return h > 0 ? `${h}:${base}` : base;
		};

		const updateSeekVisual = () => {
			if (!seek.max) {
				return;
			}
			const percent = (seek.value / seek.max) * 100;
			seek.style.setProperty("--seek-filled", `${percent}%`);
		};

		const updateVolumeVisual = () => {
			const percent = Number(volumeSlider.value) * 100;
			volumeSlider.style.setProperty("--volume-filled", `${percent}%`);
		};

		const openVolumeMenu = () => {
			volumeControl.classList.add("open");
			volumeBtn.setAttribute("aria-expanded", "true");
			volumePopover.setAttribute("aria-hidden", "false");
		};

		const closeVolumeMenu = (resetStage = false) => {
			volumeControl.classList.remove("open");
			volumeBtn.setAttribute("aria-expanded", "false");
			volumePopover.setAttribute("aria-hidden", "true");
			if (resetStage) {
				volumeCycleStage = 0;
			}
		};

		const syncTime = () => {
			const duration = Number.isFinite(player.duration) ? player.duration : 0;
			timecodeText.textContent = `${formatTime(player.currentTime)} / ${formatTime(duration)}`;
			seek.value = player.currentTime;
			updateSeekVisual();
		};

	const togglePlay = () => {
		if (player.ended || playBtn.dataset.state === "replay") {
			player.currentTime = 0;
			player.play().catch(() => {});
		} else if (player.paused) {
			player.play().catch(() => {});
		} else {
			player.pause();
		}
	};		const updatePlayButton = () => {
			playBtn.dataset.state = player.paused ? "play" : "pause";
			playBtn.setAttribute("aria-label", player.paused ? "Reproducir" : "Pausar");
		};

		const updateVolumeButton = () => {
			const muted = player.muted || player.volume === 0;
			volumeBtn.dataset.state = muted ? "mute" : "high";
			volumeBtn.setAttribute("aria-label", muted ? "Activar sonido" : "Silenciar");
		};

		const toggleMute = () => {
			player.muted = !player.muted;
		};

		const toggleFullscreen = () => {
			if (!document.fullscreenElement) {
				player.parentElement.requestFullscreen?.();
			} else {
				document.exitFullscreen?.();
			}
		};

		const updateFullscreenButton = () => {
			const active = Boolean(document.fullscreenElement);
			fullBtn.dataset.state = active ? "exit" : "enter";
			fullBtn.setAttribute("aria-label", active ? "Salir de pantalla completa" : "Pantalla completa");
		};

		const formatRate = (rate) => rate.toLocaleString("es-ES", { maximumFractionDigits: 2 });

		const closeSpeedMenu = () => {
			speedControl.classList.remove("open");
			speedToggle.setAttribute("aria-expanded", "false");
			speedMenu.setAttribute("aria-hidden", "true");
		};

		const openSpeedMenu = () => {
			speedControl.classList.add("open");
			speedToggle.setAttribute("aria-expanded", "true");
			speedMenu.setAttribute("aria-hidden", "false");
		};

		const toggleSpeedMenu = () => {
			if (speedControl.classList.contains("open")) {
				closeSpeedMenu();
			} else {
				openSpeedMenu();
				const active = speedOptions.find((btn) => btn.classList.contains("active"));
				active?.focus({ preventScroll: true });
			}
		};

		const updateSpeedVisuals = () => {
			const current = player.playbackRate;
			const label = current === 1 ? "1x" : `${formatRate(current)}x`;
			speedToggle.textContent = label;
			speedOptions.forEach((button) => {
				const rate = Number(button.dataset.rate);
				const active = Math.abs(rate - current) < 0.011;
				button.classList.toggle("active", active);
				button.setAttribute("aria-checked", active ? "true" : "false");
			});
		};

	playBtn.addEventListener("click", togglePlay);
	player.addEventListener("click", togglePlay);
	player.addEventListener("play", updatePlayButton);
	player.addEventListener("pause", updatePlayButton);
	player.addEventListener("ended", () => {
		playBtn.dataset.state = "replay";
		playBtn.setAttribute("aria-label", "Reiniciar");
	});
	
	// Control de visibilidad del fondo informativo
	const videoBackground = document.getElementById("video-background");
	
	player.addEventListener("play", () => {
		if (videoBackground) {
			videoBackground.classList.remove("visible");
		}
	});
	
	player.addEventListener("ended", () => {
		if (videoBackground) {
			videoBackground.classList.add("visible");
		}
	});
	
	player.addEventListener("loadedmetadata", () => {
			const duration = Number.isFinite(player.duration) ? player.duration : 0;
			seek.max = duration;
			seek.disabled = duration === 0;
			syncTime();
			statusEl.textContent = "";
		});

		player.addEventListener("timeupdate", syncTime);

		seek.addEventListener("input", () => {
			const newTime = Number(seek.value);
			player.currentTime = newTime;
			const duration = Number.isFinite(player.duration) ? player.duration : 0;
			timecodeText.textContent = `${formatTime(newTime)} / ${formatTime(duration)}`;
			updateSeekVisual();
		});

		volumeSlider.addEventListener("input", () => {
			const level = Number(volumeSlider.value);
			player.volume = level;
			if (level > 0) {
				lastVolume = level;
				if (player.muted) {
					player.muted = false;
				}
			}
			updateVolumeVisual();
		});

		player.addEventListener("volumechange", () => {
			const current = player.muted ? 0 : player.volume;
			volumeSlider.value = current;
			if (!player.muted && current > 0) {
				lastVolume = current;
			}
			updateVolumeButton();
			updateVolumeVisual();
		});

		volumeBtn.addEventListener("click", (event) => {
			event.stopPropagation();
			const isMuted = player.muted || Number(volumeSlider.value) === 0;
			if (isMuted) {
				player.muted = false;
				const restored = lastVolume > 0 ? lastVolume : 0.5;
				player.volume = restored;
				openVolumeMenu();
				volumeSlider.focus({ preventScroll: true });
				volumeCycleStage = 1;
				return;
			}
			if (volumeCycleStage === 0) {
				openVolumeMenu();
				volumeSlider.focus({ preventScroll: true });
				volumeCycleStage = 1;
				return;
			}
			if (volumeCycleStage === 1) {
				closeVolumeMenu();
				volumeCycleStage = 2;
				return;
			}
			if (volumeCycleStage === 2) {
				lastVolume = Number(volumeSlider.value) || lastVolume || 0.5;
				player.muted = true;
				closeVolumeMenu(true);
				volumeCycleStage = 0;
				return;
			}
			// Fallback: reset and open
			volumeCycleStage = 0;
			openVolumeMenu();
		});

		volumePopover.addEventListener("click", (event) => event.stopPropagation());
		volumeSlider.addEventListener("focus", () => {
			openVolumeMenu();
			if (volumeCycleStage < 1) {
				volumeCycleStage = 1;
			}
		});
		volumeSlider.addEventListener("pointerdown", (event) => event.stopPropagation());
		volumeSlider.addEventListener("mousedown", (event) => event.stopPropagation());
		volumeSlider.addEventListener("touchstart", (event) => event.stopPropagation(), { passive: true });

		fullBtn.addEventListener("click", toggleFullscreen);
		document.addEventListener("fullscreenchange", updateFullscreenButton);
		
		// Botones de adelantar y retrasar
		rewindBtn.addEventListener("click", () => {
			player.currentTime = Math.max(0, player.currentTime - 10);
		});
		
		forwardBtn.addEventListener("click", () => {
			player.currentTime = Math.min(player.duration, player.currentTime + 10);
		});

		speedToggle.addEventListener("click", toggleSpeedMenu);

		speedOptions.forEach((button) => {
			button.addEventListener("click", () => {
				const rate = Number(button.dataset.rate);
				player.playbackRate = rate;
				updateSpeedVisuals();
				closeSpeedMenu();
				speedToggle.focus({ preventScroll: true });
			});
		});

		document.addEventListener("click", (event) => {
			if (!speedControl.contains(event.target)) {
				closeSpeedMenu();
			}
			if (!volumeControl.contains(event.target)) {
				closeVolumeMenu(true);
			}
		});

		document.addEventListener("keydown", (event) => {
			if (event.key !== "Escape") {
				return;
			}
			let handled = false;
			if (speedControl.classList.contains("open")) {
				closeSpeedMenu();
				speedToggle.focus({ preventScroll: true });
				handled = true;
			}
			if (volumeControl.classList.contains("open")) {
				closeVolumeMenu(true);
				volumeBtn.focus({ preventScroll: true });
				handled = true;
			}
			if (handled) {
				event.preventDefault();
			}
		});

		player.addEventListener("ratechange", updateSpeedVisuals);

		player.addEventListener("keydown", (event) => {
			if (event.code === "Space") {
				event.preventDefault();
				togglePlay();
			}
		});

		// Mostrar spinner cuando el video está esperando datos
		player.addEventListener("waiting", () => {
			loadingOverlay.classList.add("active");
		});

		// Ocultar spinner cuando el video puede reproducirse
		player.addEventListener("canplay", () => {
			loadingOverlay.classList.remove("active");
		});

		// Ocultar spinner cuando el video empieza a reproducirse
		player.addEventListener("playing", () => {
			loadingOverlay.classList.remove("active");
		});

		// Mostrar spinner durante la carga inicial
		player.addEventListener("loadstart", () => {
			loadingOverlay.classList.add("active");
		});

	player.addEventListener("error", () => {
		loadingOverlay.classList.remove("active");
		statusEl.textContent = "";
	});		player.volume = Number(volumeSlider.value);
		lastVolume = player.volume || lastVolume;
		updatePlayButton();
		updateVolumeButton();
		updateFullscreenButton();
		updateSeekVisual();
		updateVolumeVisual();
		player.playbackRate = 1;
		updateSpeedVisuals();
		closeSpeedMenu();
		closeVolumeMenu(true);
	</script>
</body>
</html>
