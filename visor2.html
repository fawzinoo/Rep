<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Visor PDF Profesional</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body {
			font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: #000;
			margin: 0;
			padding: 0;
			overflow: hidden;
			position: relative;
			touch-action: none;
			user-select: none;
		}
		
		.pdf-viewer-container {
			width: 100vw;
			height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			overflow: hidden;
		}
		
		.side-arrow {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			z-index: 2000;
			width: 60px;
			height: 60px;
			border-radius: 50%;
			background: rgba(0,0,0,0.5);
			color: #fff;
			border: none;
			font-size: 2.5rem;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: background 0.2s, transform 0.2s;
			box-shadow: 0 4px 16px rgba(0,0,0,0.2);
			opacity: 0.8;
		}
		
		.side-arrow:hover {
			background: rgba(0,0,0,0.8);
			transform: translateY(-50%) scale(1.1);
			opacity: 1;
		}
		
		.left-arrow { left: 10px; }
		.right-arrow { right: 10px; }
		
		.floating-controls {
			position: absolute;
			top: 20px;
			right: 20px;
			display: flex;
			flex-direction: column;
			gap: 10px;
			z-index: 1000;
		}
		
		.exercise-input {
			width: 150px;
			padding: 8px 12px;
			border-radius: 20px;
			background: rgba(0, 0, 0, 0.6);
			border: none;
			color: white;
			font-size: 14px;
			font-weight: 500;
			backdrop-filter: blur(10px);
			outline: none;
		}
		
		.select-btn {
			padding: 8px 12px;
			border-radius: 12px;
			background: rgba(255,255,255,0.06);
			color: #fff;
			border: 1px solid rgba(255,255,255,0.06);
			cursor: pointer;
		}
		
		.showall-btn {
			padding: 8px 12px;
			border-radius: 12px;
			background: rgba(0,0,0,0.6);
			color: #fff;
			border: none;
			cursor: pointer;
		}
		
		.zone-rect {
			position: absolute;
			border: 2px dashed rgba(255,255,255,0.9);
			background: rgba(255,255,255,0.06);
			pointer-events: none;
			z-index: 2500;
		}
		
		.page-counter {
			position: absolute;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0, 0, 0, 0.6);
			color: white;
			padding: 8px 16px;
			border-radius: 20px;
			font-size: 14px;
			font-weight: 500;
			z-index: 1000;
			backdrop-filter: blur(10px);
			transition: all 0.3s ease;
		}
		
		.floating-controls button {
			width: 50px;
			height: 50px;
			border-radius: 50%;
			background: rgba(0, 0, 0, 0.6);
			border: none;
			color: white;
			font-size: 18px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all 0.3s ease;
			backdrop-filter: blur(10px);
		}
		
		.floating-controls button:hover {
			background: rgba(0, 0, 0, 0.8);
			transform: scale(1.1);
		}
		
		#pdf-canvas {
			width: 100vw !important;
			border: none;
			display: block;
			background: #fff;
			object-fit: contain;
			position: absolute;
			top: 0;
			left: 50%;
			transform: translateX(-50%);
		}

		/* Imagen del ejercicio: cubrir completamente la ventana sin barras negras */
		#exercise-img {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 100vw;     /* ajustar siempre al ancho */
			height: auto;     /* altura se ajusta proporcionalmente */
			max-height: 100vh; /* evitar desbordes verticales */
			display: none;
			z-index: 2400;
			transition: opacity 220ms ease-in-out, transform 220ms ease-in-out;
			opacity: 0;
			background: transparent;
		}
		
		.loading {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: white;
			font-size: 18px;
			font-weight: 500;
		}
		
		@media (max-width: 768px) {
			.floating-controls {
				top: 15px;
				right: 15px;
				gap: 8px;
			}
			
			.floating-controls button {
				width: 45px;
				height: 45px;
				font-size: 16px;
			}
		}
		
		@media (max-width: 480px) {
			.floating-controls {
				top: 10px;
				right: 10px;
				gap: 6px;
			}
			
			.floating-controls button {
				width: 40px;
				height: 40px;
				font-size: 14px;
			}
		}
		
		@media (max-width: 600px) {
			.side-arrow {
				width: 44px;
				height: 44px;
				font-size: 1.7rem;
			}
			.left-arrow { left: 2px; }
			.right-arrow { right: 2px; }
		}

		/* En móviles: la imagen debe ocupar todo el alto y ajustar el ancho proporcionalmente */
		@media (max-width: 768px) {
			#exercise-img {
				top: 0;
				left: 50%;
				transform: translateX(-50%);
				width: auto;    /* el ancho depende de la pantalla */
				height: 100vh;  /* ocupa todo el alto */
				max-width: 100vw; /* evitar desbordes horizontales */
				max-height: none; /* ya fijamos altura */
			}
		}
	</style>
</head>
<body>
	<div class="pdf-viewer-container">
		<button class="side-arrow left-arrow" id="prev-page" title="Página anterior">&#8592;</button>
		<button class="side-arrow right-arrow" id="next-page" title="Página siguiente">&#8594;</button>
		<div id="exercise-selector" style="position:absolute;top:18px;left:50%;transform:translateX(-50%);z-index:3000;display:flex;align-items:center;gap:8px;background:rgba(0,0,0,0.7);padding:8px 14px;border-radius:18px;">
			<label style="color:#fff;font-weight:600;margin-right:6px;">Ejercicio</label>
			<input id="exercise-input" type="number" min="1" max="28" value="1" style="width:56px;padding:6px;border-radius:8px;border:none;outline:none;font-size:1rem;" />
			<button id="show-exercise-btn" style="background:#ffb300;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600;">Ver</button>
			<button id="show-all-btn" style="background:#666;color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600;">Todo</button>
			<button id="check-missing-btn" title="Comprobar imágenes faltantes" style="background:#444;color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600;">Ver faltantes</button>
		</div>
		<div class="floating-controls">
			<button id="zoom-out" title="Zoom -">−</button>
			<button id="zoom-in" title="Zoom +">+</button>
		</div>
		
		<div class="page-counter" id="page-counter">Cargando...</div>
		<div class="loading" id="loading">Cargando PDF...</div>
		
		<canvas id="pdf-canvas"></canvas>
		<img id="exercise-img" alt="Ejercicio" />
	</div>
	<script>
		// Configurar PDF.js worker
		pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
		
		// Variables globales
		const urlDefault = 'https://fawzinoo.github.io/Rep/U11.pdf';
		let pdfDoc = null;
		let currentPage = 1;
		let totalPages = 0;
		let zoomLevel = 1.0; // Empezar con zoom 1.0 para pantalla completa
		let canvas = null;
		let ctx = null;

		// Base de imágenes (ajusta si guardas en otro sitio)
		const baseImageUrl = 'https://fawzinoo.github.io/Fotos/';
		const imageLinks = Array.from({ length: 28 }, (_, i) => `${baseImageUrl}U1E${i+1}.png`);
		const exerciseImg = document.getElementById('exercise-img');
		
		// Inicializar canvas
		canvas = document.getElementById('pdf-canvas');
		ctx = canvas.getContext('2d');
		

		// Permitir modificar el ancho y el alto visual de la página PDF
		const widthFactor = 1.0; // Cambia este valor para hacer la página más ancha (>1) o más estrecha (<1)
		const heightFactor = 0.8; // Ligeramente más alto que el original

		function renderPage(pageNum) {
		   const loading = document.getElementById('loading');
		   loading.style.display = 'block';

		   pdfDoc.getPage(pageNum).then(function(page) {
			   // Obtener dimensiones de la pantalla
			   const containerWidth = window.innerWidth;
			   const containerHeight = window.innerHeight;
			   const dpr = window.devicePixelRatio || 1;

			   // Calcular el scale para que ocupe toda la pantalla
			   const viewport = page.getViewport({ scale: 1 });
			   const scaleX = (containerWidth / viewport.width) * widthFactor;
			   const scaleY = containerHeight / viewport.height;
			   // Priorizar el alto y aumentar un 25% para que la página se vea aún más alta
			   const scale = scaleY * 1.25 * dpr * zoomLevel;

			   // Viewport escalado para alta resolución
			   const scaledViewport = page.getViewport({ scale: scale });

			   // Ajustar el tamaño interno del canvas (alta resolución)
			   canvas.width = scaledViewport.width;
			   canvas.height = scaledViewport.height;

			   // Ajustar el tamaño visual del canvas (pantalla)
			   canvas.style.width = ((scaledViewport.width / dpr) / widthFactor) + 'px';
			   canvas.style.height = ((scaledViewport.height / dpr) * heightFactor) + 'px';
			   canvas.style.objectFit = 'fill';

			   const renderContext = {
				   canvasContext: ctx,
				   viewport: scaledViewport
			   };

			   page.render(renderContext).promise.then(function() {
				   loading.style.display = 'none';
				   updatePageCounter();
			   });
		   });
		}

		// Mostrar imagen desde enlaces con reintento png->jpg, fallback a PDF
		function showImageByNumber(n) {
			const url = imageLinks[n-1];
			if (!url) {
				// fallback
				document.getElementById('exercise-img').style.display = 'none';
				document.getElementById('pdf-canvas').style.display = 'block';
				renderPage(currentPage);
				return;
			}

			// Preload: usar Image() para comprobar existencia y dimensiones antes de mostrar
			const probe = new Image();
			probe.crossOrigin = 'anonymous';
			probe.onload = function() {
				// Ocultar canvas y mostrar imagen con transición de opacidad
				document.getElementById('pdf-canvas').style.display = 'none';
				exerciseImg.style.display = 'block';
				exerciseImg.style.opacity = '0';
				exerciseImg.src = probe.src; // asignar la URL ya cargada
				// Forzar repaint y luego animar la opacidad
				requestAnimationFrame(() => {
					exerciseImg.style.opacity = '1';
				});
			};

			probe.onerror = function() {
				// Si falla png, intentar jpg
				if (url.endsWith('.png')) {
					const alt = url.replace(/\.png$/, '.jpg');
					const probe2 = new Image();
					probe2.crossOrigin = 'anonymous';
					probe2.onload = function() {
						document.getElementById('pdf-canvas').style.display = 'none';
						exerciseImg.style.display = 'block';
						exerciseImg.style.opacity = '0';
						exerciseImg.src = probe2.src;
						requestAnimationFrame(() => { exerciseImg.style.opacity = '1'; });
					};
					probe2.onerror = function() {
						// fallback final a PDF
						exerciseImg.style.display = 'none';
						document.getElementById('pdf-canvas').style.display = 'block';
						renderPage(currentPage);
					};
					probe2.src = alt;
				} else {
					// fallback a PDF
					exerciseImg.style.display = 'none';
					document.getElementById('pdf-canvas').style.display = 'block';
					renderPage(currentPage);
				}
			};

			// Iniciar probe con la URL original
			probe.src = url;
		}
		
		// Actualizar contador de páginas
		function updatePageCounter() {
			const pageCounter = document.getElementById('page-counter');
			pageCounter.textContent = `Página ${currentPage} de ${totalPages}`;
			
			// Habilitar/deshabilitar botones
			document.getElementById('prev-page').style.opacity = currentPage <= 1 ? '0.3' : '1';
			document.getElementById('next-page').style.opacity = currentPage >= totalPages ? '0.3' : '1';
		}
		
		// Navegación por páginas
		function nextPage() {
			if (currentPage < totalPages) {
				currentPage++;
				renderPage(currentPage);
			}
		}
		
		function prevPage() {
			if (currentPage > 1) {
				currentPage--;
				renderPage(currentPage);
			}
		}
		
		// Controles de zoom
		function zoomIn() {
			if (zoomLevel < 2.0) {
				zoomLevel += 0.2;
				renderPage(currentPage);
			}
		}
		
		function zoomOut() {
			if (zoomLevel > 0.6) {
				zoomLevel -= 0.2;
				renderPage(currentPage);
			}
		}
		
		// Sonido de paso de página
		const pageSound = new Audio('https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa4c3b.mp3');
		
		// Animación de transición tipo libro
		function animatePage(direction) {
			const canvas = document.getElementById('pdf-canvas');
			canvas.style.transition = 'transform 0.45s cubic-bezier(.77,0,.18,1)';
			canvas.style.transform = direction === 'right'
				? 'translateX(-50%) rotateY(-30deg) scale(0.96)'
				: 'translateX(-50%) rotateY(30deg) scale(0.96)';
			setTimeout(() => {
				canvas.style.transform = 'translateX(-50%)';
			}, 450);
		}
		
		// Event listeners
		document.getElementById('next-page').onclick = function() {
			animatePage('right');
			pageSound.currentTime = 0; pageSound.play();
			setTimeout(nextPage, 220);
		};
		
		document.getElementById('prev-page').onclick = function() {
			animatePage('left');
			pageSound.currentTime = 0; pageSound.play();
			setTimeout(prevPage, 220);
		};
		
		document.getElementById('zoom-in').addEventListener('click', zoomIn);
		document.getElementById('zoom-out').addEventListener('click', zoomOut);

		document.getElementById('show-exercise-btn').onclick = function() {
			const n = parseInt(document.getElementById('exercise-input').value, 10);
			if (!n || n < 1 || n > imageLinks.length) return alert('Número entre 1 y ' + imageLinks.length);
			showImageByNumber(n);
		};

		document.getElementById('show-all-btn').onclick = function() {
			document.getElementById('exercise-img').style.display = 'none';
			document.getElementById('pdf-canvas').style.display = 'block';
			renderPage(currentPage);
		};



		// Comprobar qué imágenes faltan (útil para depuración)
		function checkMissingImages() {
			const missing = [];
			let checked = 0;
			imageLinks.forEach((url, idx) => {
				const p = new Image();
				p.crossOrigin = 'anonymous';
				p.onload = function() {
					checked++;
					if (checked === imageLinks.length) {
						if (missing.length) alert('Faltan imágenes para: ' + missing.join(', '));
						else alert('Todas las imágenes responden correctamente.');
					}
				};
				p.onerror = function() {
					missing.push(idx+1);
					checked++;
					if (checked === imageLinks.length) {
						if (missing.length) alert('Faltan imágenes para: ' + missing.join(', '));
						else alert('Todas las imágenes responden correctamente.');
					}
				};
				p.src = url;
			});
		}

		document.getElementById('check-missing-btn').addEventListener('click', checkMissingImages);
		
		// Navegación con teclado
		document.addEventListener('keydown', function(e) {
			if (e.key === 'ArrowRight' || e.key === ' ') {
				e.preventDefault();
				nextPage();
			} else if (e.key === 'ArrowLeft') {
				e.preventDefault();
				prevPage();
			}
		});
		
		// Bloquear scroll
		document.addEventListener('wheel', function(e) {
			e.preventDefault();
		}, { passive: false });
		
		document.addEventListener('touchmove', function(e) {
			e.preventDefault();
		}, { passive: false });
		
		// Ocultar controles automáticamente
		let hideControlsTimeout;
		
		function showControls() {
			const controls = document.querySelector('.floating-controls');
			const pageCounter = document.querySelector('.page-counter');
			controls.style.opacity = '1';
			pageCounter.style.opacity = '1';
			clearTimeout(hideControlsTimeout);
			hideControlsTimeout = setTimeout(() => {
				controls.style.opacity = '0.3';
				pageCounter.style.opacity = '0.3';
			}, 3000);
		}
		
		document.addEventListener('mousemove', showControls);
		document.addEventListener('touchstart', showControls);
		
		// Cargar PDF
		pdfjsLib.getDocument(urlDefault).promise.then(function(pdfDoc_) {
			pdfDoc = pdfDoc_;
			totalPages = pdfDoc.numPages;
			
			// Renderizar primera página
			renderPage(currentPage);
			showControls();
		}).catch(function(error) {
			console.error('Error cargando PDF:', error);
			document.getElementById('loading').textContent = 'Error: No se pudo cargar el PDF';
		});
		
		// Redimensionar al cambiar tamaño de ventana
		window.addEventListener('resize', function() {
			if (pdfDoc) {
				renderPage(currentPage);
			}
		});
	</script>
</body>
</html>
